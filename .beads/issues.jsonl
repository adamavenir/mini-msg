{"id":"fray-014","title":"Add join/leave event messages","description":"Generate event-type messages for agent lifecycle:\n\n- `fray new agent`: Post event 'agent joined'\n- `fray back agent` (after bye): Post event 'agent rejoined' \n- `fray back agent` (no prior bye): Post event 'new session: agent' (handoff indicator)\n- `fray bye agent`: Post event 'agent left'\n\nThese are type='event' messages (not regular agent messages).\n\nBenefits:\n- Shows handoff history in chat\n- Reduces verbosity vs always showing in real-time\n- Provides context for read_to positions","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-31T00:08:05.328679-08:00","created_by":"adam","updated_at":"2025-12-31T05:53:48.488258-08:00","closed_at":"2025-12-31T05:53:48.488258-08:00","close_reason":"Implemented join/leave/session events: new posts '@agent joined', bye posts '@agent left', back posts '@agent rejoined' or 'new @agent session'"}
{"id":"fray-08qo","title":"Extract chat/messages.go from model.go","description":"Extract message formatting: formatMessage(), replyContext(), renderMessages(), renderByline(), formatReactionSummary(), reaction diffing, message filtering, newEventMessage(), messageAtLine(). ~600 lines.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-31T23:53:42.814054-08:00","created_by":"adam","updated_at":"2025-12-31T23:53:42.814054-08:00","dependencies":[{"issue_id":"fray-08qo","depends_on_id":"fray-eg25","type":"blocks","created_at":"2025-12-31T23:53:49.515417-08:00","created_by":"adam"}]}
{"id":"fray-08v","title":"Phase 2: Database Layer","description":"Schema initialization and typed query functions for bdm.\n\n## Goal\nA complete database layer that:\n- Discovers and connects to the beads SQLite database\n- Initializes bdm-specific tables (agents, messages, linked_projects, config)\n- Provides typed query functions for all CRUD operations\n\n## Context\nbdm extends the beads SQLite database (`.beads/*.db`) with its own tables.\nThis follows the beads extension pattern documented in EXTENDING.md.\n\nTables:\n- bdm_agents: Agent presence and identity\n- bdm_messages: Room messages with @mentions\n- bdm_linked_projects: Cross-project aliases\n- bdm_config: Settings (e.g., stale_hours)\n\nSee PLAN.md \"Schema\" section for full SQL definitions.\n\n## Exit Criteria\n- Schema creates correctly in beads DB\n- All query functions have unit tests\n- Types match schema exactly","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-04T09:57:56.726228-08:00","updated_at":"2025-12-19T22:57:34.296646-08:00","closed_at":"2025-12-04T12:24:15.535466-08:00","dependencies":[{"issue_id":"fray-08v","depends_on_id":"fray-kit","type":"blocks","created_at":"2025-12-04T10:01:18.169717-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-09h","title":"P1: Core Types \u0026 Storage","description":"Port data layer: types (Agent with status/purpose fields, Message, Claim, Channel), JSONL storage (append/read), SQLite schema with migrations (including goal-\u003estatus, bio-\u003epurpose rename), database queries with cursor pagination. ~8 hours.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T12:17:16.333962-08:00","updated_at":"2025-12-21T01:27:06.004846-08:00","closed_at":"2025-12-21T01:27:06.004846-08:00","close_reason":"Completed in Go rewrite","dependencies":[{"issue_id":"fray-09h","depends_on_id":"fray-n0h","type":"blocks","created_at":"2025-12-20T12:22:05.535897-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-0od","title":"Investigate beads daemon architecture","description":"Investigate how beads implements its per-project daemon and determine how bdm should integrate.\n\n## Context\n\n**bdm** (beads-messenger) is a CLI for agent-to-agent messaging in beads projects. We want to add an MCP server so Claude Desktop can participate in chat rooms. Before implementing, we need to understand how beads handles daemons.\n\n**MCP** (Model Context Protocol) is Anthropic's protocol for connecting Claude to external tools/data. MCP servers expose:\n- **Tools**: Actions Claude can call (like `bdm_post`)\n- **Resources**: Data loaded into Claude's context (like room messages)\n\n**Why investigate beads daemon?** beads reportedly uses one daemon per project. We need to understand this before deciding whether bdm's MCP server should:\n- Extend the beads daemon\n- Run its own daemon\n- Be stateless (no daemon)\n\n## Questions to Answer\n\n1. **How does the beads daemon work?**\n   - What triggers daemon startup?\n   - How does it discover/bind to a project?\n   - What does it serve? (HTTP? Unix socket? IPC?)\n   - How long does it live? Auto-shutdown on idle?\n\n2. **Where is the daemon code?**\n   - Find the daemon implementation in beads source\n   - Understand the architecture\n\n3. **Extension points**\n   - Can beads daemon be extended with plugins?\n   - Should bdm add its own endpoints to beads daemon?\n   - Or run a separate daemon that coordinates with beads?\n\n4. **MCP server patterns**\n   - How do other MCP servers handle per-project state?\n   - Does MCP SDK support daemon mode or is it stdio-per-call?\n   - Look at: https://modelcontextprotocol.io/docs\n\n## How to Investigate\n\n```bash\n# beads source is likely at ~/dev/beads or similar\n# Search for daemon-related code:\ngrep -r \"daemon\" --include=\"*.go\" ~/dev/beads\ngrep -r \"server\" --include=\"*.go\" ~/dev/beads\ngrep -r \"listen\" --include=\"*.go\" ~/dev/beads\n\n# Check MCP SDK docs\n# https://modelcontextprotocol.io/docs\n```\n\n## Deliverable\n\nWrite findings to PLAN-mcp.md or comment on this issue with:\n- Summary of beads daemon architecture\n- Recommended approach for bdm MCP server\n- Risks and tradeoffs\n\n## Parent Epic\n\nbdm-ae4: MCP Server for Claude Desktop Integration","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-05T16:35:05.067265-08:00","updated_at":"2025-12-19T22:57:34.29496-08:00","closed_at":"2025-12-05T17:28:30.12919-08:00"}
{"id":"fray-0sk","title":"Fix agent ID format documentation","description":"Update README to show simple names (alice, bob) as primary format, note versioned format (alice.1) as legacy/internal","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T19:55:18.057926-08:00","updated_at":"2025-12-19T22:57:34.311678-08:00","closed_at":"2025-12-17T20:03:36.765684-08:00","close_reason":"Closed"}
{"id":"fray-0sq","title":"Create chat core logic","description":"Create the core chat session logic for polling and sending messages.\n\n## New File: src/chat/core.ts\n\n```typescript\nexport interface ChatSession {\n  username: string;\n  projectName: string;\n  db: Database.Database;\n  lastMessageId: number;\n}\n\nexport function createSession(opts: {\n  db: Database.Database;\n  projectName: string;\n  username: string;\n  lastMessageId?: number;\n}): ChatSession;\n\nexport function pollNewMessages(session: ChatSession): Message[];\n\nexport function sendUserMessage(session: ChatSession, body: string): Message;\n```\n\n## Behavior\n\n### pollNewMessages\n- Query messages with `since: session.lastMessageId`\n- Update `session.lastMessageId` to latest\n- Return array of new messages\n\n### sendUserMessage\n- Extract mentions from body\n- Create message with `type: 'user'` and `from_agent: session.username`\n- Return created message for immediate display\n\n## Exit Criteria\n- Session tracks state correctly\n- Polling returns only new messages\n- User messages have correct type and sender\n- Unit tests for core functions","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-05T15:50:18.291387-08:00","updated_at":"2025-12-19T22:57:34.313652-08:00","closed_at":"2025-12-05T15:57:14.250773-08:00"}
{"id":"fray-0vz","title":"P8: Remaining Commands","description":"Port remaining commands: here, bye, whoami, who, thread, history, between, @agent, claim, claims, clear, status, watch, prune, nick/nicks, config, roster, info. Note: Agent fields are 'status' (current task) and 'purpose' (identity), not 'goal'/'bio'. ~6 hours.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T12:17:52.620646-08:00","updated_at":"2025-12-21T01:27:06.006531-08:00","closed_at":"2025-12-21T01:27:06.006531-08:00","close_reason":"Completed in Go rewrite","dependencies":[{"issue_id":"fray-0vz","depends_on_id":"fray-lz9","type":"blocks","created_at":"2025-12-20T12:22:41.751233-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-0wr","title":"Bug: /prune --all does not prune all messages","description":"The --all flag should prune ALL messages (0 remaining), but currently leaves some behind. Fix the prune logic so --all truly removes everything.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-22T12:09:15.846479-08:00","updated_at":"2025-12-22T12:12:19.567689-08:00","closed_at":"2025-12-22T12:12:19.567689-08:00","close_reason":"Fixed by agents"}
{"id":"fray-0z5","title":"Investigate integration strategy","description":"We need to develop a strategy for beads-messenger that makes it trivial for users to onboard agents. The goal should be 3 steps:\n\n- run npm install\n- config/setup (even better if also a command)\n- onboard agent (should be a command - 'new' could onboard them AND update them in one command)\n\nLook at claude code hooks, claude code skills, beads' `bd quickstart` example for onboarding.\n\nWe also need to create an MCP interface for Claude Desktop App, which can't necessarily use a cli but can use an MCP server that makes calls locally.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-04T22:53:00.040842-08:00","updated_at":"2025-12-19T22:57:34.314197-08:00","closed_at":"2025-12-06T09:05:04.57424-08:00","labels":["creator:adamavenir@hey.com","fizzy:maybe"]}
{"id":"fray-13a","title":"Rename 'status: active' to 'here: true|false' in roster","description":"In roster output, 'status: active' is confusing - it indicates presence (would show in 'mm here') not the agent's status field.\n\nChange to 'here: true' or 'here: false' to be consistent with the 'mm here' command and avoid confusion with the actual status field.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-21T12:27:34.86269-08:00","updated_at":"2025-12-21T15:54:51.483543-08:00","closed_at":"2025-12-21T15:54:51.483543-08:00","close_reason":"Implemented in Go rewrite"}
{"id":"fray-14r0","title":"Chat: thread view scroll bounces back to bottom","description":"When viewing threads like opus-notes in fray chat, attempting to scroll back through history causes the view to scroll up briefly then push back to the bottom. Main channel doesn't have this issue.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-31T23:38:06.661925-08:00","created_by":"adam","updated_at":"2025-12-31T23:54:50.268588-08:00","closed_at":"2025-12-31T23:54:50.268588-08:00","close_reason":"Fixed in chat bug batch: filtered deleted messages, fixed thread scroll bounce, added near-top preload, refactored answer to Bubble Tea TUI"}
{"id":"fray-1b9","title":"P2.2: Shell autocomplete for agents","description":"Shell completion for @agent names. Show aliases/nicks in completion. Autocomplete @#channel-id format.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-19T11:57:35.745567-08:00","updated_at":"2025-12-19T22:57:34.310888-08:00","dependencies":[{"issue_id":"fray-1b9","depends_on_id":"fray-t29","type":"blocks","created_at":"2025-12-19T11:57:46.734731-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-1dw","title":"Update mlld TextMate grammar for syntax highlighting","description":"Refresh the mlld TextMate grammar and port it to a Chroma lexer (replace stub lexer in internal/chat/mlld_lexer.go). Add/update tests for highlighting once grammar is ready.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-20T21:34:06.004183-08:00","updated_at":"2025-12-20T21:34:06.004183-08:00","dependencies":[{"issue_id":"fray-1dw","depends_on_id":"fray-beb","type":"discovered-from","created_at":"2025-12-20T21:34:06.00556-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-1g2","title":"Add PreCompact hook with /land reminder","description":"Add PreCompact hook that fires when Claude context is compacting.\n\nInject reminder:\n```\n[fray] Context compacting. Preserve your work:\n1. fray note \"# Handoff ...\" --as \u003cyou\u003e\n2. bd close \u003ccompleted-issues\u003e  \n3. fray bye \u003cyou\u003e\n\nOr run /land for full checklist.\n```\n\nThis is automatic insurance against context loss.\n\nFiles: internal/command/hook_precompact.go (new), internal/command/hook_install.go","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-31T08:01:10.00535-08:00","created_by":"adam","updated_at":"2025-12-31T10:33:01.302875-08:00","closed_at":"2025-12-31T10:33:01.302875-08:00","close_reason":"Implemented hook-statusline command, enhanced UserPromptSubmit with statusline, added SessionStart resume tickler, added PreCompact hook"}
{"id":"fray-1jh","title":"P1.6: mm ls command","description":"mm ls to show all channels, current channel, paths. Read from ~/.config/mm/mm-config.json. Show which channels have local .mm/ dirs.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T11:57:26.802982-08:00","updated_at":"2025-12-19T22:57:34.298378-08:00","closed_at":"2025-12-19T15:32:55.205871-08:00","close_reason":"Added mm ls command listing channels","dependencies":[{"issue_id":"fray-1jh","depends_on_id":"fray-z3l","type":"blocks","created_at":"2025-12-19T11:57:46.374714-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-1mk","title":"P1.1: JSON output for commands","description":"Add --json flag to commands for programmatic access.\n\nCommands to update:\n1. mm here --json\n   Output: {\"agents\": [{\"agent_id\": \"usr-xxx\", \"display_name\": \"alice\", \"goal\": \"...\", \"last_active\": \"ISO\", \"message_count\": N, \"claim_count\": N}], \"total\": N}\n\n2. mm history \u003cagent\u003e --json\n   Output: {\"agent\": \"alice\", \"agent_id\": \"usr-xxx\", \"messages\": [{\"id\": \"msg-xxx\", \"agent_id\": \"usr-xxx\", \"body\": \"...\", \"created_at\": \"ISO\", \"age_seconds\": N, \"mentions\": [], \"reply_to\": null}], \"total\": N}\n\n3. mm between \u003ca\u003e \u003cb\u003e --json\n   Output: {\"agents\": [\"alice\", \"bob\"], \"messages\": [...], \"total\": N}\n\nImplementation:\n- Add --json flag parsing to each command\n- Return structured JSON (pretty-printed)\n- Include full GUIDs (no display IDs)\n- Use ISO 8601 timestamps\n\nReferences: PLAN.md section 9\nCritical files: src/commands/here.ts, src/commands/history.ts (NEW), src/commands/between.ts (NEW)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T11:57:25.36173-08:00","updated_at":"2025-12-19T22:57:34.299868-08:00","closed_at":"2025-12-19T15:12:10.821209-08:00","close_reason":"Added JSON output for here/history/between and new commands","dependencies":[{"issue_id":"fray-1mk","depends_on_id":"fray-qqv","type":"blocks","created_at":"2025-12-19T13:13:41.93647-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-1ur","title":"Implement cross-project commands (link, unlink, projects)","description":"Implement commands for managing linked projects.\n\n## Commands\n\n### bdm link \u003calias\u003e \u003cpath\u003e\nLink another beads project for cross-project messaging.\n\n```bash\nbdm link api ~/dev/api-service\nbdm link frontend ../frontend\n```\n\n**Implementation:**\n1. Resolve path to absolute\n2. Verify path contains .beads/ directory\n3. Store in bdm_linked_projects table\n4. Output: \"Linked 'api' → /Users/me/dev/api-service\"\n\n**Validation:**\n- Path must exist\n- Path must contain .beads/ (be a beads project)\n- Alias must be valid identifier (alphanumeric, hyphens, underscores)\n- Error if alias already exists (suggest --force to overwrite)\n\n### bdm unlink \u003calias\u003e\nRemove a linked project.\n\n```bash\nbdm unlink api\n```\n\n**Implementation:**\n1. Delete from bdm_linked_projects\n2. Output: \"Unlinked 'api'\"\n\n**Error:**\n- Alias doesn't exist: \"No project linked as 'api'\"\n\n### bdm projects\nList current and linked projects.\n\n```bash\nbdm projects\n```\n\n**Output:**\n```\nCURRENT:\n  /Users/me/dev/beads-messenger\n\nLINKED:\n  api       /Users/me/dev/api-service\n  frontend  /Users/me/dev/frontend\n```\n\n## Using --project Flag\nAfter linking, any command can use --project:\n\n```bash\nbdm --project api here\nbdm --project api post --as frontend.1 \"@backend.2 heads up\"\n```\n\n**Implementation in cli.ts:**\n1. Check for --project option\n2. Look up alias in bdm_linked_projects\n3. Open that project's database instead\n4. All subsequent commands operate there\n\n## Files\n- src/commands/link.ts\n- src/commands/unlink.ts\n- src/commands/projects.ts\n- src/cli.ts (--project handling)\n\n## Acceptance Criteria\n- Link stores absolute path\n- Link validates target is beads project\n- Unlink removes entry\n- Projects lists all linked projects\n- --project flag switches context correctly","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T10:10:07.749068-08:00","updated_at":"2025-12-19T22:57:34.303511-08:00","closed_at":"2025-12-04T12:37:51.237861-08:00","dependencies":[{"issue_id":"fray-1ur","depends_on_id":"fray-yh4","type":"parent-child","created_at":"2025-12-04T10:11:09.262489-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-1ur","depends_on_id":"fray-2vy","type":"blocks","created_at":"2025-12-04T10:12:00.716049-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-1ur","depends_on_id":"fray-oa5","type":"blocks","created_at":"2025-12-04T10:47:27.896529-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-1wj","title":"Create database schema and initialization","description":"Create src/db/schema.ts with SQL schema and initialization logic.\n\n## Schema SQL\n```sql\n-- Agent presence and identity\nCREATE TABLE IF NOT EXISTS bdm_agents (\n  agent_id TEXT PRIMARY KEY,           -- e.g., \"alice.419\", \"pm.3.sub.1\"\n  goal TEXT,                           -- current focus/purpose (mutable)\n  bio TEXT,                            -- static identity info (mutable)\n  registered_at INTEGER NOT NULL,      -- unix timestamp\n  last_seen INTEGER NOT NULL,          -- updated on post\n  left_at INTEGER                      -- set by \"bye\", null if active\n);\n\n-- Room messages\nCREATE TABLE IF NOT EXISTS bdm_messages (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,  -- sequential 1,2,3...\n  ts INTEGER NOT NULL,                   -- unix timestamp\n  from_agent TEXT NOT NULL,              -- full agent address\n  body TEXT NOT NULL,                    -- message content (markdown)\n  mentions TEXT NOT NULL DEFAULT '[]'    -- JSON array of mentioned addresses\n);\n\nCREATE INDEX IF NOT EXISTS idx_bdm_messages_ts ON bdm_messages(ts);\nCREATE INDEX IF NOT EXISTS idx_bdm_messages_from ON bdm_messages(from_agent);\n\n-- Linked projects for cross-project messaging\nCREATE TABLE IF NOT EXISTS bdm_linked_projects (\n  alias TEXT PRIMARY KEY,\n  path TEXT NOT NULL                     -- absolute path to .beads directory\n);\n\n-- Configuration\nCREATE TABLE IF NOT EXISTS bdm_config (\n  key TEXT PRIMARY KEY,\n  value TEXT NOT NULL\n);\n\n-- Default config\nINSERT OR IGNORE INTO bdm_config (key, value) VALUES ('stale_hours', '4');\n```\n\n## API\n```typescript\n// src/db/schema.ts\n\n/**\n * Initialize bdm schema in database.\n * Safe to call multiple times (uses IF NOT EXISTS).\n */\nexport function initSchema(db: Database): void;\n\n/**\n * Check if bdm schema exists in database.\n */\nexport function schemaExists(db: Database): boolean;\n```\n\n## Files\n- src/db/schema.ts\n\n## Acceptance Criteria\n- Schema creates all tables with correct structure\n- Indexes are created for query performance\n- Default config is inserted\n- Idempotent - safe to run multiple times\n- Unit tests verify table creation","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T09:58:49.547065-08:00","updated_at":"2025-12-19T22:57:34.308076-08:00","closed_at":"2025-12-04T12:18:02.95021-08:00","dependencies":[{"issue_id":"fray-1wj","depends_on_id":"fray-08v","type":"parent-child","created_at":"2025-12-04T10:00:44.795828-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-1wj","depends_on_id":"fray-wjm","type":"blocks","created_at":"2025-12-04T10:01:23.295563-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-20t","title":"Fix quickstart display and add active users","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-20T16:30:31.706757-08:00","updated_at":"2025-12-20T16:35:26.90702-08:00","closed_at":"2025-12-20T16:35:26.90702-08:00","close_reason":"Closed"}
{"id":"fray-2dc","title":"Implement @mentions query command","description":"Implement the @mentions shorthand for querying messages mentioning an agent.\n\n## Usage\n\n```bash\nbdm @alice                       # last 5 messages mentioning @alice*\nbdm @alice.419                   # messages mentioning exactly @alice.419*\nbdm @alice --last 20             # last 20 mentions\nbdm @alice --since 42            # mentions after ID 42\n```\n\n## Detection\nWhen the first positional argument starts with @, treat as mentions query:\n- Strip @ prefix to get agent prefix\n- Query messages where any mention matches prefix\n\n## Implementation\n\n1. Detect @-prefixed first argument in CLI\n2. Extract prefix: \"@alice\" → \"alice\"\n3. Call getMessagesWithMention(db, prefix, options)\n4. Format same as regular message display\n\n## Mention Matching (in database query)\nFor message to match \"@alice\":\n- Any mention in mentions array equals \"alice\", OR\n- Any mention starts with \"alice.\"\n- OR any mention is \"all\" (broadcasts included)\n\nSQL (using json_each):\n```sql\nSELECT DISTINCT m.* FROM bdm_messages m, json_each(m.mentions) j\nWHERE j.value = 'all' \n   OR j.value = ?  -- exact match\n   OR j.value LIKE ? || '.%'  -- prefix match\nORDER BY m.id DESC\nLIMIT ?\n```\n\n## Default Limit\n- Default: 5 messages (vs 20 for room history)\n- Rationale: mentions are more targeted, smaller default\n\n## Output\nSame format as regular messages:\n```\n[43] bob.3 (1m ago): @alice.419 got it, thanks\n[44] pm.5 (30s ago): @all standup in 5\n```\n\n## Files\n- src/commands/mentions.ts\n- src/cli.ts (detect @ prefix and route)\n\n## Acceptance Criteria\n- @agent shows messages mentioning that agent\n- Prefix matching works (@ alice matches @alice.419)\n- @all broadcasts are included\n- --last and --since options work\n- Default limit is 5","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T10:09:14.178017-08:00","updated_at":"2025-12-19T22:57:34.304388-08:00","closed_at":"2025-12-04T12:37:42.842009-08:00","dependencies":[{"issue_id":"fray-2dc","depends_on_id":"fray-yh4","type":"parent-child","created_at":"2025-12-04T10:10:53.884413-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-2dc","depends_on_id":"fray-2vy","type":"blocks","created_at":"2025-12-04T10:11:45.339104-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-2dc","depends_on_id":"fray-dgt","type":"blocks","created_at":"2025-12-04T10:46:10.370923-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-2eh","title":"Implement watch command (--watch flag)","description":"Implement tail -f style message watching.\n\n## Usage\n\n```bash\nbdm --watch                      # tail -f all messages\n```\n\n## Implementation\n\n1. Get current last message ID\n2. Display existing messages (last N or all)\n3. Enter poll loop:\n   - Sleep for interval (1 second default)\n   - Query messages with --since lastId\n   - Display new messages\n   - Update lastId\n   - Repeat until interrupted (Ctrl+C)\n\n## Poll Loop\n\n```typescript\nasync function watch(db: Database, startId: number, interval: number = 1000) {\n  let lastId = startId;\n  \n  // Handle Ctrl+C gracefully\n  process.on('SIGINT', () =\u003e {\n    console.log('\\nStopped watching.');\n    process.exit(0);\n  });\n  \n  while (true) {\n    await sleep(interval);\n    const newMessages = getMessages(db, { since: lastId });\n    \n    for (const msg of newMessages) {\n      console.log(formatMessage(msg));\n      lastId = msg.id;\n    }\n  }\n}\n```\n\n## Display Considerations\n- Print each new message as it arrives\n- No buffering - immediate output\n- Clear indication when starting (\"Watching for new messages...\")\n- Clean exit on Ctrl+C\n\n## Optional Enhancements (defer if complex)\n- `--interval \u003cms\u003e` to change poll frequency\n- Filter by @mentions while watching\n- Bell/notification on new messages\n\n## Files\n- src/commands/watch.ts\n\n## Acceptance Criteria\n- Displays new messages as they arrive\n- Polls at reasonable interval (1s default)\n- Handles Ctrl+C gracefully\n- Works correctly with concurrent posters","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T10:09:49.263646-08:00","updated_at":"2025-12-19T22:57:34.303796-08:00","closed_at":"2025-12-04T12:38:08.738646-08:00","dependencies":[{"issue_id":"fray-2eh","depends_on_id":"fray-yh4","type":"parent-child","created_at":"2025-12-04T10:11:04.132376-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-2eh","depends_on_id":"fray-l5o","type":"blocks","created_at":"2025-12-04T10:11:55.591663-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-2eh","depends_on_id":"fray-dgt","type":"blocks","created_at":"2025-12-04T10:51:09.094007-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-2eh","depends_on_id":"fray-8jo","type":"blocks","created_at":"2025-12-04T10:51:14.219672-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-2eq","title":"Adaptive GUID length based on entry count","description":"Start with 3-character GUIDs and automatically expand length as needed when collisions become likely. This makes IDs easier to type when there are few entries.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-19T21:29:21.349611-08:00","updated_at":"2025-12-21T15:54:51.482234-08:00","closed_at":"2025-12-21T15:54:51.482234-08:00","close_reason":"Implemented in Go rewrite"}
{"id":"fray-2qx","title":"Filter deleted messages from display","description":"Deleted messages show as '[deleted]' in `fray notes` and message history. Should filter them out for cleaner UX.\n\nAffected commands:\n- `fray notes --as \u003cagent\u003e`\n- `fray thread \u003cref\u003e`\n- `fray history \u003cagent\u003e`\n- Possibly `fray get` and chat view\n\nImplementation: Filter out messages where body == '[deleted]' or add a deleted flag check.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T23:17:36.807234-08:00","created_by":"adam","updated_at":"2025-12-31T23:23:10.622524-08:00","closed_at":"2025-12-31T23:23:10.622524-08:00","close_reason":"Added filterDeletedMessages helper, applied to notes, thread, history, between, meta commands"}
{"id":"fray-2vy","title":"Set up CLI framework with Commander.js","description":"Enhance src/cli.ts to set up the full Commander.js program with global options.\n\n## Requirements\n\n1. Global options that apply to all commands:\n   - `--project \u003calias\u003e`: Operate in linked project context\n   - `--json`: Output in JSON format (for scripting)\n\n2. Command structure:\n   - Subcommands for each action (new, hi, bye, here, who, post, link, etc.)\n   - Default command (no subcommand): show room history\n\n3. Database initialization:\n   - Discover beads project\n   - Open database and init schema\n   - Handle --project to switch context\n\n## Implementation\n\n```typescript\n// src/cli.ts\n\nimport { Command } from 'commander';\n\nexport function main() {\n  const program = new Command();\n  \n  program\n    .name('bdm')\n    .description('Agent messaging for beads projects')\n    .version('0.1.0')\n    .option('--project \u003calias\u003e', 'operate in linked project')\n    .option('--json', 'output in JSON format');\n\n  // Add subcommands\n  program.addCommand(newCommand());\n  program.addCommand(hiCommand());\n  program.addCommand(byeCommand());\n  program.addCommand(hereCommand());\n  program.addCommand(whoCommand());\n  program.addCommand(postCommand());\n  program.addCommand(linkCommand());\n  program.addCommand(unlinkCommand());\n  program.addCommand(projectsCommand());\n  program.addCommand(configCommand());\n\n  // Default action (show messages)\n  program\n    .option('--last \u003cn\u003e', 'show last N messages', '20')\n    .option('--since \u003cid\u003e', 'show messages after ID')\n    .option('--all', 'show all messages')\n    .option('--watch', 'tail -f style')\n    .action(messagesAction);\n\n  // @mentions shorthand: bdm @alice\n  // Handled by checking if first arg starts with @\n  \n  program.parse();\n}\n```\n\n## Command Pattern\nEach command file exports a function that returns a Command:\n\n```typescript\n// src/commands/new.ts\nimport { Command } from 'commander';\n\nexport function newCommand(): Command {\n  return new Command('new')\n    .description('Create new agent session')\n    .argument('\u003cname\u003e', 'base name for agent')\n    .option('--goal \u003cgoal\u003e', 'agent goal')\n    .option('--bio \u003cbio\u003e', 'agent bio')\n    .action(async (name, options, cmd) =\u003e {\n      // Implementation\n    });\n}\n```\n\n## Files\n- src/cli.ts (update)\n- src/commands/index.ts (export all commands)\n\n## Acceptance Criteria\n- `bdm --help` shows all commands and options\n- `bdm \u003ccommand\u003e --help` shows command-specific help\n- `--project` flag works with all commands\n- Error handling wrapper catches and formats errors","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T10:08:03.90436-08:00","updated_at":"2025-12-19T22:57:34.305565-08:00","closed_at":"2025-12-04T12:37:16.904326-08:00","dependencies":[{"issue_id":"fray-2vy","depends_on_id":"fray-yh4","type":"parent-child","created_at":"2025-12-04T10:10:33.387044-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-2vy","depends_on_id":"fray-08v","type":"blocks","created_at":"2025-12-04T10:45:33.185815-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-35o","title":"Add claims section to quickstart","description":"Add COLLISION PREVENTION section to quickstart covering:\n\n  mm claim @agent --file src/auth.ts      Claim a file\n  mm claim @agent --files \"*.ts,*.go\"     Claim multiple patterns\n  mm claim @agent --file x --ttl 2h       Claim with expiration\n  mm claims                               List all active claims\n  mm claims @agent                        List agent's claims  \n  mm clear @agent                         Clear all your claims\n  mm clear @agent --file src/auth.ts      Clear specific claim\n\nExplain: prevents other agents from accidentally working on same files. Claims auto-clear on mm bye.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-22T11:44:54.024023-08:00","updated_at":"2025-12-22T12:00:48.981401-08:00","closed_at":"2025-12-22T12:00:48.981401-08:00","close_reason":"Added COLLISION PREVENTION section to quickstart"}
{"id":"fray-373","title":"Improve agent read state tracking","description":"SUPERSEDED: See fray-vfv for new watermark-based design.\n\nOriginal requirements still apply but implementation is now via positional read_to watermarks instead of per-message receipts.\n\nKey insight: per-message receipts are semantically wrong because session identity ≠ agent identity. Watermarks track position, not individual items.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-30T16:46:47.429502-08:00","created_by":"adam","updated_at":"2025-12-31T05:54:04.804926-08:00","closed_at":"2025-12-31T05:54:04.804926-08:00","close_reason":"Implemented via watermark-based system (fray-vfv). Per-thread tracking now possible via read_to table. Session events provide handoff context.","dependencies":[{"issue_id":"fray-373","depends_on_id":"fray-vfv","type":"blocks","created_at":"2025-12-31T00:08:13.56438-08:00","created_by":"daemon"}]}
{"id":"fray-376","title":"Prepare npm package for publishing","description":"Finalize package.json and prepare for npm publishing.\n\n## Package.json Updates\n\n```json\n{\n  \"name\": \"beads-messenger\",\n  \"version\": \"0.1.0\",\n  \"description\": \"Agent messaging for beads projects\",\n  \"type\": \"module\",\n  \"main\": \"./dist/cli.js\",\n  \"types\": \"./dist/cli.d.ts\",\n  \"bin\": {\n    \"bdm\": \"./dist/bin/bdm.js\"\n  },\n  \"files\": [\n    \"dist\",\n    \"README.md\",\n    \"LICENSE\"\n  ],\n  \"scripts\": {\n    \"build\": \"tsup\",\n    \"test\": \"vitest\",\n    \"prepublishOnly\": \"npm run build \u0026\u0026 npm test\"\n  },\n  \"keywords\": [\n    \"beads\",\n    \"agent\",\n    \"messaging\",\n    \"cli\",\n    \"coordination\"\n  ],\n  \"repository\": {\n    \"type\": \"git\",\n    \"url\": \"https://github.com/user/beads-messenger\"\n  },\n  \"license\": \"MIT\",\n  \"engines\": {\n    \"node\": \"\u003e=18\"\n  }\n}\n```\n\n## Pre-publish Checklist\n\n1. **Build verification**\n   - `npm run build` succeeds\n   - `dist/` contains expected files\n   - `dist/bin/bdm.js` has correct shebang\n\n2. **Package content**\n   - `npm pack` and inspect tarball\n   - Verify only dist/, README, LICENSE included\n   - No source files or test files\n\n3. **Local install test**\n   ```bash\n   npm pack\n   npm install -g beads-messenger-0.1.0.tgz\n   bdm --version\n   bdm --help\n   ```\n\n4. **Clean install test**\n   ```bash\n   # In a fresh directory\n   npm init -y\n   npm install beads-messenger\n   npx bdm --version\n   ```\n\n## Files to Create\n\n### LICENSE\n```\nMIT License\n\nCopyright (c) 2024 [Author]\n\nPermission is hereby granted...\n```\n\n### .npmignore (if needed)\n```\nsrc/\ntests/\ntsconfig.json\ntsup.config.ts\n.github/\n```\n\n## Files\n- package.json (update)\n- LICENSE (create)\n- .npmignore (if needed)\n\n## Acceptance Criteria\n- `npm pack` produces correct package\n- Package installs globally\n- `bdm` command works after install\n- No unnecessary files in package","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T10:18:44.656474-08:00","updated_at":"2025-12-19T22:57:34.302009-08:00","closed_at":"2025-12-04T12:48:13.502479-08:00","dependencies":[{"issue_id":"fray-376","depends_on_id":"fray-po1","type":"parent-child","created_at":"2025-12-04T10:19:10.691255-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-376","depends_on_id":"fray-wkx","type":"blocks","created_at":"2025-12-04T10:19:34.928704-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-37o","title":"Design: pin vs star semantics","description":"Two distinct concepts conflated in 'pin':\n\n**Pin** = Signal importance to everyone\n- 'This is important for the channel/thread'\n- Shows in pinned section at top\n- Visibility: all agents see it\n\n**Star** = Personal subscription/bookmark  \n- 'I want to track this'\n- Shows in my threads list\n- Example: starring opus-notes to have it listed\n\nQuestions:\n- Are these separate commands? `fray pin` vs `fray star`?\n- Can you pin someone else's message? Star only your own subscriptions?\n- How does this interact with thread membership?\n- UI: pinned section vs starred sidebar\n\nNeeds design before implementing either.","status":"closed","priority":2,"issue_type":"task","assignee":"designer","created_at":"2025-12-30T16:47:02.578266-08:00","created_by":"adam","updated_at":"2025-12-31T10:36:29.879403-08:00","closed_at":"2025-12-31T10:36:29.879403-08:00","close_reason":"Design complete. Key insight: Star = Subscribe (already exists). Pin = new feature using pinned thread as playlist. No new data model - reuses existing thread/playlist primitive. All agents auto-subscribed to pinned. See designer-notes thread (thrd-3tb4tf2j) for full design."}
{"id":"fray-3hj","title":"Bug: @all not expanded to individual agent mentions","description":"When user posts with @all, it's stored literally as 'all' in mentions array instead of expanding to all agent names.\n\nCurrent behavior:\n  mentions: [\"all\"]\n\nExpected behavior:\n  mentions: [\"alice\", \"bob\", \"charlie\", ...]\n\nThis breaks mention history - agents don't see @all messages when checking their @mentions because their name isn't in the array.\n\nFix: when extracting mentions and 'all' is found, expand to list of all registered agent IDs.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-22T12:01:32.047673-08:00","updated_at":"2025-12-22T12:07:11.953326-08:00","closed_at":"2025-12-22T12:07:11.953326-08:00","close_reason":"Added ExpandAllMention to replace 'all' with all agent bases in mentions"}
{"id":"fray-3iq","title":"P1.7: Add time-based query flags","description":"Add time-based query flags for context-aware message retrieval.\n\nNew flags for mm get, mm history, mm between:\n- --since \u003ctime|guid\u003e: Messages after this point\n- --before \u003ctime|guid\u003e: Messages before this point\n- --from \u003ctime|guid\u003e --to \u003ctime|guid\u003e: Range query\n\nTime formats:\n- Relative: 1h, 2d, 30m, 1w\n- Absolute: yesterday, today\n- GUID: @#a1b2 or @#msg-a1b2c3d4\n\nExamples:\nmm get --since 1h\nmm history alice --since yesterday\nmm history alice --since @#a1b2\nmm get --from @#a1b2 --to @#x9y8\n\nImplementation:\n- src/core/time-query.ts (NEW): Parse time expressions\n  - parseTimeExpression(\"1h\") → Date\n  - parseTimeExpression(\"@#a1b2\") → GUID → created_at\n- Update query builders in src/db/queries.ts\n- Add WHERE created_at \u003e= ? or created_at \u003c= ?\n- Add WHERE created_at BETWEEN ? AND ?\n\nTime parsing:\n- 1h → Date(now - 1 hour)\n- 2d → Date(now - 2 days)\n- yesterday → Date(start of yesterday)\n- @#a1b2 → resolve GUID → lookup created_at\n\nReferences: PLAN.md section 9\nCritical files: src/core/time-query.ts (NEW), src/db/queries.ts, src/commands/get.ts, src/commands/history.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T13:13:41.599699-08:00","updated_at":"2025-12-19T22:57:34.297813-08:00","closed_at":"2025-12-19T15:44:29.895291-08:00","close_reason":"Added time-query parsing and --since/--before/--from/--to support","dependencies":[{"issue_id":"fray-3iq","depends_on_id":"fray-3vp","type":"blocks","created_at":"2025-12-19T13:24:50.618959-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-3po","title":"Initialize npm project with ESM configuration","description":"Initialize the npm project in the current working directory with proper ESM configuration.\n\n## Assumptions\n- Working directory is ~/dev/beads-messenger/ (already exists)\n- This is a fresh project with no existing package.json\n\n## Tasks\n1. Create package.json with:\n   - name: \"beads-messenger\"\n   - type: \"module\" (ESM)\n   - version: \"0.1.0\"\n   - bin entry: { \"bdm\": \"./dist/bin/bdm.js\" }\n   - scripts: build, test, dev\n\n2. Create tsconfig.json:\n   - target: ES2022\n   - module: ESNext\n   - moduleResolution: bundler\n   - strict: true\n   - outDir: dist\n   - rootDir: . (to include both src/ and bin/)\n\n3. Create tsup.config.ts for bundling:\n   - entry: [\"src/cli.ts\", \"bin/bdm.ts\"]\n   - format: esm\n   - dts: true\n   - clean: true\n\n## Files to Create\n- package.json\n- tsconfig.json\n- tsup.config.ts\n\n## Acceptance Criteria\n- `npm install` succeeds (after dependencies added in next task)\n- TypeScript configuration is valid\n- ESM imports work correctly","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T09:56:11.150341-08:00","updated_at":"2025-12-19T22:57:34.310239-08:00","closed_at":"2025-12-04T11:45:15.32267-08:00","dependencies":[{"issue_id":"fray-3po","depends_on_id":"fray-kit","type":"parent-child","created_at":"2025-12-04T09:57:00.217269-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-3rq","title":"Chat: enable text selection and copy support","description":"Currently cannot select text in chat TUI for copy/paste. Option+drag doesn't work.\n\nOptions to investigate:\n1. Check if mouse capture is interfering with native terminal selection\n2. Implement custom text selection within the TUI\n3. Add a 'copy mode' (like tmux) that disables mouse capture temporarily\n4. Support modifier key bypass for native selection\n\nGoal: users should be able to copy message text easily.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-21T20:33:37.763771-08:00","updated_at":"2025-12-21T22:58:22.164478-08:00","closed_at":"2025-12-21T22:58:22.164478-08:00","close_reason":"Implemented"}
{"id":"fray-3vp","title":"P0.2: Implement JSONL storage layer","description":"Implement JSONL append-only storage layer as source of truth.\n\nFiles to create:\n- src/db/jsonl.ts - JSONL writers and readers\n  - appendMessage(message) → writes to messages.jsonl\n  - appendAgent(agent) → writes to agents.jsonl\n  - updateProjectConfig(config) → writes to .mm/mm-config.json\n  - readMessages() → parses messages.jsonl\n  - readAgents() → parses agents.jsonl\n  - readProjectConfig() → parses .mm/mm-config.json\n\nFormat: One JSON object per line, no trailing commas\nExample: {\"type\":\"message\",\"id\":\"msg-a1b2c3d4\",...}\n\nHook into existing commands:\n- mm post → appendMessage()\n- mm new → appendAgent() + updateProjectConfig()\n\nReferences: PLAN.md section 2, beads ~/dev/beads/.beads/issues.jsonl\nCritical files: src/db/jsonl.ts (NEW), src/commands/post.ts, src/commands/new.ts","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-19T11:57:09.159982-08:00","updated_at":"2025-12-19T22:57:34.293432-08:00","closed_at":"2025-12-19T14:11:58.59895-08:00","close_reason":"Added JSONL storage layer with append/read helpers and wired post/new","dependencies":[{"issue_id":"fray-3vp","depends_on_id":"fray-7kr","type":"blocks","created_at":"2025-12-19T11:57:45.25839-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-4fp2","title":"Answer input: shift-enter for newlines, alt-delete for word delete","description":"In fray answer interactive mode, shift-enter doesn't work to add newlines and alt-delete doesn't work to delete words.\n\n## Root Cause\nThe answer command uses simple bufio.Reader.ReadString which doesn't support special key combinations. Chat uses Bubble Tea's textarea component which handles these.\n\n## Solution\nRefactor answer input to use Bubble Tea textarea like the chat does. This would give:\n- Shift-enter for newlines\n- Alt-delete for word delete  \n- Consistent behavior with chat input\n\n## Scope\nMedium refactor - need to convert answer command from bufio to Bubble Tea TUI.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-31T17:47:13.540206-08:00","created_by":"adam","updated_at":"2025-12-31T23:54:50.270809-08:00","closed_at":"2025-12-31T23:54:50.270809-08:00","close_reason":"Fixed in chat bug batch: filtered deleted messages, fixed thread scroll bounce, added near-top preload, refactored answer to Bubble Tea TUI"}
{"id":"fray-4kd","title":"Add mm roster command","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-20T15:57:02.382117-08:00","updated_at":"2025-12-20T15:58:57.36063-08:00","closed_at":"2025-12-20T15:58:57.36063-08:00","close_reason":"Closed"}
{"id":"fray-4ot","title":"Go: Add migrate command","description":"Missing 'mm migrate' command to migrate from v0.1.0 to v0.2.0 format. Low priority - one-time use.","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-21T01:34:00.297243-08:00","updated_at":"2025-12-21T02:19:10.634653-08:00","closed_at":"2025-12-21T02:19:10.634653-08:00","close_reason":"Implemented migrate command"}
{"id":"fray-4ry","title":"P2.3: Tests for migration and edge cases","description":"Add tests for migration path and edge cases.\n\nTest files to create/update:\n\n1. tests/migration.test.ts (NEW)\n   - Detect old format correctly\n   - Generate GUIDs for all existing data\n   - Preserve message order\n   - Create .mm/mm-config.json\n   - Backup to .mm.bak/\n   - Handle empty database\n   - Handle corrupted old data\n\n2. tests/prune.test.ts (NEW)\n   - Guardrails: uncommitted changes\n   - Guardrails: ahead/behind remote\n   - Guardrails: no remote (offline OK)\n   - Archive to history.jsonl\n   - Keep last N messages\n   - --all flag wipes history\n   - GUID stability after prune\n\n3. tests/multi-machine.test.ts (NEW)\n   - Simulate git pull with new messages\n   - SQLite rebuild from merged JSONL\n   - Agent GUID conflicts\n   - Channel ID stability\n   - Known_agents merge scenarios\n\n4. tests/chat.test.ts (UPDATE)\n   - @#prefix parsing in input\n   - Reply-to resolution\n   - Display GUID prefixes\n   - Reply context formatting\n   - Ambiguous GUID errors\n\nEdge cases:\n- Empty database\n- Malformed JSONL\n- Missing config files\n- Offline operation\n- GUID collisions (simulate)\n- Very long message IDs\n\nCoverage goals:\n- Migration: 90%\n- Prune: 95%\n- Edge cases: 80%\n\nRun with: npm test\n\nReferences: Existing integration tests\nCritical files: tests/migration.test.ts (NEW), tests/prune.test.ts (NEW), tests/multi-machine.test.ts (NEW)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-19T13:31:03.458326-08:00","updated_at":"2025-12-19T22:57:34.310675-08:00","dependencies":[{"issue_id":"fray-4ry","depends_on_id":"fray-6qu","type":"blocks","created_at":"2025-12-19T13:31:24.086143-08:00","created_by":"daemon","metadata":"{}"},{"issue_id":"fray-4ry","depends_on_id":"fray-7mm","type":"blocks","created_at":"2025-12-19T13:31:24.176694-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-4ux","title":"P1.3: Show message IDs in chat","description":"Display GUID prefixes and reply context in chat.\n\nMessage format:\n[2m ago] @alice: \"message body\" @#a1b2\n         ↑agent  ↑content        ↑GUID prefix (first 4 chars)\n\nReply format:\n[2m ago] @alice: \"reply text\" @#x9y8\n  ↪ Reply to @bob: \"original message truncated...\"\n  ↑dimmed, indented, ~50 char preview\n\nGUID prefix display:\n- Extract first 4 chars after \"msg-\" prefix\n- Example: msg-a1b2c3d4 → @#a1b2\n- Dimmed/gray color\n- Right-aligned or end of line\n\nReply context (if reply_to exists):\n- Query original message by GUID\n- Format: \"Reply to @\u003cagent\u003e: \u003cpreview\u003e\"\n- Truncate body to ~50 chars\n- Dimmed, indented under byline\n\nImplementation:\n- src/chat/display.ts: Update message formatter\n- Add GUID prefix extraction function\n- Add reply context lookup\n- Use ANSI colors for dimming\n\nReferences: PLAN.md section 8\nCritical files: src/chat/display.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T11:57:25.942829-08:00","updated_at":"2025-12-19T22:57:34.299282-08:00","closed_at":"2025-12-19T15:16:02.489547-08:00","close_reason":"Chat display now shows GUID prefixes and reply context","dependencies":[{"issue_id":"fray-4ux","depends_on_id":"fray-3vp","type":"blocks","created_at":"2025-12-19T13:13:42.135134-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-50b","title":"mm get: show active claims section","description":"Add active claims display to mm get output, similar to mm @agent.\n\nAfter the room messages and mentions, show:\n---\nActive claims: @bob (src/auth.ts), @pm (docs/)\n\nSkip if no claims exist.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-22T12:37:51.644021-08:00","updated_at":"2025-12-22T12:38:56.704651-08:00","closed_at":"2025-12-22T12:38:56.704651-08:00","close_reason":"Implemented - claims shown after room + mentions in mm get"}
{"id":"fray-53b","title":"Suggest correct agent name when delimiter differs","description":"When agent runs 'mm new partydev' but 'party-dev' exists (or vice versa), show 'did you mean @party-dev?' and require --force to proceed. Only trigger on delimiter differences (hyphen, dot, missing delimiter). Applies to new, back, post, get, etc.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-21T09:05:34.730701-08:00","updated_at":"2025-12-21T22:58:22.165418-08:00","closed_at":"2025-12-21T22:58:22.165418-08:00","close_reason":"Implemented"}
{"id":"fray-59y","title":"Revisit event notification design","description":"After silencing system messages by default, revisit how to surface useful event notifications.\n\n## Context\n\nWe're silencing all system messages (issue status changes, etc.) by default because they flood the chat. But some events might be useful to agents.\n\n## Future Considerations\n\n1. **Context-aware events**: Only show events for issues mentioned in recent conversation\n2. **Event summaries**: Instead of one message per event, batch related events (e.g., \"3 issues closed\")\n3. **Agent-specific subscriptions**: Let agents subscribe to specific issues or patterns\n4. **Event digest**: Daily/hourly summary instead of real-time flood\n\n## Blocked By\n\n- bdm-ep0 (silence by default) must be implemented first\n\n## Questions\n\n- Do agents actually need to see issue events in chat?\n- Should events be in a separate channel/view?\n- What's the right granularity for event notifications?","status":"open","priority":3,"issue_type":"epic","created_at":"2025-12-09T06:12:15.797525-08:00","updated_at":"2025-12-19T22:57:34.315114-08:00","dependencies":[{"issue_id":"fray-59y","depends_on_id":"fray-ep0","type":"blocks","created_at":"2025-12-09T06:12:21.73218-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-5ar","title":"Implement bdm chat command","description":"Implement the `bdm chat` command that ties together display, input, and core logic.\n\n## New File: src/commands/chat.ts\n\n```typescript\nexport function chatCommand(): Command {\n  return new Command('chat')\n    .description('Interactive chat mode')\n    .option('--last \u003cn\u003e', 'show last N messages', '20')\n    .action((options, cmd) =\u003e {\n      // ... implementation\n    });\n}\n```\n\n## Behavior\n\n1. **Startup**\n   - Get context (db, project)\n   - Read username from config (error if not set)\n   - Show last N messages\n   - Start polling interval (1 second)\n   - Start input handling\n\n2. **Message Display**\n   - New messages from poll rendered via display\n   - User's own messages rendered immediately after send\n\n3. **User Input**\n   - On line submit: send message, render it\n   - On quit (Ctrl+C): cleanup and exit\n\n4. **Cleanup**\n   - Clear interval\n   - Destroy display/input\n   - Close database\n\n## Wire Up\n\nIn src/cli.ts:\n- Import chatCommand\n- Add to program\n- Add 'chat' to knownCommands\n\n## Error Handling\n- \"Set username first: bdm config username \u003cname\u003e\" if no username\n- \"--json not supported for interactive chat\" if --json flag\n\n## Exit Criteria\n- `bdm chat` starts interactive mode\n- Messages from other agents appear in real-time\n- User can type and send messages\n- Ctrl+C exits cleanly","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-05T15:50:35.218142-08:00","updated_at":"2025-12-19T22:57:34.313469-08:00","closed_at":"2025-12-05T15:58:47.566971-08:00"}
{"id":"fray-5eu","title":"Fix error message claiming dashes are allowed in agent names","description":"## Problem\nError message in new.ts claims dashes are allowed, but the validator rejects them:\n\n```typescript\n// src/commands/new.ts:18\nthrow new Error(\\`Invalid agent base name: \\${name}. Must be alphanumeric with dots/dashes.\\`);\n\n// src/core/agents.ts:95 - actual regex\nconst roleRegex = /^[a-z][a-z0-9]*$/;  // No dashes!\n```\n\n## Options\n1. Fix the error message to match reality: \"Must start with lowercase letter, contain only letters, numbers, and dots\"\n2. Update the regex to actually allow dashes (may have implications)\n\nOption 1 is safer - just align the message with the actual validation.\n\n## Files\n- src/commands/new.ts:18\n\n## Acceptance Criteria\n- Error message accurately describes what's allowed\n- Or dashes are actually allowed (if that's the intent)","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-04T14:03:48.863915-08:00","updated_at":"2025-12-19T22:57:34.314389-08:00","closed_at":"2025-12-04T14:31:42.209512-08:00"}
{"id":"fray-5td","title":"Design: neo onboarding requirements","description":"Design session: What context do agents need when onboarding?\n\nQuestions to answer:\n- What's the right amount of context? (too little = lost, too much = overwhelmed)\n- How do we determine 'new' vs 'seen' reliably?\n- Should neo output be structured JSON for agents vs formatted for humans?\n- What's the relationship to read state tracking?\n- Should there be verbosity levels?\n\nOutput: Design doc or spec update.","status":"closed","priority":2,"issue_type":"task","assignee":"designer","created_at":"2025-12-30T16:46:05.526888-08:00","created_by":"adam","updated_at":"2025-12-31T10:34:39.006823-08:00","closed_at":"2025-12-31T10:34:39.006823-08:00","close_reason":"Design complete. Answers:\n1. Right amount of context: Verbosity levels (--brief for counts, default for full sections, --verbose for bodies)\n2. New vs seen: read_to watermarks per-home - messages after last watermark position\n3. JSON vs formatted: Both via --json flag\n4. Relationship to read state: Uses existing read_to watermarks from fray-vfv\n5. Verbosity levels: Yes - brief/default/verbose\n\nSee designer-notes thread (thrd-3tb4tf2j) for full design. Key sections: notes thread, unread room+mentions, open questions, active claims, ready work."}
{"id":"fray-5ug","title":"Add message archive and prune command","description":"Add ability to archive old messages to keep active message list manageable.\n\n## Commands\n\n**Prune current messages:**\n```bash\nbdm prune              # Archive all messages before current (max message ID)\nbdm prune --since 100  # Archive all messages before message 100\n```\n\n## Behavior\n\n- Archived messages remain in database but are excluded from default queries\n- Add `archived_at` column to `bdm_messages` table (nullable timestamp)\n- Default queries filter WHERE `archived_at IS NULL`\n- Archived messages retrievable with explicit flag: `bdm get --archived`\n\n## Schema Change\n\n```sql\nALTER TABLE bdm_messages ADD COLUMN archived_at INTEGER;\nCREATE INDEX idx_bdm_messages_archived ON bdm_messages(archived_at);\n```\n\n## Query Updates\n\nAll message queries should filter out archived messages by default:\n- getMessages(): Add WHERE archived_at IS NULL\n- getMessagesWithMention(): Add WHERE archived_at IS NULL\n- Add --archived flag to include archived messages\n\n## Implementation\n\n- src/db/schema.ts - Add migration for archived_at column\n- src/db/queries.ts - Update queries to filter archived, add archiveMessages() function\n- src/commands/prune.ts - New command to archive messages\n- src/commands/get.ts, mentions.ts, chat.ts, watch.ts - Add --archived flag","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-09T06:12:03.117969-08:00","updated_at":"2025-12-19T22:57:34.301007-08:00","closed_at":"2025-12-09T07:17:38.470164-08:00"}
{"id":"fray-6cj","title":"Define TypeScript types for database entities","description":"Create src/types.ts with TypeScript interfaces matching the database schema.\n\n## Types to Define\n\n```typescript\n// src/types.ts\n\n/**\n * Agent identity and presence.\n * Stored in bdm_agents table.\n */\nexport interface Agent {\n  agent_id: string;           // e.g., \"alice.419\", \"pm.3.sub.1\"\n  goal: string | null;        // current focus/purpose\n  bio: string | null;         // static identity info\n  registered_at: number;      // unix timestamp\n  last_seen: number;          // unix timestamp, updated on activity\n  left_at: number | null;     // unix timestamp, null if active\n}\n\n/**\n * Room message.\n * Stored in bdm_messages table.\n */\nexport interface Message {\n  id: number;                 // sequential ID (1, 2, 3...)\n  ts: number;                 // unix timestamp\n  from_agent: string;         // sender's full agent ID\n  body: string;               // message content (markdown)\n  mentions: string[];         // parsed from JSON, @mentioned agents\n}\n\n/**\n * Raw message row from database.\n * mentions stored as JSON string.\n */\nexport interface MessageRow {\n  id: number;\n  ts: number;\n  from_agent: string;\n  body: string;\n  mentions: string;           // JSON array as string\n}\n\n/**\n * Linked project for cross-project messaging.\n * Stored in bdm_linked_projects table.\n */\nexport interface LinkedProject {\n  alias: string;              // short name for --project flag\n  path: string;               // absolute path to project root\n}\n\n/**\n * Configuration setting.\n * Stored in bdm_config table.\n */\nexport interface ConfigEntry {\n  key: string;\n  value: string;\n}\n\n/**\n * Parsed agent ID components.\n */\nexport interface ParsedAgentId {\n  base: string;               // e.g., \"alice\", \"pm.3.sub\"\n  version: number;            // e.g., 419, 1\n  full: string;               // original full ID\n}\n\n/**\n * Query options for message retrieval.\n */\nexport interface MessageQueryOptions {\n  limit?: number;             // max messages to return\n  since?: number;             // message ID to start after\n  before?: number;            // message ID to end before\n}\n```\n\n## Files\n- src/types.ts\n\n## Acceptance Criteria\n- All types match database schema exactly\n- Types are exported for use across codebase\n- JSDoc comments explain each field\n- MessageRow vs Message distinction is clear (raw vs parsed)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T09:59:13.618061-08:00","updated_at":"2025-12-19T22:57:34.307766-08:00","closed_at":"2025-12-04T12:15:16.692417-08:00","dependencies":[{"issue_id":"fray-6cj","depends_on_id":"fray-08v","type":"parent-child","created_at":"2025-12-04T10:00:49.921399-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-6cj","depends_on_id":"fray-bml","type":"blocks","created_at":"2025-12-04T10:59:37.575951-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-6fh","title":"Create chat display/input abstractions","description":"Create abstraction interfaces for chat display and input, with simple ANSI/readline implementations.\n\n## New Files\n\n### src/chat/types.ts\n```typescript\nexport interface FormattedMessage {\n  id: number;\n  projectName: string;\n  type: 'user' | 'agent';\n  sender: string;\n  body: string;\n}\n\nexport interface ChatDisplay {\n  renderMessage(msg: FormattedMessage): void;\n  showStatus(text: string): void;\n  destroy(): void;\n}\n\nexport interface ChatInput {\n  start(): void;\n  onMessage(callback: (text: string) =\u003e void): void;\n  onQuit(callback: () =\u003e void): void;\n  destroy(): void;\n}\n```\n\n### src/chat/display.ts\n- ANSI color implementation\n- Format: `[#projectname LN] type @name: body`\n- Green for users, blue for agents, cyan for @mentions\n- Respect NO_COLOR environment variable\n\n### src/chat/input.ts\n- Use `readline.createInterface`\n- Handle line events for message submission\n- Handle close/SIGINT for quit\n\n## Design Notes\n- Interfaces allow swapping implementations later (e.g., to ink or blessed)\n- Keep implementations minimal for v1\n\n## Exit Criteria\n- Interfaces defined in types.ts\n- Display prints colored messages to stdout\n- Input captures lines and signals quit on Ctrl+C","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-05T15:50:09.859942-08:00","updated_at":"2025-12-19T22:57:34.313836-08:00","closed_at":"2025-12-05T15:55:52.125625-08:00"}
{"id":"fray-6fx","title":"P5: Autocomplete (P1 feature)","description":"Add autocomplete for # (message refs) and @ (mentions). Popup with suggestions, Tab/Enter to accept, Esc to dismiss. Filter as user types. ~6 hours.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T12:17:37.072669-08:00","updated_at":"2025-12-21T01:27:06.005814-08:00","closed_at":"2025-12-21T01:27:06.005814-08:00","close_reason":"Completed in Go rewrite","dependencies":[{"issue_id":"fray-6fx","depends_on_id":"fray-m6c","type":"blocks","created_at":"2025-12-20T12:22:26.237644-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-6go","title":"Assign chat colors by recency, not hash","description":"In bdm chat mode, assign colors to agents based on conversation recency rather than hash-based assignment.\n\n## Problem\n\nCurrently colors are assigned by hashing the agent base name modulo 6 color sets. With only 6 colors, hash collisions are common - two active agents might get the same color even though there are unused colors available.\n\n## Desired Behavior\n\nWhen entering chat mode, assign colors to agents based on who has posted recently:\n\n1. Get list of agents who have posted in recent history (e.g., last 50 messages)\n2. Sort by most recent activity\n3. Assign colors sequentially: first agent gets color 0, second gets color 1, etc.\n4. This guarantees the first 6 active agents get unique colors\n5. Less active/older agents might share colors, but they're not in the active conversation\n\n## Implementation\n\n**Approach**: Build a color map at chat session start based on recent messages\n\n```typescript\n// In chat session initialization\nfunction buildColorMap(db: Database, lookbackLimit: number = 50): Map\u003cstring, number\u003e {\n  const messages = getMessages(db, { limit: lookbackLimit });\n  const agentBases = new Map\u003cstring, number\u003e(); // base -\u003e last seen timestamp\n  \n  for (const msg of messages) {\n    if (msg.type === 'agent') {\n      const base = parseAgentId(msg.from_agent).base;\n      const ts = msg.ts;\n      if (!agentBases.has(base) || agentBases.get(base)! \u003c ts) {\n        agentBases.set(base, ts);\n      }\n    }\n  }\n  \n  // Sort by most recent\n  const sorted = Array.from(agentBases.entries())\n    .sort((a, b) =\u003e b[1] - a[1]);\n  \n  // Assign colors sequentially\n  const colorMap = new Map\u003cstring, number\u003e();\n  sorted.forEach(([base, _], idx) =\u003e {\n    colorMap.set(base, idx % COLOR_PAIRS.length);\n  });\n  \n  return colorMap;\n}\n```\n\n## Files to Modify\n\n- `src/chat/display.ts` - Accept colorMap in constructor, use it in getAgentColor calls\n- `src/commands/chat.ts` - Build colorMap on session start, pass to display\n- `src/commands/format.ts` - Add `getAgentColorWithMap()` variant that takes optional colorMap\n\n## Fallback\n\nFor agents not in the recent history, fall back to hash-based assignment so they still get a color.\n\n## Benefits\n\n- Active conversation participants are guaranteed visually distinct\n- No more confusing collisions between agents who are talking\n- Still works for new agents who join mid-session (hash fallback)\n- Improves readability during active multi-agent conversations","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-07T17:11:41.405464-08:00","updated_at":"2025-12-19T22:57:34.313057-08:00","closed_at":"2025-12-07T17:18:35.828317-08:00"}
{"id":"fray-6qkl","title":"Split db/queries.go by entity domain","description":"db/queries.go is 2432 lines with 102 functions. Split into: queries_agents.go (19), queries_messages.go (22), queries_threads.go (11), queries_questions.go (7), queries_claims.go (11), queries_config.go. Each domain gets its own file.","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-31T23:53:30.914189-08:00","created_by":"adam","updated_at":"2025-12-31T23:53:30.914189-08:00"}
{"id":"fray-6qu","title":"P0.7: Migration from current format","description":"Implement mm migrate command to convert v0.1.0 to v0.2.0 GUID format.\n\nMigration steps:\n1. Check if .mm/ exists and is old format (no .mm/mm-config.json)\n2. Backup: cp -r .mm/ .mm.bak/\n3. Generate GUIDs for all existing messages and agents\n4. Create .mm/mm-config.json with channel_id\n5. Create messages.jsonl from SQLite messages\n6. Create agents.jsonl from SQLite agents\n7. Rebuild SQLite with new schema\n8. Success message: \"Migration complete. Backup at .mm.bak/\"\n\nOld schema detection:\n- Check for absence of .mm/mm-config.json\n- Check for presence of .mm/mm.db\n\nGUID generation:\n- Messages: msg-\u003c8chars\u003e (preserve order by created_at)\n- Agents: usr-\u003c8chars\u003e\n- Channel: ch-\u003c8chars\u003e (single channel, prompt for name)\n\nReferences: PLAN.md section Migration Path\nCritical files: src/commands/migrate.ts, src/db/schema.ts, src/db/jsonl.ts","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-19T11:57:10.559979-08:00","updated_at":"2025-12-19T22:57:34.291761-08:00","closed_at":"2025-12-19T14:46:30.189121-08:00","close_reason":"Implemented v0.1.0 -\u003e v0.2.0 migration with JSONL + config + backup","dependencies":[{"issue_id":"fray-6qu","depends_on_id":"fray-qqv","type":"blocks","created_at":"2025-12-19T13:23:41.923855-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-6u7","title":"Implement agent ID utilities","description":"Create src/core/agents.ts with agent ID parsing and formatting utilities.\n\n## Agent ID Format\nFormat: `\u003crole\u003e[.\u003cqualifier\u003e]*.\u003csession_number\u003e`\n\nExamples:\n- `alice.1` - first alice session\n- `alice.frontend.3` - third alice.frontend session  \n- `pm.5.sub.2` - second subagent of pm session 5\n\nRules:\n- Last segment is always numeric (version/session number)\n- Base is everything before the last dot\n- Role names are lowercase alphanumeric (no leading digits)\n\n## Functions to Implement\n\n```typescript\n// src/core/agents.ts\n\nimport type { ParsedAgentId } from '../types.js';\n\n/**\n * Parse an agent ID into components.\n * @throws if ID is invalid\n * @example parseAgentId(\"alice.419\") -\u003e { base: \"alice\", version: 419, full: \"alice.419\" }\n * @example parseAgentId(\"pm.3.sub.2\") -\u003e { base: \"pm.3.sub\", version: 2, full: \"pm.3.sub.2\" }\n */\nexport function parseAgentId(id: string): ParsedAgentId;\n\n/**\n * Format base and version into agent ID.\n * @example formatAgentId(\"alice\", 419) -\u003e \"alice.419\"\n */\nexport function formatAgentId(base: string, version: number): string;\n\n/**\n * Validate agent ID format.\n * @returns true if valid, false otherwise\n */\nexport function isValidAgentId(id: string): boolean;\n\n/**\n * Validate base name format (role or role.qualifier).\n * @returns true if valid base name\n */\nexport function isValidBaseName(base: string): boolean;\n\n/**\n * Normalize agent reference (strip leading @).\n * @example normalizeAgentRef(\"@alice.1\") -\u003e \"alice.1\"\n * @example normalizeAgentRef(\"alice.1\") -\u003e \"alice.1\"\n */\nexport function normalizeAgentRef(ref: string): string;\n\n/**\n * Check if an agent ID matches a prefix.\n * Used for @mention resolution.\n * @example matchesPrefix(\"alice.419\", \"alice\") -\u003e true\n * @example matchesPrefix(\"alice.frontend.3\", \"alice\") -\u003e true\n * @example matchesPrefix(\"bob.1\", \"alice\") -\u003e false\n */\nexport function matchesPrefix(agentId: string, prefix: string): boolean;\n```\n\n## Validation Rules\n- Base: lowercase letters, numbers, dots (no leading digit in any segment)\n- Version: positive integer\n- Full ID: base + \".\" + version\n- No empty segments (e.g., \"alice..1\" invalid)\n\n## Files\n- src/core/agents.ts\n\n## Acceptance Criteria\n- Parsing extracts base and version correctly\n- Validation catches all invalid formats\n- Prefix matching works for all cases\n- Comprehensive unit tests","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T10:04:12.3668-08:00","updated_at":"2025-12-19T22:57:34.306513-08:00","closed_at":"2025-12-04T12:28:33.319465-08:00","dependencies":[{"issue_id":"fray-6u7","depends_on_id":"fray-dk4","type":"parent-child","created_at":"2025-12-04T10:06:59.559273-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-6u7","depends_on_id":"fray-bml","type":"blocks","created_at":"2025-12-04T10:59:58.687976-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-72r","title":"Fix @mention shorthand bypassing Commander parsing","description":"## Problem\nThe @mention shorthand (`bdm @alice`) bypasses Commander entirely (src/cli.ts:39-48).\n\n```typescript\nconst args = process.argv.slice(2);\nif (args.length \u003e 0 \u0026\u0026 args[0].startsWith('@')) {\n  mentionsAction(args[0], {...}, program);\n  return;  // Skips program.parse()!\n}\n```\n\nThis means:\n- `--project` flag is ignored → queries wrong database\n- `--json` flag is ignored → loses JSON output\n- No Commander validation happens\n\n## Example\n`bdm @alice --project api` silently queries the local project instead of the linked `api` project.\n\n## Fix Options\n1. Route mentions through a real Commander command (e.g., `bdm mentions @alice`)\n2. Parse global options before dispatching to mentionsAction\n3. Remove the shorthand entirely (breaking change)\n\nOption 2 is likely best: manually parse --project and --json from args before calling mentionsAction.\n\n## Files\n- src/cli.ts:39-48\n\n## Acceptance Criteria\n- `bdm @alice --project api` queries the api project\n- `bdm @alice --json` outputs JSON\n- Existing `bdm @alice` behavior preserved","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-04T14:03:26.586925-08:00","updated_at":"2025-12-19T22:57:34.295466-08:00","closed_at":"2025-12-04T14:10:13.120412-08:00"}
{"id":"fray-7dh1","title":"Sidebar: only show open and stale questions, not closed/wondering counts","description":"The sidebar questions section should only show open-qs and stale-qs lists. Remove closed-qs and wondering from the sidebar display.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T17:54:04.585866-08:00","created_by":"adam","updated_at":"2025-12-31T23:24:16.742753-08:00","closed_at":"2025-12-31T23:24:16.742753-08:00","close_reason":"Removed closed-qs and wondering from sidebar, keeping only actionable open-qs and stale-qs"}
{"id":"fray-7ej","title":"Implement presence commands (here, who)","description":"Create presence commands for viewing active agents.\n\n## Commands\n\n### bdm here\nList active agents (filters out stale and left agents).\n\n```bash\nbdm here                         # active agents only\nbdm here --all                   # include stale\n```\n\n**Output format:**\n```\nalice.419    (2m ago)   \"implementing snake algorithm\"\npm.5         (30s ago)  \"overseeing sprint\"\nbob.3        (5m ago)   \"reviewing auth PR\"\n```\n\n**Implementation:**\n1. Get stale_hours from config (default: 4)\n2. Query getActiveAgents(db, staleHours) or getAllAgents(db) with --all\n3. Filter: left_at IS NULL (unless --all)\n4. Sort by last_seen (most recent first)\n5. Format output with relative time and goal\n\n**JSON output (--json):**\n```json\n[\n  {\"agent_id\": \"alice.419\", \"last_seen\": 1234567890, \"goal\": \"...\"}\n]\n```\n\n### bdm who \u003cagent\u003e\nShow detailed info for agent(s) matching prefix.\n\n```bash\nbdm who alice                    # all alice.* agents\nbdm who alice.419                # specific agent\nbdm who here                     # all active with details\n```\n\n**Output format:**\n```\nalice.419\n  Goal: implementing snake algorithm\n  Bio:  claude-opus, patient problem solver\n  Registered: 2h ago\n  Last seen: 12m ago\n  Status: active\n```\n\n**Implementation:**\n1. If \"here\", get active agents\n2. Otherwise, getAgentsByPrefix(db, prefix)\n3. Format each agent with full details\n4. Status: \"active\", \"stale\", or \"left\"\n\n## Files\n- src/commands/here.ts\n- src/commands/who.ts\n\n## Acceptance Criteria\n- here shows only active agents by default\n- here --all includes stale agents\n- who shows detailed agent info\n- Prefix matching works correctly\n- JSON output is valid and complete","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T10:08:39.507705-08:00","updated_at":"2025-12-19T22:57:34.304971-08:00","closed_at":"2025-12-04T12:37:33.466876-08:00","dependencies":[{"issue_id":"fray-7ej","depends_on_id":"fray-yh4","type":"parent-child","created_at":"2025-12-04T10:10:43.626764-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-7ej","depends_on_id":"fray-2vy","type":"blocks","created_at":"2025-12-04T10:11:35.094797-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-7ej","depends_on_id":"fray-xpd","type":"blocks","created_at":"2025-12-04T10:46:35.05383-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-7ej","depends_on_id":"fray-8jo","type":"blocks","created_at":"2025-12-04T10:46:43.903041-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-7ej","depends_on_id":"fray-6u7","type":"blocks","created_at":"2025-12-04T10:58:40.252551-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-7kr","title":"P0.1: Add GUID columns to schema","description":"Add guid TEXT PRIMARY KEY to mm_messages and mm_agents tables. Generate short GUIDs using 8-char base58 encoding. Remove any existing short_id or display_id columns (GUID-only architecture).\n\nImplementation:\n- Update src/db/schema.ts to add guid column\n- Add GUID generation function (base58, 8 chars)\n- Create migration to populate GUIDs for existing rows\n- Drop short_id/display_id columns if they exist\n\nReferences: PLAN.md sections 1, 2\nCritical file: src/db/schema.ts","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-19T11:57:08.832023-08:00","updated_at":"2025-12-19T22:57:34.293779-08:00","closed_at":"2025-12-19T14:06:01.62647-08:00","close_reason":"Added GUID columns with migration, GUID generator, updated queries/commands/tests"}
{"id":"fray-7mm","title":"P1.5: mm prune with cold storage","description":"Implement mm prune with guardrails and cold storage.\n\nPrune flow:\n1. Check uncommitted changes: git status --porcelain .mm/\n   - If dirty: Error \"Uncommitted changes in .mm/. Commit first.\"\n2. Check remote sync (if remote exists):\n   - git rev-list --count @{u}..HEAD (ahead)\n   - git rev-list --count HEAD..@{u} (behind)\n   - If ahead/behind: Error \"Branch not synced. Push/pull first.\"\n   - If no remote: Skip this check (offline OK)\n3. Archive messages:\n   - Append all messages.jsonl → history.jsonl\n   - Keep last N messages in messages.jsonl (default 100)\n4. Rebuild SQLite from messages.jsonl\n5. Success: \"Pruned to last N messages. Archived to history.jsonl\"\n\nFlags:\n- mm prune (default: keep 100)\n- mm prune --keep 50\n- mm prune --all (delete history.jsonl)\n\nNo counter reset needed (GUID-only architecture).\n\nImplementation:\n- src/commands/prune.ts: Update with guardrails\n- Check git status and remote sync\n- Append to history.jsonl\n- Rewrite messages.jsonl with last N\n\nReferences: PLAN.md section 7\nCritical files: src/commands/prune.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T11:57:26.505276-08:00","updated_at":"2025-12-19T22:57:34.298656-08:00","closed_at":"2025-12-19T15:37:49.452967-08:00","close_reason":"Added prune guardrails and cold storage history handling","dependencies":[{"issue_id":"fray-7mm","depends_on_id":"fray-3vp","type":"blocks","created_at":"2025-12-19T11:57:46.294418-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-7rs","title":"Go Rewrite with Charm TUI","description":"Rewrite mm from TypeScript to Go using Charm ecosystem (Bubbletea, Bubbles, Lip Gloss). Adds rich multi-channel TUI with sidebar, autocomplete, syntax highlighting. Single binary distribution.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-20T12:13:52.168625-08:00","updated_at":"2025-12-21T15:57:42.34642-08:00","closed_at":"2025-12-21T15:57:42.34642-08:00","close_reason":"Go rewrite complete - all phases implemented","dependencies":[{"issue_id":"fray-7rs","depends_on_id":"fray-dkh","type":"blocks","created_at":"2025-12-20T12:27:39.994271-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-7ze","title":"Chat: expand input area for wrapped text up to 8 lines","description":"When entering text that wraps to multiple lines, the input area should expand vertically to show all content up to 8 lines. After 8 lines, scroll internally instead of continuing to expand.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-21T16:01:15.124243-08:00","updated_at":"2025-12-21T17:04:12.155777-08:00","closed_at":"2025-12-21T17:04:12.155777-08:00","close_reason":"Implemented"}
{"id":"fray-822","title":"Autocomplete: show agent with nicks when partial match","description":"When typing @devrel and the agent is mlld-devrel with nick 'devrel', autocomplete should show:\n\n  mlld-devrel (aka devrel)\n\nOr show matching nicks alongside the primary name so user knows they resolve to the same agent.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-21T12:35:12.192538-08:00","updated_at":"2025-12-21T22:58:22.165743-08:00","closed_at":"2025-12-21T22:58:22.165743-08:00","close_reason":"Implemented"}
{"id":"fray-87l","title":"Bug: Tab opens sidebar when autocomplete is active","description":"When user has triggered autocomplete state (typing @ or #), pressing Tab should complete the selection, not open the channel sidebar. Temporarily suppress sidebar toggle when autocomplete popup is visible.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-22T12:09:10.23655-08:00","updated_at":"2025-12-22T12:12:19.567131-08:00","closed_at":"2025-12-22T12:12:19.567131-08:00","close_reason":"Fixed by agents"}
{"id":"fray-8dpw","title":"Extract hook commands to separate package","description":"Move 5 hook-related commands (hook_*.go, 830+ lines total) from internal/command/ to internal/command/hooks/ subdirectory. These are infrastructure for Claude Code integration, not user-facing commands.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-31T23:53:31.201175-08:00","created_by":"adam","updated_at":"2025-12-31T23:53:31.201175-08:00"}
{"id":"fray-8jm","title":"Go: Add ls command to list channels","description":"Missing 'mm ls' command to list known channels from global config.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-21T01:28:47.043763-08:00","updated_at":"2025-12-21T01:45:08.822163-08:00","closed_at":"2025-12-21T01:45:08.822163-08:00","close_reason":"Implemented in Go"}
{"id":"fray-8jo","title":"Implement timestamp utilities","description":"Create src/core/time.ts with timestamp formatting utilities.\n\n## Functions to Implement\n\n```typescript\n// src/core/time.ts\n\n/**\n * Format unix timestamp as relative time.\n * @example formatRelative(now - 120) -\u003e \"2m ago\"\n * @example formatRelative(now - 3600) -\u003e \"1h ago\"\n * @example formatRelative(now - 86400) -\u003e \"1d ago\"\n */\nexport function formatRelative(ts: number): string;\n\n/**\n * Check if an agent is stale based on last seen time.\n * @param lastSeen - unix timestamp of last activity\n * @param staleHours - hours of inactivity threshold\n */\nexport function isStale(lastSeen: number, staleHours: number): boolean;\n\n/**\n * Get current unix timestamp.\n */\nexport function now(): number;\n```\n\n## Relative Time Formatting Rules\n| Duration | Format |\n|----------|--------|\n| \u003c 60s | \"Xs ago\" (e.g., \"30s ago\") |\n| \u003c 60m | \"Xm ago\" (e.g., \"5m ago\") |\n| \u003c 24h | \"Xh ago\" (e.g., \"2h ago\") |\n| \u003c 7d | \"Xd ago\" (e.g., \"3d ago\") |\n| \u003e= 7d | \"Xw ago\" (e.g., \"2w ago\") |\n\nSpecial case:\n- \"just now\" for \u003c 5 seconds (optional, can use \"0s ago\")\n\n## Implementation Notes\n- Use Math.floor for all divisions\n- Unix timestamps are in seconds (not milliseconds)\n- isStale: lastSeen + (staleHours * 3600) \u003c now()\n\n## Files\n- src/core/time.ts\n\n## Acceptance Criteria\n- Relative time is human-readable\n- Stale detection works correctly\n- Unit tests for various time ranges\n- Edge cases: exactly on boundary values","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T10:05:18.073351-08:00","updated_at":"2025-12-19T22:57:34.305887-08:00","closed_at":"2025-12-04T12:29:35.216636-08:00","dependencies":[{"issue_id":"fray-8jo","depends_on_id":"fray-dk4","type":"parent-child","created_at":"2025-12-04T10:07:09.812457-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-8jo","depends_on_id":"fray-bml","type":"blocks","created_at":"2025-12-04T10:59:53.56-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-8xb","title":"Implement comprehensive error handling","description":"Create error handling utilities for clear, actionable error messages.\n\n## Error Categories\n\n### Project Errors\n- Not in beads project: \"Not in a beads project. Run 'bd init' first.\"\n- Linked project not found: \"Linked project 'api' not found at /path/to/project\"\n- Linked path not a beads project: \"Path /path/to/dir is not a beads project\"\n\n### Agent Errors\n- Unknown agent: \"Unknown agent: alice.999\"\n- Agent not active: \"Agent alice.419 is not active. Use 'bdm hi alice.419' to resume.\"\n- Agent already active: \"alice.419 is already active\"\n- Agent already left: \"alice.419 has already left\"\n- Invalid agent ID: \"Invalid agent ID: 'alice' (missing version number)\"\n\n### Message Errors\n- Empty message: \"Message cannot be empty\"\n\n### Config Errors\n- Unknown key: \"Unknown config key: foo\"\n- Invalid value: \"Invalid value for stale_hours: must be a positive integer\"\n\n## Implementation\n\n```typescript\n// src/errors.ts\n\nexport class BdmError extends Error {\n  constructor(message: string, public readonly code: string) {\n    super(message);\n    this.name = 'BdmError';\n  }\n}\n\nexport class NotInProjectError extends BdmError {\n  constructor() {\n    super(\"Not in a beads project. Run 'bd init' first.\", 'NOT_IN_PROJECT');\n  }\n}\n\nexport class UnknownAgentError extends BdmError {\n  constructor(agentId: string) {\n    super(\\`Unknown agent: \\${agentId}\\`, 'UNKNOWN_AGENT');\n  }\n}\n\n// etc.\n```\n\n## CLI Error Wrapper\n\n```typescript\n// src/cli.ts\n\nasync function run(fn: () =\u003e Promise\u003cvoid\u003e) {\n  try {\n    await fn();\n    process.exit(0);\n  } catch (err) {\n    if (err instanceof BdmError) {\n      console.error(\\`Error: \\${err.message}\\`);\n      process.exit(1);\n    }\n    // Unexpected error\n    console.error('Unexpected error:', err);\n    process.exit(2);\n  }\n}\n```\n\n## Exit Codes\n- 0: Success\n- 1: Known error (BdmError)\n- 2: Unexpected error\n\n## Files\n- src/errors.ts\n- src/cli.ts (update error handling)\n\n## Acceptance Criteria\n- All error messages are clear and actionable\n- Exit codes are consistent\n- Stack traces not shown for expected errors\n- Unexpected errors show debug info","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T10:17:20.919183-08:00","updated_at":"2025-12-19T22:57:34.302651-08:00","closed_at":"2025-12-04T12:44:17.326819-08:00","dependencies":[{"issue_id":"fray-8xb","depends_on_id":"fray-po1","type":"parent-child","created_at":"2025-12-04T10:19:00.456116-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-8xf","title":"Design: Claude Desktop project discovery and MCP architecture","description":"Design how Claude Desktop discovers and connects to beads projects via MCP.\n\n## Context\n\n**bdm** (beads-messenger) is a CLI for agent-to-agent messaging in beads projects. It stores messages in `.beads/*.db` (same SQLite database as beads issue tracker). Current features:\n- Agents register with `bdm new \u003cname\u003e` and get IDs like `alice.1`\n- Messages posted with `bdm post --as alice.1 \"message\"`\n- @mentions for routing (`@bob.2`, `@all`)\n- `bdm chat` for interactive user participation\n\n**Goal**: Add an MCP server so Claude Desktop can join rooms as an agent.\n\n**MCP** (Model Context Protocol) lets Claude Desktop connect to external tools/data:\n- **Tools**: Actions Claude calls on-demand (`bdm_post`, `bdm_get`)\n- **Resources**: Data auto-loaded into context (`bdm://room` with recent messages)\n\n## Questions to Answer\n\n1. **Project Discovery**\n   - How does Claude Desktop know which projects exist?\n   - Options: config file, auto-discovery, manual add via UI\n   - Where would config live? `~/.config/bdm/projects.json`?\n\n2. **Connection Model**\n   - One MCP server per project? Or one server serving multiple projects?\n   - How to switch between projects in conversation?\n   - Can Claude Desktop handle multiple MCP connections?\n\n3. **Agent Identity**\n   - Auto-register on connect? Or require explicit `bdm_new`?\n   - Persist agent ID across sessions? (Same `claude.1` every time vs new ID)\n   - Storage: config file, server memory, or stateless?\n\n4. **Tools vs Resources**\n   - **Tools** (likely): `bdm_new`, `bdm_post`, `bdm_get`, `bdm_here`, `bdm_bye`\n   - **Resources** (maybe): `bdm://room`, `bdm://mentions/{agent}`\n   - Start tools-only for simplicity? Resources add ambient awareness.\n\n5. **Configuration**\n   - Claude Desktop config: `~/Library/Application Support/Claude/claude_desktop_config.json`\n   - How to add bdm-mcp there?\n   - Example: `{\"mcpServers\": {\"bdm\": {\"command\": \"npx\", \"args\": [\"bdm-mcp\", \"/path/to/project\"]}}}`\n\n## Deliverable\n\nWrite to PLAN-mcp.md:\n- Recommended architecture diagram\n- User flow for connecting Claude Desktop to a project\n- MCP server interface (tools + resources definitions)\n- Config file formats\n- Implementation phases\n\n## Dependencies\n\n- Findings from bdm-0od (beads daemon investigation)\n\n## Parent Epic\n\nbdm-ae4: MCP Server for Claude Desktop Integration","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-05T16:35:17.103598-08:00","updated_at":"2025-12-19T22:57:34.294653-08:00","closed_at":"2025-12-05T17:28:30.22267-08:00"}
{"id":"fray-90g","title":"Add 'export' command","description":"Export thread/channel to file.\n\n```bash\nfray export thrd-xyz \u003e discussion.txt\nfray export --channel \u003e full-channel.md\nfray export --format markdown thrd-xyz\nfray export --format json thrd-xyz\n```\n\nOutput formats:\n- Plain text (default)\n- Markdown with metadata\n- JSON for programmatic use\n\nUse cases: documentation, archiving, sharing outside fray.","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-30T16:47:25.980687-08:00","created_by":"adam","updated_at":"2025-12-30T16:47:25.980687-08:00"}
{"id":"fray-92p","title":"Implement mention parsing utilities","description":"Create src/core/mentions.ts with @mention extraction and matching utilities.\n\n## Mention Format\n- Mentions start with @ followed by agent ID or prefix\n- @all is special broadcast mention\n- Can mention full IDs (@alice.419) or prefixes (@alice)\n- Examples: @alice, @alice.419, @pm.3.sub, @all\n\n## Functions to Implement\n\n```typescript\n// src/core/mentions.ts\n\n/**\n * Extract all @mentions from message body.\n * Returns mention targets without @ prefix.\n * @example extractMentions(\"hey @alice.1 and @bob.3\") -\u003e [\"alice.1\", \"bob.3\"]\n * @example extractMentions(\"@all heads up\") -\u003e [\"all\"]\n * @example extractMentions(\"@alice check this\") -\u003e [\"alice\"]\n */\nexport function extractMentions(body: string): string[];\n\n/**\n * Check if an agent ID matches a mention prefix.\n * Used to determine if a message is relevant to an agent.\n * @example matchesMention(\"alice.419\", \"alice\") -\u003e true (prefix match)\n * @example matchesMention(\"alice.419\", \"alice.419\") -\u003e true (exact match)\n * @example matchesMention(\"alice.frontend.3\", \"alice\") -\u003e true (prefix match)\n * @example matchesMention(\"bob.1\", \"alice\") -\u003e false\n */\nexport function matchesMention(agentId: string, mentionPrefix: string): boolean;\n\n/**\n * Check if a mention is the broadcast mention.\n */\nexport function isAllMention(mention: string): boolean;\n\n/**\n * Highlight mentions in message body for display (optional - can defer to Phase 5).\n * @example highlightMentions(\"hey @alice\") -\u003e \"hey \\x1b[36m@alice\\x1b[0m\"\n */\nexport function highlightMentions(body: string): string;\n```\n\n## Regex Pattern for Mentions\n```typescript\n// Match @ followed by:\n// - \"all\" (broadcast)\n// - OR valid agent ID/prefix: starts with letter, then letters/numbers/dots\n// The pattern allows both full IDs (alice.419) and prefixes (alice)\nconst MENTION_REGEX = /@(all|[a-z][a-z0-9]*(?:\\.[a-z0-9]+)*)/g;\n```\n\nNote: This regex matches both `@alice` (prefix) and `@alice.419` (full ID). The `.419` part is captured because `[a-z0-9]+` allows digits.\n\n## matchesMention Logic\n```typescript\nfunction matchesMention(agentId: string, mentionPrefix: string): boolean {\n  // Exact match\n  if (agentId === mentionPrefix) return true;\n  // Prefix match: agentId starts with prefix followed by dot\n  if (agentId.startsWith(mentionPrefix + '.')) return true;\n  return false;\n}\n```\n\n## Edge Cases\n- Multiple mentions in one message: \"@alice @bob both of you\"\n- Mentions at start/end of message\n- Mentions with punctuation after: \"@alice, please\" → extracts \"alice\"\n- @all mixed with specific mentions: \"@all and especially @alice\"\n- Email-like strings should NOT match: \"contact@alice.com\" should not extract \"alice.com\"\n  - The regex handles this because it requires @ at word boundary\n\n## Files\n- src/core/mentions.ts\n\n## Acceptance Criteria\n- Extracts all valid mentions from message body\n- Does not extract from email addresses\n- Handles punctuation correctly\n- Prefix matching works per spec\n- Unit tests cover all patterns including edge cases","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T10:04:41.987627-08:00","updated_at":"2025-12-19T22:57:34.306214-08:00","closed_at":"2025-12-04T12:31:00.864701-08:00","dependencies":[{"issue_id":"fray-92p","depends_on_id":"fray-dk4","type":"parent-child","created_at":"2025-12-04T10:07:04.689551-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-92p","depends_on_id":"fray-6u7","type":"blocks","created_at":"2025-12-04T10:07:23.734885-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-9ds","title":"Show nicks in roster and info output","description":"When listing agents in roster and info, show their nicknames. E.g.:\n  @devrel (aka @helper, @dr)\n    status: working on docs\n    last seen: 5m ago","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-21T12:27:29.385149-08:00","updated_at":"2025-12-21T15:54:51.483825-08:00","closed_at":"2025-12-21T15:54:51.483825-08:00","close_reason":"Implemented in Go rewrite"}
{"id":"fray-9kh","title":"Prune: preserve thread integrity","description":"When pruning, preserve parent messages for any replies in the keep window. Walk up the reply_to chain and add those parents to the keep set.\n\nExample with --keep 3:\n  msg-1: \"Project idea\"\n  msg-2: \"Sounds good\" (reply to msg-1)\n  msg-3: \"Random update\"\n  msg-4: \"Another thing\"\n  msg-5: \"Question\"\n  msg-6: \"Answer\" (reply to msg-5)  ← in keep window\n  msg-7: \"Latest\"                   ← in keep window\n  msg-8: \"Got it\" (reply to msg-7)  ← in keep window\n\nResult: Keep msg-5, msg-6, msg-7, msg-8 (msg-5 pulled in as parent of msg-6)\nPrune: msg-1 through msg-4 (old thread has no replies in keep window)\n\nKey: \"preserve parents of active replies\" not \"preserve all threads\".","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-21T10:58:15.528352-08:00","updated_at":"2025-12-21T17:04:12.155122-08:00","closed_at":"2025-12-21T17:04:12.155122-08:00","close_reason":"Implemented"}
{"id":"fray-9mq","title":"Fix 'ago ago' duplication in claims output","description":"Claims output shows 'src/test.ts (6s ago ago)' with duplicate 'ago'. Affects both TS and Go implementations.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-21T01:29:20.292687-08:00","updated_at":"2025-12-21T01:46:11.577467-08:00","closed_at":"2025-12-21T01:46:11.577467-08:00","close_reason":"Fixed duplicate 'ago' in claims output"}
{"id":"fray-9o8s","title":"Chat: main channel should scroll to last prune point","description":"Main channel in fray chat doesn't scroll through full history. Expected: should be able to scroll back to the last prune point.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-31T23:38:06.794714-08:00","created_by":"adam","updated_at":"2025-12-31T23:54:50.269774-08:00","closed_at":"2025-12-31T23:54:50.269774-08:00","close_reason":"Fixed in chat bug batch: filtered deleted messages, fixed thread scroll bounce, added near-top preload, refactored answer to Bubble Tea TUI"}
{"id":"fray-9s6","title":"Fix config command printing undefined for missing keys","description":"## Problem\n`bdm config \u003ckey\u003e` prints `key: undefined` for missing entries (src/commands/config.ts:32-43).\n\n```typescript\nconst configValue = getConfig(db, normalizedKey);\nif (configValue === null) {  // Only checks null, not undefined!\n  console.log(\\`Config key '\\${key}' not found\\`);\n} else {\n  console.log(\\`\\${key}: \\${configValue}\\`);  // Prints \"key: undefined\"\n}\n```\n\n## Issues\n1. Only checks for `null`, but `getConfig` may return `undefined`\n2. Should exit with non-zero code for missing keys (scripting)\n3. JSON mode outputs `{\"key\": null}` which is ambiguous\n\n## Fix\n1. Check `configValue == null` (catches both null and undefined)\n2. Call `process.exit(1)` for missing keys\n3. Consider whether JSON should include the key at all when missing\n\n## Files\n- src/commands/config.ts:32-43\n\n## Acceptance Criteria\n- `bdm config unknown-key` prints \"not found\" message\n- Exit code is 1 for missing keys\n- No \"undefined\" in output","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-04T14:03:26.784839-08:00","updated_at":"2025-12-19T22:57:34.301723-08:00","closed_at":"2025-12-04T14:26:40.621581-08:00"}
{"id":"fray-9si","title":"Implement post command","description":"Implement the post command for sending messages.\n\n## Usage\n\n```bash\nbdm post --as alice.419 \"hello world\"\nbdm post --as alice.419 \"@bob.3 check auth.py:47\"\nbdm post --as pm.5 \"@all standup in 5\"\n```\n\n## Implementation\n\n1. Validate --as agent exists and is active\n2. Extract mentions from message body\n3. Create message with:\n   - ts: now()\n   - from_agent: agent ID from --as\n   - body: message text\n   - mentions: extracted mentions array\n4. Update agent's last_seen to now()\n5. Output: Show the posted message\n\n## Validation\n\n**Agent validation:**\n- Agent must exist\n- Agent must not have left_at set (or be resumed first)\n- Error: \"Agent alice.419 is not active. Use 'bdm hi alice.419' to resume.\"\n\n**Message validation:**\n- Body must not be empty\n- Error: \"Message cannot be empty\"\n\n## Side Effects\n- Creates message in bdm_messages\n- Updates agent's last_seen (heartbeat)\n\n## Output\n\n```\nPosted:\n[45] alice.419 (just now): hello world\n```\n\nOr minimal:\n```\n→ [45]\n```\n\n## JSON Output\n\n```json\n{\n  \"id\": 45,\n  \"ts\": 1234567890,\n  \"from_agent\": \"alice.419\",\n  \"body\": \"hello world\",\n  \"mentions\": []\n}\n```\n\n## Files\n- src/commands/post.ts\n\n## Acceptance Criteria\n- Post creates message correctly\n- Mentions are extracted and stored\n- Agent last_seen is updated\n- Validation rejects inactive agents\n- Validation rejects empty messages","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T10:09:31.908202-08:00","updated_at":"2025-12-19T22:57:34.304101-08:00","closed_at":"2025-12-04T12:37:47.554217-08:00","dependencies":[{"issue_id":"fray-9si","depends_on_id":"fray-yh4","type":"parent-child","created_at":"2025-12-04T10:10:59.02053-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-9si","depends_on_id":"fray-2vy","type":"blocks","created_at":"2025-12-04T10:11:50.46289-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-9si","depends_on_id":"fray-92p","type":"blocks","created_at":"2025-12-04T10:45:51.774855-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-9si","depends_on_id":"fray-dgt","type":"blocks","created_at":"2025-12-04T10:46:24.834651-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-a5w","title":"Add merge command for combining agent history","description":"mm merge @partydev @party-dev - Merge chat history from one agent into another. Useful when same person registered under slightly different names.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-21T09:05:40.111785-08:00","updated_at":"2025-12-21T15:54:51.481558-08:00","closed_at":"2025-12-21T15:54:51.481558-08:00","close_reason":"Implemented in Go rewrite"}
{"id":"fray-a88l","title":"Answer display polish: byline tag format","description":"In chat view, 'answered @opus' should be inside the colored byline tag so it reads '@adam answered @opus:' instead of '@adam:' on one line and 'answered @opus' on the next.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-31T17:47:13.267827-08:00","created_by":"adam","updated_at":"2025-12-31T17:47:13.267827-08:00"}
{"id":"fray-ae4","title":"MCP Server for Claude Desktop Integration","description":"Add an MCP server to bdm that allows Claude Desktop to participate in project chat rooms as an agent.\n\n## Context\n\n**bdm** (beads-messenger) is a CLI for agent-to-agent messaging in beads projects. Currently works via:\n- CLI commands (`bdm post`, `bdm get`, `bdm new`)\n- Claude Code hooks (ambient context injection)\n- Interactive chat (`bdm chat`)\n\n**MCP** (Model Context Protocol) is Anthropic's protocol for connecting Claude to external tools/data. Adding an MCP server would let **Claude Desktop** (not just Claude Code) participate in project rooms.\n\n## Goal\n\nClaude Desktop users can:\n- Connect to a beads project\n- Register as an agent (`bdm_new`)\n- Post messages (`bdm_post`) \n- Read room + @mentions (`bdm_get`)\n- See who's active (`bdm_here`)\n- Leave (`bdm_bye`)\n\n## Key Questions\n\n1. **Daemon architecture**: beads uses one daemon per project. Should bdm:\n   - Extend the beads daemon?\n   - Run its own daemon?\n   - Be stateless (discover project per-call)?\n\n2. **Multi-project**: How does Claude Desktop know which projects to connect to?\n\n3. **Resources vs Tools**: \n   - Tools: on-demand actions\n   - Resources: auto-loaded context (room messages in context window)\n\n4. **Agent identity**: How to persist agent ID across MCP calls?\n\n## Planned Implementation\n\n```\nsrc/mcp/\n  server.ts      # MCP server entry\n  tools.ts       # Tool handlers  \n  resources.ts   # Resource handlers (if needed)\nbin/\n  bdm-mcp.ts     # Entry point for \"npx bdm-mcp\"\n```\n\n## Child Issues\n\n| Issue | Title | Status |\n|-------|-------|--------|\n| bdm-0od | Investigate beads daemon architecture | open |\n| bdm-8xf | Design: Claude Desktop project discovery | open |\n| TBD | Implement MCP server with tools | - |\n| TBD | Add resources for ambient context | - |\n\n## Resources\n\n- MCP docs: https://modelcontextprotocol.io/docs\n- MCP TypeScript SDK: @modelcontextprotocol/sdk\n- Claude Desktop config: ~/Library/Application Support/Claude/claude_desktop_config.json","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-05T16:34:48.910772-08:00","updated_at":"2025-12-19T22:57:34.313259-08:00","closed_at":"2025-12-06T09:04:54.613653-08:00"}
{"id":"fray-aex","title":"Go: Add edit command","description":"Missing 'mm edit \u003cmsgid\u003e \u003cmessage\u003e' command to edit posted messages.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-21T01:29:04.388839-08:00","updated_at":"2025-12-21T01:49:46.741764-08:00","closed_at":"2025-12-21T01:49:46.741764-08:00","close_reason":"Implemented in Go"}
{"id":"fray-aiw","title":"Highlight user mentions in default color","description":"User mentions like @adam should be visually distinct but use the terminal's default color.\n\n## Current Behavior\n\nWhen agents mention users like @adam, the mention appears as plain text because users don't have entries in the bdm_agents table. Only registered agent mentions get colorized.\n\nExample:\n- `@validation.1` → colored (registered agent)\n- `@adam` → plain text (user, no visual distinction)\n\n## Desired Behavior\n\nUser mentions should be highlighted in the terminal's default/reset color (white text on dark terminals, black on light terminals). This makes them visually distinct from plain text while differentiating them from agent mentions.\n\nExample:\n- `@validation.1` → colored with agent's color (e.g., green background)\n- `@adam` → bold or underlined in default terminal color\n\n## Implementation\n\nAdd a third category of mention highlighting:\n\n1. **Agent mentions** (in agentBases): Use agent's color\n2. **User mentions** (not in agentBases, but looks like a name): Use default/reset color with bold\n3. **Everything else** (@payload, @foobar): Plain text\n\n**Detection heuristic for users:**\n- Not in agentBases set\n- Length 3-15 characters\n- No dots (distinguishes from agent IDs)\n- Alphanumeric only\n\n**Styling**: `${BOLD}${match}${RESET}${senderColor}` (bold in default color)\n\n## Files to Modify\n\n- `src/commands/format.ts` - Update `colorizeBody()` to handle user mentions\n- `src/chat/display.ts` - Update `colorizeBody()` to handle user mentions\n\n## Testing\n\n```bash\nbdm post --as test.1 \"Hey @adam can you review this?\"\nbdm get --last 1  # @adam should be bold in default color\n```","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-07T17:20:57.581699-08:00","updated_at":"2025-12-19T22:57:34.31283-08:00","closed_at":"2025-12-07T17:26:46.773194-08:00"}
{"id":"fray-aj6","title":"fray get \u003cagent\u003e should default to unread-only","description":"The watermark system (4258ebd) tracks read positions but `fray get \u003cagent\u003e` doesn't use it by default.\n\n## Current Behavior\n- `fray get \u003cagent\u003e` returns last N room messages regardless of watermark\n- Agents waste tokens re-reading already-seen messages\n\n## Proposed Behavior\n- `fray get \u003cagent\u003e` → unread only (messages since agent's watermark)\n- `fray get \u003cagent\u003e --last 10` → last 10 regardless of watermark (cap at 10-20)\n- `fray get \u003cagent\u003e --since X --to Y` → explicit range for history pagination\n- Remove or hide `--all` for agents (token waste)\n\n## Additional: Chained Replies in Mentions\nReplies to an agent's messages (via reply chain) should be included in the 'mentions' result, not just explicit @mentions. If someone replies to my question, I should see it even without an explicit @designer.\n\n## Context\nDiscovered during design session - agents repeatedly calling `fray get designer --room 8` burning tokens on already-read content.\n\nSee msg-wor9q3ge for discussion, msg-kj4bo1tn for reply chain note.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-31T14:42:38.378412-08:00","created_by":"adam","updated_at":"2025-12-31T23:19:39.160988-08:00","closed_at":"2025-12-31T23:19:39.160988-08:00","close_reason":"Implemented watermark-based unread filtering for room messages, --last override, reply chain inclusion in mentions, and unread-only mention filtering"}
{"id":"fray-ayw","title":"Replace --last suggestion with --since, add token limit","description":"The suggestion at the end of `bdm get` encourages agents to use `--last 50` which immediately consumes all their tokens.\n\n## Current Behavior\n\nAt the end of `bdm get alice.1`, we show:\n```\nMore: bdm get --last 50 | bdm @alice --all | bdm get --since \u003cid\u003e\n```\n\nAgents see `--last 50` and immediately run it, eating their context.\n\n## Desired Behavior\n\n1. Remove `--last 50` suggestion entirely\n2. Suggest `bdm get --since \u003cid\u003e` instead\n3. Add token protection: error if requesting more than 10 messages back without explicit flag\n\n**New suggestion line:**\n```\nMore: bdm @alice --all | bdm get --since \u003cid\u003e\n```\n\n**Token limit enforcement:**\n```bash\nbdm get --last 50        # ERROR: \"Requesting 50 messages. Use --bypass-token-limit to proceed.\"\nbdm get --since 100      # If \u003e10 messages: ERROR with same message\nbdm get --last 50 --bypass-token-limit   # OK, proceeds\n```\n\n## Implementation\n\n- Remove `--last 50` from suggestion in get.ts\n- Add validation in get.ts and mentions.ts:\n  - Count how many messages would be returned\n  - If \u003e10, error unless `--bypass-token-limit` flag is present\n- Add `--bypass-token-limit` flag to relevant commands\n\n## Files\n\n- src/commands/get.ts - Update suggestion, add token limit check\n- src/commands/mentions.ts - Add token limit check","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-09T06:12:03.002401-08:00","updated_at":"2025-12-19T22:57:34.312627-08:00"}
{"id":"fray-az3","title":"Add type column to bdm_messages table","description":"Add a `type` column to distinguish user messages from agent messages.\n\n## Changes\n\n1. **src/db/schema.ts** - Add migration logic:\n   - Check if column exists with `PRAGMA table_info(bdm_messages)`\n   - If missing: `ALTER TABLE bdm_messages ADD COLUMN type TEXT DEFAULT 'agent'`\n\n2. **src/types.ts** - Update interfaces:\n   ```typescript\n   export type MessageType = 'user' | 'agent';\n   export interface Message {\n     // ... existing\n     type: MessageType;\n   }\n   ```\n\n3. **src/db/queries.ts** - Update functions:\n   - `createMessage()` accepts optional `type` parameter (default 'agent')\n   - `parseMessageRow()` includes type field\n\n## Exit Criteria\n- Existing messages have type='agent' after migration\n- New messages can specify type='user' or type='agent'\n- All existing tests pass","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-05T15:49:59.514678-08:00","updated_at":"2025-12-19T22:57:34.314018-08:00","closed_at":"2025-12-05T15:56:24.971371-08:00"}
{"id":"fray-b1j","title":"Design: Conversation primitives (threads, questions, answers, tasks, notes)","description":"Design and implement structured conversation primitives for multi-agent coordination.\n\n**Spec**: docs/THREADS-SPEC.md\n\nCore insight: Messages are facts, threads are bookmarks.\n\nPrimitives:\n- Threads (bookmarks on message chains, implicit vs explicit)\n- Questions (with respondents + decider)\n- Answers (with confidence scores, is_decision flag)\n- Tasks (agent work queue, can link to beads)\n- Notes (agent memory/scratchpad)\n\nInspired by And Bang (2012) - real-time team coordination.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-23T04:36:54.766126-08:00","updated_at":"2025-12-30T16:13:05.826002-08:00","closed_at":"2025-12-30T16:13:05.826002-08:00","close_reason":"MVP complete: threads, questions, answers, notes all implemented. Tasks deferred to beads integration."}
{"id":"fray-b56","title":"Add reactions for short replies (\u003c20 char)","description":"Reactions are 1-20 char responses (including emoji) that attach to messages rather than being full messages.\n\nSyntax: #id 👍 or #id let's do it\n\nStorage:\n- Messages have a reactions object\n- JSON groups users by reaction text:\n  {\"reactions\": {\"👍\": [\"alice\", \"bob\"], \"let's do it\": [\"charlie\"]}}\n\nDisplay in mentions:\n- Grouped: '\u003cuser\u003e, \u003cuser\u003e reacted \"👍\" to \"#msg-id Some truncated...\"'\n\nLive chat behavior:\n- If reaction arrives after chat opened: append inline italic event + amend original message\n- Event format: '\u003cuser\u003e reacted \"x\" to \"#msgid Some message...\"' (no byline, just event)\n\nAuto-detection:\n- All replies \u003c20 chars become reactions by default\n\nVisual feedback in input:\n- Text color yellow when \u003c20 chars (reaction mode)\n- Normal color when \u003e=20 chars (reply mode)\n\nRemoval:\n- Reactions can be removed but not edited\n- Syntax: mm unreact #msg-id (removes your reaction)\n\nAllows informal polls and quick responses without cluttering chat.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-21T14:03:59.749902-08:00","updated_at":"2025-12-21T15:54:51.483258-08:00","closed_at":"2025-12-21T15:54:51.483258-08:00","close_reason":"Implemented in Go rewrite"}
{"id":"fray-bcx","title":"Enhance UserPromptSubmit hook with status line","description":"Add compact status line to UserPromptSubmit hook:\n- Asked questions count\n- Wondered questions count  \n- Unread count (once summary command exists)\n- Claims status (all agents, for collision awareness)\n\nFormat: `[fray opus] asked:2 wondered:1 | claims: @alice (auth.go)`\n\nFiles: internal/command/hook_prompt.go","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-31T08:01:09.723069-08:00","created_by":"adam","updated_at":"2025-12-31T10:33:01.300414-08:00","closed_at":"2025-12-31T10:33:01.300414-08:00","close_reason":"Implemented hook-statusline command, enhanced UserPromptSubmit with statusline, added SessionStart resume tickler, added PreCompact hook"}
{"id":"fray-beb","title":"P7: Syntax Highlighting (P3 feature)","description":"Add Chroma-based syntax highlighting for code blocks. Port mlld TextMate grammar to Chroma lexer. Detect fenced code blocks, apply highlighting. ~8 hours.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T12:17:47.437229-08:00","updated_at":"2025-12-21T01:27:06.006305-08:00","closed_at":"2025-12-21T01:27:06.006305-08:00","close_reason":"Completed in Go rewrite","dependencies":[{"issue_id":"fray-beb","depends_on_id":"fray-m6c","type":"blocks","created_at":"2025-12-20T12:22:36.578322-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-bfj","title":"Poller plugin system for external event sources","description":"Add a plugin system for polling external systems and injecting messages into the mm room. Like webhooks but pull-based since there's no endpoint.\n\n## Design\n\n**Configuration** (in mm-config.json):\n```json\n{\n  \"pollers\": [\n    {\n      \"package\": \"mm-poller-beads\",\n      \"config\": {\n        \"path\": \".beads\"\n      }\n    },\n    {\n      \"package\": \"mm-poller-github\",\n      \"config\": {\n        \"repo\": \"adamavenir/mini-msg\",\n        \"events\": [\"issues\", \"pull_requests\"],\n        \"token_env\": \"GITHUB_TOKEN\"\n      },\n      \"interval\": 60000\n    }\n  ]\n}\n```\n\n**Polling triggers:**\n- Lazy: Any `mm` command runs all pollers once before executing\n- Active: `mm watch` / `mm chat` run pollers on interval in addition to lazy\n\n**Cursor storage** (.mm/poller-state.json):\n```json\n{\n  \"mm-poller-beads\": { \"cursor\": \"2025-12-19T10:30:00Z\", \"lastPoll\": 1734567890 },\n  \"mm-poller-github\": { \"cursor\": \"etag:abc123\", \"lastPoll\": 1734567850 }\n}\n```\n\n**Poller interface:**\n```typescript\nexport interface Poller {\n  name: string;\n  defaultInterval?: number;\n  poll(ctx: PollerContext): Promise\u003cPollResult\u003e;\n}\n\nexport interface PollerContext {\n  config: Record\u003cstring, unknown\u003e;\n  cursor: string | null;\n  projectPath: string;\n}\n\nexport interface PollResult {\n  messages: PollerMessage[];\n  cursor: string | null;\n}\n\nexport interface PollerMessage {\n  body: string;\n  mentions?: string[];\n  source?: string;        // e.g. \"github:issues/123\"\n}\n```\n\nmm creates messages with `from_agent: poller.name`, `type: 'event'`.\n\n## Implementation tasks\n- [ ] Define poller interface in src/pollers/types.ts\n- [ ] Add poller config schema to mm-config.json\n- [ ] Add poller-state.json read/write helpers\n- [ ] Create runPollers() function that loads and executes configured pollers\n- [ ] Call runPollers() lazily from shared.ts (before command execution)\n- [ ] Call runPollers() on interval in watch.ts and chat.ts\n- [ ] Create mm-poller-beads package (watches .beads/issues.jsonl)\n- [ ] Create mm-poller-github package (optional, example)","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-19T22:20:27.468386-08:00","updated_at":"2025-12-19T22:57:34.314768-08:00"}
{"id":"fray-bml","title":"Create directory structure and entry points","description":"Create the project directory structure and minimal entry point files.\n\n## Directory Structure\n```\nbeads-messenger/\n├── src/\n│   ├── cli.ts           # Commander program setup\n│   ├── commands/        # Command implementations (empty for now)\n│   ├── db/              # Database layer (empty for now)\n│   ├── core/            # Business logic (empty for now)\n│   └── types.ts         # Type definitions (placeholder)\n├── bin/\n│   └── bdm.ts           # CLI entry point (hashbang)\n├── tests/               # Test files (empty for now)\n├── package.json\n├── tsconfig.json\n└── tsup.config.ts\n```\n\n## Files to Create\n\n### bin/bdm.ts\n```typescript\n#!/usr/bin/env node\nimport { main } from '../src/cli.js';\nmain();\n```\n\n### src/cli.ts\nNote: Importing version from package.json is tricky with ESM. Use one of:\n- Read package.json with fs and JSON.parse\n- Hardcode version and update on release\n- Use a build-time replacement\n\nSimple approach for now:\n```typescript\nimport { Command } from 'commander';\n\nconst VERSION = '0.1.0';  // TODO: sync with package.json\n\nexport function main() {\n  const program = new Command();\n  program\n    .name('bdm')\n    .description('Agent messaging for beads projects')\n    .version(VERSION);\n  \n  program.parse();\n}\n```\n\n### src/types.ts\n```typescript\n// Placeholder - full types defined in bdm-6cj\nexport interface Agent {\n  agent_id: string;\n}\n\nexport interface Message {\n  id: number;\n}\n```\n\n### Empty directories\nCreate with .gitkeep or placeholder files:\n- src/commands/\n- src/db/\n- src/core/\n- tests/\n\n## Acceptance Criteria\n- `npm run build` completes successfully\n- `./dist/bin/bdm.js --version` outputs \"0.1.0\"\n- `./dist/bin/bdm.js --help` shows usage\n- All directories exist","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T09:56:48.142467-08:00","updated_at":"2025-12-19T22:57:34.309639-08:00","closed_at":"2025-12-04T12:14:03.391558-08:00","dependencies":[{"issue_id":"fray-bml","depends_on_id":"fray-kit","type":"parent-child","created_at":"2025-12-04T09:57:10.46725-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-bml","depends_on_id":"fray-3po","type":"blocks","created_at":"2025-12-04T09:57:24.695706-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-bml","depends_on_id":"fray-fr5","type":"blocks","created_at":"2025-12-04T09:57:29.816894-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-bsj","title":"Respect NO_COLOR env var in mention highlighting","description":"## Problem\n`highlightMentions()` always emits ANSI color codes (src/core/mentions.ts:50-55):\n\n```typescript\nexport function highlightMentions(body: string): string {\n  return body.replace(MENTION_REGEX, '\\x1b[36m@\\$1\\x1b[0m');\n}\n```\n\nShould respect the `NO_COLOR` environment variable standard (https://no-color.org/).\n\n## Fix\n```typescript\nexport function highlightMentions(body: string): string {\n  if (process.env.NO_COLOR) {\n    return body;  // No highlighting\n  }\n  return body.replace(MENTION_REGEX, '\\x1b[36m@\\$1\\x1b[0m');\n}\n```\n\nAlso consider:\n- Skipping colors when stdout is not a TTY (`!process.stdout.isTTY`)\n- Skipping colors in JSON mode (caller responsibility)\n\n## Files\n- src/core/mentions.ts:50-55\n\n## Acceptance Criteria\n- NO_COLOR=1 bdm ... produces no ANSI codes\n- Normal operation still has colored mentions","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-04T14:03:48.763263-08:00","updated_at":"2025-12-19T22:57:34.314568-08:00","closed_at":"2025-12-04T14:30:31.507019-08:00"}
{"id":"fray-c0sc","title":"Chat: filter deleted messages from display","description":"The filterDeletedMessages helper was added to CLI commands (notes, thread, history, etc.) but the fray chat TUI still shows '[deleted]' placeholders for deleted messages.\n\nNeed to add filtering in the chat view rendering, similar to internal/chat/commands.go:155 check.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-31T23:38:06.530795-08:00","created_by":"adam","updated_at":"2025-12-31T23:54:50.26718-08:00","closed_at":"2025-12-31T23:54:50.26718-08:00","close_reason":"Fixed in chat bug batch: filtered deleted messages, fixed thread scroll bounce, added near-top preload, refactored answer to Bubble Tea TUI"}
{"id":"fray-caq","title":"Go: Add rm command","description":"Missing 'mm rm \u003cmsgid\u003e' command to delete messages.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-21T01:29:09.760585-08:00","updated_at":"2025-12-21T01:49:46.74208-08:00","closed_at":"2025-12-21T01:49:46.74208-08:00","close_reason":"Implemented in Go"}
{"id":"fray-cbt","title":"In-chat slash commands","description":"Bring CLI capabilities into the chat interface.\n\n```\n/ask @bob what's blocking?       # ask question\n/answer #qstn-xyz the thing      # answer question  \n/thread new research             # create thread\n/pin #abc123                     # pin message\n/alias #abc123 context           # create alias\n/neo                             # onboard with context dump\n```\n\nSlash commands parsed in chat input. Reduces context switching between chat and CLI.\n\n**Depends on**: Core features (alias, pin, neo) should exist first.","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-30T16:47:26.234814-08:00","created_by":"adam","updated_at":"2025-12-30T16:47:26.234814-08:00"}
{"id":"fray-cbu","title":"Go: Fix JSON output to use snake_case keys","description":"Go uses PascalCase (ID, TS, ChannelID) but TS uses snake_case (id, ts, channel_id). This breaks API compatibility.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-21T01:28:36.28564-08:00","updated_at":"2025-12-21T01:41:40.399971-08:00","closed_at":"2025-12-21T01:41:40.399971-08:00","close_reason":"Go JSON output now uses snake_case struct tags"}
{"id":"fray-co5","title":"Implement config command","description":"Implement the config command for viewing and setting configuration.\n\n## Usage\n\n```bash\nbdm config                       # show all config\nbdm config stale-hours           # show specific key\nbdm config stale-hours 8         # set value\n```\n\n## Available Config Keys\n\n| Key | Default | Description |\n|-----|---------|-------------|\n| stale_hours | 4 | Hours of inactivity before agent is stale |\n\n## Implementation\n\n### Show all config\n```bash\nbdm config\n```\n\nOutput:\n```\nstale_hours = 4\n```\n\n### Show specific key\n```bash\nbdm config stale-hours\n```\n\nOutput:\n```\nstale_hours = 4\n```\n\n### Set value\n```bash\nbdm config stale-hours 8\n```\n\nOutput:\n```\nstale_hours = 8 (was: 4)\n```\n\n## Key Name Normalization\n- Accept both `stale-hours` and `stale_hours`\n- Store with underscores internally\n- Display with underscores\n\n## Validation\n- stale_hours: must be positive integer\n- Unknown key: \"Unknown config key: foo\"\n\n## JSON Output\n\n```json\n{\n  \"stale_hours\": \"4\"\n}\n```\n\n## Files\n- src/commands/config.ts\n\n## Acceptance Criteria\n- Show all config works\n- Show specific key works\n- Set value works with validation\n- Key name normalization (hyphens to underscores)\n- Error on unknown keys","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T10:10:22.288019-08:00","updated_at":"2025-12-19T22:57:34.303229-08:00","closed_at":"2025-12-04T12:37:54.318274-08:00","dependencies":[{"issue_id":"fray-co5","depends_on_id":"fray-yh4","type":"parent-child","created_at":"2025-12-04T10:11:14.38319-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-co5","depends_on_id":"fray-2vy","type":"blocks","created_at":"2025-12-04T10:12:05.836053-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-co5","depends_on_id":"fray-oa5","type":"blocks","created_at":"2025-12-04T10:47:33.00824-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-cyq","title":"Add 'alias' command","description":"Create semantic aliases for messages/notes.\n\n```bash\nfray alias #abc123 context       # alias as 'context'\nfray alias #def456 handoff       # alias as 'handoff'\n```\n\nUsage:\n- `#alias` works anywhere (posts, replies, etc.)\n- In chat, shows truncated 'quote retweet' with first line + original ID\n- `#alias#` embeds the full message content\n\n**Agent namespacing rule**: Agent-created aliases are auto-prefixed with agent name (e.g. `opus.context`) unless `--no-prefix` flag. Prevents collisions while allowing users to create shared aliases like `#context`, `#handoff`.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-30T16:46:47.56964-08:00","created_by":"adam","updated_at":"2025-12-30T16:46:47.56964-08:00"}
{"id":"fray-d9y","title":"Add fray summary command","description":"Smart context dump when running `fray` with FRAY_AGENT_ID set, or `fray --as \u003cagent\u003e`.\n\nShould replace/enhance current `fray get` with more useful agent-aware summary.\n\nDesign pending - likely follows fray-poo (neo) design.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-31T08:01:18.485432-08:00","created_by":"adam","updated_at":"2025-12-31T08:01:18.485432-08:00","dependencies":[{"issue_id":"fray-d9y","depends_on_id":"fray-poo","type":"related","created_at":"2025-12-31T08:01:25.292603-08:00","created_by":"daemon"},{"issue_id":"fray-d9y","depends_on_id":"fray-qnd","type":"blocks","created_at":"2025-12-31T14:42:44.038847-08:00","created_by":"adam"}]}
{"id":"fray-dgt","title":"Implement message query functions","description":"Create query functions for message CRUD operations in src/db/queries.ts.\n\n## Functions to Implement\n\n```typescript\n// src/db/queries.ts (message functions)\n\nimport type { Message, MessageRow, MessageQueryOptions } from '../types.js';\nimport type Database from 'better-sqlite3';\n\n/**\n * Create a new message.\n * @param mentions - Pre-extracted mentions array (caller extracts from body)\n * @returns The created message with ID\n */\nexport function createMessage(\n  db: Database, \n  message: { from_agent: string; body: string; mentions: string[] }\n): Message;\n\n/**\n * Get messages with optional filtering.\n * Returns in chronological order (oldest first).\n */\nexport function getMessages(\n  db: Database, \n  options?: MessageQueryOptions\n): Message[];\n\n/**\n * Get messages where the given prefix is mentioned.\n * Uses prefix matching: @alice matches messages mentioning alice.1, alice.419, etc.\n * Also includes @all broadcasts.\n */\nexport function getMessagesWithMention(\n  db: Database, \n  mentionPrefix: string, \n  options?: MessageQueryOptions\n): Message[];\n\n/**\n * Get the last message ID.\n * Used for --since polling.\n * @returns 0 if no messages exist\n */\nexport function getLastMessageId(db: Database): number;\n\n/**\n * Convert MessageRow to Message (parse mentions JSON).\n */\nexport function parseMessageRow(row: MessageRow): Message;\n```\n\n## Implementation Notes\n- mentions are stored as JSON array in database\n- **Important**: Caller is responsible for extracting mentions from body before calling createMessage. The extractMentions() function is implemented later in Phase 3 (bdm-92p). For now, just accept mentions as a parameter.\n- Prefix matching for mentions: check if any mention starts with prefix\n- @all is stored literally and matched specially\n\n## Query for Mention Matching\n```sql\n-- For each message, check if any mention in the JSON array starts with prefix\n-- SQLite approach: use json_each to expand array\nSELECT * FROM bdm_messages \nWHERE id IN (\n  SELECT m.id FROM bdm_messages m, json_each(m.mentions) j\n  WHERE j.value = 'all' OR j.value LIKE ? || '%'\n)\nORDER BY id\nLIMIT ?\n```\n\n## Files\n- src/db/queries.ts (add message functions)\n\n## Acceptance Criteria\n- Messages are created with provided mentions array\n- Mention filtering uses prefix matching\n- @all broadcasts are always included\n- Pagination via limit/since works correctly\n- Unit tests for all functions","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T09:59:53.467278-08:00","updated_at":"2025-12-19T22:57:34.307137-08:00","closed_at":"2025-12-04T12:22:37.756841-08:00","dependencies":[{"issue_id":"fray-dgt","depends_on_id":"fray-08v","type":"parent-child","created_at":"2025-12-04T10:01:00.162331-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-dgt","depends_on_id":"fray-6cj","type":"blocks","created_at":"2025-12-04T10:01:38.661022-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-dgt","depends_on_id":"fray-1wj","type":"blocks","created_at":"2025-12-04T10:01:43.784959-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-dil","title":"P4: Multi-Channel Sidebar (P0 feature)","description":"Add IRC-style channel sidebar. Tab toggles visibility, Tab cycles focus when open, Esc returns to input. Channel list with j/k navigation, Enter to select. ~8 hours.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T12:17:31.894036-08:00","updated_at":"2025-12-21T01:35:04.917991-08:00","closed_at":"2025-12-21T01:35:04.917991-08:00","close_reason":"Implemented Bubbletea channel sidebar with toggle, focus, navigation, and switching","dependencies":[{"issue_id":"fray-dil","depends_on_id":"fray-m6c","type":"blocks","created_at":"2025-12-20T12:22:21.062727-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-dk4","title":"Phase 3: Core Logic","description":"Agent identity and mention parsing logic for bdm.\n\n## Goal\nCore business logic utilities for:\n- Agent ID parsing, validation, and formatting\n- @mention extraction and matching\n- Timestamp formatting for human-readable display\n\n## Context\nAgent IDs follow a hierarchical format with mandatory version suffix:\n- Format: `\u003crole\u003e[.\u003cqualifier\u003e]*.\u003csession_number\u003e`\n- Examples: `alice.1`, `alice.frontend.3`, `pm.5.sub.2`\n\n@mentions use prefix matching:\n- `@alice` matches alice.1, alice.419, alice.frontend.3\n- `@alice.4` matches alice.4, alice.4.sub.1\n- `@all` is a special broadcast\n\nSee PLAN.md \"Decision 4\" and \"Decision 5\" for full rationale.\n\n## Exit Criteria\n- Agent ID parsing handles all valid cases\n- Mention extraction works with various patterns\n- Relative time formatting is human-readable\n- Unit tests for all core functions","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-04T10:03:37.254737-08:00","updated_at":"2025-12-19T22:57:34.296343-08:00","closed_at":"2025-12-04T12:31:11.373478-08:00","dependencies":[{"issue_id":"fray-dk4","depends_on_id":"fray-08v","type":"blocks","created_at":"2025-12-04T10:07:18.617208-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-dkh","title":"P9: Polish \u0026 Testing","description":"Error handling, graceful degradation, config validation, documentation updates, cross-platform builds, version embedding. ~4 hours.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T12:17:57.814501-08:00","updated_at":"2025-12-21T15:54:51.48262-08:00","closed_at":"2025-12-21T15:54:51.48262-08:00","close_reason":"Implemented in Go rewrite","dependencies":[{"issue_id":"fray-dkh","depends_on_id":"fray-dil","type":"blocks","created_at":"2025-12-20T12:22:46.925074-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-dkh","depends_on_id":"fray-6fx","type":"blocks","created_at":"2025-12-20T12:22:52.100511-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-dkh","depends_on_id":"fray-n7d","type":"blocks","created_at":"2025-12-20T12:22:57.274081-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-dkh","depends_on_id":"fray-beb","type":"blocks","created_at":"2025-12-20T12:23:02.443356-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-dkh","depends_on_id":"fray-0vz","type":"blocks","created_at":"2025-12-20T12:23:07.612555-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-dro","title":"mm @agent: show activity summary and claims hint","description":"When running mm @agent, after showing mentions, display a summary to help agents catch up:\n\n---\nX messages since you last posted (from @bob, @charlie)\nActive claims: @bob (src/auth.ts), @pm (docs/)\nRun 'mm get \u003cagent\u003e' to catch up\n\nThis nudges agents toward the right command and shows claim awareness without changing core behavior.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-22T12:34:24.19896-08:00","updated_at":"2025-12-22T12:37:46.009347-08:00","closed_at":"2025-12-22T12:37:46.009347-08:00","close_reason":"Implemented activity summary with messages since last post, unique senders, and active claims"}
{"id":"fray-dvn","title":"P0.3: SQLite rebuild from JSONL","description":"Implement SQLite rebuild from JSONL on startup (beads-style staleness detection).\n\nImplementation:\n- Check JSONL mtime vs SQLite mtime on db connection\n- If JSONL newer or SQLite missing: rebuild from JSONL\n- Read messages.jsonl, agents.jsonl, .mm/mm-config.json\n- Drop and recreate tables, insert all records\n- Update .mm/.gitignore to ignore *.db, *.db-wal, *.db-shm\n\nStaleness check:\n- Compare max(messages.jsonl mtime, agents.jsonl mtime) vs mm.db mtime\n- Log: \"Rebuilding SQLite from JSONL (stale database)\"\n\nReferences: PLAN.md section 2, beads staleness detection\nCritical files: src/db/schema.ts, src/db/jsonl.ts, .mm/.gitignore","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-19T11:57:09.444343-08:00","updated_at":"2025-12-19T22:57:34.293117-08:00","closed_at":"2025-12-19T14:17:02.539391-08:00","close_reason":"Added JSONL staleness rebuild, DB rebuild from JSONL, and .mm gitignore","dependencies":[{"issue_id":"fray-dvn","depends_on_id":"fray-3vp","type":"blocks","created_at":"2025-12-19T11:57:45.361823-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-dym","title":"Rename agent goal/bio to status/purpose","description":"Rename goal to status and bio to purpose for clarity. Update mm new flags to --status and --purpose.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-20T16:16:06.01408-08:00","updated_at":"2025-12-20T16:26:40.551136-08:00","closed_at":"2025-12-20T16:26:40.551136-08:00","close_reason":"Closed"}
{"id":"fray-e01","title":"Go: Add back command","description":"Missing 'mm back \u003cagent\u003e' command to rejoin as previous agent.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-21T01:28:59.016584-08:00","updated_at":"2025-12-21T01:49:46.74026-08:00","closed_at":"2025-12-21T01:49:46.74026-08:00","close_reason":"Implemented in Go"}
{"id":"fray-ebf","title":"Fix bdm watch --last 0 showing all history","description":"Running bdm watch --last 0 should skip history and only stream new messages, but it shows all history first.\n\n## Bug\n\nWhen running bdm watch --last 0:\n1. Shows 0 messages from history (correct)\n2. Sets lastMessageId = 0 (because recent.length === 0)\n3. Starts polling with since: 0\n4. Queries since: 0 returns ALL messages in database\n5. Floods output with entire history\n\n## Expected Behavior\n\nbdm watch --last 0 should:\n1. Skip showing any history\n2. Set lastMessageId to current max message ID\n3. Only show NEW messages that arrive after the command starts\n\n## Fix\n\nIn src/commands/watch.ts around line 26-45:\n\n```typescript\n// Get last message ID - if --last 0, skip to current\nlet lastMessageId = 0;\nconst lastN = parseInt(options.last, 10);\n\nif (lastN === 0) {\n  // Skip history, start from current\n  const maxId = getLastMessageId(db);\n  lastMessageId = maxId;\n} else {\n  // Show recent context first\n  const recent = getMessages(db, { limit: lastN });\n  if (recent.length \u003e 0) {\n    // ... display messages ...\n    lastMessageId = recent[recent.length - 1].id;\n  }\n}\n```\n\n## Files\n\n- src/commands/watch.ts - Fix initialization of lastMessageId when --last 0","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-09T06:14:53.848443-08:00","updated_at":"2025-12-19T22:57:34.294095-08:00","closed_at":"2025-12-09T06:23:24.938312-08:00"}
{"id":"fray-eg25","title":"Decompose chat/model.go into focused modules","description":"chat/model.go is 2966 lines handling 10+ UI subsystems. Split into: model.go (core), model_update.go, model_view.go, messages.go, suggestions.go, panels.go, questions.go, viewport.go, colors.go, layout.go, input.go. Each file \u003c300 lines with single responsibility.","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-31T23:53:30.767432-08:00","created_by":"adam","updated_at":"2025-12-31T23:53:30.767432-08:00"}
{"id":"fray-egc","title":"Update .gitignore to exclude development files","description":"Add .mm/, PLAN*.md, RESEARCH*.md, .claude/settings.local.json to .gitignore","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T19:55:17.227921-08:00","updated_at":"2025-12-19T22:57:34.300554-08:00","closed_at":"2025-12-17T19:57:10.228079-08:00","close_reason":"Closed"}
{"id":"fray-egq3","title":"Answer input: move prompt below question","description":"In fray answer interactive mode, the input prompt should be on a separate line below the question/options display, giving a fresh writing space rather than inline after the prompt text.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-31T17:47:13.669462-08:00","created_by":"adam","updated_at":"2025-12-31T17:47:13.669462-08:00"}
{"id":"fray-eog","title":"Update LICENSE copyright","description":"Update copyright year and add author name to LICENSE file","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T19:55:18.265004-08:00","updated_at":"2025-12-19T22:57:34.311496-08:00","closed_at":"2025-12-17T19:58:14.223377-08:00","close_reason":"Closed"}
{"id":"fray-ep0","title":"Silence system messages by default","description":"System messages (beads issue events) are flooding chat and causing noise.\n\n## Problem\n\nRunning `bdm watch` triggers a flood of system messages about issue status changes, which then appear in `bdm chat`. These messages clutter the conversation and make it hard to follow agent-to-agent communication.\n\nExample spam:\n```\n[#party #party-3f5]  @system:\nupdate: _party-3f5 status_changed_\n```\n\n## Solution\n\n**Default behavior**: Silence system messages in all modes (get, chat, watch, @mentions)\n\n**Opt-in**: Add `--show-updates` flag to display system messages when explicitly requested\n\n```bash\nbdm chat --show-updates      # Show system messages\nbdm watch --show-updates     # Include events\nbdm get alice.1 --show-updates  # Show events in combined view\n```\n\n## Implementation\n\n- Add `exclude_events` parameter to message queries (default: true)\n- Update all commands to respect this flag\n- Add `--show-updates` option to: chat, watch, get, @mentions commands\n\n## Follow-up\n\nCreate a separate card to revisit event notification design - we may want smarter filtering (e.g., only show events for issues mentioned in conversation).\n\n## Files\n\n- src/db/queries.ts - Add exclude_events to getMessages query\n- src/commands/chat.ts - Add --show-updates flag\n- src/commands/watch.ts - Add --show-updates flag, default exclude events\n- src/commands/get.ts - Add --show-updates flag\n- src/commands/mentions.ts - Add --show-updates flag","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-09T06:12:02.890916-08:00","updated_at":"2025-12-19T22:57:34.29436-08:00","closed_at":"2025-12-09T06:23:24.902711-08:00"}
{"id":"fray-ex1","title":"Prompt: Better agent onboarding for reply chains and threading","description":"Agents aren't threading replies effectively. Need better onboarding about --reply-to and when to create threads. See msg-j1a4fspw for context.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-31T14:52:14.128959-08:00","created_by":"adam","updated_at":"2025-12-31T14:52:14.128959-08:00"}
{"id":"fray-eya","title":"Bug: prune --all doesn't prune all, leaves 20","description":"Current behavior:\n- --all leaves last 20 messages (should prune ALL)\n- Default keeps 100 messages\n\nExpected behavior:\n- --all should prune ALL messages (0 remaining)\n- Default should keep last 20 (not 100)","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-21T10:56:33.792706-08:00","updated_at":"2025-12-21T17:04:12.154598-08:00","closed_at":"2025-12-21T17:04:12.154598-08:00","close_reason":"Implemented"}
{"id":"fray-fr5","title":"Set up project dependencies","description":"Install and configure all required dependencies for bdm.\n\n## Runtime Dependencies\n- better-sqlite3: Synchronous SQLite3 bindings for Node.js\n- commander: CLI framework for argument parsing\n\n## Dev Dependencies\n- typescript: TypeScript compiler\n- tsup: Fast TypeScript bundler\n- vitest: Test framework\n- @types/better-sqlite3: Type definitions\n- @types/node: Node.js type definitions\n\n## Optional (defer if not needed)\n- chalk: Terminal colors (respect NO_COLOR env var)\n\n## Tasks\n1. Run npm install for each dependency\n2. Verify better-sqlite3 compiles native bindings successfully\n3. Verify TypeScript recognizes all type definitions\n\n## Notes\n- better-sqlite3 requires native compilation - ensure build tools available\n- Use exact versions in package.json for reproducibility\n\n## Acceptance Criteria\n- All dependencies install without errors\n- `import Database from 'better-sqlite3'` compiles\n- `import { Command } from 'commander'` compiles","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T09:56:29.176972-08:00","updated_at":"2025-12-19T22:57:34.309973-08:00","closed_at":"2025-12-04T12:14:03.390899-08:00","dependencies":[{"issue_id":"fray-fr5","depends_on_id":"fray-kit","type":"parent-child","created_at":"2025-12-04T09:57:05.341912-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-fr5","depends_on_id":"fray-3po","type":"blocks","created_at":"2025-12-04T09:57:19.576357-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-frz","title":"Handling long messages in fray chat","description":"**Needs design revisit** given new TUI capabilities.\n\nOriginal scope:\n1. Give more acceptable line length for `fray chat` than for agents. Keep as-is for agents, but set to something huge like 500 lines for users.\n2. Give user some way of showing the rest of the message -- either via command, keyboard shortcut, or rewriting full history in view.\n\nNew considerations:\n- Thread view vs room view behavior\n- Interaction with message expansion/collapse\n- Mobile-friendly truncation?\n- How does this work with structured message display?\n\nFirst step: Design session to clarify UX.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-09T19:04:34.609119-08:00","updated_at":"2025-12-30T16:47:25.854687-08:00","labels":["creator:adamavenir@hey.com","feature"]}
{"id":"fray-g5e","title":"Implement lifecycle commands (new, hi, bye)","description":"Create lifecycle commands for agent session management.\n\n## Commands\n\n### bdm new \u003cname\u003e\nCreate a new agent session with auto-incremented version.\n\n```bash\nbdm new alice                    # → alice.1 (or alice.N+1)\nbdm new alice --goal \"...\"       # with goal\nbdm new alice --bio \"...\"        # with bio\n```\n\n**Implementation:**\n1. Parse and validate base name\n2. Query getMaxVersion(db, base) to find highest version\n3. Create agent with version = max + 1\n4. Set registered_at and last_seen to now()\n5. Output: \"Registered as alice.N\"\n\n### bdm hi \u003cagent.N\u003e\nResume a previous session (clear left_at, update last_seen).\n\n```bash\nbdm hi alice.419\n```\n\n**Implementation:**\n1. Parse and validate full agent ID\n2. Verify agent exists\n3. Update: left_at = NULL, last_seen = now()\n4. Output: \"Welcome back, alice.419\"\n\n**Error cases:**\n- Agent doesn't exist: \"Unknown agent: alice.419\"\n- Agent never left: \"alice.419 is already active\"\n\n### bdm bye \u003cagent.N\u003e\nLeave the session (set left_at).\n\n```bash\nbdm bye alice.419\n```\n\n**Implementation:**\n1. Parse and validate full agent ID\n2. Verify agent exists and is active\n3. Update: left_at = now()\n4. Output: \"Goodbye, alice.419\"\n\n**Error cases:**\n- Agent doesn't exist: \"Unknown agent: alice.419\"\n- Agent already left: \"alice.419 has already left\"\n\n## Files\n- src/commands/new.ts\n- src/commands/hi.ts\n- src/commands/bye.ts\n\n## Acceptance Criteria\n- new creates agent with correct version\n- hi reactivates agent\n- bye marks agent as left\n- Clear error messages for all failure cases\n- Integration test for full lifecycle","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T10:08:21.729327-08:00","updated_at":"2025-12-19T22:57:34.305261-08:00","closed_at":"2025-12-04T12:37:29.60012-08:00","dependencies":[{"issue_id":"fray-g5e","depends_on_id":"fray-yh4","type":"parent-child","created_at":"2025-12-04T10:10:38.505506-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-g5e","depends_on_id":"fray-2vy","type":"blocks","created_at":"2025-12-04T10:11:29.975136-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-g5e","depends_on_id":"fray-xpd","type":"blocks","created_at":"2025-12-04T10:46:29.940376-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-g5e","depends_on_id":"fray-6u7","type":"blocks","created_at":"2025-12-04T10:58:21.183265-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-gcr","title":"Add batch-update command for bulk agent management","description":"Add 'mm batch-update' command that accepts JSON to batch register/update agents.\n\nUsage:\n  mm batch-update --file agents.json\n  echo '{...}' | mm batch-update\n\nJSON shape:\n{\n  \"agents\": [\n    {\n      \"agent_id\": \"devrel\",\n      \"status\": \"working on docs\",\n      \"purpose\": \"developer relations\",\n      \"nicks\": [\"dr\", \"devrel-alias\"]\n    }\n  ]\n}\n\nBehavior:\n- Agent exists → update status/purpose/nicks (only fields provided)\n- Agent doesn't exist → register it\n- Never deletes\n\nReturns summary:\n{\"created\": 2, \"updated\": 1, \"unchanged\": 0}","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-21T13:30:37.154806-08:00","updated_at":"2025-12-21T15:54:51.482958-08:00","closed_at":"2025-12-21T15:54:51.482958-08:00","close_reason":"Implemented in Go rewrite"}
{"id":"fray-guc","title":"QA: Compare TS vs Go implementation gaps","description":"Compared TS and Go mm implementations. See docs/go-ts-gap-analysis.md for full report. Key findings: 12 missing commands, critical JSON casing difference.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T01:23:13.528035-08:00","updated_at":"2025-12-21T01:28:22.535445-08:00","closed_at":"2025-12-21T01:28:22.535445-08:00","close_reason":"QA complete. Gap analysis documented in docs/go-ts-gap-analysis.md"}
{"id":"fray-h03","title":"Add mm destroy \u003cchannel\u003e to delete channel entirely","description":"mm destroy \u003cchannel\u003e should:\n- Remove the entry from global config (~/.config/mm/mm-config.json)\n- Delete the .mm/ directory for that channel\n\nRequires N/y confirmation (default No) with clear warning that this is irreversible and destroys all messages/history. Use --force to skip confirmation.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-21T10:51:34.105328-08:00","updated_at":"2025-12-21T17:04:12.155465-08:00","closed_at":"2025-12-21T17:04:12.155465-08:00","close_reason":"Implemented"}
{"id":"fray-hiu","title":"Chat: Ctrl-C clears text first, exits only if empty","description":"In chat mode, Ctrl-C should clear the entered text if there's text in the input. Only exit chat if Ctrl-C is pressed on an empty input.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-21T10:49:16.184442-08:00","updated_at":"2025-12-21T17:04:12.15609-08:00","closed_at":"2025-12-21T17:04:12.15609-08:00","close_reason":"Implemented"}
{"id":"fray-hj9","title":"P1.8: Tests for channel system and agents","description":"Add tests for channel operations and agent discovery.\n\nTest files to create/update:\n\n1. tests/channels.test.ts (NEW)\n   - Channel GUID generation\n   - .mm/mm-config.json creation\n   - Global config registration\n   - Channel context resolution (--in flag, mm use)\n   - Cross-channel message references\n\n2. tests/agent-discovery.test.ts (NEW)\n   - Progressive discovery flow\n   - Reuse existing agent GUID\n   - Create new agent on collision\n   - known_agents updates\n   - Auto-nick generation (home channel)\n\n3. tests/prefix-resolution.test.ts (NEW)\n   - Unique match works\n   - Ambiguous match errors with suggestions\n   - Channel scoping (default vs full GUID)\n   - Minimum 2-char prefix\n   - Case sensitivity\n\n4. tests/time-queries.test.ts (NEW)\n   - Parse relative time (1h, 2d)\n   - Parse absolute time (yesterday, today)\n   - Parse GUID references (@#a1b2)\n   - --since, --before, --from, --to flags\n   - Invalid input handling\n\n5. tests/integration.test.ts (UPDATE)\n   - End-to-end GUID flow\n   - Multi-channel coordination\n   - Agent migration scenarios\n   - Prune with guardrails\n\nCoverage goals:\n- Channel operations: 95%\n- Agent discovery: 95%\n- Prefix resolution: 100%\n- Time queries: 90%\n\nRun with: npm test\n\nReferences: Existing integration tests\nCritical files: tests/channels.test.ts (NEW), tests/agent-discovery.test.ts (NEW), tests/prefix-resolution.test.ts (NEW)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T13:31:03.020705-08:00","updated_at":"2025-12-19T22:57:34.297515-08:00","closed_at":"2025-12-19T16:25:46.110193-08:00","close_reason":"Added tests for channel context/agent discovery and updated integration coverage","dependencies":[{"issue_id":"fray-hj9","depends_on_id":"fray-w6q","type":"blocks","created_at":"2025-12-19T13:31:23.574468-08:00","created_by":"daemon","metadata":"{}"},{"issue_id":"fray-hj9","depends_on_id":"fray-3iq","type":"blocks","created_at":"2025-12-19T13:31:23.661195-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-hlr","title":"Add SessionStart resume tickler","description":"On SessionStart (resume), add 3-bullet tickler with key principles:\n- Claim files before editing\n- Close beads when done\n- Check fray @\u003cagent\u003e for mentions\n\nKeep it terse to avoid noise. Could rotate/vary bullets to prevent habituation.\n\nFiles: internal/command/hook_session.go","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-31T08:01:09.867-08:00","created_by":"adam","updated_at":"2025-12-31T10:33:01.301709-08:00","closed_at":"2025-12-31T10:33:01.301709-08:00","close_reason":"Implemented hook-statusline command, enhanced UserPromptSubmit with statusline, added SessionStart resume tickler, added PreCompact hook"}
{"id":"fray-hrm","title":"Channel sidebar: # or spacebar to filter/autocomplete","description":"When channel sidebar is open (via tab), pressing '#' or spacebar should enable filtering mode. As you type, narrow the list and auto-select first best match. Allows quick channel switching without arrow keys.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-21T13:09:35.33417-08:00","updated_at":"2025-12-21T22:58:22.165037-08:00","closed_at":"2025-12-21T22:58:22.165037-08:00","close_reason":"Implemented"}
{"id":"fray-irj","title":"Add CONTRIBUTING.md","description":"Create CONTRIBUTING.md with guidelines for contributors","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-17T19:55:18.668151-08:00","updated_at":"2025-12-19T22:57:34.314935-08:00","closed_at":"2025-12-17T20:01:59.128952-08:00","close_reason":"Closed"}
{"id":"fray-j31","title":"P0.6: Display ID mapping system","description":"Create mm_display_ids table. Map GUIDs to short IDs (mm-42). Resolve @devrel to usr-guid, @#mm-42 to msg-guid.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-19T11:57:10.279565-08:00","updated_at":"2025-12-19T22:57:34.29212-08:00","closed_at":"2025-12-19T13:13:39.128208-08:00","close_reason":"Display IDs eliminated - using GUID-only with partial matching instead","dependencies":[{"issue_id":"fray-j31","depends_on_id":"fray-qqv","type":"blocks","created_at":"2025-12-19T11:57:45.612295-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-j4h","title":"Add fray status/statusline command for Claude Code","description":"New command for Claude Code statusline integration.\n\nEither `fray status` or `fray statusline` - TBD on naming.\n\nShould provide compact, structured output suitable for statusline display.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-31T08:01:18.355711-08:00","created_by":"adam","updated_at":"2025-12-31T10:33:01.298837-08:00","closed_at":"2025-12-31T10:33:01.298837-08:00","close_reason":"Implemented hook-statusline command, enhanced UserPromptSubmit with statusline, added SessionStart resume tickler, added PreCompact hook"}
{"id":"fray-j5q","title":"Bug: Chat requires double-enter to send","description":"In fray chat TUI, user has to hit enter twice to send. See msg-mpuy8iwg.","status":"open","priority":3,"issue_type":"bug","created_at":"2025-12-31T14:52:14.168581-08:00","created_by":"adam","updated_at":"2025-12-31T14:52:14.168581-08:00"}
{"id":"fray-k9v","title":"Public release readiness review","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T19:46:23.654835-08:00","updated_at":"2025-12-19T22:57:34.312046-08:00","closed_at":"2025-12-17T20:04:45.634763-08:00","close_reason":"Closed"}
{"id":"fray-kc3","title":"Update CHANGELOG and README for v0.2.0","description":"Document GUID architecture, channel system, cross-channel ops, JSONL storage. Breaking change: requires migration.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T11:57:36.079241-08:00","updated_at":"2025-12-19T22:57:34.298111-08:00","closed_at":"2025-12-19T16:01:46.216244-08:00","close_reason":"Updated CHANGELOG, README, CLAUDE.md, package.json, and cli.ts for v0.2.0","dependencies":[{"issue_id":"fray-kc3","depends_on_id":"fray-w6q","type":"blocks","created_at":"2025-12-19T11:57:46.827304-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-kd0g","title":"Extract chat/suggestions.go from model.go","description":"Extract suggestion system: refreshSuggestions(), buildSuggestions(), buildMentionSuggestions(), buildReplySuggestions(), handleSuggestionKeys(), applySuggestion(), renderSuggestions(), clearSuggestions(). ~250 lines.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-31T23:53:42.957607-08:00","created_by":"adam","updated_at":"2025-12-31T23:53:42.957607-08:00","dependencies":[{"issue_id":"fray-kd0g","depends_on_id":"fray-eg25","type":"blocks","created_at":"2025-12-31T23:53:49.541043-08:00","created_by":"adam"}]}
{"id":"fray-kit","title":"Phase 1: Project Setup","description":"Scaffold TypeScript project with build tooling.\n\n## Goal\nA working TypeScript project structure with:\n- npm package configured for ESM (ECMAScript modules)\n- TypeScript compilation via tsup (a fast TS bundler)\n- CLI entry point that responds to --version\n- Directory structure ready for implementation\n\n## Context\nbeads-messenger (bdm) is a lightweight agent coordination layer extending beads (the `bd` CLI tool). It provides room-based messaging with @mention routing for AI coding agents working on the same codebase.\n\nKey concepts:\n- **Room**: Each beads project has one shared message room\n- **Agents**: AI or human participants with hierarchical IDs like alice.1, pm.5.sub.2\n- **@mentions**: Route messages to specific agents via prefix matching\n\nSee PLAN.md for full design decisions and rationale.\n\n## Exit Criteria\n- `npm run build` succeeds\n- `bdm --version` works\n- Project structure matches spec in PLAN.md","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-04T09:55:51.813944-08:00","updated_at":"2025-12-19T22:57:34.296992-08:00","closed_at":"2025-12-04T12:13:19.006642-08:00"}
{"id":"fray-kx4","title":"Chat: /help or ? shows keyboard shortcuts and slash commands","description":"In chat mode, typing '/help' or '?' at the start of a blank line shows all available keyboard shortcuts and slash commands. Typing '?' should remove the input character (acts as keyboard shortcut, not typed text).","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-21T10:49:10.749368-08:00","updated_at":"2025-12-21T17:04:12.156436-08:00","closed_at":"2025-12-21T17:04:12.156436-08:00","close_reason":"Implemented"}
{"id":"fray-l5o","title":"Implement message display command (default action)","description":"Implement the default bdm command to show room message history.\n\n## Usage\n\n```bash\nbdm                              # last 20 messages\nbdm --last 50                    # last 50 messages\nbdm --since 42                   # messages after ID 42\nbdm --all                        # full history\n```\n\n## Output Format\n\n```\n[42] alice.419 (2m ago): figured out the auth issue, @bob.3 see auth.py:47\n[43] bob.3 (1m ago): @alice.419 got it, thanks\n[44] pm.5 (30s ago): @all standup in 5\n```\n\nFormat: `[id] agent (time): body`\n\n## Implementation\n\n1. Parse options (--last, --since, --all)\n2. Build MessageQueryOptions from flags\n3. Call getMessages(db, options)\n4. Format each message:\n   - `[{id}] {from_agent} ({relative_time}): {body}`\n   - Optionally highlight @mentions in body\n\n## Default Behavior\n- No flags: last 20 messages\n- --last N: last N messages\n- --since ID: messages with id \u003e ID\n- --all: no limit (may be large)\n\n## JSON Output (--json)\n\n```json\n[\n  {\n    \"id\": 42,\n    \"ts\": 1234567890,\n    \"from_agent\": \"alice.419\",\n    \"body\": \"...\",\n    \"mentions\": [\"bob.3\"]\n  }\n]\n```\n\n## Files\n- src/commands/messages.ts (or inline in cli.ts default action)\n\n## Acceptance Criteria\n- Default shows last 20 messages\n- --last, --since, --all work correctly\n- Output format matches spec\n- Empty room shows appropriate message\n- JSON output is valid","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T10:08:56.250496-08:00","updated_at":"2025-12-19T22:57:34.304668-08:00","closed_at":"2025-12-04T12:37:40.104216-08:00","dependencies":[{"issue_id":"fray-l5o","depends_on_id":"fray-yh4","type":"parent-child","created_at":"2025-12-04T10:10:48.755947-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-l5o","depends_on_id":"fray-2vy","type":"blocks","created_at":"2025-12-04T10:11:40.21361-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-l5o","depends_on_id":"fray-dgt","type":"blocks","created_at":"2025-12-04T10:46:19.709933-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-l5o","depends_on_id":"fray-8jo","type":"blocks","created_at":"2025-12-04T10:46:49.01768-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-l71b","title":"Update fly/land protocols: workstream threads","description":"fly: Create thread for agent's workstream on session start (when appropriate)\nland: Collapse and close workstream thread so it can be referenced\n\nDesign consideration: Not all sessions need threads. Simple 'complete task a, b, c' sessions where the plan is clear might just update beads. Need heuristics for when to create workstream thread vs. not.\n\nPotential triggers for workstream thread:\n- Exploratory/design work\n- Multi-step implementation with decisions\n- Work that might inform future sessions\n\nSkip thread for:\n- Clear task execution with known approach\n- Bug fixes with obvious solution\n- Chore/cleanup work","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-31T23:03:07.602932-08:00","created_by":"adam","updated_at":"2025-12-31T23:03:07.602932-08:00"}
{"id":"fray-lfo","title":"Add --range flag for message queries","description":"Add ability to query specific message ID ranges.\n\n## Usage\n\n```bash\nbdm get --range 20:25       # Get messages 20-25 inclusive\nbdm get --range 20:25 --json  # JSON output\nbdm @alice --range 100:110  # Get mentions in range\n```\n\n## Behavior\n\n- Inclusive range: `20:25` includes messages 20, 21, 22, 23, 24, 25\n- Works with all query commands: get, @mentions\n- Works with --json flag\n- Subject to token limit checks (\u003e10 messages requires --bypass-token-limit)\n\n## Implementation\n\nAdd --range option to commands:\n- Parse format: `\u003cstart\u003e:\u003cend\u003e`\n- Convert to SQL: `WHERE id \u003e= start AND id \u003c= end`\n- Validate: start \u003c= end, both are positive integers\n\n## Files\n\n- src/commands/get.ts - Add --range option\n- src/commands/mentions.ts - Add --range option\n- src/db/queries.ts - Add range parameters to query functions","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-09T06:12:03.232996-08:00","updated_at":"2025-12-19T22:57:34.312436-08:00"}
{"id":"fray-li8","title":"Rename package to mini-msg","description":"Update package.json name from mini-messenger to mini-msg, update all documentation references","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T19:55:17.446495-08:00","updated_at":"2025-12-19T22:57:34.300345-08:00","closed_at":"2025-12-17T20:02:53.838857-08:00","close_reason":"Closed"}
{"id":"fray-ljh","title":"Add package.json metadata","description":"Add repository, homepage, bugs URLs pointing to github.com/adamavenir/mini-msg. Add author field.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T19:55:17.651578-08:00","updated_at":"2025-12-19T22:57:34.300133-08:00","closed_at":"2025-12-17T20:02:18.894442-08:00","close_reason":"Closed"}
{"id":"fray-lqi","title":"Go: Add ANSI color support for output","description":"TS has rich ANSI colors with different colors for different agents. Go has minimal formatting.","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-21T01:34:11.076969-08:00","updated_at":"2025-12-21T02:25:28.596348-08:00","closed_at":"2025-12-21T02:25:28.596348-08:00","close_reason":"Added ANSI formatting for CLI output"}
{"id":"fray-ly8","title":"Add SQLite WAL mode and busy_timeout for multi-agent resilience","description":"## Problem\nNo WAL mode or busy_timeout configured when opening databases (src/core/project.ts:55-60, src/commands/shared.ts:38-40).\n\n```typescript\nexport function openDatabase(project: BeadsProject): Database.Database {\n  const db = new Database(project.dbPath);\n  db.pragma('foreign_keys = ON');\n  return db;  // No WAL, no busy_timeout\n}\n```\n\nMultiple agents posting/watching simultaneously can hit SQLITE_BUSY errors. This is the primary use case for bdm!\n\n## Fix\nAdd pragmas after opening:\n```typescript\ndb.pragma('journal_mode = WAL');\ndb.pragma('busy_timeout = 5000');  // 5 seconds\n```\n\n## Considerations\n- WAL mode creates additional files (*.db-wal, *.db-shm)\n- beads itself may have opinions on journal mode - check compatibility\n- busy_timeout of 5000ms is reasonable; can make configurable later\n\n## Files\n- src/core/project.ts:55-60\n- src/commands/shared.ts:38-40 (linked project opening)\n\n## Acceptance Criteria\n- Database opened with WAL mode enabled\n- busy_timeout set to reasonable value (5000ms)\n- Multiple concurrent bdm processes don't get SQLITE_BUSY","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T14:03:48.663946-08:00","updated_at":"2025-12-19T22:57:34.301248-08:00","closed_at":"2025-12-04T14:29:01.461774-08:00"}
{"id":"fray-lz9","title":"P2: Basic CLI Commands","description":"Port essential commands: init (with --defaults flag for scripting), new (--status/--purpose flags), post, get. Port context resolution (--in flag, CWD discovery), mention extraction with prefix matching. ~6 hours.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T12:17:21.540833-08:00","updated_at":"2025-12-21T01:27:06.005223-08:00","closed_at":"2025-12-21T01:27:06.005223-08:00","close_reason":"Completed in Go rewrite","dependencies":[{"issue_id":"fray-lz9","depends_on_id":"fray-09h","type":"blocks","created_at":"2025-12-20T12:22:10.711518-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-m2u","title":"Update README with claims documentation","description":"Document claims system (mm claim, mm status, mm clear) in README command reference","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T19:55:17.853029-08:00","updated_at":"2025-12-19T22:57:34.311859-08:00","closed_at":"2025-12-17T20:04:15.920658-08:00","close_reason":"Closed"}
{"id":"fray-m6c","title":"P3: Basic Chat TUI","description":"Implement basic interactive chat mode with Bubbletea. Message viewport with scrolling, text input, reply syntax (#abc), polling for new messages, agent colors. ~10 hours.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T12:17:26.712853-08:00","updated_at":"2025-12-21T01:27:06.005549-08:00","closed_at":"2025-12-21T01:27:06.005549-08:00","close_reason":"Completed in Go rewrite","dependencies":[{"issue_id":"fray-m6c","depends_on_id":"fray-lz9","type":"blocks","created_at":"2025-12-20T12:22:15.888555-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-n0h","title":"P0: Project Setup","description":"Initialize Go module, add dependencies (bubbletea, bubbles, lipgloss, cobra, modernc.org/sqlite, chroma, gobwas/glob). Create basic main.go and root command structure. ~2 hours.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T12:14:04.095215-08:00","updated_at":"2025-12-21T01:27:06.003553-08:00","closed_at":"2025-12-21T01:27:06.003553-08:00","close_reason":"Completed in Go rewrite"}
{"id":"fray-n6r","title":"Add CHANGELOG.md","description":"Create CHANGELOG.md with v0.1.0 initial release entry","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T19:55:18.468517-08:00","updated_at":"2025-12-19T22:57:34.311312-08:00","closed_at":"2025-12-17T20:01:45.308131-08:00","close_reason":"Closed"}
{"id":"fray-n7d","title":"P6: Slash Commands \u0026 Edit (P2 feature)","description":"Add slash commands: /edit, /delete, /prune, /help, /quit. Implement up-to-edit (up arrow with empty input loads last message). ~4 hours.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T12:17:42.254058-08:00","updated_at":"2025-12-21T01:27:06.006062-08:00","closed_at":"2025-12-21T01:27:06.006062-08:00","close_reason":"Completed in Go rewrite","dependencies":[{"issue_id":"fray-n7d","depends_on_id":"fray-m6c","type":"blocks","created_at":"2025-12-20T12:22:31.404849-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-nxv","title":"Fix chat sidebar UX + thread search","description":"Current issues:\n- Sidebar tries to show channels AND threads simultaneously\n- Can't search for threads not in list\n\nNeeded behavior:\n- Tab cycles: channels → threads → hidden (clean separation)\n- Consistent keyboard navigation\n- **Thread search**: Type to filter/search threads even if not listed\n- Enter to switch to selected item\n\nReference: internal/chat/model.go","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-30T16:46:47.705933-08:00","created_by":"adam","updated_at":"2025-12-30T17:13:20.170908-08:00","closed_at":"2025-12-30T17:13:20.170908-08:00","close_reason":"Implemented: Tab cycles threads→channels→hidden, thread search queries DB for unlisted threads"}
{"id":"fray-o8k","title":"When an agent runs `post` if there are unread @s or messages, return those in the confirmation","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T11:43:34.841778-08:00","updated_at":"2025-12-19T22:57:34.31223-08:00","closed_at":"2025-12-09T12:27:50.498855-08:00","labels":["creator:adamavenir@hey.com","fizzy:maybe"]}
{"id":"fray-oa5","title":"Implement config and linked project query functions","description":"Create query functions for config and linked projects in src/db/queries.ts.\n\n## Functions to Implement\n\n```typescript\n// src/db/queries.ts (config and project functions)\n\nimport type { LinkedProject, ConfigEntry } from '../types.js';\nimport type Database from 'better-sqlite3';\n\n/**\n * Get config value by key.\n * @returns value or undefined if not set\n */\nexport function getConfig(db: Database, key: string): string | undefined;\n\n/**\n * Set config value.\n * Uses INSERT OR REPLACE for upsert.\n */\nexport function setConfig(db: Database, key: string, value: string): void;\n\n/**\n * Get all config entries.\n */\nexport function getAllConfig(db: Database): ConfigEntry[];\n\n/**\n * Get linked project by alias.\n */\nexport function getLinkedProject(db: Database, alias: string): LinkedProject | undefined;\n\n/**\n * Get all linked projects.\n */\nexport function getLinkedProjects(db: Database): LinkedProject[];\n\n/**\n * Link a project (store in database).\n * @param alias - short name for --project flag\n * @param path - absolute path to project root\n * Note: Caller is responsible for validating path exists and contains .beads/\n */\nexport function linkProject(db: Database, alias: string, path: string): void;\n\n/**\n * Unlink a project.\n * @returns true if project was removed, false if didn't exist\n */\nexport function unlinkProject(db: Database, alias: string): boolean;\n```\n\n## Implementation Notes\n- Config uses INSERT OR REPLACE for upsert semantics\n- linkProject is a pure database function - path validation happens in the CLI command layer (bdm-1ur)\n- Store absolute paths (caller should resolve relative paths before calling)\n\n## Default Config Values\n- stale_hours: \"4\" (inserted by schema initialization)\n\n## Files\n- src/db/queries.ts (add config and project functions)\n\n## Acceptance Criteria\n- Config get/set works correctly\n- Linked projects store paths as provided\n- Unit tests for all functions","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T10:00:19.532948-08:00","updated_at":"2025-12-19T22:57:34.306839-08:00","closed_at":"2025-12-04T12:23:55.92686-08:00","dependencies":[{"issue_id":"fray-oa5","depends_on_id":"fray-08v","type":"parent-child","created_at":"2025-12-04T10:01:05.2842-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-oa5","depends_on_id":"fray-6cj","type":"blocks","created_at":"2025-12-04T10:01:48.915854-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-oa5","depends_on_id":"fray-1wj","type":"blocks","created_at":"2025-12-04T10:01:54.035998-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-pk0","title":"Go: Add rename command","description":"Missing 'mm rename \u003cold\u003e \u003cnew\u003e' command to rename an agent.","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-21T01:34:05.679639-08:00","updated_at":"2025-12-21T02:17:13.693346-08:00","closed_at":"2025-12-21T02:17:13.693346-08:00","close_reason":"Implemented rename command"}
{"id":"fray-po1","title":"Phase 5: Polish \u0026 Documentation","description":"Production-ready CLI with documentation.\n\n## Goal\nFinal polish for v1.0 release:\n- Consistent output formatting\n- Comprehensive error handling\n- Complete README documentation\n- Installable npm package\n\n## Context\nAll core functionality is implemented in Phases 1-4.\nThis phase focuses on user experience and release readiness.\n\n## Exit Criteria\n- README covers all functionality\n- `npm pack` produces installable package\n- `npm install -g` works\n- No console warnings in normal operation\n- All tests pass","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-04T10:12:22.895797-08:00","updated_at":"2025-12-19T22:57:34.295705-08:00","closed_at":"2025-12-04T12:48:18.166892-08:00","dependencies":[{"issue_id":"fray-po1","depends_on_id":"fray-yh4","type":"blocks","created_at":"2025-12-04T10:19:19.550804-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-poo","title":"Design: neo command (agent onboarding)","description":"Agent onboarding brain dump - 'I know kung fu' moment.\n\n```bash\nfray neo alice                   # register + dump context\n```\n\nOutputs (ideas):\n- Pinned/starred items from subscribed threads\n- Open questions assigned to agent\n- Active claims in channel\n- Recent activity summary\n- Unread context since last session\n\n**Blocker**: Needs improved read state tracking to know what's 'new' vs 'caught up'.\n\nFirst step: Design session to clarify what context agents actually need on onboard.","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-30T16:46:05.404301-08:00","created_by":"adam","updated_at":"2025-12-30T16:46:05.404301-08:00","dependencies":[{"issue_id":"fray-poo","depends_on_id":"fray-373","type":"blocks","created_at":"2025-12-30T16:47:08.923804-08:00","created_by":"daemon"},{"issue_id":"fray-poo","depends_on_id":"fray-5td","type":"blocks","created_at":"2025-12-30T16:47:08.953183-08:00","created_by":"daemon"},{"issue_id":"fray-poo","depends_on_id":"fray-qnd","type":"blocks","created_at":"2025-12-31T14:42:44.01567-08:00","created_by":"adam"}]}
{"id":"fray-qhy","title":"Implement Tasks primitive","description":"Agent work queue with blocking/unblocking.\n\n**Spec**: threads-03-aspirational.md (lines 128-148)\n\nKey features:\n- task-XXXXXXXX GUIDs\n- Status: pending, active, done, blocked\n- External ID linking: bead:xyz-123, gh:owner/repo/123, linear:PROJ-123\n- blocked_by: array of question/task GUIDs\n- Auto-unblock when blocking question resolves (→ pending, not active)\n\nCLI:\n- fray task add \"...\" --as bob [--external bead:xyz-123]\n- fray tasks [@agent]\n- fray task active/done/block task-abc\n\nStorage: tasks.jsonl or graph.jsonl","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-30T16:14:41.783494-08:00","created_by":"adam","updated_at":"2025-12-30T16:14:41.783494-08:00"}
{"id":"fray-ql6","title":"P0.0: Minimal GUID proof-of-concept","description":"Create minimal vertical slice to prove GUID architecture before full implementation.\n\nGoal: Simple working example of GUID→JSONL→SQLite flow\n\nImplement:\n1. GUID generation function (8-char base58)\n2. Single JSONL writer (messages.jsonl only)\n3. Simple SQLite rebuild from JSONL\n4. Basic .mm/mm-config.json with channel_id\n\nTest with:\n- mm post creates msg-GUID\n- Writes to messages.jsonl\n- Rebuilds SQLite on next read\n- Verify GUID stable across rebuilds\n\nFiles:\n- src/core/guid.ts (NEW) - generateGuid(type)\n- src/db/jsonl.ts (NEW) - appendMessage(), readMessages()\n- src/db/schema.ts - Add guid column to mm_messages\n- src/commands/post.ts - Generate GUID, write JSONL\n\nAcceptance:\n- Can post message\n- JSONL file created with valid format\n- SQLite rebuilt from JSONL\n- GUIDs preserved\n\nThis proves the architecture works before implementing all the features.\n\nReferences: PLAN.md sections 1, 2\nCritical files: src/core/guid.ts (NEW), src/db/jsonl.ts (NEW)","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-19T13:26:44.503921-08:00","updated_at":"2025-12-19T22:57:34.291364-08:00","closed_at":"2025-12-19T13:28:05.115706-08:00","close_reason":"No proof-of-concept - building the full thing","dependencies":[{"issue_id":"fray-ql6","depends_on_id":"fray-3vp","type":"blocks","created_at":"2025-12-19T13:31:03.878456-08:00","created_by":"daemon","metadata":"{}"},{"issue_id":"fray-ql6","depends_on_id":"fray-z3l","type":"blocks","created_at":"2025-12-19T13:31:03.965833-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-qlw","title":"Skip integration tests gracefully when bd CLI not installed","description":"## Problem\nIntegration tests hard-fail when `bd` isn't installed (tests/integration.test.ts:15-22).\n\n```typescript\nbeforeEach(() =\u003e {\n  try {\n    execSync('bd init --prefix test', { cwd: testDir, stdio: 'pipe' });\n  } catch (error) {\n    console.log('Skipping integration tests: bd CLI not found');\n    throw new Error('bd CLI not installed - skipping integration tests');\n  }\n});\n```\n\nThrowing in `beforeEach` causes the entire test suite to **fail**, not skip. This breaks `npm test` on machines without `bd`.\n\n## Fix\n1. Check for `bd` availability before the describe block\n2. Use `describe.skipIf()` or conditional `describe.skip`\n3. Or wrap in try/catch at describe level\n\nExample pattern:\n```typescript\nconst bdAvailable = (() =\u003e {\n  try {\n    execSync('bd --version', { stdio: 'pipe' });\n    return true;\n  } catch { return false; }\n})();\n\ndescribe.skipIf(!bdAvailable)('CLI integration tests', () =\u003e { ... });\n```\n\n## Files\n- tests/integration.test.ts:15-22\n\n## Acceptance Criteria\n- `npm test` passes on machines without bd installed\n- Integration tests are skipped (not failed) when bd unavailable\n- Clear skip message indicates why tests were skipped","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-04T14:03:48.56224-08:00","updated_at":"2025-12-19T22:57:34.301483-08:00","closed_at":"2025-12-04T14:27:52.621597-08:00"}
{"id":"fray-qnd","title":"Parse '# Questions for @x' sections from posts","description":"Auto-extract questions from markdown posts.\n\n## Convention\n- REQUIRE `# Questions for @x` header (or just `# Questions` = for user)\n- Allow `#` or `##` headers, ignore `###`+\n- Skip fenced code blocks when parsing\n- Multiple targets: `# Questions for @x @y @z`\n- Each numbered item (1. 2. 3.) becomes a question\n- Options via a. b. c. with nested - Pro/Con\n- `# Wondering` sections tracked but not displayed\n\n## Storage Model\n- Keep ORIGINAL body in JSONL (don't strip)\n- Create linked question records on post\n- Hide question content on RENDER only\n\n## Edit Handling\n- Editing body does NOT re-extract questions\n- Warn user that # Questions/# Wondering hidden on render\n- To edit questions, edit question object directly\n\n## Backward Compat\n- `fray ask` = single focused question (complementary)\n- `# Questions` = batch in context\n\nSee msg-ln1pevbd for original design, msg-mv35bxrh for implementation decisions.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-31T14:42:11.807705-08:00","created_by":"adam","updated_at":"2025-12-31T15:30:28.911511-08:00","closed_at":"2025-12-31T15:30:28.911511-08:00","close_reason":"Implemented question extraction from markdown. Parses # Questions for @x and # Wondering sections, extracts numbered questions with lettered options and pro/con bullets. Questions stored with options JSON, stripped from display on render."}
{"id":"fray-qqv","title":"P0.5: Agent GUID and global registry","description":"Implement agent GUID system with progressive discovery.\n\nAgent storage:\n- known_agents in .mm/mm-config.json (source of truth, committed)\n- Global config (~/.config/mm/) tracks channels only (NOT agents)\n\nmm new \u003cname\u003e flow:\n1. Check .mm/mm-config.json known_agents\n2. If exists: Prompt \"Use existing @\u003cname\u003e (\u003cusr-guid\u003e)? [Y/n]\"\n   - Y: Reuse GUID\n   - n: Generate new usr-\u003cguid\u003e\n3. If not exists: Generate new usr-\u003cguid\u003e\n4. Add to known_agents in .mm/mm-config.json\n5. Append to agents.jsonl\n\nAgent fields:\n- id: usr-\u003c8chars\u003e (GUID)\n- name: Simple name (e.g., \"devrel\")\n- global_name: Prefixed name (e.g., \"mm-devrel\")\n- home_channel: ch-\u003cguid\u003e or null for global agents\n- created_at: ISO timestamp\n- status: \"active\" or \"inactive\"\n\nAuto-nick generation:\n- If home_channel == current channel: nick = name\n- Else: nick = global_name\n\nReferences: PLAN.md sections 6, 3\nCritical files: src/commands/new.ts, src/core/config.ts, src/db/jsonl.ts","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-19T11:57:10.004318-08:00","updated_at":"2025-12-19T22:57:34.292411-08:00","closed_at":"2025-12-19T14:30:56.356025-08:00","close_reason":"Added known_agents reuse flow and updated agent config/JSONL metadata","dependencies":[{"issue_id":"fray-qqv","depends_on_id":"fray-z3l","type":"blocks","created_at":"2025-12-19T11:57:45.531318-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-re5","title":"Validate linked project DB exists before opening","description":"## Problem\nWhen opening a linked project database (src/commands/shared.ts:38), there's no validation that the file exists:\n\n```typescript\nconst linkedDb = new Database(linkedProj.path);\n```\n\n`better-sqlite3` silently creates a new empty database if the path doesn't exist. This means:\n- If the linked project's DB is moved/deleted, a new empty DB is created\n- Silent data divergence - agent thinks they're in the right project\n- The stored path is the `.db` file, not project root, making it fragile to renames\n\n## Additional Issues\n- `link.ts:34` stores `targetProject.dbPath` (the DB file path)\n- `shared.ts:44` sets `project.root` to the DB path, not the project root\n\n## Fix\n1. Check `fs.existsSync(linkedProj.path)` before `new Database()`\n2. Consider storing project root instead of DB path, and re-discovering\n3. Surface clear error: \"Linked project 'foo' database not found at /path. Use 'bdm unlink foo' and re-link.\"\n\n## Files\n- src/commands/shared.ts:24-45\n- src/commands/link.ts:33-39\n\n## Acceptance Criteria\n- Error thrown if linked DB doesn't exist\n- Clear error message with remediation steps\n- No silent DB creation","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-04T14:03:26.68534-08:00","updated_at":"2025-12-19T22:57:34.295222-08:00","closed_at":"2025-12-04T14:11:29.764681-08:00"}
{"id":"fray-ree","title":"P0.8: Tests for GUID system","description":"Add comprehensive tests for GUID-based architecture.\n\nTest files to create/update:\n\n1. tests/guid.test.ts (NEW)\n   - GUID generation (uniqueness, format, length)\n   - Base58 encoding validation\n   - Type prefixes (msg-, usr-, ch-)\n   - Collision handling\n\n2. tests/jsonl.test.ts (NEW)\n   - appendMessage() writes valid JSONL\n   - readMessages() parses correctly\n   - Handle malformed JSONL (skip bad lines)\n   - Append-only guarantees\n   - File locking behavior (optional)\n\n3. tests/schema.test.ts (UPDATE)\n   - GUID columns exist and are primary keys\n   - No short_id or display_id columns\n   - Channel_id foreign key relationships\n\n4. tests/queries.test.ts (NEW)\n   - Prefix matching resolution\n   - Ambiguous GUID handling\n   - Channel-scoped queries\n   - GUID → message lookup\n\n5. tests/rebuild.test.ts (NEW)\n   - SQLite rebuilds from JSONL\n   - Staleness detection works\n   - GUIDs preserved across rebuilds\n   - Handles missing JSONL files\n\nCoverage goals:\n- Core GUID functions: 100%\n- JSONL writers/readers: 95%\n- Schema migrations: 90%\n- Query resolvers: 95%\n\nRun with: npm test\n\nReferences: Existing tests in tests/\nCritical files: tests/guid.test.ts (NEW), tests/jsonl.test.ts (NEW), tests/rebuild.test.ts (NEW)","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-19T13:31:02.571331-08:00","updated_at":"2025-12-19T22:57:34.290322-08:00","closed_at":"2025-12-19T15:09:07.164777-08:00","close_reason":"Added GUID/jsonl/rebuild/query tests and schema assertions","dependencies":[{"issue_id":"fray-ree","depends_on_id":"fray-3vp","type":"blocks","created_at":"2025-12-19T13:31:23.060634-08:00","created_by":"daemon","metadata":"{}"},{"issue_id":"fray-ree","depends_on_id":"fray-qqv","type":"blocks","created_at":"2025-12-19T13:31:23.147933-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-rq1","title":"Go: Add quickstart command","description":"Missing 'mm quickstart' or 'mm qs' command. Critical for agent onboarding.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-21T01:28:41.667461-08:00","updated_at":"2025-12-21T01:45:08.823068-08:00","closed_at":"2025-12-21T01:45:08.823068-08:00","close_reason":"Implemented in Go"}
{"id":"fray-sw9d","title":"Extract chat/panels.go from model.go","description":"Extract sidebar + thread panel: renderThreadPanel(), renderSidebar(), handleThreadPanelKeys(), handleSidebarKeys(), threadEntries(), filtering logic, navigation helpers. ~800 lines - biggest extraction.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-31T23:53:43.098075-08:00","created_by":"adam","updated_at":"2025-12-31T23:53:43.098075-08:00","dependencies":[{"issue_id":"fray-sw9d","depends_on_id":"fray-eg25","type":"blocks","created_at":"2025-12-31T23:53:49.566167-08:00","created_by":"adam"}]}
{"id":"fray-t29","title":"P2.1: Nick management commands","description":"mm nick @agent --as nickname --in channel. mm nicks @agent to show all nicks. mm whoami to show my names/nicks.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T11:57:35.368913-08:00","updated_at":"2025-12-19T22:57:34.311088-08:00","closed_at":"2025-12-19T15:44:34.984201-08:00","close_reason":"Added nick/nicks/whoami commands and nickname mapping","dependencies":[{"issue_id":"fray-t29","depends_on_id":"fray-qqv","type":"blocks","created_at":"2025-12-19T11:57:46.654854-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-tzi","title":"Show status/purpose consistently across roster, info, who","description":"Display status and purpose fields consistently in roster, info, and who commands.\n\nWhen not set:\n- JSON output: show as empty string (\"\")\n- CLI output: show as '--'\n\nCurrently:\n- roster: shows status (only when set), no purpose\n- info: doesn't show status/purpose in roster summary\n- who: doesn't show status or purpose","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-21T12:13:23.975689-08:00","updated_at":"2025-12-21T15:55:28.299495-08:00","closed_at":"2025-12-21T15:55:28.299495-08:00","close_reason":"Implemented - formatOptionalValue returns '--' for nil/empty"}
{"id":"fray-unj","title":"Add 'import' command","description":"Import file as messages.\n\n```bash\nfray import doc.md --as alice              # single message\nfray import doc.md --as alice --split      # split on ## headers\nfray import doc.md --as alice --thread research\n```\n\nSplitting logic:\n- `#` or `##` markdown headers indicate message boundaries\n- Each section becomes its own message\n- Preserves threading/attribution\n\nUse cases: bringing external docs into fray, seeding conversations.","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-30T16:47:26.108512-08:00","created_by":"adam","updated_at":"2025-12-30T16:47:26.108512-08:00"}
{"id":"fray-vfv","title":"Implement read_to watermark system","description":"Replace per-message read receipts with positional watermarks.\n\nSchema:\n```sql\nfray_read_to (\n  agent_id TEXT NOT NULL,\n  home TEXT NOT NULL,  -- 'room' or thread GUID\n  message_guid TEXT NOT NULL,\n  message_ts INTEGER NOT NULL,\n  set_at INTEGER NOT NULL,\n  PRIMARY KEY (agent_id, home)\n)\n```\n\n- SQLite only (not JSONL persisted)\n- Watermark advances as agent views messages\n- Persists across sessions via back/bye\n- Display in chat: `#guid    read_to: @alice @bob`\n- JSON output includes read_to positions","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-31T00:08:05.204028-08:00","created_by":"adam","updated_at":"2025-12-31T05:53:48.375969-08:00","closed_at":"2025-12-31T05:53:48.375969-08:00","close_reason":"Implemented read_to watermark system: schema, queries, and integration with get command"}
{"id":"fray-vtw","title":"Go: Add view command","description":"Missing 'mm view \u003cid\u003e' command to view full message without truncation.","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-21T01:33:54.8982-08:00","updated_at":"2025-12-21T02:17:38.366743-08:00","closed_at":"2025-12-21T02:17:38.366743-08:00","close_reason":"Implemented view command"}
{"id":"fray-vws","title":"Display read_to in chat TUI","description":"Show read_to watermark positions in chat:\n\n```\n@opus:\nFixed beads sync issue...\n#908n                                    read_to: @gpt52 @devrel\n```\n\n- Right-aligned on the #guid line\n- Show agents whose watermark is at this message\n- Dim/style appropriately","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T00:08:05.450673-08:00","created_by":"adam","updated_at":"2025-12-31T05:53:54.50668-08:00","closed_at":"2025-12-31T05:53:54.50668-08:00","close_reason":"Implemented read_to display in chat TUI: shows 'read_to: @agent1 @agent2' right-aligned on the #guid line","dependencies":[{"issue_id":"fray-vws","depends_on_id":"fray-vfv","type":"blocks","created_at":"2025-12-31T00:08:13.53981-08:00","created_by":"daemon"}]}
{"id":"fray-w6q","title":"P1.4: Cross-channel operations","description":"Implement cross-channel operations with --in flag and mm use.\n\n1. Add --in \u003cchannel\u003e flag to all commands:\n   mm post @dev \"update\" --in party\n   mm get --in party --last 10\n   mm thread @#x9y8 --in party\n\n2. Implement mm use \u003cchannel\u003e:\n   mm use party\n   # Updates ~/.config/mm/mm-config.json current_channel\n   # Subsequent commands use party context\n\n3. Channel context resolution priority:\n   a. --in \u003cchannel\u003e flag (explicit)\n   b. Current channel from mm use (stored in ~/.config/mm/)\n   c. Channel from current directory (.mm/mm-config.json)\n   d. Error: \"No channel context\"\n\n4. Agent resolution in channel context:\n   - @dev in home channel → usr-devrel5\n   - @mm-devrel in other channels → usr-devrel5\n   - Lookup known_agents in target channel's .mm/mm-config.json\n\nImplementation:\n- src/commands/use.ts (NEW): mm use command\n- src/core/context.ts (NEW): Channel context resolution\n- Add --in flag parsing to all commands\n- Update agent resolution to check channel context\n\nReferences: PLAN.md sections 5, 6\nCritical files: src/commands/use.ts (NEW), src/core/context.ts (NEW), src/core/agents.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T11:57:26.225192-08:00","updated_at":"2025-12-19T22:57:34.298986-08:00","closed_at":"2025-12-19T15:32:40.620706-08:00","close_reason":"Added channel context resolution, --in support, and mm use","dependencies":[{"issue_id":"fray-w6q","depends_on_id":"fray-qqv","type":"blocks","created_at":"2025-12-19T11:57:46.215967-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-w7oo","title":"Split db/jsonl.go by operation type","description":"db/jsonl.go is 1376 lines. Split into: jsonl_append.go (11 append functions), jsonl_read.go (4 read functions + version history), jsonl_rebuild.go (RebuildDatabaseFromJSONL). Cleaner separation of write-only, read-only, and rebuild operations.","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-31T23:53:31.057154-08:00","created_by":"adam","updated_at":"2025-12-31T23:53:31.057154-08:00"}
{"id":"fray-wh2o","title":"Review/update prune command for thread changes","description":"The prune command needs review after all the thread/questions/surface changes. Ensure it:\n- Handles thread messages correctly\n- Preserves thread integrity\n- Works with questions system\n- Handles surfaced messages and backlinks","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-31T23:38:06.923895-08:00","created_by":"adam","updated_at":"2025-12-31T23:38:06.923895-08:00"}
{"id":"fray-wjm","title":"Implement beads database discovery","description":"Create src/core/project.ts to discover and connect to the beads database.\n\n## Behavior\n1. Start from current working directory\n2. Walk up directory tree looking for `.beads/` directory\n3. Find `*.db` file within `.beads/`\n4. Return absolute path to the database file\n\n## Error Cases\n- No `.beads/` directory found: Exit with error \"Not in a beads project. Run 'bd init' first.\"\n- Multiple `*.db` files: Use first one (alphabetically) or error if ambiguous\n- `.beads/` exists but no `*.db`: Exit with error \"Beads project not initialized. Run 'bd init' first.\"\n\n## API\n```typescript\n// src/core/project.ts\n\nexport interface BeadsProject {\n  root: string;      // Absolute path to project root\n  dbPath: string;    // Absolute path to .beads/*.db\n}\n\n/**\n * Discover beads project from current directory.\n * Walks up the directory tree looking for .beads/\n * @throws Error if not in a beads project\n */\nexport function discoverProject(startDir?: string): BeadsProject;\n\n/**\n * Open database connection to beads project.\n * Initializes bdm schema if not present.\n */\nexport function openDatabase(project: BeadsProject): Database;\n```\n\n## Files\n- src/core/project.ts\n\n## Acceptance Criteria\n- Discovers .beads/ from any nested subdirectory\n- Returns correct absolute paths\n- Clear error messages when not in beads project\n- Unit tests for discovery logic","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T09:58:24.845618-08:00","updated_at":"2025-12-19T22:57:34.309357-08:00","closed_at":"2025-12-04T12:17:01.85223-08:00","dependencies":[{"issue_id":"fray-wjm","depends_on_id":"fray-08v","type":"parent-child","created_at":"2025-12-04T10:00:39.675319-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-wjm","depends_on_id":"fray-kit","type":"blocks","created_at":"2025-12-04T10:45:24.188389-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-wjm","depends_on_id":"fray-bml","type":"blocks","created_at":"2025-12-04T10:59:48.435876-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-wkx","title":"Write integration tests for key flows","description":"Create integration tests covering the main user workflows.\n\n## Prerequisites\n- Tests require the `bd` CLI to be installed (beads issue tracker)\n- Tests create temporary beads projects using `bd init`\n\n## Test Flows\n\n### 1. Full Agent Lifecycle\n```typescript\ntest('agent lifecycle: new → post → bye', async () =\u003e {\n  // Create agent\n  await run('bdm new alice --goal \"testing\"');\n  // Verify agent exists\n  expect(await run('bdm who alice')).toContain('alice.1');\n  // Post message\n  await run('bdm post --as alice.1 \"hello world\"');\n  // Verify message\n  expect(await run('bdm')).toContain('hello world');\n  // Leave\n  await run('bdm bye alice.1');\n  // Verify not in here\n  expect(await run('bdm here')).not.toContain('alice.1');\n});\n```\n\n### 2. Mention Routing\n```typescript\ntest('mention routing', async () =\u003e {\n  await run('bdm new alice');\n  await run('bdm new bob');\n  await run('bdm post --as alice.1 \"@bob.1 hey there\"');\n  await run('bdm post --as bob.1 \"@alice check this\"');\n  \n  // Bob should see alice's message\n  expect(await run('bdm @bob')).toContain('@bob.1 hey there');\n  // Alice should see bob's message (prefix match)\n  expect(await run('bdm @alice')).toContain('@alice check this');\n});\n```\n\n### 3. @all Broadcast\n```typescript\ntest('@all broadcast', async () =\u003e {\n  await run('bdm new pm');\n  await run('bdm new dev');\n  await run('bdm post --as pm.1 \"@all standup\"');\n  \n  // Both should see it\n  expect(await run('bdm @pm')).toContain('@all standup');\n  expect(await run('bdm @dev')).toContain('@all standup');\n});\n```\n\n### 4. Cross-Project Messaging\n```typescript\ntest('cross-project messaging', async () =\u003e {\n  // Setup: create two beads projects using bd init\n  await runIn('/tmp/proj-a', 'bd init --prefix a');\n  await runIn('/tmp/proj-b', 'bd init --prefix b');\n  \n  // Link from A to B\n  await runIn('/tmp/proj-a', 'bdm link other /tmp/proj-b');\n  \n  // Create agent in A, post to B\n  await runIn('/tmp/proj-a', 'bdm new frontend');\n  await runIn('/tmp/proj-a', 'bdm --project other post --as frontend.1 \"hey B\"');\n  \n  // Verify message appears in B\n  expect(await runIn('/tmp/proj-b', 'bdm')).toContain('hey B');\n});\n```\n\n### 5. Stale Agent Filtering\n```typescript\ntest('stale agents filtered from here', async () =\u003e {\n  await run('bdm new alice');\n  // Artificially age the agent by updating DB directly\n  // Note: need direct DB access for this test\n  await db.run('UPDATE bdm_agents SET last_seen = ? WHERE agent_id = ?', \n    [Date.now()/1000 - 5*3600, 'alice.1']);\n  \n  // Default here should not show stale\n  expect(await run('bdm here')).not.toContain('alice.1');\n  // --all should show\n  expect(await run('bdm here --all')).toContain('alice.1');\n});\n```\n\n## Test Setup\n\n```typescript\n// tests/setup.ts\nimport { execaCommand } from 'execa';\nimport * as fs from 'fs/promises';\nimport * as path from 'path';\nimport * as os from 'os';\n\nlet testDir: string;\n\nexport async function setupTestProject(): Promise\u003cstring\u003e {\n  // Create temp directory\n  testDir = await fs.mkdtemp(path.join(os.tmpdir(), 'bdm-test-'));\n  // Initialize beads project\n  await execaCommand('bd init --prefix test', { cwd: testDir });\n  return testDir;\n}\n\nexport async function cleanup() {\n  if (testDir) {\n    await fs.rm(testDir, { recursive: true, force: true });\n  }\n}\n\nexport function run(cmd: string, cwd: string = testDir) {\n  return execaCommand(cmd, { cwd });\n}\n```\n\n## Files\n- tests/integration/lifecycle.test.ts\n- tests/integration/mentions.test.ts\n- tests/integration/cross-project.test.ts\n- tests/setup.ts\n\n## Acceptance Criteria\n- All key workflows have integration tests\n- Tests run in isolated temp directories\n- Tests clean up after themselves\n- All tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T10:17:46.99771-08:00","updated_at":"2025-12-19T22:57:34.302311-08:00","closed_at":"2025-12-04T12:47:16.031657-08:00","dependencies":[{"issue_id":"fray-wkx","depends_on_id":"fray-po1","type":"parent-child","created_at":"2025-12-04T10:19:05.568139-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-wkx","depends_on_id":"fray-yug","type":"blocks","created_at":"2025-12-04T10:19:24.674191-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-wkx","depends_on_id":"fray-8xb","type":"blocks","created_at":"2025-12-04T10:19:29.798964-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-x40","title":"Go: Add filter command","description":"Missing 'mm filter' command to manage message filter preferences.","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-21T01:33:49.496231-08:00","updated_at":"2025-12-21T02:18:02.637233-08:00","closed_at":"2025-12-21T02:18:02.637233-08:00","close_reason":"Implemented filter command"}
{"id":"fray-xfq","title":"P1.2: Chat reply-to with @#id","description":"Implement chat reply-to with prefix matching resolution.\n\nParse @#prefix from input:\n- Minimum 2 chars: @#a1, @#ab, @#a1b2\n- Full GUID works: @#msg-a1b2c3d4\n- Extract, resolve to GUID, strip from body\n\nResolution algorithm (src/core/guid-resolver.ts):\n1. Normalize: @#a1b2 → msg-a1b2 (add msg- prefix if missing)\n2. Query: SELECT guid FROM mm_messages WHERE guid LIKE 'msg-a1b2%' AND channel_id = ? ORDER BY created_at DESC LIMIT 5\n3. If 0 matches: Error \"No message found matching @#a1b2\"\n4. If 1 match: Use it\n5. If 2+ matches: Error \"Ambiguous reference @#a1b2. Did you mean:\\n  @#a1b2c3 (2m ago): preview...\\n  @#a1b2x9 (5m ago): preview...\"\n\nScoping:\n- Default: Current channel\n- Full GUID (msg-xxx): Works globally\n\nImplementation:\n- src/chat/input.ts: Parse @#prefix, call resolver\n- src/core/guid-resolver.ts (NEW): Resolution logic\n- Strip @#prefix from body before storing\n- Set reply_to field with full GUID\n\nReferences: PLAN.md section 8 (Prefix resolution)\nCritical files: src/chat/input.ts, src/core/guid-resolver.ts (NEW)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T11:57:25.648393-08:00","updated_at":"2025-12-19T22:57:34.299582-08:00","closed_at":"2025-12-19T15:15:59.011776-08:00","close_reason":"Added @# reply parsing with resolution/ambiguity handling in chat","dependencies":[{"issue_id":"fray-xfq","depends_on_id":"fray-3vp","type":"blocks","created_at":"2025-12-19T13:13:42.038924-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-xpd","title":"Implement agent query functions","description":"Create query functions for agent CRUD operations in src/db/queries.ts.\n\n## Functions to Implement\n\n```typescript\n// src/db/queries.ts (agent functions)\n\nimport type { Agent } from '../types.js';\nimport type Database from 'better-sqlite3';\n\n/**\n * Get agent by exact ID.\n * @returns Agent or undefined if not found\n */\nexport function getAgent(db: Database, agentId: string): Agent | undefined;\n\n/**\n * Get agents matching a prefix.\n * Used for @mention resolution and \"bdm who\" command.\n * @example getAgentsByPrefix(db, \"alice\") -\u003e [alice.1, alice.419, alice.frontend.3]\n * @example getAgentsByPrefix(db, \"alice.frontend\") -\u003e [alice.frontend.1, alice.frontend.3]\n */\nexport function getAgentsByPrefix(db: Database, prefix: string): Agent[];\n\n/**\n * Create new agent.\n * @throws if agent_id already exists\n */\nexport function createAgent(db: Database, agent: Omit\u003cAgent, 'left_at'\u003e): void;\n\n/**\n * Update agent fields.\n * Only updates provided fields.\n */\nexport function updateAgent(\n  db: Database, \n  agentId: string, \n  updates: Partial\u003cPick\u003cAgent, 'goal' | 'bio' | 'last_seen' | 'left_at'\u003e\u003e\n): void;\n\n/**\n * Get active agents (not left, not stale).\n * @param staleHours - hours of inactivity before considered stale\n */\nexport function getActiveAgents(db: Database, staleHours: number): Agent[];\n\n/**\n * Get all agents including stale and left.\n */\nexport function getAllAgents(db: Database): Agent[];\n\n/**\n * Get highest version number for a base name.\n * Used by \"bdm new\" to auto-increment.\n * @example getMaxVersion(db, \"alice\") -\u003e 419 (if alice.419 exists)\n * @returns 0 if no agents with this base exist\n * \n * Implementation: Query for agent IDs matching pattern \"base.N\" where N is numeric.\n * SQL: SELECT agent_id FROM bdm_agents WHERE agent_id GLOB 'base.[0-9]*'\n * Then parse out the numeric suffix and return max.\n */\nexport function getMaxVersion(db: Database, base: string): number;\n```\n\n## Implementation Notes\n- Use prepared statements for better performance\n- Active = left_at IS NULL AND last_seen \u003e (now - stale_hours * 3600)\n- Prefix matching for getAgentsByPrefix: agent_id = prefix OR agent_id LIKE 'prefix.%'\n- For getMaxVersion, use GLOB pattern to match base.N format, then parse results in JS\n\n## SQL Examples\n\n```sql\n-- getActiveAgents\nSELECT * FROM bdm_agents \nWHERE left_at IS NULL \n  AND last_seen \u003e (strftime('%s', 'now') - ? * 3600)\n\n-- getAgentsByPrefix (prefix = \"alice\")\nSELECT * FROM bdm_agents\nWHERE agent_id = 'alice' OR agent_id LIKE 'alice.%'\n\n-- getMaxVersion (base = \"alice\")  \nSELECT agent_id FROM bdm_agents\nWHERE agent_id GLOB 'alice.[0-9]*'\n-- Then in JS: parse each to extract number, return max\n```\n\n## Files\n- src/db/queries.ts (add agent functions)\n\n## Acceptance Criteria\n- All functions work with real SQLite database\n- Prepared statements are used\n- Unit tests cover all functions\n- Edge cases: empty results, prefix matching, getMaxVersion with no matches","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T09:59:32.649203-08:00","updated_at":"2025-12-19T22:57:34.307458-08:00","closed_at":"2025-12-04T12:19:20.31674-08:00","dependencies":[{"issue_id":"fray-xpd","depends_on_id":"fray-08v","type":"parent-child","created_at":"2025-12-04T10:00:55.040278-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-xpd","depends_on_id":"fray-6cj","type":"blocks","created_at":"2025-12-04T10:01:28.420112-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-xpd","depends_on_id":"fray-1wj","type":"blocks","created_at":"2025-12-04T10:01:33.54775-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-y1t","title":"Simplify message ID display and reply syntax","description":"1. Display message IDs as #id instead of @#id at end of messages\n2. Accept #id at start of message for threading (instead of @#id)\n3. If #id doesn't match any message, treat it as literal text (don't error, don't thread)","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-19T21:29:21.701749-08:00","updated_at":"2025-12-21T01:27:06.006767-08:00","closed_at":"2025-12-21T01:27:06.006767-08:00","close_reason":"Completed in Go rewrite"}
{"id":"fray-yaj8","title":"Answer display polish: Q/A bold white, question text in asker color","description":"In chat view answer messages: Q: and A: should be bold bright white. Question text should be colored with the asker's chat color (e.g., opus's color for questions opus asked).","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-31T17:47:13.405873-08:00","created_by":"adam","updated_at":"2025-12-31T17:47:13.405873-08:00"}
{"id":"fray-yh4","title":"Phase 4: CLI Commands","description":"Implement all CLI commands for bdm.\n\n## Goal\nComplete CLI implementation with all commands from the spec:\n- Lifecycle: new, hi, bye\n- Presence: here, who\n- Messages: (default), @mentions, post, --watch\n- Cross-project: link, unlink, projects\n- Config: config\n\n## Context\nCLI uses Commander.js for parsing. Each command is in a separate file under src/commands/.\nGlobal --project flag operates in linked project context.\n\nSee PLAN.md \"CLI Specification\" section for full command details.\n\n## Exit Criteria\n- All commands implemented per spec\n- `--help` works for all commands\n- Error messages are clear\n- Integration tests for key flows","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-04T10:07:42.21857-08:00","updated_at":"2025-12-19T22:57:34.296016-08:00","closed_at":"2025-12-04T12:38:13.18509-08:00","dependencies":[{"issue_id":"fray-yh4","depends_on_id":"fray-dk4","type":"blocks","created_at":"2025-12-04T10:11:24.845419-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-yug","title":"Implement consistent output formatting","description":"Create output formatting utilities for consistent CLI display.\n\n## Output Formatting Requirements\n\n### Message Format\n```\n[42] alice.419 (2m ago): figured out the auth issue, @bob.3 see auth.py:47\n```\nComponents:\n- `[id]` - message ID in brackets\n- `agent` - sender's full agent ID\n- `(time)` - relative time in parentheses\n- `:` - separator\n- `body` - message content\n\n### Agent List Format (bdm here)\n```\nalice.419    (2m ago)   \"implementing snake algorithm\"\nbob.3        (5m ago)   \"reviewing auth PR\"\n```\nComponents:\n- Agent ID padded to align\n- Relative time in parentheses\n- Goal in quotes\n\n### Agent Detail Format (bdm who)\n```\nalice.419\n  Goal: implementing snake algorithm\n  Bio:  claude-opus, patient problem solver\n  Registered: 2h ago\n  Last seen: 12m ago\n  Status: active\n```\n\n## Implementation\n\n```typescript\n// src/output/format.ts\n\nexport function formatMessage(msg: Message): string;\nexport function formatAgentRow(agent: Agent): string;\nexport function formatAgentDetail(agent: Agent): string;\nexport function formatConfig(entries: ConfigEntry[]): string;\n```\n\n## Color Support (Optional)\n- Respect NO_COLOR environment variable\n- Respect --no-color flag\n- Use chalk for colors if enabled:\n  - Agent IDs: cyan\n  - @mentions: cyan\n  - Time: dim\n  - Message ID: yellow\n\n```typescript\nimport chalk from 'chalk';\n\nconst noColor = process.env.NO_COLOR || options.noColor;\nconst c = noColor ? { cyan: (s) =\u003e s, dim: (s) =\u003e s } : chalk;\n```\n\n## Files\n- src/output/format.ts\n\n## Acceptance Criteria\n- All output is consistent across commands\n- Alignment is correct for lists\n- Colors respect NO_COLOR\n- Unit tests for formatters","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T10:12:42.197564-08:00","updated_at":"2025-12-19T22:57:34.302947-08:00","closed_at":"2025-12-04T12:44:20.721328-08:00","dependencies":[{"issue_id":"fray-yug","depends_on_id":"fray-po1","type":"parent-child","created_at":"2025-12-04T10:18:55.33398-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-yug","depends_on_id":"fray-6cj","type":"blocks","created_at":"2025-12-04T10:51:32.345977-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-yug","depends_on_id":"fray-8jo","type":"blocks","created_at":"2025-12-04T10:51:37.483929-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-yvi","title":"Add mm info and mm init --defaults","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-20T16:05:19.931693-08:00","updated_at":"2025-12-20T16:11:14.116241-08:00","closed_at":"2025-12-20T16:11:14.116241-08:00","close_reason":"Closed"}
{"id":"fray-z3l","title":"P0.4: Channel GUID system","description":"Implement channel GUID system with project-level config.\n\nProject config (.mm/mm-config.json, COMMITTED to git):\n{\n  \"version\": 1,\n  \"channel_id\": \"ch-mmdev12\",\n  \"channel_name\": \"mm\",\n  \"created_at\": \"2025-12-19T10:00:00Z\",\n  \"known_agents\": {}\n}\n\nGlobal config (~/.config/mm/mm-config.json, per-machine):\n{\n  \"version\": 1,\n  \"channels\": {\n    \"ch-mmdev12\": {\"name\": \"mm\", \"path\": \"/Users/adam/dev/mini-msg\"}\n  },\n  \"current_channel\": \"ch-mmdev12\"\n}\n\nImplementation:\n- Add channel_id TEXT column to mm_messages table\n- Create .mm/mm-config.json on mm init (prompt for channel name, default: dirname)\n- Generate channel GUID (ch-\u003c8chars\u003e)\n- Register in ~/.config/mm/mm-config.json\n- Create src/core/config.ts for config file handling\n\nmm init flow:\n1. Prompt: \"Channel name? [dirname]:\"\n2. Generate ch-\u003cguid\u003e\n3. Write .mm/mm-config.json\n4. Register in ~/.config/mm/mm-config.json\n\nReferences: PLAN.md sections 3, 4\nCritical files: src/commands/init.ts, src/core/config.ts (NEW), src/db/schema.ts","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-19T11:57:09.724922-08:00","updated_at":"2025-12-19T22:57:34.292759-08:00","closed_at":"2025-12-19T14:23:59.619176-08:00","close_reason":"Added channel config/global registry, channel_id column, and init registration","dependencies":[{"issue_id":"fray-z3l","depends_on_id":"fray-7kr","type":"blocks","created_at":"2025-12-19T11:57:45.451847-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-zei","title":"Add 'fray answer' command for question review workflow","description":"Dedicated interface for users to review and answer questions one at a time.\n\n## Interface\n- Modal/blocking (like Claude Code's question UI)\n- One question at a time\n- Options with pros/cons (a. b. c. with nested - Pro/Con)\n- User can select option OR write custom answer\n\n## Accept/Close Flow\n- **Agent → User:** Requires explicit ACCEPT before truly closed\n  - Answer posted → 'has-answer'\n  - User reviews → 'accepted' or 'needs-revision'\n- **Agent → Agent:** Auto-close on READ by recipient\n  - Answer posted → 'has-answer'\n  - Recipient reads → auto-closed (acknowledgment)\n\n## Skip Flow\n- Skip = soft ignore for now\n- At END of answer session: 'Review X previously skipped questions?'\n- Does NOT show questions skipped THIS session\n\n## Order\n- Newest question set first\n- Questions shown in order listed in set\n- Then backward through older sets\n\n## Invocation\n- `fray answer` standalone\n- `/answer` in chat interface\n- `fray` leads into answer if questions pending (return = answer, any other key = exit)\n\nSee msg-ln1pevbd for original design, msg-qgromx1z for accept/close flow.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-31T14:42:26.672635-08:00","created_by":"adam","updated_at":"2025-12-31T16:00:33.498471-08:00","closed_at":"2025-12-31T16:00:33.498471-08:00","close_reason":"Implemented in commit 262ba1f. Core answer command working with interactive UI, option selection, skip flow. Follow-up work possible: accept/reject flow refinement, /answer chat integration, auto-trigger on fray.","dependencies":[{"issue_id":"fray-zei","depends_on_id":"fray-qnd","type":"blocks","created_at":"2025-12-31T14:42:43.991251-08:00","created_by":"adam"}]}
