{"id":"fray-014","title":"Add join/leave event messages","description":"Generate event-type messages for agent lifecycle:\n\n- `fray new agent`: Post event 'agent joined'\n- `fray back agent` (after bye): Post event 'agent rejoined' \n- `fray back agent` (no prior bye): Post event 'new session: agent' (handoff indicator)\n- `fray bye agent`: Post event 'agent left'\n\nThese are type='event' messages (not regular agent messages).\n\nBenefits:\n- Shows handoff history in chat\n- Reduces verbosity vs always showing in real-time\n- Provides context for read_to positions","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-31T00:08:05.328679-08:00","created_by":"adam","updated_at":"2025-12-31T05:53:48.488258-08:00","closed_at":"2025-12-31T05:53:48.488258-08:00","close_reason":"Implemented join/leave/session events: new posts '@agent joined', bye posts '@agent left', back posts '@agent rejoined' or 'new @agent session'"}
{"id":"fray-01ap","title":"Daemon: contextual @mention interpretation","description":"Use mlld to route @mentions and assemble context based on response mode.\n\n## Implementation Complete\n\nStructure in llm/:\n- spawn-context.mld - main entry point\n- lib/claude.mld - haiku wrapper\n- routers/response-mode.router.mld - deterministic + haiku routing\n- routers/response-mode.prompt.att - haiku prompt template  \n- context/{deep-work,weigh-in,quick-answer}.context.mld - mode-specific prompts\n\n## Flow\n\n1. Daemon gets @mention (passed direct-address filter)\n2. Calls `mlld llm/spawn-context.mld` with payload\n3. Router does deterministic check (task verbs, opinion asks, question patterns)\n4. If ambiguous (confidence \u003c 0.7), asks Haiku to decide\n5. Based on mode, assembles right-sized context\n6. Returns { mode, prompt, shouldSpawn }\n7. Daemon spawns with appropriate prompt (or skips if acknowledge)\n\n## Response Modes\n\n| Mode | Trigger | Context |\n|------|---------|---------|\n| deep-work | Task verbs, assignments | Full /fly prompt, session resume |\n| weigh-in | Opinion/review asks | Thread context, relevant notes |\n| quick-answer | Short questions | Just the message |\n| acknowledge | FYI/CC | No spawn |\n\n## Blocked By\n\n- mlld-go SDK (in testing, nearly ready)\n\n## Reference\n\nPattern from ~/dev/party/proto-5.1/llm/routers/\n\n---\n**Update 2026-01-06**: mlld Go SDK should now be published. See ~/dev/mlld/sdk/README.md for integration details.","status":"open","priority":1,"issue_type":"feature","created_at":"2026-01-02T13:19:51.260322-08:00","created_by":"adam","updated_at":"2026-01-06T12:37:08.47925-08:00"}
{"id":"fray-0530","title":"Agent-aware watch: filter to agent-relevant events","description":"Agent-aware watch - design deferred to neo/bare message work.\n\nKey insight: agents need ambient awareness without interruption. Two concerns:\n1. Timer visibility ('how long until recycled?')\n2. Notification hints ('something needs attention' - signal, not content)\n\nArchitectural need: 'agent inbox since last activity' abstraction that powers:\n- fray get (mentions)\n- fray post (unread hint after posting)  \n- fray clock (counts only)\n- fray watch --agent (filtered stream)\n\nThis inbox includes:\n- Unread @mentions\n- Reactions to my messages\n- Replies to my messages\n- (Later: subscribed thread updates via fray-dlvh)\n\nDesign questions to resolve with neo work:\n- What's in minimal vs full views?\n- How should agents be instructed what to subscribe to?\n- Should watch be filterable by agent role/needs?","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-02T19:28:47.578058-08:00","created_by":"adam","updated_at":"2026-01-03T07:15:33.533944-08:00","closed_at":"2026-01-03T07:15:33.533944-08:00","close_reason":"Added --as flag to fray watch. Filters stream to agent-relevant events: own messages, @mentions, replies to agent's messages, reactions to agent's messages."}
{"id":"fray-08qo","title":"Extract chat/messages.go from model.go","description":"Extract message formatting: formatMessage(), replyContext(), renderMessages(), renderByline(), formatReactionSummary(), reaction diffing, message filtering, newEventMessage(), messageAtLine(). ~600 lines.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T23:53:42.814054-08:00","created_by":"adam","updated_at":"2026-01-01T00:27:29.781702-08:00","closed_at":"2026-01-01T00:27:29.781702-08:00","close_reason":"Extracted messages.go (307 lines). model.go 1911→1623.","dependencies":[{"issue_id":"fray-08qo","depends_on_id":"fray-v24f","type":"blocks","created_at":"2026-01-01T00:07:10.252556-08:00","created_by":"adam"}]}
{"id":"fray-08v","title":"Phase 2: Database Layer","description":"Schema initialization and typed query functions for bdm.\n\n## Goal\nA complete database layer that:\n- Discovers and connects to the beads SQLite database\n- Initializes bdm-specific tables (agents, messages, linked_projects, config)\n- Provides typed query functions for all CRUD operations\n\n## Context\nbdm extends the beads SQLite database (`.beads/*.db`) with its own tables.\nThis follows the beads extension pattern documented in EXTENDING.md.\n\nTables:\n- bdm_agents: Agent presence and identity\n- bdm_messages: Room messages with @mentions\n- bdm_linked_projects: Cross-project aliases\n- bdm_config: Settings (e.g., stale_hours)\n\nSee PLAN.md \"Schema\" section for full SQL definitions.\n\n## Exit Criteria\n- Schema creates correctly in beads DB\n- All query functions have unit tests\n- Types match schema exactly","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-04T09:57:56.726228-08:00","updated_at":"2025-12-19T22:57:34.296646-08:00","closed_at":"2025-12-04T12:24:15.535466-08:00","dependencies":[{"issue_id":"fray-08v","depends_on_id":"fray-kit","type":"blocks","created_at":"2025-12-04T10:01:18.169717-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-09h","title":"P1: Core Types \u0026 Storage","description":"Port data layer: types (Agent with status/purpose fields, Message, Claim, Channel), JSONL storage (append/read), SQLite schema with migrations (including goal-\u003estatus, bio-\u003epurpose rename), database queries with cursor pagination. ~8 hours.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T12:17:16.333962-08:00","updated_at":"2025-12-21T01:27:06.004846-08:00","closed_at":"2025-12-21T01:27:06.004846-08:00","close_reason":"Completed in Go rewrite","dependencies":[{"issue_id":"fray-09h","depends_on_id":"fray-n0h","type":"blocks","created_at":"2025-12-20T12:22:05.535897-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-0etk","title":"Agent Coordination UX","description":"Coordination conventions and UX improvements for agent workflows.\n\n## Source\nDerived from fray-cbcs design discussion (thrd-kw5z6vmu).\n\n## Core Insight\nConvention-based approach: clear prompts and habits, not new commands. Room = standups + announcements + blocked. Everything else in threads.\n\n## Components\n\n### fray-l42t: Convention prompts\n- Update /fly, /land with conventions\n- Standup report format\n- Work startup patterns\n\n### fray-a8h1: /hop command\n- Quick session join without full /fly\n- Minimal context injection\n\n### fray-bu0g: Mention hierarchy\n- Recent vs FYI vs likely stale\n- Direct address detection\n- No wasteful suggestions\n\n## Related\n- fray-mzg8: Chat UX epic (sidebar, notifications)\n- fray-cbcs: Original design bead (closed)","status":"closed","priority":0,"issue_type":"epic","created_at":"2026-01-03T21:21:44.779257-08:00","created_by":"adam","updated_at":"2026-01-03T21:54:40.577516-08:00","closed_at":"2026-01-03T21:54:40.577516-08:00","close_reason":"All children complete: l42t (conventions thread + /fly update), a8h1 (/hop command), bu0g (mention hierarchy display)."}
{"id":"fray-0od","title":"Investigate beads daemon architecture","description":"Investigate how beads implements its per-project daemon and determine how bdm should integrate.\n\n## Context\n\n**bdm** (beads-messenger) is a CLI for agent-to-agent messaging in beads projects. We want to add an MCP server so Claude Desktop can participate in chat rooms. Before implementing, we need to understand how beads handles daemons.\n\n**MCP** (Model Context Protocol) is Anthropic's protocol for connecting Claude to external tools/data. MCP servers expose:\n- **Tools**: Actions Claude can call (like `bdm_post`)\n- **Resources**: Data loaded into Claude's context (like room messages)\n\n**Why investigate beads daemon?** beads reportedly uses one daemon per project. We need to understand this before deciding whether bdm's MCP server should:\n- Extend the beads daemon\n- Run its own daemon\n- Be stateless (no daemon)\n\n## Questions to Answer\n\n1. **How does the beads daemon work?**\n   - What triggers daemon startup?\n   - How does it discover/bind to a project?\n   - What does it serve? (HTTP? Unix socket? IPC?)\n   - How long does it live? Auto-shutdown on idle?\n\n2. **Where is the daemon code?**\n   - Find the daemon implementation in beads source\n   - Understand the architecture\n\n3. **Extension points**\n   - Can beads daemon be extended with plugins?\n   - Should bdm add its own endpoints to beads daemon?\n   - Or run a separate daemon that coordinates with beads?\n\n4. **MCP server patterns**\n   - How do other MCP servers handle per-project state?\n   - Does MCP SDK support daemon mode or is it stdio-per-call?\n   - Look at: https://modelcontextprotocol.io/docs\n\n## How to Investigate\n\n```bash\n# beads source is likely at ~/dev/beads or similar\n# Search for daemon-related code:\ngrep -r \"daemon\" --include=\"*.go\" ~/dev/beads\ngrep -r \"server\" --include=\"*.go\" ~/dev/beads\ngrep -r \"listen\" --include=\"*.go\" ~/dev/beads\n\n# Check MCP SDK docs\n# https://modelcontextprotocol.io/docs\n```\n\n## Deliverable\n\nWrite findings to PLAN-mcp.md or comment on this issue with:\n- Summary of beads daemon architecture\n- Recommended approach for bdm MCP server\n- Risks and tradeoffs\n\n## Parent Epic\n\nbdm-ae4: MCP Server for Claude Desktop Integration","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-05T16:35:05.067265-08:00","updated_at":"2025-12-19T22:57:34.29496-08:00","closed_at":"2025-12-05T17:28:30.12919-08:00"}
{"id":"fray-0oq5","title":"Child threads inherit parent agent avatar","description":"Threads nested under an agent thread (like meta/opus/notes) should show the parent agent's avatar as a visual indicator of ownership.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-06T10:35:27.999629-08:00","created_by":"adam","updated_at":"2026-01-06T10:35:27.999629-08:00"}
{"id":"fray-0sk","title":"Fix agent ID format documentation","description":"Update README to show simple names (alice, bob) as primary format, note versioned format (alice.1) as legacy/internal","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T19:55:18.057926-08:00","updated_at":"2025-12-19T22:57:34.311678-08:00","closed_at":"2025-12-17T20:03:36.765684-08:00","close_reason":"Closed"}
{"id":"fray-0sq","title":"Create chat core logic","description":"Create the core chat session logic for polling and sending messages.\n\n## New File: src/chat/core.ts\n\n```typescript\nexport interface ChatSession {\n  username: string;\n  projectName: string;\n  db: Database.Database;\n  lastMessageId: number;\n}\n\nexport function createSession(opts: {\n  db: Database.Database;\n  projectName: string;\n  username: string;\n  lastMessageId?: number;\n}): ChatSession;\n\nexport function pollNewMessages(session: ChatSession): Message[];\n\nexport function sendUserMessage(session: ChatSession, body: string): Message;\n```\n\n## Behavior\n\n### pollNewMessages\n- Query messages with `since: session.lastMessageId`\n- Update `session.lastMessageId` to latest\n- Return array of new messages\n\n### sendUserMessage\n- Extract mentions from body\n- Create message with `type: 'user'` and `from_agent: session.username`\n- Return created message for immediate display\n\n## Exit Criteria\n- Session tracks state correctly\n- Polling returns only new messages\n- User messages have correct type and sender\n- Unit tests for core functions","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-05T15:50:18.291387-08:00","updated_at":"2025-12-19T22:57:34.313652-08:00","closed_at":"2025-12-05T15:57:14.250773-08:00"}
{"id":"fray-0v2y","title":"Daemon stabilization gate","description":"Gate for daemon-related work. Close this when daemon is stable and @adam gives greenlight for journal/protocol work to proceed.\n\nBlocks:\n- fray-xihp (journal reflection in /land)\n- fray-l71b (workstream threads in fly/land)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T13:03:39.594589-08:00","created_by":"adam","updated_at":"2026-01-03T07:05:19.417939-08:00","closed_at":"2026-01-03T07:05:19.417939-08:00","close_reason":"All P0 blockers complete (vftl, xbg4, ypuj). Daemon stable. Greenlight from @adam to proceed with journal/protocol work.","dependencies":[{"issue_id":"fray-0v2y","depends_on_id":"fray-ypuj","type":"blocks","created_at":"2026-01-02T13:20:01.11628-08:00","created_by":"adam"},{"issue_id":"fray-0v2y","depends_on_id":"fray-xbg4","type":"blocks","created_at":"2026-01-02T13:20:01.141099-08:00","created_by":"adam"},{"issue_id":"fray-0v2y","depends_on_id":"fray-vftl","type":"blocks","created_at":"2026-01-02T13:20:01.164628-08:00","created_by":"adam"}]}
{"id":"fray-0vz","title":"P8: Remaining Commands","description":"Port remaining commands: here, bye, whoami, who, thread, history, between, @agent, claim, claims, clear, status, watch, prune, nick/nicks, config, roster, info. Note: Agent fields are 'status' (current task) and 'purpose' (identity), not 'goal'/'bio'. ~6 hours.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T12:17:52.620646-08:00","updated_at":"2025-12-21T01:27:06.006531-08:00","closed_at":"2025-12-21T01:27:06.006531-08:00","close_reason":"Completed in Go rewrite","dependencies":[{"issue_id":"fray-0vz","depends_on_id":"fray-lz9","type":"blocks","created_at":"2025-12-20T12:22:41.751233-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-0wr","title":"Bug: /prune --all does not prune all messages","description":"The --all flag should prune ALL messages (0 remaining), but currently leaves some behind. Fix the prune logic so --all truly removes everything.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-22T12:09:15.846479-08:00","updated_at":"2025-12-22T12:12:19.567689-08:00","closed_at":"2025-12-22T12:12:19.567689-08:00","close_reason":"Fixed by agents"}
{"id":"fray-0z5","title":"Investigate integration strategy","description":"We need to develop a strategy for beads-messenger that makes it trivial for users to onboard agents. The goal should be 3 steps:\n\n- run npm install\n- config/setup (even better if also a command)\n- onboard agent (should be a command - 'new' could onboard them AND update them in one command)\n\nLook at claude code hooks, claude code skills, beads' `bd quickstart` example for onboarding.\n\nWe also need to create an MCP interface for Claude Desktop App, which can't necessarily use a cli but can use an MCP server that makes calls locally.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-04T22:53:00.040842-08:00","updated_at":"2025-12-19T22:57:34.314197-08:00","closed_at":"2025-12-06T09:05:04.57424-08:00","labels":["creator:adamavenir@hey.com","fizzy:maybe"]}
{"id":"fray-13a","title":"Rename 'status: active' to 'here: true|false' in roster","description":"In roster output, 'status: active' is confusing - it indicates presence (would show in 'mm here') not the agent's status field.\n\nChange to 'here: true' or 'here: false' to be consistent with the 'mm here' command and avoid confusion with the actual status field.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-21T12:27:34.86269-08:00","updated_at":"2025-12-21T15:54:51.483543-08:00","closed_at":"2025-12-21T15:54:51.483543-08:00","close_reason":"Implemented in Go rewrite"}
{"id":"fray-147s","title":"Daemon: emergency controls (/stop-all, /pause, /resume)","description":"Emergency controls for daemon - BOTH CLI and chat UI.\n\nCLI commands:\n- fray daemon stop (or /stop-all in chat)\n- fray daemon pause \u003cagent|all\u003e\n- fray daemon resume \u003cagent|all\u003e\n\nChat UI:\n- Warning under textarea if user @mentions paused agent\n- Pause indicator (unicode, not emoji) when paused\n\nThis is part of broader CLI/chat parity effort - many commands should work in both.","status":"open","priority":1,"issue_type":"feature","created_at":"2026-01-02T13:19:52.105487-08:00","created_by":"adam","updated_at":"2026-01-02T15:17:17.063243-08:00"}
{"id":"fray-14r0","title":"Chat: thread view scroll bounces back to bottom","description":"When viewing threads like opus-notes in fray chat, attempting to scroll back through history causes the view to scroll up briefly then push back to the bottom. Main channel doesn't have this issue.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-31T23:38:06.661925-08:00","created_by":"adam","updated_at":"2025-12-31T23:54:50.268588-08:00","closed_at":"2025-12-31T23:54:50.268588-08:00","close_reason":"Fixed in chat bug batch: filtered deleted messages, fixed thread scroll bounce, added near-top preload, refactored answer to Bubble Tea TUI"}
{"id":"fray-1b9","title":"P2.2: Shell autocomplete for agents","description":"Shell completion for @agent names. Show aliases/nicks in completion. Autocomplete @#channel-id format.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-19T11:57:35.745567-08:00","updated_at":"2025-12-19T22:57:34.310888-08:00","dependencies":[{"issue_id":"fray-1b9","depends_on_id":"fray-t29","type":"blocks","created_at":"2025-12-19T11:57:46.734731-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-1dw","title":"Update mlld TextMate grammar for syntax highlighting","description":"Use mlld's updated regex highlighter for syntax highlighting in fray chat.\n\nmlld has updated their TextMate grammar/regex highlighter. Fray already does some mlld highlighting - this is about updating to use the newer version.\n\nSee: internal/chat/mlld_lexer.go (current stub/basic lexer)\n\nAction: Port mlld's updated grammar to Chroma lexer for fray chat display.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-20T21:34:06.004183-08:00","updated_at":"2026-01-06T13:11:57.557785-08:00","dependencies":[{"issue_id":"fray-1dw","depends_on_id":"fray-beb","type":"discovered-from","created_at":"2025-12-20T21:34:06.00556-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-1g0s","title":"Bug: click-to-copy paragraph vs section distinction","description":"Current: multiple lines treated as paragraph, copies whole section. Fix: (a) clicking text copies just that line/paragraph ending at newline, (b) only copy whole section when clicking whitespace within section.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-05T20:38:36.081409-08:00","created_by":"adam","updated_at":"2026-01-05T20:52:01.83129-08:00","closed_at":"2026-01-05T20:52:01.83129-08:00","close_reason":"Changed click-to-copy from paragraph-level to line-level granularity. Now clicking on a specific line copies just that line (not the whole paragraph). Fallback to whole message when clicking outside line zones (e.g., blank lines)."}
{"id":"fray-1g2","title":"Add PreCompact hook with /land reminder","description":"Add PreCompact hook that fires when Claude context is compacting.\n\nInject reminder:\n```\n[fray] Context compacting. Preserve your work:\n1. fray note \"# Handoff ...\" --as \u003cyou\u003e\n2. bd close \u003ccompleted-issues\u003e  \n3. fray bye \u003cyou\u003e\n\nOr run /land for full checklist.\n```\n\nThis is automatic insurance against context loss.\n\nFiles: internal/command/hook_precompact.go (new), internal/command/hook_install.go","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-31T08:01:10.00535-08:00","created_by":"adam","updated_at":"2025-12-31T10:33:01.302875-08:00","closed_at":"2025-12-31T10:33:01.302875-08:00","close_reason":"Implemented hook-statusline command, enhanced UserPromptSubmit with statusline, added SessionStart resume tickler, added PreCompact hook"}
{"id":"fray-1jh","title":"P1.6: mm ls command","description":"mm ls to show all channels, current channel, paths. Read from ~/.config/mm/mm-config.json. Show which channels have local .mm/ dirs.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T11:57:26.802982-08:00","updated_at":"2025-12-19T22:57:34.298378-08:00","closed_at":"2025-12-19T15:32:55.205871-08:00","close_reason":"Added mm ls command listing channels","dependencies":[{"issue_id":"fray-1jh","depends_on_id":"fray-z3l","type":"blocks","created_at":"2025-12-19T11:57:46.374714-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-1mch","title":"Roles \u0026 Knowledge System","description":"First-class roles with knowledge hierarchy and reflections.\n\n## Components\n\n### fray-wl5n: Roles as first-class concept\n- Three dimensions: Identity (agent), Capability (model), Context (role)\n- Hold/play/drop semantics\n- Knowledge access filtered by role\n\n### fray-adj6: Knowledge thread hierarchy  \n- meta/ (project-wide)\n- roles/{role}/ (role knowledge)\n- {agent}/ (agent knowledge)\n\n### fray-gju8: Reflections (was: journals)\n- `fray reflect` - atomic insights to role learnings\n- `fray reflections` - view by role, top by reactions\n- Integrates with role hold/play\n\n## Design Discussions\n- gju8-design (thrd-54hilwmi): Journal → reflect pivot\n- See fray-wl5n, fray-adj6 descriptions for role design\n\n## Key Insight\nReflections are role-based, not agent-based. Discovery by role ('what do architects know?') is more valuable than by agent.","status":"closed","priority":0,"issue_type":"epic","created_at":"2026-01-03T21:09:11.778015-08:00","created_by":"adam","updated_at":"2026-01-05T00:02:55.52344-08:00","closed_at":"2026-01-05T00:02:55.52344-08:00","close_reason":"All components complete: fray-wl5n (roles), fray-adj6 (knowledge hierarchy), fray-gju8 (reflections). Remaining work (legacy migration, /fly injection) can be separate issues."}
{"id":"fray-1mk","title":"P1.1: JSON output for commands","description":"Add --json flag to commands for programmatic access.\n\nCommands to update:\n1. mm here --json\n   Output: {\"agents\": [{\"agent_id\": \"usr-xxx\", \"display_name\": \"alice\", \"goal\": \"...\", \"last_active\": \"ISO\", \"message_count\": N, \"claim_count\": N}], \"total\": N}\n\n2. mm history \u003cagent\u003e --json\n   Output: {\"agent\": \"alice\", \"agent_id\": \"usr-xxx\", \"messages\": [{\"id\": \"msg-xxx\", \"agent_id\": \"usr-xxx\", \"body\": \"...\", \"created_at\": \"ISO\", \"age_seconds\": N, \"mentions\": [], \"reply_to\": null}], \"total\": N}\n\n3. mm between \u003ca\u003e \u003cb\u003e --json\n   Output: {\"agents\": [\"alice\", \"bob\"], \"messages\": [...], \"total\": N}\n\nImplementation:\n- Add --json flag parsing to each command\n- Return structured JSON (pretty-printed)\n- Include full GUIDs (no display IDs)\n- Use ISO 8601 timestamps\n\nReferences: PLAN.md section 9\nCritical files: src/commands/here.ts, src/commands/history.ts (NEW), src/commands/between.ts (NEW)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T11:57:25.36173-08:00","updated_at":"2025-12-19T22:57:34.299868-08:00","closed_at":"2025-12-19T15:12:10.821209-08:00","close_reason":"Added JSON output for here/history/between and new commands","dependencies":[{"issue_id":"fray-1mk","depends_on_id":"fray-qqv","type":"blocks","created_at":"2025-12-19T13:13:41.93647-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-1mri","title":"Sidebar collection view ordering and indentation","description":"Fixed:\n1. Collection views (open-qs, stale-qs, muted) now have same 3-space indentation as threads\n2. open-qs and stale-qs appear just below faves (only if they have content)\n3. muted collection always at bottom\n4. Empty collections are hidden","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-05T22:17:03.166527-08:00","created_by":"adam","updated_at":"2026-01-05T22:17:07.43913-08:00","closed_at":"2026-01-05T22:17:07.43913-08:00","close_reason":"Fixed in panels.go: collection views now have consistent indentation, open-qs/stale-qs appear after faves if non-empty, muted stays at bottom"}
{"id":"fray-1ur","title":"Implement cross-project commands (link, unlink, projects)","description":"Implement commands for managing linked projects.\n\n## Commands\n\n### bdm link \u003calias\u003e \u003cpath\u003e\nLink another beads project for cross-project messaging.\n\n```bash\nbdm link api ~/dev/api-service\nbdm link frontend ../frontend\n```\n\n**Implementation:**\n1. Resolve path to absolute\n2. Verify path contains .beads/ directory\n3. Store in bdm_linked_projects table\n4. Output: \"Linked 'api' → /Users/me/dev/api-service\"\n\n**Validation:**\n- Path must exist\n- Path must contain .beads/ (be a beads project)\n- Alias must be valid identifier (alphanumeric, hyphens, underscores)\n- Error if alias already exists (suggest --force to overwrite)\n\n### bdm unlink \u003calias\u003e\nRemove a linked project.\n\n```bash\nbdm unlink api\n```\n\n**Implementation:**\n1. Delete from bdm_linked_projects\n2. Output: \"Unlinked 'api'\"\n\n**Error:**\n- Alias doesn't exist: \"No project linked as 'api'\"\n\n### bdm projects\nList current and linked projects.\n\n```bash\nbdm projects\n```\n\n**Output:**\n```\nCURRENT:\n  /Users/me/dev/beads-messenger\n\nLINKED:\n  api       /Users/me/dev/api-service\n  frontend  /Users/me/dev/frontend\n```\n\n## Using --project Flag\nAfter linking, any command can use --project:\n\n```bash\nbdm --project api here\nbdm --project api post --as frontend.1 \"@backend.2 heads up\"\n```\n\n**Implementation in cli.ts:**\n1. Check for --project option\n2. Look up alias in bdm_linked_projects\n3. Open that project's database instead\n4. All subsequent commands operate there\n\n## Files\n- src/commands/link.ts\n- src/commands/unlink.ts\n- src/commands/projects.ts\n- src/cli.ts (--project handling)\n\n## Acceptance Criteria\n- Link stores absolute path\n- Link validates target is beads project\n- Unlink removes entry\n- Projects lists all linked projects\n- --project flag switches context correctly","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T10:10:07.749068-08:00","updated_at":"2025-12-19T22:57:34.303511-08:00","closed_at":"2025-12-04T12:37:51.237861-08:00","dependencies":[{"issue_id":"fray-1ur","depends_on_id":"fray-yh4","type":"parent-child","created_at":"2025-12-04T10:11:09.262489-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-1ur","depends_on_id":"fray-2vy","type":"blocks","created_at":"2025-12-04T10:12:00.716049-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-1ur","depends_on_id":"fray-oa5","type":"blocks","created_at":"2025-12-04T10:47:27.896529-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-1wj","title":"Create database schema and initialization","description":"Create src/db/schema.ts with SQL schema and initialization logic.\n\n## Schema SQL\n```sql\n-- Agent presence and identity\nCREATE TABLE IF NOT EXISTS bdm_agents (\n  agent_id TEXT PRIMARY KEY,           -- e.g., \"alice.419\", \"pm.3.sub.1\"\n  goal TEXT,                           -- current focus/purpose (mutable)\n  bio TEXT,                            -- static identity info (mutable)\n  registered_at INTEGER NOT NULL,      -- unix timestamp\n  last_seen INTEGER NOT NULL,          -- updated on post\n  left_at INTEGER                      -- set by \"bye\", null if active\n);\n\n-- Room messages\nCREATE TABLE IF NOT EXISTS bdm_messages (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,  -- sequential 1,2,3...\n  ts INTEGER NOT NULL,                   -- unix timestamp\n  from_agent TEXT NOT NULL,              -- full agent address\n  body TEXT NOT NULL,                    -- message content (markdown)\n  mentions TEXT NOT NULL DEFAULT '[]'    -- JSON array of mentioned addresses\n);\n\nCREATE INDEX IF NOT EXISTS idx_bdm_messages_ts ON bdm_messages(ts);\nCREATE INDEX IF NOT EXISTS idx_bdm_messages_from ON bdm_messages(from_agent);\n\n-- Linked projects for cross-project messaging\nCREATE TABLE IF NOT EXISTS bdm_linked_projects (\n  alias TEXT PRIMARY KEY,\n  path TEXT NOT NULL                     -- absolute path to .beads directory\n);\n\n-- Configuration\nCREATE TABLE IF NOT EXISTS bdm_config (\n  key TEXT PRIMARY KEY,\n  value TEXT NOT NULL\n);\n\n-- Default config\nINSERT OR IGNORE INTO bdm_config (key, value) VALUES ('stale_hours', '4');\n```\n\n## API\n```typescript\n// src/db/schema.ts\n\n/**\n * Initialize bdm schema in database.\n * Safe to call multiple times (uses IF NOT EXISTS).\n */\nexport function initSchema(db: Database): void;\n\n/**\n * Check if bdm schema exists in database.\n */\nexport function schemaExists(db: Database): boolean;\n```\n\n## Files\n- src/db/schema.ts\n\n## Acceptance Criteria\n- Schema creates all tables with correct structure\n- Indexes are created for query performance\n- Default config is inserted\n- Idempotent - safe to run multiple times\n- Unit tests verify table creation","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T09:58:49.547065-08:00","updated_at":"2025-12-19T22:57:34.308076-08:00","closed_at":"2025-12-04T12:18:02.95021-08:00","dependencies":[{"issue_id":"fray-1wj","depends_on_id":"fray-08v","type":"parent-child","created_at":"2025-12-04T10:00:44.795828-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-1wj","depends_on_id":"fray-wjm","type":"blocks","created_at":"2025-12-04T10:01:23.295563-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-20jz","title":"Chat: persist read state across sessions","description":"Currently when reopening fray chat, everything appears as unread. Should persist user's cursor/read position in the database so:\n\n- Reopening chat shows only genuinely new messages as unread\n- Read state survives across chat sessions\n- Store per-user watermark (last-read message ID) per thread/room\n\n**This is specifically for human users only** - agents don't use fray chat and have their own cursor mechanisms (ghost cursors for handoffs).\n\nHuman users are identified via db.GetActiveUsers() / the chat username config.","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-06T15:33:12.974674-08:00","created_by":"adam","updated_at":"2026-01-06T15:33:44.093695-08:00","dependencies":[{"issue_id":"fray-20jz","depends_on_id":"fray-91ix","type":"blocks","created_at":"2026-01-06T15:34:37.144033-08:00","created_by":"adam"}]}
{"id":"fray-20t","title":"Fix quickstart display and add active users","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-20T16:30:31.706757-08:00","updated_at":"2025-12-20T16:35:26.90702-08:00","closed_at":"2025-12-20T16:35:26.90702-08:00","close_reason":"Closed"}
{"id":"fray-24of","title":"Feature: make inline #-prefixed IDs copyable","description":"Convention: agents write IDs with # prefix (e.g. #fray-y590). These should be bold+underlined and double-click copies just the ID. Avoids tight coupling to beads prefix patterns.","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-01-05T20:38:35.854907-08:00","created_by":"adam","updated_at":"2026-01-06T14:27:10.962261-08:00","closed_at":"2026-01-06T14:27:10.962261-08:00","close_reason":"Implemented inline #-prefixed ID styling and click-to-copy. IDs like #fray-abc123, #msg-xyz are bold+underlined; double-click copies ID without #."}
{"id":"fray-24yf","title":"fray agent subcommands (create/start/refresh/end/list)","description":"CLI commands to manage agent configs and lifecycle.\n\n## Schema Reference (fray-7w5d)\n- Agent struct in `internal/types/types.go`: Managed, Invoke, Presence, MentionWatermark\n- InvokeConfig: Driver, Config, PromptDelivery, SpawnTimeoutMs, IdleAfterMs, MaxRuntimeMs\n- AppendAgent, AppendAgentUpdate in `internal/db/jsonl_append.go`\n\n## Commands\n- `fray agent create \u003cname\u003e --driver \u003cclaude|codex|opencode\u003e` - create managed agent config\n- `fray agent start \u003cname\u003e [--prompt '...']` - fresh session with /fly-equivalent prompt\n- `fray agent refresh \u003cname\u003e` - bye current session + start new\n- `fray agent end \u003cname\u003e` - graceful bye, clear session\n- `fray agent list` - show all with status/driver\n- `fray agent check \u003cname\u003e` - daemon-less poll (for CI/cron)\n\n## Creating Managed Agent\n```go\nagent := types.Agent{\n    Managed: true,\n    Invoke: \u0026types.InvokeConfig{\n        Driver: \"claude\",\n        PromptDelivery: types.PromptDeliveryStdin,\n        SpawnTimeoutMs: 30000,\n        IdleAfterMs: 5000,\n        MaxRuntimeMs: 600000,\n    },\n}\n```\n\n## Prompt Templates\n- Fresh-start: /fly equivalent (full onboarding)\n- Resume: minimal ('check fray, you've been @'d')\n\n## Security\nUse exec.Command directly - no shell execution. Avoids quoting/injection issues.\n\n## Exit Criteria\n- All subcommands implemented and tested\n- Prompt templates load correctly\n- exec.Command used (no shell)\n- `agent check` respects daemon lock\n\nReferences: msg-fginuidn (decisions)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-01T22:45:16.962369-08:00","created_by":"adam","updated_at":"2026-01-02T01:58:58.629812-08:00","closed_at":"2026-01-02T01:58:58.629812-08:00","close_reason":"Implemented all 6 agent CLI subcommands (create, start, refresh, end, list, check). Reviewed and greenlit by @gpt52.","dependencies":[{"issue_id":"fray-24yf","depends_on_id":"fray-7w5d","type":"blocks","created_at":"2026-01-01T22:45:24.472981-08:00","created_by":"adam"},{"issue_id":"fray-24yf","depends_on_id":"fray-y5za","type":"blocks","created_at":"2026-01-01T23:19:16.767731-08:00","created_by":"adam"}]}
{"id":"fray-2dc","title":"Implement @mentions query command","description":"Implement the @mentions shorthand for querying messages mentioning an agent.\n\n## Usage\n\n```bash\nbdm @alice                       # last 5 messages mentioning @alice*\nbdm @alice.419                   # messages mentioning exactly @alice.419*\nbdm @alice --last 20             # last 20 mentions\nbdm @alice --since 42            # mentions after ID 42\n```\n\n## Detection\nWhen the first positional argument starts with @, treat as mentions query:\n- Strip @ prefix to get agent prefix\n- Query messages where any mention matches prefix\n\n## Implementation\n\n1. Detect @-prefixed first argument in CLI\n2. Extract prefix: \"@alice\" → \"alice\"\n3. Call getMessagesWithMention(db, prefix, options)\n4. Format same as regular message display\n\n## Mention Matching (in database query)\nFor message to match \"@alice\":\n- Any mention in mentions array equals \"alice\", OR\n- Any mention starts with \"alice.\"\n- OR any mention is \"all\" (broadcasts included)\n\nSQL (using json_each):\n```sql\nSELECT DISTINCT m.* FROM bdm_messages m, json_each(m.mentions) j\nWHERE j.value = 'all' \n   OR j.value = ?  -- exact match\n   OR j.value LIKE ? || '.%'  -- prefix match\nORDER BY m.id DESC\nLIMIT ?\n```\n\n## Default Limit\n- Default: 5 messages (vs 20 for room history)\n- Rationale: mentions are more targeted, smaller default\n\n## Output\nSame format as regular messages:\n```\n[43] bob.3 (1m ago): @alice.419 got it, thanks\n[44] pm.5 (30s ago): @all standup in 5\n```\n\n## Files\n- src/commands/mentions.ts\n- src/cli.ts (detect @ prefix and route)\n\n## Acceptance Criteria\n- @agent shows messages mentioning that agent\n- Prefix matching works (@ alice matches @alice.419)\n- @all broadcasts are included\n- --last and --since options work\n- Default limit is 5","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T10:09:14.178017-08:00","updated_at":"2025-12-19T22:57:34.304388-08:00","closed_at":"2025-12-04T12:37:42.842009-08:00","dependencies":[{"issue_id":"fray-2dc","depends_on_id":"fray-yh4","type":"parent-child","created_at":"2025-12-04T10:10:53.884413-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-2dc","depends_on_id":"fray-2vy","type":"blocks","created_at":"2025-12-04T10:11:45.339104-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-2dc","depends_on_id":"fray-dgt","type":"blocks","created_at":"2025-12-04T10:46:10.370923-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-2eh","title":"Implement watch command (--watch flag)","description":"Implement tail -f style message watching.\n\n## Usage\n\n```bash\nbdm --watch                      # tail -f all messages\n```\n\n## Implementation\n\n1. Get current last message ID\n2. Display existing messages (last N or all)\n3. Enter poll loop:\n   - Sleep for interval (1 second default)\n   - Query messages with --since lastId\n   - Display new messages\n   - Update lastId\n   - Repeat until interrupted (Ctrl+C)\n\n## Poll Loop\n\n```typescript\nasync function watch(db: Database, startId: number, interval: number = 1000) {\n  let lastId = startId;\n  \n  // Handle Ctrl+C gracefully\n  process.on('SIGINT', () =\u003e {\n    console.log('\\nStopped watching.');\n    process.exit(0);\n  });\n  \n  while (true) {\n    await sleep(interval);\n    const newMessages = getMessages(db, { since: lastId });\n    \n    for (const msg of newMessages) {\n      console.log(formatMessage(msg));\n      lastId = msg.id;\n    }\n  }\n}\n```\n\n## Display Considerations\n- Print each new message as it arrives\n- No buffering - immediate output\n- Clear indication when starting (\"Watching for new messages...\")\n- Clean exit on Ctrl+C\n\n## Optional Enhancements (defer if complex)\n- `--interval \u003cms\u003e` to change poll frequency\n- Filter by @mentions while watching\n- Bell/notification on new messages\n\n## Files\n- src/commands/watch.ts\n\n## Acceptance Criteria\n- Displays new messages as they arrive\n- Polls at reasonable interval (1s default)\n- Handles Ctrl+C gracefully\n- Works correctly with concurrent posters","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T10:09:49.263646-08:00","updated_at":"2025-12-19T22:57:34.303796-08:00","closed_at":"2025-12-04T12:38:08.738646-08:00","dependencies":[{"issue_id":"fray-2eh","depends_on_id":"fray-yh4","type":"parent-child","created_at":"2025-12-04T10:11:04.132376-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-2eh","depends_on_id":"fray-l5o","type":"blocks","created_at":"2025-12-04T10:11:55.591663-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-2eh","depends_on_id":"fray-dgt","type":"blocks","created_at":"2025-12-04T10:51:09.094007-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-2eh","depends_on_id":"fray-8jo","type":"blocks","created_at":"2025-12-04T10:51:14.219672-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-2eq","title":"Adaptive GUID length based on entry count","description":"Start with 3-character GUIDs and automatically expand length as needed when collisions become likely. This makes IDs easier to type when there are few entries.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-19T21:29:21.349611-08:00","updated_at":"2025-12-21T15:54:51.482234-08:00","closed_at":"2025-12-21T15:54:51.482234-08:00","close_reason":"Implemented in Go rewrite"}
{"id":"fray-2qx","title":"Filter deleted messages from display","description":"Deleted messages show as '[deleted]' in `fray notes` and message history. Should filter them out for cleaner UX.\n\nAffected commands:\n- `fray notes --as \u003cagent\u003e`\n- `fray thread \u003cref\u003e`\n- `fray history \u003cagent\u003e`\n- Possibly `fray get` and chat view\n\nImplementation: Filter out messages where body == '[deleted]' or add a deleted flag check.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T23:17:36.807234-08:00","created_by":"adam","updated_at":"2025-12-31T23:23:10.622524-08:00","closed_at":"2025-12-31T23:23:10.622524-08:00","close_reason":"Added filterDeletedMessages helper, applied to notes, thread, history, between, meta commands"}
{"id":"fray-2r6m","title":"Chat: lazy load history with infinite scroll","description":"When scrolling back through message history, lazy load older content and allow infinite scroll rather than loading fixed chunks.","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-06T10:58:59.099314-08:00","created_by":"adam","updated_at":"2026-01-06T10:58:59.099314-08:00"}
{"id":"fray-2vy","title":"Set up CLI framework with Commander.js","description":"Enhance src/cli.ts to set up the full Commander.js program with global options.\n\n## Requirements\n\n1. Global options that apply to all commands:\n   - `--project \u003calias\u003e`: Operate in linked project context\n   - `--json`: Output in JSON format (for scripting)\n\n2. Command structure:\n   - Subcommands for each action (new, hi, bye, here, who, post, link, etc.)\n   - Default command (no subcommand): show room history\n\n3. Database initialization:\n   - Discover beads project\n   - Open database and init schema\n   - Handle --project to switch context\n\n## Implementation\n\n```typescript\n// src/cli.ts\n\nimport { Command } from 'commander';\n\nexport function main() {\n  const program = new Command();\n  \n  program\n    .name('bdm')\n    .description('Agent messaging for beads projects')\n    .version('0.1.0')\n    .option('--project \u003calias\u003e', 'operate in linked project')\n    .option('--json', 'output in JSON format');\n\n  // Add subcommands\n  program.addCommand(newCommand());\n  program.addCommand(hiCommand());\n  program.addCommand(byeCommand());\n  program.addCommand(hereCommand());\n  program.addCommand(whoCommand());\n  program.addCommand(postCommand());\n  program.addCommand(linkCommand());\n  program.addCommand(unlinkCommand());\n  program.addCommand(projectsCommand());\n  program.addCommand(configCommand());\n\n  // Default action (show messages)\n  program\n    .option('--last \u003cn\u003e', 'show last N messages', '20')\n    .option('--since \u003cid\u003e', 'show messages after ID')\n    .option('--all', 'show all messages')\n    .option('--watch', 'tail -f style')\n    .action(messagesAction);\n\n  // @mentions shorthand: bdm @alice\n  // Handled by checking if first arg starts with @\n  \n  program.parse();\n}\n```\n\n## Command Pattern\nEach command file exports a function that returns a Command:\n\n```typescript\n// src/commands/new.ts\nimport { Command } from 'commander';\n\nexport function newCommand(): Command {\n  return new Command('new')\n    .description('Create new agent session')\n    .argument('\u003cname\u003e', 'base name for agent')\n    .option('--goal \u003cgoal\u003e', 'agent goal')\n    .option('--bio \u003cbio\u003e', 'agent bio')\n    .action(async (name, options, cmd) =\u003e {\n      // Implementation\n    });\n}\n```\n\n## Files\n- src/cli.ts (update)\n- src/commands/index.ts (export all commands)\n\n## Acceptance Criteria\n- `bdm --help` shows all commands and options\n- `bdm \u003ccommand\u003e --help` shows command-specific help\n- `--project` flag works with all commands\n- Error handling wrapper catches and formats errors","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T10:08:03.90436-08:00","updated_at":"2025-12-19T22:57:34.305565-08:00","closed_at":"2025-12-04T12:37:16.904326-08:00","dependencies":[{"issue_id":"fray-2vy","depends_on_id":"fray-yh4","type":"parent-child","created_at":"2025-12-04T10:10:33.387044-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-2vy","depends_on_id":"fray-08v","type":"blocks","created_at":"2025-12-04T10:45:33.185815-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-32cw","title":"Double-click or re-click thread should drill into nested threads","description":"Clicking an already-highlighted thread with children (or double-clicking any such thread) should drill into it, same as pressing 'l'. Makes navigation more intuitive for mouse users.","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-01-06T10:58:57.671024-08:00","created_by":"adam","updated_at":"2026-01-06T11:14:56.609476-08:00","closed_at":"2026-01-06T11:14:56.609476-08:00","close_reason":"Re-clicking an already-selected thread now drills into it (if it has children). Same effect as pressing 'l' or right arrow. Handles both re-click and double-click cases."}
{"id":"fray-35o","title":"Add claims section to quickstart","description":"Add COLLISION PREVENTION section to quickstart covering:\n\n  mm claim @agent --file src/auth.ts      Claim a file\n  mm claim @agent --files \"*.ts,*.go\"     Claim multiple patterns\n  mm claim @agent --file x --ttl 2h       Claim with expiration\n  mm claims                               List all active claims\n  mm claims @agent                        List agent's claims  \n  mm clear @agent                         Clear all your claims\n  mm clear @agent --file src/auth.ts      Clear specific claim\n\nExplain: prevents other agents from accidentally working on same files. Claims auto-clear on mm bye.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-22T11:44:54.024023-08:00","updated_at":"2025-12-22T12:00:48.981401-08:00","closed_at":"2025-12-22T12:00:48.981401-08:00","close_reason":"Added COLLISION PREVENTION section to quickstart"}
{"id":"fray-373","title":"Improve agent read state tracking","description":"SUPERSEDED: See fray-vfv for new watermark-based design.\n\nOriginal requirements still apply but implementation is now via positional read_to watermarks instead of per-message receipts.\n\nKey insight: per-message receipts are semantically wrong because session identity ≠ agent identity. Watermarks track position, not individual items.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-30T16:46:47.429502-08:00","created_by":"adam","updated_at":"2025-12-31T05:54:04.804926-08:00","closed_at":"2025-12-31T05:54:04.804926-08:00","close_reason":"Implemented via watermark-based system (fray-vfv). Per-thread tracking now possible via read_to table. Session events provide handoff context.","dependencies":[{"issue_id":"fray-373","depends_on_id":"fray-vfv","type":"blocks","created_at":"2025-12-31T00:08:13.56438-08:00","created_by":"daemon"}]}
{"id":"fray-376","title":"Prepare npm package for publishing","description":"Finalize package.json and prepare for npm publishing.\n\n## Package.json Updates\n\n```json\n{\n  \"name\": \"beads-messenger\",\n  \"version\": \"0.1.0\",\n  \"description\": \"Agent messaging for beads projects\",\n  \"type\": \"module\",\n  \"main\": \"./dist/cli.js\",\n  \"types\": \"./dist/cli.d.ts\",\n  \"bin\": {\n    \"bdm\": \"./dist/bin/bdm.js\"\n  },\n  \"files\": [\n    \"dist\",\n    \"README.md\",\n    \"LICENSE\"\n  ],\n  \"scripts\": {\n    \"build\": \"tsup\",\n    \"test\": \"vitest\",\n    \"prepublishOnly\": \"npm run build \u0026\u0026 npm test\"\n  },\n  \"keywords\": [\n    \"beads\",\n    \"agent\",\n    \"messaging\",\n    \"cli\",\n    \"coordination\"\n  ],\n  \"repository\": {\n    \"type\": \"git\",\n    \"url\": \"https://github.com/user/beads-messenger\"\n  },\n  \"license\": \"MIT\",\n  \"engines\": {\n    \"node\": \"\u003e=18\"\n  }\n}\n```\n\n## Pre-publish Checklist\n\n1. **Build verification**\n   - `npm run build` succeeds\n   - `dist/` contains expected files\n   - `dist/bin/bdm.js` has correct shebang\n\n2. **Package content**\n   - `npm pack` and inspect tarball\n   - Verify only dist/, README, LICENSE included\n   - No source files or test files\n\n3. **Local install test**\n   ```bash\n   npm pack\n   npm install -g beads-messenger-0.1.0.tgz\n   bdm --version\n   bdm --help\n   ```\n\n4. **Clean install test**\n   ```bash\n   # In a fresh directory\n   npm init -y\n   npm install beads-messenger\n   npx bdm --version\n   ```\n\n## Files to Create\n\n### LICENSE\n```\nMIT License\n\nCopyright (c) 2024 [Author]\n\nPermission is hereby granted...\n```\n\n### .npmignore (if needed)\n```\nsrc/\ntests/\ntsconfig.json\ntsup.config.ts\n.github/\n```\n\n## Files\n- package.json (update)\n- LICENSE (create)\n- .npmignore (if needed)\n\n## Acceptance Criteria\n- `npm pack` produces correct package\n- Package installs globally\n- `bdm` command works after install\n- No unnecessary files in package","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T10:18:44.656474-08:00","updated_at":"2025-12-19T22:57:34.302009-08:00","closed_at":"2025-12-04T12:48:13.502479-08:00","dependencies":[{"issue_id":"fray-376","depends_on_id":"fray-po1","type":"parent-child","created_at":"2025-12-04T10:19:10.691255-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-376","depends_on_id":"fray-wkx","type":"blocks","created_at":"2025-12-04T10:19:34.928704-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-37o","title":"Design: pin vs star semantics","description":"Two distinct concepts conflated in 'pin':\n\n**Pin** = Signal importance to everyone\n- 'This is important for the channel/thread'\n- Shows in pinned section at top\n- Visibility: all agents see it\n\n**Star** = Personal subscription/bookmark  \n- 'I want to track this'\n- Shows in my threads list\n- Example: starring opus-notes to have it listed\n\nQuestions:\n- Are these separate commands? `fray pin` vs `fray star`?\n- Can you pin someone else's message? Star only your own subscriptions?\n- How does this interact with thread membership?\n- UI: pinned section vs starred sidebar\n\nNeeds design before implementing either.","status":"closed","priority":2,"issue_type":"task","assignee":"designer","created_at":"2025-12-30T16:47:02.578266-08:00","created_by":"adam","updated_at":"2025-12-31T10:36:29.879403-08:00","closed_at":"2025-12-31T10:36:29.879403-08:00","close_reason":"Design complete. Key insight: Star = Subscribe (already exists). Pin = new feature using pinned thread as playlist. No new data model - reuses existing thread/playlist primitive. All agents auto-subscribed to pinned. See designer-notes thread (thrd-3tb4tf2j) for full design."}
{"id":"fray-3943","title":"Chat: simplify thread renaming UX","description":"Current thread renaming is awkward - requires room to be selected.\n\n**Proposed UX:**\n1. When viewing a thread, `/n new-name` (or `/rename new-name`) renames the current thread directly\n2. When in sidebar with a thread selected, `\u003cctrl-n\u003e` inserts `/n ` in the input and focuses it\n\nNo need to navigate away from the thread to rename it.","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-06T15:24:47.614864-08:00","created_by":"adam","updated_at":"2026-01-06T15:24:47.614864-08:00"}
{"id":"fray-3hj","title":"Bug: @all not expanded to individual agent mentions","description":"When user posts with @all, it's stored literally as 'all' in mentions array instead of expanding to all agent names.\n\nCurrent behavior:\n  mentions: [\"all\"]\n\nExpected behavior:\n  mentions: [\"alice\", \"bob\", \"charlie\", ...]\n\nThis breaks mention history - agents don't see @all messages when checking their @mentions because their name isn't in the array.\n\nFix: when extracting mentions and 'all' is found, expand to list of all registered agent IDs.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-22T12:01:32.047673-08:00","updated_at":"2025-12-22T12:07:11.953326-08:00","closed_at":"2025-12-22T12:07:11.953326-08:00","close_reason":"Added ExpandAllMention to replace 'all' with all agent bases in mentions"}
{"id":"fray-3iq","title":"P1.7: Add time-based query flags","description":"Add time-based query flags for context-aware message retrieval.\n\nNew flags for mm get, mm history, mm between:\n- --since \u003ctime|guid\u003e: Messages after this point\n- --before \u003ctime|guid\u003e: Messages before this point\n- --from \u003ctime|guid\u003e --to \u003ctime|guid\u003e: Range query\n\nTime formats:\n- Relative: 1h, 2d, 30m, 1w\n- Absolute: yesterday, today\n- GUID: @#a1b2 or @#msg-a1b2c3d4\n\nExamples:\nmm get --since 1h\nmm history alice --since yesterday\nmm history alice --since @#a1b2\nmm get --from @#a1b2 --to @#x9y8\n\nImplementation:\n- src/core/time-query.ts (NEW): Parse time expressions\n  - parseTimeExpression(\"1h\") → Date\n  - parseTimeExpression(\"@#a1b2\") → GUID → created_at\n- Update query builders in src/db/queries.ts\n- Add WHERE created_at \u003e= ? or created_at \u003c= ?\n- Add WHERE created_at BETWEEN ? AND ?\n\nTime parsing:\n- 1h → Date(now - 1 hour)\n- 2d → Date(now - 2 days)\n- yesterday → Date(start of yesterday)\n- @#a1b2 → resolve GUID → lookup created_at\n\nReferences: PLAN.md section 9\nCritical files: src/core/time-query.ts (NEW), src/db/queries.ts, src/commands/get.ts, src/commands/history.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T13:13:41.599699-08:00","updated_at":"2025-12-19T22:57:34.297813-08:00","closed_at":"2025-12-19T15:44:29.895291-08:00","close_reason":"Added time-query parsing and --since/--before/--from/--to support","dependencies":[{"issue_id":"fray-3iq","depends_on_id":"fray-3vp","type":"blocks","created_at":"2025-12-19T13:24:50.618959-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-3oon","title":"Search command","description":"Add a search command to find messages across the channel.\n\nCommands:\n- fray search \u003cquery\u003e - search messages by content\n- Options: --by \u003cagent\u003e, --since \u003ctime\u003e, --thread \u003cref\u003e, --limit N\n\nShould search message bodies and potentially agent names. Results should show context (which thread/room, timestamp, author).","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-05T22:07:54.892682-08:00","created_by":"adam","updated_at":"2026-01-05T22:07:54.892682-08:00"}
{"id":"fray-3po","title":"Initialize npm project with ESM configuration","description":"Initialize the npm project in the current working directory with proper ESM configuration.\n\n## Assumptions\n- Working directory is ~/dev/beads-messenger/ (already exists)\n- This is a fresh project with no existing package.json\n\n## Tasks\n1. Create package.json with:\n   - name: \"beads-messenger\"\n   - type: \"module\" (ESM)\n   - version: \"0.1.0\"\n   - bin entry: { \"bdm\": \"./dist/bin/bdm.js\" }\n   - scripts: build, test, dev\n\n2. Create tsconfig.json:\n   - target: ES2022\n   - module: ESNext\n   - moduleResolution: bundler\n   - strict: true\n   - outDir: dist\n   - rootDir: . (to include both src/ and bin/)\n\n3. Create tsup.config.ts for bundling:\n   - entry: [\"src/cli.ts\", \"bin/bdm.ts\"]\n   - format: esm\n   - dts: true\n   - clean: true\n\n## Files to Create\n- package.json\n- tsconfig.json\n- tsup.config.ts\n\n## Acceptance Criteria\n- `npm install` succeeds (after dependencies added in next task)\n- TypeScript configuration is valid\n- ESM imports work correctly","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T09:56:11.150341-08:00","updated_at":"2025-12-19T22:57:34.310239-08:00","closed_at":"2025-12-04T11:45:15.32267-08:00","dependencies":[{"issue_id":"fray-3po","depends_on_id":"fray-kit","type":"parent-child","created_at":"2025-12-04T09:57:00.217269-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-3rq","title":"Chat: enable text selection and copy support","description":"Currently cannot select text in chat TUI for copy/paste. Option+drag doesn't work.\n\nOptions to investigate:\n1. Check if mouse capture is interfering with native terminal selection\n2. Implement custom text selection within the TUI\n3. Add a 'copy mode' (like tmux) that disables mouse capture temporarily\n4. Support modifier key bypass for native selection\n\nGoal: users should be able to copy message text easily.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-21T20:33:37.763771-08:00","updated_at":"2025-12-21T22:58:22.164478-08:00","closed_at":"2025-12-21T22:58:22.164478-08:00","close_reason":"Implemented"}
{"id":"fray-3vp","title":"P0.2: Implement JSONL storage layer","description":"Implement JSONL append-only storage layer as source of truth.\n\nFiles to create:\n- src/db/jsonl.ts - JSONL writers and readers\n  - appendMessage(message) → writes to messages.jsonl\n  - appendAgent(agent) → writes to agents.jsonl\n  - updateProjectConfig(config) → writes to .mm/mm-config.json\n  - readMessages() → parses messages.jsonl\n  - readAgents() → parses agents.jsonl\n  - readProjectConfig() → parses .mm/mm-config.json\n\nFormat: One JSON object per line, no trailing commas\nExample: {\"type\":\"message\",\"id\":\"msg-a1b2c3d4\",...}\n\nHook into existing commands:\n- mm post → appendMessage()\n- mm new → appendAgent() + updateProjectConfig()\n\nReferences: PLAN.md section 2, beads ~/dev/beads/.beads/issues.jsonl\nCritical files: src/db/jsonl.ts (NEW), src/commands/post.ts, src/commands/new.ts","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-19T11:57:09.159982-08:00","updated_at":"2025-12-19T22:57:34.293432-08:00","closed_at":"2025-12-19T14:11:58.59895-08:00","close_reason":"Added JSONL storage layer with append/read helpers and wired post/new","dependencies":[{"issue_id":"fray-3vp","depends_on_id":"fray-7kr","type":"blocks","created_at":"2025-12-19T11:57:45.25839-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-470u","title":"Remove unreact command (reactions are permanent)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T09:37:52.699455-08:00","created_by":"adam","updated_at":"2026-01-02T09:46:56.549337-08:00","closed_at":"2026-01-02T09:46:56.549337-08:00","close_reason":"Implemented fray react command, removed unreact (reactions are permanent)"}
{"id":"fray-4fp2","title":"Answer input: shift-enter for newlines, alt-delete for word delete","description":"In fray answer interactive mode, shift-enter doesn't work to add newlines and alt-delete doesn't work to delete words.\n\n## Root Cause\nThe answer command uses simple bufio.Reader.ReadString which doesn't support special key combinations. Chat uses Bubble Tea's textarea component which handles these.\n\n## Solution\nRefactor answer input to use Bubble Tea textarea like the chat does. This would give:\n- Shift-enter for newlines\n- Alt-delete for word delete  \n- Consistent behavior with chat input\n\n## Scope\nMedium refactor - need to convert answer command from bufio to Bubble Tea TUI.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-31T17:47:13.540206-08:00","created_by":"adam","updated_at":"2025-12-31T23:54:50.270809-08:00","closed_at":"2025-12-31T23:54:50.270809-08:00","close_reason":"Fixed in chat bug batch: filtered deleted messages, fixed thread scroll bounce, added near-top preload, refactored answer to Bubble Tea TUI"}
{"id":"fray-4i7y","title":"Allow --as flag on fray rm and archive commands","description":"Currently `fray rm msg-xxx --as opus` fails with 'unknown flag'.\n\nShould work - agents delete messages and we should log who did it for attribution/blame.\n\nCommands needing --as support:\n- `fray rm` (messages and threads)\n- `fray archive` (threads)\n\nAdd --as flag to these commands, store deleted_by/archived_by in the appropriate JSONL records.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T01:01:25.636362-08:00","created_by":"adam","updated_at":"2026-01-06T17:16:17.207508-08:00","closed_at":"2026-01-06T17:16:17.207508-08:00","close_reason":"Added --as flag to rm, archive, and restore commands"}
{"id":"fray-4kd","title":"Add mm roster command","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-20T15:57:02.382117-08:00","updated_at":"2025-12-20T15:58:57.36063-08:00","closed_at":"2025-12-20T15:58:57.36063-08:00","close_reason":"Closed"}
{"id":"fray-4mal","title":"Review old beads for relevance","description":"Review these old beads and determine if still relevant:\n\n- **fray-1dw**: Update mlld TextMate grammar for syntax highlighting\n- **fray-1b9**: Shell autocomplete for agents\n- **fray-frz**: Handling long messages in fray chat\n- **fray-lfo**: Add --range flag for message queries (labeled needs-rewrite)\n- **fray-ayw**: Replace --last suggestion with --since (labeled needs-rewrite)\n- **fray-cyq**: Add alias command\n- **fray-d9y**: Add fray summary command\n- **fray-ldl8**: Question lifecycle: blocking status, answer validation\n\n**Already closed:**\n- fray-4ry: Closed as outdated (TypeScript refs)\n\n**Action for each:**\n- Still relevant → update description to align with current Go codebase\n- Obsolete → close with reason\n- Superseded → close and link to replacement","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T13:09:05.087371-08:00","created_by":"adam","updated_at":"2026-01-06T13:10:14.537741-08:00","closed_at":"2026-01-06T13:10:14.537741-08:00","close_reason":"Review complete. Closed: fray-1dw (mlld-specific), fray-lfo (old bdm refs), fray-ayw (--since exists). Kept: fray-1b9 (autocomplete), fray-frz (long msgs), fray-cyq (alias), fray-d9y (summary), fray-ldl8 (question lifecycle)."}
{"id":"fray-4ot","title":"Go: Add migrate command","description":"Missing 'mm migrate' command to migrate from v0.1.0 to v0.2.0 format. Low priority - one-time use.","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-21T01:34:00.297243-08:00","updated_at":"2025-12-21T02:19:10.634653-08:00","closed_at":"2025-12-21T02:19:10.634653-08:00","close_reason":"Implemented migrate command"}
{"id":"fray-4ry","title":"P2.3: Tests for migration and edge cases","description":"Add tests for migration path and edge cases.\n\nTest files to create/update:\n\n1. tests/migration.test.ts (NEW)\n   - Detect old format correctly\n   - Generate GUIDs for all existing data\n   - Preserve message order\n   - Create .mm/mm-config.json\n   - Backup to .mm.bak/\n   - Handle empty database\n   - Handle corrupted old data\n\n2. tests/prune.test.ts (NEW)\n   - Guardrails: uncommitted changes\n   - Guardrails: ahead/behind remote\n   - Guardrails: no remote (offline OK)\n   - Archive to history.jsonl\n   - Keep last N messages\n   - --all flag wipes history\n   - GUID stability after prune\n\n3. tests/multi-machine.test.ts (NEW)\n   - Simulate git pull with new messages\n   - SQLite rebuild from merged JSONL\n   - Agent GUID conflicts\n   - Channel ID stability\n   - Known_agents merge scenarios\n\n4. tests/chat.test.ts (UPDATE)\n   - @#prefix parsing in input\n   - Reply-to resolution\n   - Display GUID prefixes\n   - Reply context formatting\n   - Ambiguous GUID errors\n\nEdge cases:\n- Empty database\n- Malformed JSONL\n- Missing config files\n- Offline operation\n- GUID collisions (simulate)\n- Very long message IDs\n\nCoverage goals:\n- Migration: 90%\n- Prune: 95%\n- Edge cases: 80%\n\nRun with: npm test\n\nReferences: Existing integration tests\nCritical files: tests/migration.test.ts (NEW), tests/prune.test.ts (NEW), tests/multi-machine.test.ts (NEW)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T13:31:03.458326-08:00","updated_at":"2026-01-06T12:38:38.724306-08:00","closed_at":"2026-01-06T12:38:38.724306-08:00","close_reason":"Outdated: references TypeScript tests, old mm format. Fray is now Go-based.","dependencies":[{"issue_id":"fray-4ry","depends_on_id":"fray-6qu","type":"blocks","created_at":"2025-12-19T13:31:24.086143-08:00","created_by":"daemon","metadata":"{}"},{"issue_id":"fray-4ry","depends_on_id":"fray-7mm","type":"blocks","created_at":"2025-12-19T13:31:24.176694-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-4ux","title":"P1.3: Show message IDs in chat","description":"Display GUID prefixes and reply context in chat.\n\nMessage format:\n[2m ago] @alice: \"message body\" @#a1b2\n         ↑agent  ↑content        ↑GUID prefix (first 4 chars)\n\nReply format:\n[2m ago] @alice: \"reply text\" @#x9y8\n  ↪ Reply to @bob: \"original message truncated...\"\n  ↑dimmed, indented, ~50 char preview\n\nGUID prefix display:\n- Extract first 4 chars after \"msg-\" prefix\n- Example: msg-a1b2c3d4 → @#a1b2\n- Dimmed/gray color\n- Right-aligned or end of line\n\nReply context (if reply_to exists):\n- Query original message by GUID\n- Format: \"Reply to @\u003cagent\u003e: \u003cpreview\u003e\"\n- Truncate body to ~50 chars\n- Dimmed, indented under byline\n\nImplementation:\n- src/chat/display.ts: Update message formatter\n- Add GUID prefix extraction function\n- Add reply context lookup\n- Use ANSI colors for dimming\n\nReferences: PLAN.md section 8\nCritical files: src/chat/display.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T11:57:25.942829-08:00","updated_at":"2025-12-19T22:57:34.299282-08:00","closed_at":"2025-12-19T15:16:02.489547-08:00","close_reason":"Chat display now shows GUID prefixes and reply context","dependencies":[{"issue_id":"fray-4ux","depends_on_id":"fray-3vp","type":"blocks","created_at":"2025-12-19T13:13:42.135134-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-4y76","title":"Outline mode (Ctrl-O) to expand full thread tree in sidebar","description":"When user presses Ctrl-O, toggle outline mode that shows full expanded tree with indentation.\n\n## Implementation\n\nAdd to Model struct:\n```go\noutlineMode bool // toggle with Ctrl-O\n```\n\nUpdate walk function to recurse when outlineMode is true:\n```go\nwalk = func(thread types.Thread, indent int) {\n    t := thread\n    kids, hasKids := children[thread.GUID]\n    faved := m.favedThreads[thread.GUID]\n    entries = append(entries, threadEntry{\n        Kind:        threadEntryThread,\n        Thread:      \u0026t,\n        Label:       thread.Name,\n        Indent:      indent,\n        HasChildren: hasKids \u0026\u0026 len(kids) \u003e 0,\n        Collapsed:   false,\n        Faved:       faved,\n    })\n    // Recurse in outline mode\n    if m.outlineMode \u0026\u0026 hasKids {\n        for _, child := range kids {\n            walk(child, indent+1)\n        }\n    }\n}\n```\n\nIndent rendering in threadEntryLabel (already added):\n```go\nindent := strings.Repeat(\"  \", entry.Indent) // 2 spaces per level\nlabel := leftIndicator + indent + displayName\n```\n\nAdd Ctrl-O handler in Update():\n```go\ncase \"ctrl+o\":\n    m.outlineMode = !m.outlineMode\n    if m.outlineMode {\n        m.status = \"Outline mode ON\"\n    } else {\n        m.status = \"Outline mode OFF\"\n    }\n```\n\nTest exists: TestWalkProducesCorrectIndents_OutlineMode","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-06T11:47:15.941813-08:00","created_by":"adam","updated_at":"2026-01-06T11:49:53.399066-08:00"}
{"id":"fray-50b","title":"mm get: show active claims section","description":"Add active claims display to mm get output, similar to mm @agent.\n\nAfter the room messages and mentions, show:\n---\nActive claims: @bob (src/auth.ts), @pm (docs/)\n\nSkip if no claims exist.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-22T12:37:51.644021-08:00","updated_at":"2025-12-22T12:38:56.704651-08:00","closed_at":"2025-12-22T12:38:56.704651-08:00","close_reason":"Implemented - claims shown after room + mentions in mm get"}
{"id":"fray-50na","title":"Pin threads (public) + Fave threads (personal)","description":"Pin threads (public): highlight for everyone, fray thread pin/unpin. Fave threads (personal): add to sidebar + subscribe, fray fave. Both serve discoverability - pin is public curation, fave is private collection. See THREAD-CURATION-SPEC.md Phase 2.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-01T12:23:36.924885-08:00","created_by":"adam","updated_at":"2026-01-02T02:11:44.888764-08:00","closed_at":"2026-01-02T02:11:44.888764-08:00","close_reason":"Implemented in f59e8a3","dependencies":[{"issue_id":"fray-50na","depends_on_id":"fray-gz26","type":"parent-child","created_at":"2026-01-01T12:24:28.035355-08:00","created_by":"adam"}]}
{"id":"fray-53b","title":"Suggest correct agent name when delimiter differs","description":"When agent runs 'mm new partydev' but 'party-dev' exists (or vice versa), show 'did you mean @party-dev?' and require --force to proceed. Only trigger on delimiter differences (hyphen, dot, missing delimiter). Applies to new, back, post, get, etc.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-21T09:05:34.730701-08:00","updated_at":"2025-12-21T22:58:22.165418-08:00","closed_at":"2025-12-21T22:58:22.165418-08:00","close_reason":"Implemented"}
{"id":"fray-53ee","title":"Bug: Byline missing from first message in thread view","description":"When viewing a thread, the first message's author byline (@adam) was missing. Subsequent messages showed bylines correctly.\n\nSource: msg-6beab2ny, msg-dem05tmi in 73w9-design thread","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-02T08:59:36.113203-08:00","created_by":"adam","updated_at":"2026-01-02T11:55:20.692026-08:00","closed_at":"2026-01-02T11:55:20.692026-08:00","close_reason":"Fixed: Added ANCHOR label, bylines were already working"}
{"id":"fray-59y","title":"Revisit event notification design","description":"After silencing system messages by default, revisit how to surface useful event notifications.\n\n## Context\n\nWe're silencing all system messages (issue status changes, etc.) by default because they flood the chat. But some events might be useful to agents.\n\n## Future Considerations\n\n1. **Context-aware events**: Only show events for issues mentioned in recent conversation\n2. **Event summaries**: Instead of one message per event, batch related events (e.g., \"3 issues closed\")\n3. **Agent-specific subscriptions**: Let agents subscribe to specific issues or patterns\n4. **Event digest**: Daily/hourly summary instead of real-time flood\n\n## Blocked By\n\n- bdm-ep0 (silence by default) must be implemented first\n\n## Questions\n\n- Do agents actually need to see issue events in chat?\n- Should events be in a separate channel/view?\n- What's the right granularity for event notifications?","status":"open","priority":3,"issue_type":"epic","created_at":"2025-12-09T06:12:15.797525-08:00","updated_at":"2025-12-19T22:57:34.315114-08:00","dependencies":[{"issue_id":"fray-59y","depends_on_id":"fray-ep0","type":"blocks","created_at":"2025-12-09T06:12:21.73218-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-59zj","title":"Chat: /thread and /subthread commands","description":"Add /thread (or /t) to create a global thread from chat.\nAdd /subthread (or /st) to create a subthread of the current thread.\n\nSyntax:\n  /thread name-of-thread \"anchor message\"\n  /t name-of-thread \"anchor\"\n  /subthread name-of-thread \"anchor\"\n  /st name-of-thread \"anchor\"\n\nSource: msg-0d2e0oab","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-06T13:54:50.92099-08:00","created_by":"adam","updated_at":"2026-01-06T17:05:14.485669-08:00","closed_at":"2026-01-06T17:05:14.485669-08:00","close_reason":"Implemented /thread (/t) and /subthread (/st) slash commands in chat for creating threads with optional anchor messages"}
{"id":"fray-5ar","title":"Implement bdm chat command","description":"Implement the `bdm chat` command that ties together display, input, and core logic.\n\n## New File: src/commands/chat.ts\n\n```typescript\nexport function chatCommand(): Command {\n  return new Command('chat')\n    .description('Interactive chat mode')\n    .option('--last \u003cn\u003e', 'show last N messages', '20')\n    .action((options, cmd) =\u003e {\n      // ... implementation\n    });\n}\n```\n\n## Behavior\n\n1. **Startup**\n   - Get context (db, project)\n   - Read username from config (error if not set)\n   - Show last N messages\n   - Start polling interval (1 second)\n   - Start input handling\n\n2. **Message Display**\n   - New messages from poll rendered via display\n   - User's own messages rendered immediately after send\n\n3. **User Input**\n   - On line submit: send message, render it\n   - On quit (Ctrl+C): cleanup and exit\n\n4. **Cleanup**\n   - Clear interval\n   - Destroy display/input\n   - Close database\n\n## Wire Up\n\nIn src/cli.ts:\n- Import chatCommand\n- Add to program\n- Add 'chat' to knownCommands\n\n## Error Handling\n- \"Set username first: bdm config username \u003cname\u003e\" if no username\n- \"--json not supported for interactive chat\" if --json flag\n\n## Exit Criteria\n- `bdm chat` starts interactive mode\n- Messages from other agents appear in real-time\n- User can type and send messages\n- Ctrl+C exits cleanly","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-05T15:50:35.218142-08:00","updated_at":"2025-12-19T22:57:34.313469-08:00","closed_at":"2025-12-05T15:58:47.566971-08:00"}
{"id":"fray-5eu","title":"Fix error message claiming dashes are allowed in agent names","description":"## Problem\nError message in new.ts claims dashes are allowed, but the validator rejects them:\n\n```typescript\n// src/commands/new.ts:18\nthrow new Error(\\`Invalid agent base name: \\${name}. Must be alphanumeric with dots/dashes.\\`);\n\n// src/core/agents.ts:95 - actual regex\nconst roleRegex = /^[a-z][a-z0-9]*$/;  // No dashes!\n```\n\n## Options\n1. Fix the error message to match reality: \"Must start with lowercase letter, contain only letters, numbers, and dots\"\n2. Update the regex to actually allow dashes (may have implications)\n\nOption 1 is safer - just align the message with the actual validation.\n\n## Files\n- src/commands/new.ts:18\n\n## Acceptance Criteria\n- Error message accurately describes what's allowed\n- Or dashes are actually allowed (if that's the intent)","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-04T14:03:48.863915-08:00","updated_at":"2025-12-19T22:57:34.314389-08:00","closed_at":"2025-12-04T14:31:42.209512-08:00"}
{"id":"fray-5qcm","title":"Bug: /land unclear about replacing existing handoff note","description":"From msg-ju7phate: agent saw existing good handoff in notes but didn't realize /land step 2 would replace it. Need to clarify in skill that they should UPDATE (not create fresh) if handoff already exists.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-03T22:47:36.915236-08:00","created_by":"adam","updated_at":"2026-01-03T22:56:00.758875-08:00","closed_at":"2026-01-03T22:56:00.758875-08:00","close_reason":"Updated /fly: clarified notes = assignment, mentions = context. Section renamed 'Get Your Assignment', added 'only deviate for blocking/human questions'. Also fixed /land step 2 for handoff clarity."}
{"id":"fray-5td","title":"Design: neo onboarding requirements","description":"Design session: What context do agents need when onboarding?\n\nQuestions to answer:\n- What's the right amount of context? (too little = lost, too much = overwhelmed)\n- How do we determine 'new' vs 'seen' reliably?\n- Should neo output be structured JSON for agents vs formatted for humans?\n- What's the relationship to read state tracking?\n- Should there be verbosity levels?\n\nOutput: Design doc or spec update.","status":"closed","priority":2,"issue_type":"task","assignee":"designer","created_at":"2025-12-30T16:46:05.526888-08:00","created_by":"adam","updated_at":"2025-12-31T10:34:39.006823-08:00","closed_at":"2025-12-31T10:34:39.006823-08:00","close_reason":"Design complete. Answers:\n1. Right amount of context: Verbosity levels (--brief for counts, default for full sections, --verbose for bodies)\n2. New vs seen: read_to watermarks per-home - messages after last watermark position\n3. JSON vs formatted: Both via --json flag\n4. Relationship to read state: Uses existing read_to watermarks from fray-vfv\n5. Verbosity levels: Yes - brief/default/verbose\n\nSee designer-notes thread (thrd-3tb4tf2j) for full design. Key sections: notes thread, unread room+mentions, open questions, active claims, ready work."}
{"id":"fray-5ug","title":"Add message archive and prune command","description":"Add ability to archive old messages to keep active message list manageable.\n\n## Commands\n\n**Prune current messages:**\n```bash\nbdm prune              # Archive all messages before current (max message ID)\nbdm prune --since 100  # Archive all messages before message 100\n```\n\n## Behavior\n\n- Archived messages remain in database but are excluded from default queries\n- Add `archived_at` column to `bdm_messages` table (nullable timestamp)\n- Default queries filter WHERE `archived_at IS NULL`\n- Archived messages retrievable with explicit flag: `bdm get --archived`\n\n## Schema Change\n\n```sql\nALTER TABLE bdm_messages ADD COLUMN archived_at INTEGER;\nCREATE INDEX idx_bdm_messages_archived ON bdm_messages(archived_at);\n```\n\n## Query Updates\n\nAll message queries should filter out archived messages by default:\n- getMessages(): Add WHERE archived_at IS NULL\n- getMessagesWithMention(): Add WHERE archived_at IS NULL\n- Add --archived flag to include archived messages\n\n## Implementation\n\n- src/db/schema.ts - Add migration for archived_at column\n- src/db/queries.ts - Update queries to filter archived, add archiveMessages() function\n- src/commands/prune.ts - New command to archive messages\n- src/commands/get.ts, mentions.ts, chat.ts, watch.ts - Add --archived flag","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-09T06:12:03.117969-08:00","updated_at":"2025-12-19T22:57:34.301007-08:00","closed_at":"2025-12-09T07:17:38.470164-08:00"}
{"id":"fray-632s","title":"Feature: fray mv thread reparenting","description":"Allow fray mv to reparent threads: fray mv \u003cthread\u003e \u003cnew-parent\u003e [anchor]. Also add /mv to chat.","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-01-06T13:44:52.342355-08:00","created_by":"adam","updated_at":"2026-01-06T13:48:33.691318-08:00","closed_at":"2026-01-06T13:48:33.691318-08:00","close_reason":"Implemented thread reparenting in fray mv CLI and /mv chat command. Includes cycle detection, depth checking, and optional anchor text support."}
{"id":"fray-659c","title":"Chat: expand / commands with contextual inference","description":"Add more `/` commands to chat with implicit/explicit forms.\n\n**Thread-contextual (infer current thread):**\n- `/archive` - archive current thread\n- `/restore` - restore archived thread\n- `/rename \u003cname\u003e` - rename current thread\n- `/fave`, `/f` - fave current thread (fix: remove \"thread panel only\" restriction)\n- `/unfave` - unfave current thread\n- `/pin` - pin current thread\n- `/unpin` - unpin current thread\n- `/follow` - follow current thread\n- `/unfollow` - unfollow current thread\n- `/mute` - mute current thread\n- `/unmute` - unmute current thread\n- `/thread \u003cname\u003e` - create new sub-thread\n- `/anchor \u003cmsg-id\u003e` - set anchor message\n- `/add \u003cmsg-id\u003e` - add message to thread\n- `/remove \u003cmsg-id\u003e` - remove message from thread\n- `/surface \u003cmsg-id\u003e` - surface message to room\n\n**Movement:**\n- `/mv \u003cdest-thrd\u003e \"anchor\"` - move current thread under dest\n- `/mv \u003csrc\u003e \u003cdest\u003e \"anchor\"` - explicit form\n\n**Explicit form (specify target):**\n- `/fave \u003cid\u003e`, `/unfave \u003cid\u003e`\n- `/pin \u003cid\u003e`, `/unpin \u003cid\u003e`\n- `/archive \u003cthrd\u003e`, `/restore \u003cthrd\u003e`\n\n**Keep existing:**\n- `/n` - nickname\n- `/edit`, `/delete`, `/rm` - message ops\n- `/help`, `/quit`, `/exit`\n\n**Fix:**\n- `/f` - should work anywhere as shortcut for `/fave`, not limited to thread panel\n- `/M` - deprecate in favor of `/mute` / `/unmute` (clearer)\n\n**Pattern:** Implicit where intent is clear, explicit form always available.","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-01-06T12:55:36.356922-08:00","created_by":"adam","updated_at":"2026-01-06T13:29:03.71189-08:00","closed_at":"2026-01-06T13:29:03.71189-08:00","close_reason":"Added /fave, /unfave, /follow, /unfollow, /mute, /unmute, /archive, /restore, /rename commands. All operate on current thread by default. Help text updated.","dependencies":[{"issue_id":"fray-659c","depends_on_id":"fray-nbjk","type":"blocks","created_at":"2026-01-06T12:59:08.905659-08:00","created_by":"adam"},{"issue_id":"fray-659c","depends_on_id":"fray-a5hc","type":"parent-child","created_at":"2026-01-06T13:18:45.131837-08:00","created_by":"adam"}]}
{"id":"fray-67cy","title":"UX: Right-align message IDs on speaker line","description":"Move message IDs to be right-aligned on the same line as the speaker name. Source: msg-wnxcwfjb","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-02T00:26:39.318331-08:00","created_by":"adam","updated_at":"2026-01-02T00:26:39.318331-08:00"}
{"id":"fray-6cj","title":"Define TypeScript types for database entities","description":"Create src/types.ts with TypeScript interfaces matching the database schema.\n\n## Types to Define\n\n```typescript\n// src/types.ts\n\n/**\n * Agent identity and presence.\n * Stored in bdm_agents table.\n */\nexport interface Agent {\n  agent_id: string;           // e.g., \"alice.419\", \"pm.3.sub.1\"\n  goal: string | null;        // current focus/purpose\n  bio: string | null;         // static identity info\n  registered_at: number;      // unix timestamp\n  last_seen: number;          // unix timestamp, updated on activity\n  left_at: number | null;     // unix timestamp, null if active\n}\n\n/**\n * Room message.\n * Stored in bdm_messages table.\n */\nexport interface Message {\n  id: number;                 // sequential ID (1, 2, 3...)\n  ts: number;                 // unix timestamp\n  from_agent: string;         // sender's full agent ID\n  body: string;               // message content (markdown)\n  mentions: string[];         // parsed from JSON, @mentioned agents\n}\n\n/**\n * Raw message row from database.\n * mentions stored as JSON string.\n */\nexport interface MessageRow {\n  id: number;\n  ts: number;\n  from_agent: string;\n  body: string;\n  mentions: string;           // JSON array as string\n}\n\n/**\n * Linked project for cross-project messaging.\n * Stored in bdm_linked_projects table.\n */\nexport interface LinkedProject {\n  alias: string;              // short name for --project flag\n  path: string;               // absolute path to project root\n}\n\n/**\n * Configuration setting.\n * Stored in bdm_config table.\n */\nexport interface ConfigEntry {\n  key: string;\n  value: string;\n}\n\n/**\n * Parsed agent ID components.\n */\nexport interface ParsedAgentId {\n  base: string;               // e.g., \"alice\", \"pm.3.sub\"\n  version: number;            // e.g., 419, 1\n  full: string;               // original full ID\n}\n\n/**\n * Query options for message retrieval.\n */\nexport interface MessageQueryOptions {\n  limit?: number;             // max messages to return\n  since?: number;             // message ID to start after\n  before?: number;            // message ID to end before\n}\n```\n\n## Files\n- src/types.ts\n\n## Acceptance Criteria\n- All types match database schema exactly\n- Types are exported for use across codebase\n- JSDoc comments explain each field\n- MessageRow vs Message distinction is clear (raw vs parsed)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T09:59:13.618061-08:00","updated_at":"2025-12-19T22:57:34.307766-08:00","closed_at":"2025-12-04T12:15:16.692417-08:00","dependencies":[{"issue_id":"fray-6cj","depends_on_id":"fray-08v","type":"parent-child","created_at":"2025-12-04T10:00:49.921399-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-6cj","depends_on_id":"fray-bml","type":"blocks","created_at":"2025-12-04T10:59:37.575951-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-6fh","title":"Create chat display/input abstractions","description":"Create abstraction interfaces for chat display and input, with simple ANSI/readline implementations.\n\n## New Files\n\n### src/chat/types.ts\n```typescript\nexport interface FormattedMessage {\n  id: number;\n  projectName: string;\n  type: 'user' | 'agent';\n  sender: string;\n  body: string;\n}\n\nexport interface ChatDisplay {\n  renderMessage(msg: FormattedMessage): void;\n  showStatus(text: string): void;\n  destroy(): void;\n}\n\nexport interface ChatInput {\n  start(): void;\n  onMessage(callback: (text: string) =\u003e void): void;\n  onQuit(callback: () =\u003e void): void;\n  destroy(): void;\n}\n```\n\n### src/chat/display.ts\n- ANSI color implementation\n- Format: `[#projectname LN] type @name: body`\n- Green for users, blue for agents, cyan for @mentions\n- Respect NO_COLOR environment variable\n\n### src/chat/input.ts\n- Use `readline.createInterface`\n- Handle line events for message submission\n- Handle close/SIGINT for quit\n\n## Design Notes\n- Interfaces allow swapping implementations later (e.g., to ink or blessed)\n- Keep implementations minimal for v1\n\n## Exit Criteria\n- Interfaces defined in types.ts\n- Display prints colored messages to stdout\n- Input captures lines and signals quit on Ctrl+C","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-05T15:50:09.859942-08:00","updated_at":"2025-12-19T22:57:34.313836-08:00","closed_at":"2025-12-05T15:55:52.125625-08:00"}
{"id":"fray-6fx","title":"P5: Autocomplete (P1 feature)","description":"Add autocomplete for # (message refs) and @ (mentions). Popup with suggestions, Tab/Enter to accept, Esc to dismiss. Filter as user types. ~6 hours.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T12:17:37.072669-08:00","updated_at":"2025-12-21T01:27:06.005814-08:00","closed_at":"2025-12-21T01:27:06.005814-08:00","close_reason":"Completed in Go rewrite","dependencies":[{"issue_id":"fray-6fx","depends_on_id":"fray-m6c","type":"blocks","created_at":"2025-12-20T12:22:26.237644-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-6go","title":"Assign chat colors by recency, not hash","description":"In bdm chat mode, assign colors to agents based on conversation recency rather than hash-based assignment.\n\n## Problem\n\nCurrently colors are assigned by hashing the agent base name modulo 6 color sets. With only 6 colors, hash collisions are common - two active agents might get the same color even though there are unused colors available.\n\n## Desired Behavior\n\nWhen entering chat mode, assign colors to agents based on who has posted recently:\n\n1. Get list of agents who have posted in recent history (e.g., last 50 messages)\n2. Sort by most recent activity\n3. Assign colors sequentially: first agent gets color 0, second gets color 1, etc.\n4. This guarantees the first 6 active agents get unique colors\n5. Less active/older agents might share colors, but they're not in the active conversation\n\n## Implementation\n\n**Approach**: Build a color map at chat session start based on recent messages\n\n```typescript\n// In chat session initialization\nfunction buildColorMap(db: Database, lookbackLimit: number = 50): Map\u003cstring, number\u003e {\n  const messages = getMessages(db, { limit: lookbackLimit });\n  const agentBases = new Map\u003cstring, number\u003e(); // base -\u003e last seen timestamp\n  \n  for (const msg of messages) {\n    if (msg.type === 'agent') {\n      const base = parseAgentId(msg.from_agent).base;\n      const ts = msg.ts;\n      if (!agentBases.has(base) || agentBases.get(base)! \u003c ts) {\n        agentBases.set(base, ts);\n      }\n    }\n  }\n  \n  // Sort by most recent\n  const sorted = Array.from(agentBases.entries())\n    .sort((a, b) =\u003e b[1] - a[1]);\n  \n  // Assign colors sequentially\n  const colorMap = new Map\u003cstring, number\u003e();\n  sorted.forEach(([base, _], idx) =\u003e {\n    colorMap.set(base, idx % COLOR_PAIRS.length);\n  });\n  \n  return colorMap;\n}\n```\n\n## Files to Modify\n\n- `src/chat/display.ts` - Accept colorMap in constructor, use it in getAgentColor calls\n- `src/commands/chat.ts` - Build colorMap on session start, pass to display\n- `src/commands/format.ts` - Add `getAgentColorWithMap()` variant that takes optional colorMap\n\n## Fallback\n\nFor agents not in the recent history, fall back to hash-based assignment so they still get a color.\n\n## Benefits\n\n- Active conversation participants are guaranteed visually distinct\n- No more confusing collisions between agents who are talking\n- Still works for new agents who join mid-session (hash fallback)\n- Improves readability during active multi-agent conversations","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-07T17:11:41.405464-08:00","updated_at":"2025-12-19T22:57:34.313057-08:00","closed_at":"2025-12-07T17:18:35.828317-08:00"}
{"id":"fray-6qkl","title":"Split db/queries.go by entity domain","description":"## Overview\ndb/queries.go is 2432 lines with 102 functions. Split by entity domain.\n\n## Target Files\n1. **queries_agents.go** (19 functions)\n   - GetAgent, GetAgentsByPrefix, GetAgents, GetAllAgents\n   - CreateAgent, UpdateAgent, GetActiveAgents, IsAgentActive\n   - GetActiveUsers, GetAgentBases, RenameAgent, MergeAgentHistory\n   - GetMaxVersion, NextVersion, plus helpers\n\n2. **queries_messages.go** (22 functions)\n   - CreateMessage, GetMessages, GetMessageByPrefix, GetMessage\n   - GetMessagesWithMention, GetLastMessageCursor\n   - GetReplyChain, GetReplyCount, EditMessage, DeleteMessage\n   - AddReaction, RemoveReactions, GetMessageReactions\n   - ArchiveMessages, scanMessage, scanMessages\n\n3. **queries_threads.go** (11 functions)\n   - CreateThread, UpdateThread, GetThread, GetThreadByPrefix\n   - GetThreadByName, GetThreads, SubscribeThread, UnsubscribeThread\n   - AddMessageToThread, RemoveMessageFromThread, GetThreadMessages\n\n4. **queries_questions.go** (7 functions)\n   - CreateQuestion, UpdateQuestion, GetQuestion, GetQuestionByPrefix\n   - GetQuestionsByRe, GetQuestions, scanQuestion, scanQuestions\n\n5. **queries_claims.go** (11 functions)\n   - CreateClaim, DeleteClaim, DeleteClaimsByAgent\n   - GetClaim, GetClaimsByAgent, GetClaimsByType, GetAllClaims\n   - FindConflictingFileClaims, CheckFileConflict\n   - UpdateClaimsAgentID, GetClaimCountsByAgent, PruneExpiredClaims\n\n6. **queries_config.go** (config + filters + read tracking)\n   - GetConfig, SetConfig, GetAllConfig\n   - GetFilter, SetFilter, ClearFilter\n   - MarkMessagesRead, GetReadReceipts, GetReadReceiptCount\n   - SetReadTo, GetReadTo, GetReadToForHome, GetReadToByMessage\n   - GetLinkedProject, GetLinkedProjects, LinkProject, UnlinkProject\n\n## Approach\nSame as chat decomposition: extract one file at a time, go build \u0026\u0026 go test after each.\n\n## Risk\nLow - these are standalone functions with no internal dependencies between domains.","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-31T23:53:30.914189-08:00","created_by":"adam","updated_at":"2026-01-01T06:17:09.657742-08:00","closed_at":"2026-01-01T06:17:09.657742-08:00","close_reason":"Split queries.go (2432 lines) into 6 domain files: agents (534), messages (742), threads (311), questions (260), claims (279), config (280). Remaining queries.go is 81 lines of shared helpers. 97% reduction."}
{"id":"fray-6qu","title":"P0.7: Migration from current format","description":"Implement mm migrate command to convert v0.1.0 to v0.2.0 GUID format.\n\nMigration steps:\n1. Check if .mm/ exists and is old format (no .mm/mm-config.json)\n2. Backup: cp -r .mm/ .mm.bak/\n3. Generate GUIDs for all existing messages and agents\n4. Create .mm/mm-config.json with channel_id\n5. Create messages.jsonl from SQLite messages\n6. Create agents.jsonl from SQLite agents\n7. Rebuild SQLite with new schema\n8. Success message: \"Migration complete. Backup at .mm.bak/\"\n\nOld schema detection:\n- Check for absence of .mm/mm-config.json\n- Check for presence of .mm/mm.db\n\nGUID generation:\n- Messages: msg-\u003c8chars\u003e (preserve order by created_at)\n- Agents: usr-\u003c8chars\u003e\n- Channel: ch-\u003c8chars\u003e (single channel, prompt for name)\n\nReferences: PLAN.md section Migration Path\nCritical files: src/commands/migrate.ts, src/db/schema.ts, src/db/jsonl.ts","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-19T11:57:10.559979-08:00","updated_at":"2025-12-19T22:57:34.291761-08:00","closed_at":"2025-12-19T14:46:30.189121-08:00","close_reason":"Implemented v0.1.0 -\u003e v0.2.0 migration with JSONL + config + backup","dependencies":[{"issue_id":"fray-6qu","depends_on_id":"fray-qqv","type":"blocks","created_at":"2025-12-19T13:23:41.923855-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-6rjt","title":"Fix rebuild FK constraint error (code 787)","description":"fray rebuild fails with FOREIGN KEY constraint error. Threads exist in JSONL but won't load to SQLite. Likely caused by avatar column changes in jsonl_rebuild.go lines 249-295. Blocks all development.","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-06T09:37:39.478193-08:00","created_by":"adam","updated_at":"2026-01-06T10:40:45.397519-08:00","closed_at":"2026-01-06T10:40:45.397519-08:00","close_reason":"Fixed via topological sort of threads before insert. Commit 2ed5ed5."}
{"id":"fray-6u7","title":"Implement agent ID utilities","description":"Create src/core/agents.ts with agent ID parsing and formatting utilities.\n\n## Agent ID Format\nFormat: `\u003crole\u003e[.\u003cqualifier\u003e]*.\u003csession_number\u003e`\n\nExamples:\n- `alice.1` - first alice session\n- `alice.frontend.3` - third alice.frontend session  \n- `pm.5.sub.2` - second subagent of pm session 5\n\nRules:\n- Last segment is always numeric (version/session number)\n- Base is everything before the last dot\n- Role names are lowercase alphanumeric (no leading digits)\n\n## Functions to Implement\n\n```typescript\n// src/core/agents.ts\n\nimport type { ParsedAgentId } from '../types.js';\n\n/**\n * Parse an agent ID into components.\n * @throws if ID is invalid\n * @example parseAgentId(\"alice.419\") -\u003e { base: \"alice\", version: 419, full: \"alice.419\" }\n * @example parseAgentId(\"pm.3.sub.2\") -\u003e { base: \"pm.3.sub\", version: 2, full: \"pm.3.sub.2\" }\n */\nexport function parseAgentId(id: string): ParsedAgentId;\n\n/**\n * Format base and version into agent ID.\n * @example formatAgentId(\"alice\", 419) -\u003e \"alice.419\"\n */\nexport function formatAgentId(base: string, version: number): string;\n\n/**\n * Validate agent ID format.\n * @returns true if valid, false otherwise\n */\nexport function isValidAgentId(id: string): boolean;\n\n/**\n * Validate base name format (role or role.qualifier).\n * @returns true if valid base name\n */\nexport function isValidBaseName(base: string): boolean;\n\n/**\n * Normalize agent reference (strip leading @).\n * @example normalizeAgentRef(\"@alice.1\") -\u003e \"alice.1\"\n * @example normalizeAgentRef(\"alice.1\") -\u003e \"alice.1\"\n */\nexport function normalizeAgentRef(ref: string): string;\n\n/**\n * Check if an agent ID matches a prefix.\n * Used for @mention resolution.\n * @example matchesPrefix(\"alice.419\", \"alice\") -\u003e true\n * @example matchesPrefix(\"alice.frontend.3\", \"alice\") -\u003e true\n * @example matchesPrefix(\"bob.1\", \"alice\") -\u003e false\n */\nexport function matchesPrefix(agentId: string, prefix: string): boolean;\n```\n\n## Validation Rules\n- Base: lowercase letters, numbers, dots (no leading digit in any segment)\n- Version: positive integer\n- Full ID: base + \".\" + version\n- No empty segments (e.g., \"alice..1\" invalid)\n\n## Files\n- src/core/agents.ts\n\n## Acceptance Criteria\n- Parsing extracts base and version correctly\n- Validation catches all invalid formats\n- Prefix matching works for all cases\n- Comprehensive unit tests","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T10:04:12.3668-08:00","updated_at":"2025-12-19T22:57:34.306513-08:00","closed_at":"2025-12-04T12:28:33.319465-08:00","dependencies":[{"issue_id":"fray-6u7","depends_on_id":"fray-dk4","type":"parent-child","created_at":"2025-12-04T10:06:59.559273-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-6u7","depends_on_id":"fray-bml","type":"blocks","created_at":"2025-12-04T10:59:58.687976-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-70y1","title":"Show avatars in fray get CLI output","description":"Currently avatars only show in fray chat bylines. They should also appear in fray get output next to agent names.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-06T10:35:27.55371-08:00","created_by":"adam","updated_at":"2026-01-06T10:35:27.55371-08:00"}
{"id":"fray-72r","title":"Fix @mention shorthand bypassing Commander parsing","description":"## Problem\nThe @mention shorthand (`bdm @alice`) bypasses Commander entirely (src/cli.ts:39-48).\n\n```typescript\nconst args = process.argv.slice(2);\nif (args.length \u003e 0 \u0026\u0026 args[0].startsWith('@')) {\n  mentionsAction(args[0], {...}, program);\n  return;  // Skips program.parse()!\n}\n```\n\nThis means:\n- `--project` flag is ignored → queries wrong database\n- `--json` flag is ignored → loses JSON output\n- No Commander validation happens\n\n## Example\n`bdm @alice --project api` silently queries the local project instead of the linked `api` project.\n\n## Fix Options\n1. Route mentions through a real Commander command (e.g., `bdm mentions @alice`)\n2. Parse global options before dispatching to mentionsAction\n3. Remove the shorthand entirely (breaking change)\n\nOption 2 is likely best: manually parse --project and --json from args before calling mentionsAction.\n\n## Files\n- src/cli.ts:39-48\n\n## Acceptance Criteria\n- `bdm @alice --project api` queries the api project\n- `bdm @alice --json` outputs JSON\n- Existing `bdm @alice` behavior preserved","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-04T14:03:26.586925-08:00","updated_at":"2025-12-19T22:57:34.295466-08:00","closed_at":"2025-12-04T14:10:13.120412-08:00"}
{"id":"fray-73w9","title":"Design: Daemon timeout via fray checkin instead of max runtime","description":"Replace hard max_runtime (10m default) with activity-based done-detection.\n\n## Problem Statement\n\nClaude Code agents run until they stop acting. Once stopped, they're zombie processes - alive but dormant. **Resume is the only way to inject new prompts.** The daemon needs to detect 'probably done' so it can kill/resume with pending @mentions.\n\nThe current 10m `max_runtime` kills *active* agents mid-work.\n\n## Approved Design (fray-73w9)\n\n| Signal | Default | Purpose | Action |\n|--------|---------|---------|--------|\n| `idle_after` | 5s | Presence indicator | Update presence to 'idle' |\n| `min_checkin` | 10m | Done-detection | If idle AND no fray posts → kill, resumable on next @mention |\n| `max_runtime` | 2h | Zombie safety net | Force kill |\n\n## Key Behaviors\n\n1. Any fray activity (posts, replies, threads) resets checkin timer\n2. Natural communication = checkin (no forced heartbeats)\n3. Silence + idle = probably done → recycle session\n4. Graceful recycle: session killed but agent can resume on next @mention\n\n## Agent Awareness\n\nPrompt text for spawn/watch:\n\u003e \"Posting to fray resets a 10m timer. Silence = session recycled (resumable on @mention).\"\n\n## Exit Criteria\n\n- [ ] `min_checkin` config added to InvokeConfig\n- [ ] Daemon checks fray activity (via messages.jsonl or DB query)\n- [ ] Done-detection logic: idle + no posts for min_checkin → kill\n- [ ] max_runtime default changed to 2h\n- [ ] Spawn prompt updated with checkin explanation\n- [ ] `fray watch --with-checkin-timer` (optional, can defer)\n\n## Approvals\n\n- @opus: 👍\n- @designer: 👍\n- @architect: 👍\n\n## Source\n\nDesign thread: thrd-7xyvibhj (73w9-design)","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-02T08:39:51.538482-08:00","created_by":"adam","updated_at":"2026-01-02T10:22:26.531352-08:00","closed_at":"2026-01-02T10:22:26.531352-08:00","close_reason":"Implemented done-detection via checkin: min_checkin=10m (idle + no fray activity = kill), max_runtime=0 (unlimited), added fray heartbeat for silent checkins"}
{"id":"fray-7dh1","title":"Sidebar: only show open and stale questions, not closed/wondering counts","description":"The sidebar questions section should only show open-qs and stale-qs lists. Remove closed-qs and wondering from the sidebar display.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T17:54:04.585866-08:00","created_by":"adam","updated_at":"2025-12-31T23:24:16.742753-08:00","closed_at":"2025-12-31T23:24:16.742753-08:00","close_reason":"Removed closed-qs and wondering from sidebar, keeping only actionable open-qs and stale-qs"}
{"id":"fray-7ej","title":"Implement presence commands (here, who)","description":"Create presence commands for viewing active agents.\n\n## Commands\n\n### bdm here\nList active agents (filters out stale and left agents).\n\n```bash\nbdm here                         # active agents only\nbdm here --all                   # include stale\n```\n\n**Output format:**\n```\nalice.419    (2m ago)   \"implementing snake algorithm\"\npm.5         (30s ago)  \"overseeing sprint\"\nbob.3        (5m ago)   \"reviewing auth PR\"\n```\n\n**Implementation:**\n1. Get stale_hours from config (default: 4)\n2. Query getActiveAgents(db, staleHours) or getAllAgents(db) with --all\n3. Filter: left_at IS NULL (unless --all)\n4. Sort by last_seen (most recent first)\n5. Format output with relative time and goal\n\n**JSON output (--json):**\n```json\n[\n  {\"agent_id\": \"alice.419\", \"last_seen\": 1234567890, \"goal\": \"...\"}\n]\n```\n\n### bdm who \u003cagent\u003e\nShow detailed info for agent(s) matching prefix.\n\n```bash\nbdm who alice                    # all alice.* agents\nbdm who alice.419                # specific agent\nbdm who here                     # all active with details\n```\n\n**Output format:**\n```\nalice.419\n  Goal: implementing snake algorithm\n  Bio:  claude-opus, patient problem solver\n  Registered: 2h ago\n  Last seen: 12m ago\n  Status: active\n```\n\n**Implementation:**\n1. If \"here\", get active agents\n2. Otherwise, getAgentsByPrefix(db, prefix)\n3. Format each agent with full details\n4. Status: \"active\", \"stale\", or \"left\"\n\n## Files\n- src/commands/here.ts\n- src/commands/who.ts\n\n## Acceptance Criteria\n- here shows only active agents by default\n- here --all includes stale agents\n- who shows detailed agent info\n- Prefix matching works correctly\n- JSON output is valid and complete","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T10:08:39.507705-08:00","updated_at":"2025-12-19T22:57:34.304971-08:00","closed_at":"2025-12-04T12:37:33.466876-08:00","dependencies":[{"issue_id":"fray-7ej","depends_on_id":"fray-yh4","type":"parent-child","created_at":"2025-12-04T10:10:43.626764-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-7ej","depends_on_id":"fray-2vy","type":"blocks","created_at":"2025-12-04T10:11:35.094797-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-7ej","depends_on_id":"fray-xpd","type":"blocks","created_at":"2025-12-04T10:46:35.05383-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-7ej","depends_on_id":"fray-8jo","type":"blocks","created_at":"2025-12-04T10:46:43.903041-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-7ej","depends_on_id":"fray-6u7","type":"blocks","created_at":"2025-12-04T10:58:40.252551-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-7jy7","title":"Add daemon logging/observability","description":"Consider adding structured logging to daemon for production observability. Currently daemon is silent - may want to log spawns, kills, errors, etc.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-02T11:40:41.982692-08:00","created_by":"adam","updated_at":"2026-01-02T11:40:41.982692-08:00"}
{"id":"fray-7kr","title":"P0.1: Add GUID columns to schema","description":"Add guid TEXT PRIMARY KEY to mm_messages and mm_agents tables. Generate short GUIDs using 8-char base58 encoding. Remove any existing short_id or display_id columns (GUID-only architecture).\n\nImplementation:\n- Update src/db/schema.ts to add guid column\n- Add GUID generation function (base58, 8 chars)\n- Create migration to populate GUIDs for existing rows\n- Drop short_id/display_id columns if they exist\n\nReferences: PLAN.md sections 1, 2\nCritical file: src/db/schema.ts","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-19T11:57:08.832023-08:00","updated_at":"2025-12-19T22:57:34.293779-08:00","closed_at":"2025-12-19T14:06:01.62647-08:00","close_reason":"Added GUID columns with migration, GUID generator, updated queries/commands/tests"}
{"id":"fray-7ks8","title":"Extract chat/input.go from model.go","description":"Extract text input handling: insertInputText(), inputCursorPos(), updateInputStyle(), dismissHelpOnInput(), prefillReply(), normalizeNewlines(), reactionInputText(). ~120 lines.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-01T00:07:01.602772-08:00","created_by":"adam","updated_at":"2026-01-01T00:15:11.275214-08:00","closed_at":"2026-01-01T00:15:11.275214-08:00","close_reason":"Extracted input.go (130 lines). model.go 2749→2630.","dependencies":[{"issue_id":"fray-7ks8","depends_on_id":"fray-v2dj","type":"blocks","created_at":"2026-01-01T00:07:10.15701-08:00","created_by":"adam"}]}
{"id":"fray-7mm","title":"P1.5: mm prune with cold storage","description":"Implement mm prune with guardrails and cold storage.\n\nPrune flow:\n1. Check uncommitted changes: git status --porcelain .mm/\n   - If dirty: Error \"Uncommitted changes in .mm/. Commit first.\"\n2. Check remote sync (if remote exists):\n   - git rev-list --count @{u}..HEAD (ahead)\n   - git rev-list --count HEAD..@{u} (behind)\n   - If ahead/behind: Error \"Branch not synced. Push/pull first.\"\n   - If no remote: Skip this check (offline OK)\n3. Archive messages:\n   - Append all messages.jsonl → history.jsonl\n   - Keep last N messages in messages.jsonl (default 100)\n4. Rebuild SQLite from messages.jsonl\n5. Success: \"Pruned to last N messages. Archived to history.jsonl\"\n\nFlags:\n- mm prune (default: keep 100)\n- mm prune --keep 50\n- mm prune --all (delete history.jsonl)\n\nNo counter reset needed (GUID-only architecture).\n\nImplementation:\n- src/commands/prune.ts: Update with guardrails\n- Check git status and remote sync\n- Append to history.jsonl\n- Rewrite messages.jsonl with last N\n\nReferences: PLAN.md section 7\nCritical files: src/commands/prune.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T11:57:26.505276-08:00","updated_at":"2025-12-19T22:57:34.298656-08:00","closed_at":"2025-12-19T15:37:49.452967-08:00","close_reason":"Added prune guardrails and cold storage history handling","dependencies":[{"issue_id":"fray-7mm","depends_on_id":"fray-3vp","type":"blocks","created_at":"2025-12-19T11:57:46.294418-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-7nst","title":"CLI: --by filter should work for room queries, not just threads","description":"Currently `--by` flag only filters when viewing a thread:\n\n```bash\n# Works:\nfray get some-thread --by adam\n\n# Doesn't filter (should work):\nfray get --by adam --last 20\n```\n\nThe filter is only applied in getThread(), not in the room query path (internal/command/get.go:532).","status":"open","priority":2,"issue_type":"bug","created_at":"2026-01-06T15:24:40.153199-08:00","created_by":"adam","updated_at":"2026-01-06T15:24:40.153199-08:00"}
{"id":"fray-7o25","title":"Chat: requires hitting enter twice to send message","status":"closed","priority":2,"issue_type":"bug","assignee":"opus","created_at":"2026-01-01T07:51:16.706251-08:00","created_by":"adam","updated_at":"2026-01-02T08:30:58.472453-08:00","closed_at":"2026-01-02T08:30:58.472453-08:00","close_reason":"Fixed: history now works for users, mentions include threads, double-enter bug fixed by not consuming Enter after suggestion apply"}
{"id":"fray-7rs","title":"Go Rewrite with Charm TUI","description":"Rewrite mm from TypeScript to Go using Charm ecosystem (Bubbletea, Bubbles, Lip Gloss). Adds rich multi-channel TUI with sidebar, autocomplete, syntax highlighting. Single binary distribution.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-20T12:13:52.168625-08:00","updated_at":"2025-12-21T15:57:42.34642-08:00","closed_at":"2025-12-21T15:57:42.34642-08:00","close_reason":"Go rewrite complete - all phases implemented","dependencies":[{"issue_id":"fray-7rs","depends_on_id":"fray-dkh","type":"blocks","created_at":"2025-12-20T12:27:39.994271-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-7rsr","title":"Thread listing filters: --subscribed, --pinned, --activity, --tree, --muted, --mine","description":"Thread listing filters: --following, --pinned, --activity, --tree, --muted, --mine\n\nNow that fray-w6xh landed, command structure is:\n- fray threads --following (was --subscribed, aligns with 'fray follow')\n- fray threads --pinned\n- fray threads --activity (sort by last_activity_at)\n- fray threads --tree (nested display with indicators)\n- fray threads --muted\n- fray threads --mine (threads I created)\n- fray threads --all (includes muted)\n- Default excludes muted\n\n**One-liner default** (from cbcs-design):\n- Thread listing should show compact format by default\n- Use 'fray get \u003cpath\u003e' for full content\n\n**Accordion view**:\n- '--accordion x,y,z': x first posts full, y char limit for middle, z last posts full\n- 2-arg shorthand: '--accordion x,z' = first x, last z full\n- Default: '--accordion 1,1' (oldest + newest full, one-liners between)","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-01T12:24:04.795655-08:00","created_by":"adam","updated_at":"2026-01-05T02:54:56.849439-08:00","closed_at":"2026-01-05T02:54:56.849439-08:00","close_reason":"Added --following, --activity flags. --tree is separate issue (fray-ao2f). --mine deferred (requires created_by schema migration).","dependencies":[{"issue_id":"fray-7rsr","depends_on_id":"fray-gz26","type":"parent-child","created_at":"2026-01-01T12:24:28.200815-08:00","created_by":"adam"}]}
{"id":"fray-7w5d","title":"Extend agents.jsonl schema for managed agents","description":"Extend agents.jsonl schema for managed agents.\n\n## Agent Record Extensions\n- `managed: bool` - whether daemon controls this agent\n- `invoke.driver`: string (claude, codex, opencode)\n- `invoke.config`: driver-specific nested config\n- `invoke.prompt_delivery`: 'args' | 'stdin' | 'tempfile'\n\n## Timeout Configs (in invoke.config)\n- `spawn_timeout_ms`: max time in 'spawning' before 'error' (default: 30000)\n- `idle_after_ms`: time since activity before 'idle' (default: 5000)\n- `max_runtime_ms`: forced termination timeout (default: 600000)\n\n## New Event Types\n- `session_start`: agent_id, session_id, triggered_by (msg_id), thread_guid\n- `session_end`: agent_id, session_id, exit_code, duration_ms\n- `session_heartbeat`: agent_id, session_id, status\n\n## Presence States\nTrack: active, spawning, idle, error, offline\n\n## Migration\nAdd defaults for old agent records (managed: false)\n\nReferences: msg-fginuidn (decisions), msg-j8axywm5 (gpt52 timeouts)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-01T22:45:16.834816-08:00","created_by":"adam","updated_at":"2026-01-01T23:54:59.281124-08:00","closed_at":"2026-01-01T23:54:59.281124-08:00","close_reason":"Implemented schema extensions for managed agents. Commits: ecc2e59 (feat), e1ad3b0 (docs). Reviewed by @gpt52."}
{"id":"fray-7ze","title":"Chat: expand input area for wrapped text up to 8 lines","description":"When entering text that wraps to multiple lines, the input area should expand vertically to show all content up to 8 lines. After 8 lines, scroll internally instead of continuing to expand.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-21T16:01:15.124243-08:00","updated_at":"2025-12-21T17:04:12.155777-08:00","closed_at":"2025-12-21T17:04:12.155777-08:00","close_reason":"Implemented"}
{"id":"fray-80bc","title":"UX: Shift-tab sidebar persistence","description":"Shift-tab keeps current sidebar view open. In this mode, shift-tab changes sidebar views, tab changes focus between textarea and sidebar. Source: msg-4ruvs8be","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-02T00:26:39.474214-08:00","created_by":"adam","updated_at":"2026-01-02T00:26:39.474214-08:00"}
{"id":"fray-822","title":"Autocomplete: show agent with nicks when partial match","description":"When typing @devrel and the agent is mlld-devrel with nick 'devrel', autocomplete should show:\n\n  mlld-devrel (aka devrel)\n\nOr show matching nicks alongside the primary name so user knows they resolve to the same agent.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-21T12:35:12.192538-08:00","updated_at":"2025-12-21T22:58:22.165743-08:00","closed_at":"2025-12-21T22:58:22.165743-08:00","close_reason":"Implemented"}
{"id":"fray-87l","title":"Bug: Tab opens sidebar when autocomplete is active","description":"When user has triggered autocomplete state (typing @ or #), pressing Tab should complete the selection, not open the channel sidebar. Temporarily suppress sidebar toggle when autocomplete popup is visible.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-22T12:09:10.23655-08:00","updated_at":"2025-12-22T12:12:19.567131-08:00","closed_at":"2025-12-22T12:12:19.567131-08:00","close_reason":"Fixed by agents"}
{"id":"fray-883d","title":"CLI: Rich metadata footer when viewing messages","description":"When running `fray \u003cid\u003e` or `fray get \u003cid\u003e`, show a summary of related metadata:\n- Tree of chained replies with one-liners\n- What this message is a reply to (if any)\n- Thread where message is homed\n- Other threads where message is mentioned or shared\n- Commands for exploring each relationship\n\nFrom: #msg-qt8qkhv5","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-06T15:20:42.78922-08:00","created_by":"adam","updated_at":"2026-01-06T15:20:42.78922-08:00"}
{"id":"fray-8dpw","title":"Extract hook commands to separate package","description":"## Overview\nMove hook commands from internal/command/ to internal/command/hooks/ subdirectory.\n\n## Files to Move\n- hook_install.go (210 lines)\n- hook_session.go (164 lines)\n- hook_prompt.go (76 lines)\n- hook_precommit.go (138 lines)\n- hook_precompact.go (37 lines)\n- hook_statusline.go (100 lines)\n\nTotal: ~725 lines, 6 files\n\n## Why\nThese are infrastructure for Claude Code integration, not user-facing commands. Separating them improves discoverability of actual user commands.\n\n## Approach\n1. Create internal/command/hooks/ directory\n2. Move files, update package to `package hooks`\n3. Export necessary functions\n4. Update root.go to import hooks package and register commands\n5. go build \u0026\u0026 go test\n\n## Risk\nLow - straightforward file moves with import updates.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-31T23:53:31.201175-08:00","created_by":"adam","updated_at":"2026-01-01T11:24:44.31791-08:00","closed_at":"2026-01-01T11:24:44.31791-08:00","close_reason":"Moved 8 hook files to internal/command/hooks/ subpackage. Separates Claude Code infrastructure from user-facing commands."}
{"id":"fray-8jm","title":"Go: Add ls command to list channels","description":"Missing 'mm ls' command to list known channels from global config.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-21T01:28:47.043763-08:00","updated_at":"2025-12-21T01:45:08.822163-08:00","closed_at":"2025-12-21T01:45:08.822163-08:00","close_reason":"Implemented in Go"}
{"id":"fray-8jo","title":"Implement timestamp utilities","description":"Create src/core/time.ts with timestamp formatting utilities.\n\n## Functions to Implement\n\n```typescript\n// src/core/time.ts\n\n/**\n * Format unix timestamp as relative time.\n * @example formatRelative(now - 120) -\u003e \"2m ago\"\n * @example formatRelative(now - 3600) -\u003e \"1h ago\"\n * @example formatRelative(now - 86400) -\u003e \"1d ago\"\n */\nexport function formatRelative(ts: number): string;\n\n/**\n * Check if an agent is stale based on last seen time.\n * @param lastSeen - unix timestamp of last activity\n * @param staleHours - hours of inactivity threshold\n */\nexport function isStale(lastSeen: number, staleHours: number): boolean;\n\n/**\n * Get current unix timestamp.\n */\nexport function now(): number;\n```\n\n## Relative Time Formatting Rules\n| Duration | Format |\n|----------|--------|\n| \u003c 60s | \"Xs ago\" (e.g., \"30s ago\") |\n| \u003c 60m | \"Xm ago\" (e.g., \"5m ago\") |\n| \u003c 24h | \"Xh ago\" (e.g., \"2h ago\") |\n| \u003c 7d | \"Xd ago\" (e.g., \"3d ago\") |\n| \u003e= 7d | \"Xw ago\" (e.g., \"2w ago\") |\n\nSpecial case:\n- \"just now\" for \u003c 5 seconds (optional, can use \"0s ago\")\n\n## Implementation Notes\n- Use Math.floor for all divisions\n- Unix timestamps are in seconds (not milliseconds)\n- isStale: lastSeen + (staleHours * 3600) \u003c now()\n\n## Files\n- src/core/time.ts\n\n## Acceptance Criteria\n- Relative time is human-readable\n- Stale detection works correctly\n- Unit tests for various time ranges\n- Edge cases: exactly on boundary values","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T10:05:18.073351-08:00","updated_at":"2025-12-19T22:57:34.305887-08:00","closed_at":"2025-12-04T12:29:35.216636-08:00","dependencies":[{"issue_id":"fray-8jo","depends_on_id":"fray-dk4","type":"parent-child","created_at":"2025-12-04T10:07:09.812457-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-8jo","depends_on_id":"fray-bml","type":"blocks","created_at":"2025-12-04T10:59:53.56-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-8joy","title":"UX: Tab/Esc sidebar navigation","description":"Tab opens sidebar, then toggles between views. Esc closes sidebar if no selection made. Enables future sidebar views. Source: msg-z7ruzlkg","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-02T00:26:26.086025-08:00","created_by":"adam","updated_at":"2026-01-02T00:26:26.086025-08:00"}
{"id":"fray-8lw2","title":"Daemon test scenarios setup","description":"Create controlled test environment for daemon testing.\n\nStructure:\n- test/daemon/{scenario}/.fray/ directories\n- Each scenario is a git-restorable state\n- git checkout to reset to scenario baseline\n\nScenarios needed:\n- fresh-room: empty room, one human, multiple managed agents\n- active-thread: ongoing discussion with ownership\n- mention-patterns: various @mention types to test filtering\n- stale-session: agent with old session to test resume\n\nThis unblocks safe testing of daemon changes without polluting working fray.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T15:17:16.91944-08:00","created_by":"adam","updated_at":"2026-01-02T23:49:15.437175-08:00","closed_at":"2026-01-02T23:49:15.437175-08:00","close_reason":"Created test/daemon/ with 4 scenarios: fresh-room, active-thread, mention-patterns, stale-session. Each is git-restorable. README documents expected daemon behavior."}
{"id":"fray-8nin","title":"fray clock: ambient agent status display","description":"Simple status line for agents to run in background:\n\n```\n$ fray clock\n@opus: 7m23s remaining | 2 mentions | 1 reply\n```\n\nUpdates in place periodically. Shows:\n- Heartbeat timer (time until session recycled)\n- Notification counts (mentions, replies, reactions)\n- NOT message content - just signals\n\nWhen agent is ready to context-switch, they check `fray get` for full content.\n\nUses the 'agent inbox' abstraction (see fray-0530).\n\nDesign: Simple, single-purpose. Agent glances at it, knows if they need to respond to something.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-02T19:50:55.073968-08:00","created_by":"adam","updated_at":"2026-01-02T20:10:08.86484-08:00","closed_at":"2026-01-02T20:10:08.86484-08:00","close_reason":"Implemented fray clock command - shows timer + mention/reply counts, updates in place","dependencies":[{"issue_id":"fray-8nin","depends_on_id":"fray-0530","type":"related","created_at":"2026-01-02T19:51:08.451726-08:00","created_by":"adam"}]}
{"id":"fray-8pa7","title":"Bug: click-to-copy footer ID should not be bold+underlined","description":"Footer anchor should remain dimmed as before. Only inline IDs (prefixed with #) should be bold+underlined and copyable.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-05T20:38:35.629193-08:00","created_by":"adam","updated_at":"2026-01-05T20:49:48.710208-08:00","closed_at":"2026-01-05T20:49:48.710208-08:00","close_reason":"Removed Bold(true).Underline(true) from footer GUID in messages.go. Footer now stays dimmed via Faint(true) while remaining a clickable zone for copy."}
{"id":"fray-8qok","title":"Reactions and replies should notify original message author","description":"Two issues:\n\n1. **Reactions don't notify authors**: When someone reacts to your message, you have no way to know. Need to either:\n   - Create an event message: '@bob reacted 👍 to msg-xxx \"Something I said...\"'\n   - Or add a query that includes 'messages I authored that got reactions'\n\n2. **Chained replies don't auto-mention**: `fray react 👍 msg-xxx --reply \"great point\"` doesn't notify the original author. The reply should automatically include the original author in mentions (unless they're already mentioned).\n\nBoth should appear in `fray @alice` and other mention queries.\n\nSource: manual testing of fray-lqjj implementation","status":"open","priority":1,"issue_type":"feature","created_at":"2026-01-02T09:50:20.107497-08:00","created_by":"adam","updated_at":"2026-01-06T12:37:23.908124-08:00"}
{"id":"fray-8xb","title":"Implement comprehensive error handling","description":"Create error handling utilities for clear, actionable error messages.\n\n## Error Categories\n\n### Project Errors\n- Not in beads project: \"Not in a beads project. Run 'bd init' first.\"\n- Linked project not found: \"Linked project 'api' not found at /path/to/project\"\n- Linked path not a beads project: \"Path /path/to/dir is not a beads project\"\n\n### Agent Errors\n- Unknown agent: \"Unknown agent: alice.999\"\n- Agent not active: \"Agent alice.419 is not active. Use 'bdm hi alice.419' to resume.\"\n- Agent already active: \"alice.419 is already active\"\n- Agent already left: \"alice.419 has already left\"\n- Invalid agent ID: \"Invalid agent ID: 'alice' (missing version number)\"\n\n### Message Errors\n- Empty message: \"Message cannot be empty\"\n\n### Config Errors\n- Unknown key: \"Unknown config key: foo\"\n- Invalid value: \"Invalid value for stale_hours: must be a positive integer\"\n\n## Implementation\n\n```typescript\n// src/errors.ts\n\nexport class BdmError extends Error {\n  constructor(message: string, public readonly code: string) {\n    super(message);\n    this.name = 'BdmError';\n  }\n}\n\nexport class NotInProjectError extends BdmError {\n  constructor() {\n    super(\"Not in a beads project. Run 'bd init' first.\", 'NOT_IN_PROJECT');\n  }\n}\n\nexport class UnknownAgentError extends BdmError {\n  constructor(agentId: string) {\n    super(\\`Unknown agent: \\${agentId}\\`, 'UNKNOWN_AGENT');\n  }\n}\n\n// etc.\n```\n\n## CLI Error Wrapper\n\n```typescript\n// src/cli.ts\n\nasync function run(fn: () =\u003e Promise\u003cvoid\u003e) {\n  try {\n    await fn();\n    process.exit(0);\n  } catch (err) {\n    if (err instanceof BdmError) {\n      console.error(\\`Error: \\${err.message}\\`);\n      process.exit(1);\n    }\n    // Unexpected error\n    console.error('Unexpected error:', err);\n    process.exit(2);\n  }\n}\n```\n\n## Exit Codes\n- 0: Success\n- 1: Known error (BdmError)\n- 2: Unexpected error\n\n## Files\n- src/errors.ts\n- src/cli.ts (update error handling)\n\n## Acceptance Criteria\n- All error messages are clear and actionable\n- Exit codes are consistent\n- Stack traces not shown for expected errors\n- Unexpected errors show debug info","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T10:17:20.919183-08:00","updated_at":"2025-12-19T22:57:34.302651-08:00","closed_at":"2025-12-04T12:44:17.326819-08:00","dependencies":[{"issue_id":"fray-8xb","depends_on_id":"fray-po1","type":"parent-child","created_at":"2025-12-04T10:19:00.456116-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-8xf","title":"Design: Claude Desktop project discovery and MCP architecture","description":"Design how Claude Desktop discovers and connects to beads projects via MCP.\n\n## Context\n\n**bdm** (beads-messenger) is a CLI for agent-to-agent messaging in beads projects. It stores messages in `.beads/*.db` (same SQLite database as beads issue tracker). Current features:\n- Agents register with `bdm new \u003cname\u003e` and get IDs like `alice.1`\n- Messages posted with `bdm post --as alice.1 \"message\"`\n- @mentions for routing (`@bob.2`, `@all`)\n- `bdm chat` for interactive user participation\n\n**Goal**: Add an MCP server so Claude Desktop can join rooms as an agent.\n\n**MCP** (Model Context Protocol) lets Claude Desktop connect to external tools/data:\n- **Tools**: Actions Claude calls on-demand (`bdm_post`, `bdm_get`)\n- **Resources**: Data auto-loaded into context (`bdm://room` with recent messages)\n\n## Questions to Answer\n\n1. **Project Discovery**\n   - How does Claude Desktop know which projects exist?\n   - Options: config file, auto-discovery, manual add via UI\n   - Where would config live? `~/.config/bdm/projects.json`?\n\n2. **Connection Model**\n   - One MCP server per project? Or one server serving multiple projects?\n   - How to switch between projects in conversation?\n   - Can Claude Desktop handle multiple MCP connections?\n\n3. **Agent Identity**\n   - Auto-register on connect? Or require explicit `bdm_new`?\n   - Persist agent ID across sessions? (Same `claude.1` every time vs new ID)\n   - Storage: config file, server memory, or stateless?\n\n4. **Tools vs Resources**\n   - **Tools** (likely): `bdm_new`, `bdm_post`, `bdm_get`, `bdm_here`, `bdm_bye`\n   - **Resources** (maybe): `bdm://room`, `bdm://mentions/{agent}`\n   - Start tools-only for simplicity? Resources add ambient awareness.\n\n5. **Configuration**\n   - Claude Desktop config: `~/Library/Application Support/Claude/claude_desktop_config.json`\n   - How to add bdm-mcp there?\n   - Example: `{\"mcpServers\": {\"bdm\": {\"command\": \"npx\", \"args\": [\"bdm-mcp\", \"/path/to/project\"]}}}`\n\n## Deliverable\n\nWrite to PLAN-mcp.md:\n- Recommended architecture diagram\n- User flow for connecting Claude Desktop to a project\n- MCP server interface (tools + resources definitions)\n- Config file formats\n- Implementation phases\n\n## Dependencies\n\n- Findings from bdm-0od (beads daemon investigation)\n\n## Parent Epic\n\nbdm-ae4: MCP Server for Claude Desktop Integration","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-05T16:35:17.103598-08:00","updated_at":"2025-12-19T22:57:34.294653-08:00","closed_at":"2025-12-05T17:28:30.22267-08:00"}
{"id":"fray-8xy8","title":"Feature: Esc in drilled sidebar should return to main list","description":"When drilled into a thread hierarchy (e.g., architect/notes/), pressing Esc should navigate back to the main channel list, not just close the panel.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-05T20:39:21.279069-08:00","created_by":"adam","updated_at":"2026-01-05T20:45:40.89484-08:00","closed_at":"2026-01-05T20:45:40.89484-08:00","close_reason":"Esc now drills out when drilled into a thread hierarchy. Only closes panel when at top level."}
{"id":"fray-90g","title":"Add 'export' command","description":"Export thread/channel to file.\n\n```bash\nfray export thrd-xyz \u003e discussion.txt\nfray export --channel \u003e full-channel.md\nfray export --format markdown thrd-xyz\nfray export --format json thrd-xyz\n```\n\nOutput formats:\n- Plain text (default)\n- Markdown with metadata\n- JSON for programmatic use\n\nUse cases: documentation, archiving, sharing outside fray.","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-30T16:47:25.980687-08:00","created_by":"adam","updated_at":"2025-12-30T16:47:25.980687-08:00"}
{"id":"fray-91ix","title":"Bug: read state of mentions not persisting properly","description":"Fixed: mentions now use durable watermarks (fray_read_to) instead of volatile read receipts. Rebuild command now shelves and restores read state. Ghost cursors remain for session handoffs (setting read position farther back).","status":"closed","priority":1,"issue_type":"bug","assignee":"opus","created_at":"2026-01-06T13:24:48.697831-08:00","created_by":"adam","updated_at":"2026-01-06T16:45:41.331724-08:00","closed_at":"2026-01-06T16:32:50.450391-08:00","close_reason":"Added durable watermark-based read state for mentions. Uses fray_read_to table (which survives rebuilds) instead of relying solely on fray_read_receipts (which is dropped on rebuild). Falls back to watermark when no ghost cursor exists."}
{"id":"fray-92p","title":"Implement mention parsing utilities","description":"Create src/core/mentions.ts with @mention extraction and matching utilities.\n\n## Mention Format\n- Mentions start with @ followed by agent ID or prefix\n- @all is special broadcast mention\n- Can mention full IDs (@alice.419) or prefixes (@alice)\n- Examples: @alice, @alice.419, @pm.3.sub, @all\n\n## Functions to Implement\n\n```typescript\n// src/core/mentions.ts\n\n/**\n * Extract all @mentions from message body.\n * Returns mention targets without @ prefix.\n * @example extractMentions(\"hey @alice.1 and @bob.3\") -\u003e [\"alice.1\", \"bob.3\"]\n * @example extractMentions(\"@all heads up\") -\u003e [\"all\"]\n * @example extractMentions(\"@alice check this\") -\u003e [\"alice\"]\n */\nexport function extractMentions(body: string): string[];\n\n/**\n * Check if an agent ID matches a mention prefix.\n * Used to determine if a message is relevant to an agent.\n * @example matchesMention(\"alice.419\", \"alice\") -\u003e true (prefix match)\n * @example matchesMention(\"alice.419\", \"alice.419\") -\u003e true (exact match)\n * @example matchesMention(\"alice.frontend.3\", \"alice\") -\u003e true (prefix match)\n * @example matchesMention(\"bob.1\", \"alice\") -\u003e false\n */\nexport function matchesMention(agentId: string, mentionPrefix: string): boolean;\n\n/**\n * Check if a mention is the broadcast mention.\n */\nexport function isAllMention(mention: string): boolean;\n\n/**\n * Highlight mentions in message body for display (optional - can defer to Phase 5).\n * @example highlightMentions(\"hey @alice\") -\u003e \"hey \\x1b[36m@alice\\x1b[0m\"\n */\nexport function highlightMentions(body: string): string;\n```\n\n## Regex Pattern for Mentions\n```typescript\n// Match @ followed by:\n// - \"all\" (broadcast)\n// - OR valid agent ID/prefix: starts with letter, then letters/numbers/dots\n// The pattern allows both full IDs (alice.419) and prefixes (alice)\nconst MENTION_REGEX = /@(all|[a-z][a-z0-9]*(?:\\.[a-z0-9]+)*)/g;\n```\n\nNote: This regex matches both `@alice` (prefix) and `@alice.419` (full ID). The `.419` part is captured because `[a-z0-9]+` allows digits.\n\n## matchesMention Logic\n```typescript\nfunction matchesMention(agentId: string, mentionPrefix: string): boolean {\n  // Exact match\n  if (agentId === mentionPrefix) return true;\n  // Prefix match: agentId starts with prefix followed by dot\n  if (agentId.startsWith(mentionPrefix + '.')) return true;\n  return false;\n}\n```\n\n## Edge Cases\n- Multiple mentions in one message: \"@alice @bob both of you\"\n- Mentions at start/end of message\n- Mentions with punctuation after: \"@alice, please\" → extracts \"alice\"\n- @all mixed with specific mentions: \"@all and especially @alice\"\n- Email-like strings should NOT match: \"contact@alice.com\" should not extract \"alice.com\"\n  - The regex handles this because it requires @ at word boundary\n\n## Files\n- src/core/mentions.ts\n\n## Acceptance Criteria\n- Extracts all valid mentions from message body\n- Does not extract from email addresses\n- Handles punctuation correctly\n- Prefix matching works per spec\n- Unit tests cover all patterns including edge cases","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T10:04:41.987627-08:00","updated_at":"2025-12-19T22:57:34.306214-08:00","closed_at":"2025-12-04T12:31:00.864701-08:00","dependencies":[{"issue_id":"fray-92p","depends_on_id":"fray-dk4","type":"parent-child","created_at":"2025-12-04T10:07:04.689551-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-92p","depends_on_id":"fray-6u7","type":"blocks","created_at":"2025-12-04T10:07:23.734885-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-9bad","title":"Bug: Thread anchor not visible at top of thread view","description":"When viewing a thread with fray thread \u003cref\u003e, the anchor message should appear prominently at the top (as the TL;DR), but currently it just appears in the message list truncated. Users have to run 'fray view \u003cmsg\u003e' to see the full anchor content.\n\nSource: msg-52pl1xw8, msg-sdys7lwt in 73w9-design thread","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-02T08:59:35.962767-08:00","created_by":"adam","updated_at":"2026-01-02T11:58:16.635564-08:00","closed_at":"2026-01-02T11:58:16.635564-08:00","close_reason":"Thread anchor now displays prominently at top with ANCHOR: label and shows full content without truncation."}
{"id":"fray-9ds","title":"Show nicks in roster and info output","description":"When listing agents in roster and info, show their nicknames. E.g.:\n  @devrel (aka @helper, @dr)\n    status: working on docs\n    last seen: 5m ago","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-21T12:27:29.385149-08:00","updated_at":"2025-12-21T15:54:51.483825-08:00","closed_at":"2025-12-21T15:54:51.483825-08:00","close_reason":"Implemented in Go rewrite"}
{"id":"fray-9es0","title":"fray answers \u003cissue-id\u003e: link questions to external issues","description":"Allow attaching questions to external issue IDs (beads, github, etc).\n\n```bash\nfray answers fray-mzg8           # Show questions linked to issue\nfray ask \"...\" --issue fray-mzg8  # Link question to issue\n```\n\nQuestions become contextual to work items. When working on an issue, `fray answers \u003cid\u003e` shows what's unresolved.\n\nFeeds into neo onboarding - when you pick up an issue, you see its open questions.","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-05T11:44:12.431172-08:00","created_by":"adam","updated_at":"2026-01-05T11:44:12.431172-08:00"}
{"id":"fray-9kh","title":"Prune: preserve thread integrity","description":"When pruning, preserve parent messages for any replies in the keep window. Walk up the reply_to chain and add those parents to the keep set.\n\nExample with --keep 3:\n  msg-1: \"Project idea\"\n  msg-2: \"Sounds good\" (reply to msg-1)\n  msg-3: \"Random update\"\n  msg-4: \"Another thing\"\n  msg-5: \"Question\"\n  msg-6: \"Answer\" (reply to msg-5)  ← in keep window\n  msg-7: \"Latest\"                   ← in keep window\n  msg-8: \"Got it\" (reply to msg-7)  ← in keep window\n\nResult: Keep msg-5, msg-6, msg-7, msg-8 (msg-5 pulled in as parent of msg-6)\nPrune: msg-1 through msg-4 (old thread has no replies in keep window)\n\nKey: \"preserve parents of active replies\" not \"preserve all threads\".","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-21T10:58:15.528352-08:00","updated_at":"2025-12-21T17:04:12.155122-08:00","closed_at":"2025-12-21T17:04:12.155122-08:00","close_reason":"Implemented"}
{"id":"fray-9mq","title":"Fix 'ago ago' duplication in claims output","description":"Claims output shows 'src/test.ts (6s ago ago)' with duplicate 'ago'. Affects both TS and Go implementations.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-21T01:29:20.292687-08:00","updated_at":"2025-12-21T01:46:11.577467-08:00","closed_at":"2025-12-21T01:46:11.577467-08:00","close_reason":"Fixed duplicate 'ago' in claims output"}
{"id":"fray-9o8s","title":"Chat: main channel should scroll to last prune point","description":"Main channel in fray chat doesn't scroll through full history. Expected: should be able to scroll back to the last prune point.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-31T23:38:06.794714-08:00","created_by":"adam","updated_at":"2025-12-31T23:54:50.269774-08:00","closed_at":"2025-12-31T23:54:50.269774-08:00","close_reason":"Fixed in chat bug batch: filtered deleted messages, fixed thread scroll bounce, added near-top preload, refactored answer to Bubble Tea TUI"}
{"id":"fray-9s6","title":"Fix config command printing undefined for missing keys","description":"## Problem\n`bdm config \u003ckey\u003e` prints `key: undefined` for missing entries (src/commands/config.ts:32-43).\n\n```typescript\nconst configValue = getConfig(db, normalizedKey);\nif (configValue === null) {  // Only checks null, not undefined!\n  console.log(\\`Config key '\\${key}' not found\\`);\n} else {\n  console.log(\\`\\${key}: \\${configValue}\\`);  // Prints \"key: undefined\"\n}\n```\n\n## Issues\n1. Only checks for `null`, but `getConfig` may return `undefined`\n2. Should exit with non-zero code for missing keys (scripting)\n3. JSON mode outputs `{\"key\": null}` which is ambiguous\n\n## Fix\n1. Check `configValue == null` (catches both null and undefined)\n2. Call `process.exit(1)` for missing keys\n3. Consider whether JSON should include the key at all when missing\n\n## Files\n- src/commands/config.ts:32-43\n\n## Acceptance Criteria\n- `bdm config unknown-key` prints \"not found\" message\n- Exit code is 1 for missing keys\n- No \"undefined\" in output","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-04T14:03:26.784839-08:00","updated_at":"2025-12-19T22:57:34.301723-08:00","closed_at":"2025-12-04T14:26:40.621581-08:00"}
{"id":"fray-9si","title":"Implement post command","description":"Implement the post command for sending messages.\n\n## Usage\n\n```bash\nbdm post --as alice.419 \"hello world\"\nbdm post --as alice.419 \"@bob.3 check auth.py:47\"\nbdm post --as pm.5 \"@all standup in 5\"\n```\n\n## Implementation\n\n1. Validate --as agent exists and is active\n2. Extract mentions from message body\n3. Create message with:\n   - ts: now()\n   - from_agent: agent ID from --as\n   - body: message text\n   - mentions: extracted mentions array\n4. Update agent's last_seen to now()\n5. Output: Show the posted message\n\n## Validation\n\n**Agent validation:**\n- Agent must exist\n- Agent must not have left_at set (or be resumed first)\n- Error: \"Agent alice.419 is not active. Use 'bdm hi alice.419' to resume.\"\n\n**Message validation:**\n- Body must not be empty\n- Error: \"Message cannot be empty\"\n\n## Side Effects\n- Creates message in bdm_messages\n- Updates agent's last_seen (heartbeat)\n\n## Output\n\n```\nPosted:\n[45] alice.419 (just now): hello world\n```\n\nOr minimal:\n```\n→ [45]\n```\n\n## JSON Output\n\n```json\n{\n  \"id\": 45,\n  \"ts\": 1234567890,\n  \"from_agent\": \"alice.419\",\n  \"body\": \"hello world\",\n  \"mentions\": []\n}\n```\n\n## Files\n- src/commands/post.ts\n\n## Acceptance Criteria\n- Post creates message correctly\n- Mentions are extracted and stored\n- Agent last_seen is updated\n- Validation rejects inactive agents\n- Validation rejects empty messages","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T10:09:31.908202-08:00","updated_at":"2025-12-19T22:57:34.304101-08:00","closed_at":"2025-12-04T12:37:47.554217-08:00","dependencies":[{"issue_id":"fray-9si","depends_on_id":"fray-yh4","type":"parent-child","created_at":"2025-12-04T10:10:59.02053-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-9si","depends_on_id":"fray-2vy","type":"blocks","created_at":"2025-12-04T10:11:50.46289-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-9si","depends_on_id":"fray-92p","type":"blocks","created_at":"2025-12-04T10:45:51.774855-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-9si","depends_on_id":"fray-dgt","type":"blocks","created_at":"2025-12-04T10:46:24.834651-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-a5hc","title":"Chat UX Polish: commands, help, breadcrumbs","description":"P0 epic for next session - chat UX improvements.\n\n## Children\n- fray-659c: Chat / commands expansion (/archive, /fave, /mute, /rename, etc.)\n- fray-aqcw: ? shows help when textarea empty\n- fray-lu53: / command autocomplete\n- fray-gllz: Breadcrumb nav at bottom\n- fray-jqxf: Disable /prune until redesign\n- fray-nbjk: CLI thread rename command (needed for /rename)\n\n## Scope\nMake chat textarea a proper command interface with:\n1. Help accessible via ? in empty input\n2. / commands with autocomplete\n3. Full breadcrumb navigation display\n4. Expanded command set for thread operations","status":"closed","priority":0,"issue_type":"epic","created_at":"2026-01-06T13:18:40.275151-08:00","created_by":"adam","updated_at":"2026-01-06T13:37:35.11898-08:00","closed_at":"2026-01-06T13:37:35.11898-08:00","close_reason":"All 6 child features implemented: / commands expansion, ? help display, / command autocomplete, breadcrumb nav, /prune disabled, and thread rename."}
{"id":"fray-a5w","title":"Add merge command for combining agent history","description":"mm merge @partydev @party-dev - Merge chat history from one agent into another. Useful when same person registered under slightly different names.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-21T09:05:40.111785-08:00","updated_at":"2025-12-21T15:54:51.481558-08:00","closed_at":"2025-12-21T15:54:51.481558-08:00","close_reason":"Implemented in Go rewrite"}
{"id":"fray-a88l","title":"Answer display polish: byline tag format","description":"In chat view, 'answered @opus' should be inside the colored byline tag so it reads '@adam answered @opus:' instead of '@adam:' on one line and 'answered @opus' on the next.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-31T17:47:13.267827-08:00","created_by":"adam","updated_at":"2025-12-31T17:47:13.267827-08:00"}
{"id":"fray-a8h1","title":"/hop command: quick session join without full /fly","description":"Quick 'hop-in' command for agents who need to briefly join a session without full /fly context injection.\n\n## Source Discussion\ncbcs-design thread (thrd-kw5z6vmu), msg-g0qstn64.\n\n## Use Case\nAn agent needs to quickly check something or provide input, but doesn't need the full /fly onboarding:\n- Already familiar with the project\n- Just checking one thread or message\n- Brief consultation, not a full work session\n\n## Distinction from /fly\n- **/fly**: Full session start. Injects notes, meta, unread, questions, ready work. 'I know kung fu.'\n- **/hop**: Quick join. Minimal context. 'Just popping in.'\n\n## Proposed Behavior\n```\n/hop                    # Rejoin, show only direct @mentions since last /land\n/hop \u003cthread\u003e           # Jump directly to a thread\n/hop \u003cmsg-id\u003e           # Jump to specific message context\n```\n\n## Context Injection\nMinimal:\n- Your last note (if any)\n- Direct @mentions only (not FYIs)\n- Active claims\n- Skip: meta, questions, ready work, thread activity\n\n## Related\n- fray-bu0g: Mention hierarchy (direct vs FYI)\n- /fly and /land updates for conventions","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-03T19:40:29.851516-08:00","created_by":"adam","updated_at":"2026-01-03T21:51:10.670725-08:00","closed_at":"2026-01-03T21:51:10.670725-08:00","close_reason":"Created /hop command (hop.md). Minimal context injection: back, @mentions --last 5, claims. Skips meta, questions, ready work. Quick hop-out guidance.","dependencies":[{"issue_id":"fray-a8h1","depends_on_id":"fray-0etk","type":"parent-child","created_at":"2026-01-03T21:21:51.168788-08:00","created_by":"adam"}]}
{"id":"fray-adj6","title":"Knowledge thread hierarchy: meta/, roles/, agents/","description":"Standard thread structure for accumulated knowledge:\n\n**meta/** - Project-wide knowledge (everyone sees)\n- architecture/ - technical decisions\n- principles/ - philosophy  \n- patterns/ - reusable solutions\n\n**roles/{role}/** - Role knowledge (role holders/players see)\n- (anchor) - role definition\n- learnings/ - what works for this role\n- skills/ - playbooks, pointers to skill files\n\n**{agent}/** - Agent knowledge (agent sees)\n- notes/ - working notes\n- journal/ - personal reflection\n- meta/ - self-knowledge (strengths/, patterns/)\n\n**Knowledge flow:** self → role → meta (promotion via reactions)","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-01T13:34:49.719798-08:00","created_by":"adam","updated_at":"2026-01-05T00:02:16.587104-08:00","closed_at":"2026-01-05T00:02:16.587104-08:00","close_reason":"Implemented knowledge thread hierarchy: ThreadType system, auto-creation of role/agent hierarchies on role add/play and fray new, fray key/keys commands for role insights. Deferred: legacy notes migration and /fly injection.","dependencies":[{"issue_id":"fray-adj6","depends_on_id":"fray-wl5n","type":"related","created_at":"2026-01-01T13:34:56.682037-08:00","created_by":"adam"},{"issue_id":"fray-adj6","depends_on_id":"fray-gju8","type":"related","created_at":"2026-01-01T13:34:56.706117-08:00","created_by":"adam"},{"issue_id":"fray-adj6","depends_on_id":"fray-1mch","type":"parent-child","created_at":"2026-01-03T21:09:19.049856-08:00","created_by":"adam"}]}
{"id":"fray-ae4","title":"MCP Server for Claude Desktop Integration","description":"Add an MCP server to bdm that allows Claude Desktop to participate in project chat rooms as an agent.\n\n## Context\n\n**bdm** (beads-messenger) is a CLI for agent-to-agent messaging in beads projects. Currently works via:\n- CLI commands (`bdm post`, `bdm get`, `bdm new`)\n- Claude Code hooks (ambient context injection)\n- Interactive chat (`bdm chat`)\n\n**MCP** (Model Context Protocol) is Anthropic's protocol for connecting Claude to external tools/data. Adding an MCP server would let **Claude Desktop** (not just Claude Code) participate in project rooms.\n\n## Goal\n\nClaude Desktop users can:\n- Connect to a beads project\n- Register as an agent (`bdm_new`)\n- Post messages (`bdm_post`) \n- Read room + @mentions (`bdm_get`)\n- See who's active (`bdm_here`)\n- Leave (`bdm_bye`)\n\n## Key Questions\n\n1. **Daemon architecture**: beads uses one daemon per project. Should bdm:\n   - Extend the beads daemon?\n   - Run its own daemon?\n   - Be stateless (discover project per-call)?\n\n2. **Multi-project**: How does Claude Desktop know which projects to connect to?\n\n3. **Resources vs Tools**: \n   - Tools: on-demand actions\n   - Resources: auto-loaded context (room messages in context window)\n\n4. **Agent identity**: How to persist agent ID across MCP calls?\n\n## Planned Implementation\n\n```\nsrc/mcp/\n  server.ts      # MCP server entry\n  tools.ts       # Tool handlers  \n  resources.ts   # Resource handlers (if needed)\nbin/\n  bdm-mcp.ts     # Entry point for \"npx bdm-mcp\"\n```\n\n## Child Issues\n\n| Issue | Title | Status |\n|-------|-------|--------|\n| bdm-0od | Investigate beads daemon architecture | open |\n| bdm-8xf | Design: Claude Desktop project discovery | open |\n| TBD | Implement MCP server with tools | - |\n| TBD | Add resources for ambient context | - |\n\n## Resources\n\n- MCP docs: https://modelcontextprotocol.io/docs\n- MCP TypeScript SDK: @modelcontextprotocol/sdk\n- Claude Desktop config: ~/Library/Application Support/Claude/claude_desktop_config.json","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-05T16:34:48.910772-08:00","updated_at":"2025-12-19T22:57:34.313259-08:00","closed_at":"2025-12-06T09:04:54.613653-08:00"}
{"id":"fray-aebw","title":"Bug: SELECT * causes scan errors when column order differs from schema","description":"When migrations add columns via ALTER TABLE, columns are appended to the end. SELECT * returns them in physical order, not schema order. The scanMessage function expects a specific order. Fix: explicitly list columns in SELECT statements.","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-03T22:59:51.868497-08:00","created_by":"adam","updated_at":"2026-01-03T23:02:56.911954-08:00","closed_at":"2026-01-03T23:02:56.911954-08:00","close_reason":"Fixed by replacing SELECT * with explicit column lists (messageColumns, messageColumnsAliased) in queries_messages.go and queries_threads.go. This ensures column order matches scanMessage expectations regardless of ALTER TABLE history."}
{"id":"fray-aex","title":"Go: Add edit command","description":"Missing 'mm edit \u003cmsgid\u003e \u003cmessage\u003e' command to edit posted messages.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-21T01:29:04.388839-08:00","updated_at":"2025-12-21T01:49:46.741764-08:00","closed_at":"2025-12-21T01:49:46.741764-08:00","close_reason":"Implemented in Go"}
{"id":"fray-aiw","title":"Highlight user mentions in default color","description":"User mentions like @adam should be visually distinct but use the terminal's default color.\n\n## Current Behavior\n\nWhen agents mention users like @adam, the mention appears as plain text because users don't have entries in the bdm_agents table. Only registered agent mentions get colorized.\n\nExample:\n- `@validation.1` → colored (registered agent)\n- `@adam` → plain text (user, no visual distinction)\n\n## Desired Behavior\n\nUser mentions should be highlighted in the terminal's default/reset color (white text on dark terminals, black on light terminals). This makes them visually distinct from plain text while differentiating them from agent mentions.\n\nExample:\n- `@validation.1` → colored with agent's color (e.g., green background)\n- `@adam` → bold or underlined in default terminal color\n\n## Implementation\n\nAdd a third category of mention highlighting:\n\n1. **Agent mentions** (in agentBases): Use agent's color\n2. **User mentions** (not in agentBases, but looks like a name): Use default/reset color with bold\n3. **Everything else** (@payload, @foobar): Plain text\n\n**Detection heuristic for users:**\n- Not in agentBases set\n- Length 3-15 characters\n- No dots (distinguishes from agent IDs)\n- Alphanumeric only\n\n**Styling**: `${BOLD}${match}${RESET}${senderColor}` (bold in default color)\n\n## Files to Modify\n\n- `src/commands/format.ts` - Update `colorizeBody()` to handle user mentions\n- `src/chat/display.ts` - Update `colorizeBody()` to handle user mentions\n\n## Testing\n\n```bash\nbdm post --as test.1 \"Hey @adam can you review this?\"\nbdm get --last 1  # @adam should be bold in default color\n```","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-07T17:20:57.581699-08:00","updated_at":"2025-12-19T22:57:34.31283-08:00","closed_at":"2025-12-07T17:26:46.773194-08:00"}
{"id":"fray-aj6","title":"fray get \u003cagent\u003e should default to unread-only","description":"The watermark system (4258ebd) tracks read positions but `fray get \u003cagent\u003e` doesn't use it by default.\n\n## Current Behavior\n- `fray get \u003cagent\u003e` returns last N room messages regardless of watermark\n- Agents waste tokens re-reading already-seen messages\n\n## Proposed Behavior\n- `fray get \u003cagent\u003e` → unread only (messages since agent's watermark)\n- `fray get \u003cagent\u003e --last 10` → last 10 regardless of watermark (cap at 10-20)\n- `fray get \u003cagent\u003e --since X --to Y` → explicit range for history pagination\n- Remove or hide `--all` for agents (token waste)\n\n## Additional: Chained Replies in Mentions\nReplies to an agent's messages (via reply chain) should be included in the 'mentions' result, not just explicit @mentions. If someone replies to my question, I should see it even without an explicit @designer.\n\n## Context\nDiscovered during design session - agents repeatedly calling `fray get designer --room 8` burning tokens on already-read content.\n\nSee msg-wor9q3ge for discussion, msg-kj4bo1tn for reply chain note.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-31T14:42:38.378412-08:00","created_by":"adam","updated_at":"2025-12-31T23:19:39.160988-08:00","closed_at":"2025-12-31T23:19:39.160988-08:00","close_reason":"Implemented watermark-based unread filtering for room messages, --last override, reply chain inclusion in mentions, and unread-only mention filtering"}
{"id":"fray-ao2f","title":"Thread tree display with indicators","description":"Tree display with nesting indicators for 'fray threads --tree'.\n\nShows:\n- ★ followed\n- 📌 pinned  \n- (muted)\n- message counts\n- unread indicators\n\n**Sidebar navigation for fray chat** (from cbcs-design):\n- All threads listed in sidebar\n- Faves float to top or have separate section\n- Expand/collapse for nested threads (supports 4-level nesting)\n- Unread indicators per thread\n\n**Thread naming convention**:\nDisplay handles hierarchical names:\n  gz26-curation/                     # epic main\n  ├── design-dua7-anchors            # feature design\n  ├── review-eeor-pins               # feature review\n  └── dev-jlw8-move                  # implementation","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-01T12:24:05.995341-08:00","created_by":"adam","updated_at":"2026-01-05T03:17:57.054285-08:00","closed_at":"2026-01-05T03:17:57.054285-08:00","close_reason":"Added --tree flag with nested display and indicators (★ followed, 📌 pinned, (muted))","dependencies":[{"issue_id":"fray-ao2f","depends_on_id":"fray-gz26","type":"parent-child","created_at":"2026-01-01T12:24:28.32022-08:00","created_by":"adam"}]}
{"id":"fray-aqcw","title":"Chat: ? shows help when textarea empty, hide tip on input","description":"Two related UX improvements:\n\n1. Pressing `?` in an empty textarea should show help (currently does not)\n2. The \"? for help\" tip should disappear as soon as any text is entered (since we only want ? to trigger when input is empty)","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-01-06T12:55:22.424834-08:00","created_by":"adam","updated_at":"2026-01-06T13:24:19.151917-08:00","closed_at":"2026-01-06T13:24:19.151917-08:00","close_reason":"Both features already/now work: ? shows help when textarea empty (was already implemented), and '? for help' tip now hides when input has text","dependencies":[{"issue_id":"fray-aqcw","depends_on_id":"fray-a5hc","type":"parent-child","created_at":"2026-01-06T13:18:45.133814-08:00","created_by":"adam"}]}
{"id":"fray-arlf","title":"Protocol \u0026 Prompt Refresh: fly/land, knowledge threads, questions","description":"Review and update protocol-related beads to align with current fray functionality.\n\n## Scope\n\nThese beads were created before recent changes and need review/consolidation:\n\n1. **fray-l71b**: fly/land workstream threads (now P3/discuss)\n2. **fray-kj5j**: Knowledge threads with reaction-based curation\n3. **fray-n0pg**: mlld-based /fly and /land protocols\n4. **fray-mgr0**: Questions integration in /fly and /land\n\n## Goal\n\nDetermine what the *current* plan is for:\n- Session startup (/fly)\n- Session teardown (/land)\n- Knowledge thread curation\n- Question integration\n\nMany of these concepts may have been implemented differently than originally conceived, or may no longer be needed given convention-based approach.\n\n## Action\n\nReview each, close if obsolete, update if still relevant, or consolidate into fewer focused beads.","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-06T12:38:56.297264-08:00","created_by":"adam","updated_at":"2026-01-06T12:38:56.297264-08:00"}
{"id":"fray-awkj","title":"Thread names: sanitize to kebab-case with confirmation","description":"Instead of erroring when thread name has invalid chars/case:\n\n1. Sanitize to kebab-case lowercase\n2. Prompt for confirmation: \"Creating 'new-thread-name' -- ok? Y/n\"\n\nExample: \"My Thread Name\" → \"my-thread-name\"","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-06T12:55:36.22037-08:00","created_by":"adam","updated_at":"2026-01-06T12:55:36.22037-08:00"}
{"id":"fray-ayw","title":"Replace --last suggestion with --since, add token limit","description":"The suggestion at the end of `bdm get` encourages agents to use `--last 50` which immediately consumes all their tokens.\n\n## Current Behavior\n\nAt the end of `bdm get alice.1`, we show:\n```\nMore: bdm get --last 50 | bdm @alice --all | bdm get --since \u003cid\u003e\n```\n\nAgents see `--last 50` and immediately run it, eating their context.\n\n## Desired Behavior\n\n1. Remove `--last 50` suggestion entirely\n2. Suggest `bdm get --since \u003cid\u003e` instead\n3. Add token protection: error if requesting more than 10 messages back without explicit flag\n\n**New suggestion line:**\n```\nMore: bdm @alice --all | bdm get --since \u003cid\u003e\n```\n\n**Token limit enforcement:**\n```bash\nbdm get --last 50        # ERROR: \"Requesting 50 messages. Use --bypass-token-limit to proceed.\"\nbdm get --since 100      # If \u003e10 messages: ERROR with same message\nbdm get --last 50 --bypass-token-limit   # OK, proceeds\n```\n\n## Implementation\n\n- Remove `--last 50` from suggestion in get.ts\n- Add validation in get.ts and mentions.ts:\n  - Count how many messages would be returned\n  - If \u003e10, error unless `--bypass-token-limit` flag is present\n- Add `--bypass-token-limit` flag to relevant commands\n\n## Files\n\n- src/commands/get.ts - Update suggestion, add token limit check\n- src/commands/mentions.ts - Add token limit check\n\n---\n**2026-01-06**: References old bdm tool. Concept may be valid but needs complete rewrite for Go-based fray if still wanted.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-09T06:12:03.002401-08:00","updated_at":"2026-01-06T13:10:08.771169-08:00","closed_at":"2026-01-06T13:10:08.771169-08:00","close_reason":"Partially done: --since flag exists. Token limit protection not implemented but unclear if needed given current usage patterns.","labels":["needs-rewrite"]}
{"id":"fray-az3","title":"Add type column to bdm_messages table","description":"Add a `type` column to distinguish user messages from agent messages.\n\n## Changes\n\n1. **src/db/schema.ts** - Add migration logic:\n   - Check if column exists with `PRAGMA table_info(bdm_messages)`\n   - If missing: `ALTER TABLE bdm_messages ADD COLUMN type TEXT DEFAULT 'agent'`\n\n2. **src/types.ts** - Update interfaces:\n   ```typescript\n   export type MessageType = 'user' | 'agent';\n   export interface Message {\n     // ... existing\n     type: MessageType;\n   }\n   ```\n\n3. **src/db/queries.ts** - Update functions:\n   - `createMessage()` accepts optional `type` parameter (default 'agent')\n   - `parseMessageRow()` includes type field\n\n## Exit Criteria\n- Existing messages have type='agent' after migration\n- New messages can specify type='user' or type='agent'\n- All existing tests pass","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-05T15:49:59.514678-08:00","updated_at":"2025-12-19T22:57:34.314018-08:00","closed_at":"2025-12-05T15:56:24.971371-08:00"}
{"id":"fray-b1j","title":"Design: Conversation primitives (threads, questions, answers, tasks, notes)","description":"Design and implement structured conversation primitives for multi-agent coordination.\n\n**Spec**: docs/THREADS-SPEC.md\n\nCore insight: Messages are facts, threads are bookmarks.\n\nPrimitives:\n- Threads (bookmarks on message chains, implicit vs explicit)\n- Questions (with respondents + decider)\n- Answers (with confidence scores, is_decision flag)\n- Tasks (agent work queue, can link to beads)\n- Notes (agent memory/scratchpad)\n\nInspired by And Bang (2012) - real-time team coordination.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-23T04:36:54.766126-08:00","updated_at":"2025-12-30T16:13:05.826002-08:00","closed_at":"2025-12-30T16:13:05.826002-08:00","close_reason":"MVP complete: threads, questions, answers, notes all implemented. Tasks deferred to beads integration."}
{"id":"fray-b56","title":"Add reactions for short replies (\u003c20 char)","description":"Reactions are 1-20 char responses (including emoji) that attach to messages rather than being full messages.\n\nSyntax: #id 👍 or #id let's do it\n\nStorage:\n- Messages have a reactions object\n- JSON groups users by reaction text:\n  {\"reactions\": {\"👍\": [\"alice\", \"bob\"], \"let's do it\": [\"charlie\"]}}\n\nDisplay in mentions:\n- Grouped: '\u003cuser\u003e, \u003cuser\u003e reacted \"👍\" to \"#msg-id Some truncated...\"'\n\nLive chat behavior:\n- If reaction arrives after chat opened: append inline italic event + amend original message\n- Event format: '\u003cuser\u003e reacted \"x\" to \"#msgid Some message...\"' (no byline, just event)\n\nAuto-detection:\n- All replies \u003c20 chars become reactions by default\n\nVisual feedback in input:\n- Text color yellow when \u003c20 chars (reaction mode)\n- Normal color when \u003e=20 chars (reply mode)\n\nRemoval:\n- Reactions can be removed but not edited\n- Syntax: mm unreact #msg-id (removes your reaction)\n\nAllows informal polls and quick responses without cluttering chat.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-21T14:03:59.749902-08:00","updated_at":"2025-12-21T15:54:51.483258-08:00","closed_at":"2025-12-21T15:54:51.483258-08:00","close_reason":"Implemented in Go rewrite"}
{"id":"fray-bcx","title":"Enhance UserPromptSubmit hook with status line","description":"Add compact status line to UserPromptSubmit hook:\n- Asked questions count\n- Wondered questions count  \n- Unread count (once summary command exists)\n- Claims status (all agents, for collision awareness)\n\nFormat: `[fray opus] asked:2 wondered:1 | claims: @alice (auth.go)`\n\nFiles: internal/command/hook_prompt.go","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-31T08:01:09.723069-08:00","created_by":"adam","updated_at":"2025-12-31T10:33:01.300414-08:00","closed_at":"2025-12-31T10:33:01.300414-08:00","close_reason":"Implemented hook-statusline command, enhanced UserPromptSubmit with statusline, added SessionStart resume tickler, added PreCompact hook"}
{"id":"fray-be5y","title":"UX: Visual indicator for sidebar search mode","description":"After entering space to type/search in sidebar, change the view visually to show the mode has changed. Source: msg-7k7tw63y","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-02T00:26:39.783044-08:00","created_by":"adam","updated_at":"2026-01-02T00:26:39.783044-08:00"}
{"id":"fray-beb","title":"P7: Syntax Highlighting (P3 feature)","description":"Add Chroma-based syntax highlighting for code blocks. Port mlld TextMate grammar to Chroma lexer. Detect fenced code blocks, apply highlighting. ~8 hours.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T12:17:47.437229-08:00","updated_at":"2025-12-21T01:27:06.006305-08:00","closed_at":"2025-12-21T01:27:06.006305-08:00","close_reason":"Completed in Go rewrite","dependencies":[{"issue_id":"fray-beb","depends_on_id":"fray-m6c","type":"blocks","created_at":"2025-12-20T12:22:36.578322-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-bfj","title":"Poller plugin system for external event sources","description":"Add a plugin system for polling external systems and injecting messages into the mm room. Like webhooks but pull-based since there's no endpoint.\n\n## Design\n\n**Configuration** (in mm-config.json):\n```json\n{\n  \"pollers\": [\n    {\n      \"package\": \"mm-poller-beads\",\n      \"config\": {\n        \"path\": \".beads\"\n      }\n    },\n    {\n      \"package\": \"mm-poller-github\",\n      \"config\": {\n        \"repo\": \"adamavenir/mini-msg\",\n        \"events\": [\"issues\", \"pull_requests\"],\n        \"token_env\": \"GITHUB_TOKEN\"\n      },\n      \"interval\": 60000\n    }\n  ]\n}\n```\n\n**Polling triggers:**\n- Lazy: Any `mm` command runs all pollers once before executing\n- Active: `mm watch` / `mm chat` run pollers on interval in addition to lazy\n\n**Cursor storage** (.mm/poller-state.json):\n```json\n{\n  \"mm-poller-beads\": { \"cursor\": \"2025-12-19T10:30:00Z\", \"lastPoll\": 1734567890 },\n  \"mm-poller-github\": { \"cursor\": \"etag:abc123\", \"lastPoll\": 1734567850 }\n}\n```\n\n**Poller interface:**\n```typescript\nexport interface Poller {\n  name: string;\n  defaultInterval?: number;\n  poll(ctx: PollerContext): Promise\u003cPollResult\u003e;\n}\n\nexport interface PollerContext {\n  config: Record\u003cstring, unknown\u003e;\n  cursor: string | null;\n  projectPath: string;\n}\n\nexport interface PollResult {\n  messages: PollerMessage[];\n  cursor: string | null;\n}\n\nexport interface PollerMessage {\n  body: string;\n  mentions?: string[];\n  source?: string;        // e.g. \"github:issues/123\"\n}\n```\n\nmm creates messages with `from_agent: poller.name`, `type: 'event'`.\n\n## Implementation tasks\n- [ ] Define poller interface in src/pollers/types.ts\n- [ ] Add poller config schema to mm-config.json\n- [ ] Add poller-state.json read/write helpers\n- [ ] Create runPollers() function that loads and executes configured pollers\n- [ ] Call runPollers() lazily from shared.ts (before command execution)\n- [ ] Call runPollers() on interval in watch.ts and chat.ts\n- [ ] Create mm-poller-beads package (watches .beads/issues.jsonl)\n- [ ] Create mm-poller-github package (optional, example)","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-19T22:20:27.468386-08:00","updated_at":"2025-12-19T22:57:34.314768-08:00"}
{"id":"fray-bg2z","title":"Bug: fray thread missing --last/--since flags","description":"Thread command is missing --last and --since flags that work in other commands like 'fray get'. Error: 'unknown flag: --last'. Reported by adam: msg-j4f40b5u. Should be consistent with get/history commands.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-02T00:17:37.980413-08:00","created_by":"adam","updated_at":"2026-01-02T12:00:35.732048-08:00","closed_at":"2026-01-02T12:00:35.732048-08:00","close_reason":"Added --last and --since flags to fray thread command"}
{"id":"fray-bml","title":"Create directory structure and entry points","description":"Create the project directory structure and minimal entry point files.\n\n## Directory Structure\n```\nbeads-messenger/\n├── src/\n│   ├── cli.ts           # Commander program setup\n│   ├── commands/        # Command implementations (empty for now)\n│   ├── db/              # Database layer (empty for now)\n│   ├── core/            # Business logic (empty for now)\n│   └── types.ts         # Type definitions (placeholder)\n├── bin/\n│   └── bdm.ts           # CLI entry point (hashbang)\n├── tests/               # Test files (empty for now)\n├── package.json\n├── tsconfig.json\n└── tsup.config.ts\n```\n\n## Files to Create\n\n### bin/bdm.ts\n```typescript\n#!/usr/bin/env node\nimport { main } from '../src/cli.js';\nmain();\n```\n\n### src/cli.ts\nNote: Importing version from package.json is tricky with ESM. Use one of:\n- Read package.json with fs and JSON.parse\n- Hardcode version and update on release\n- Use a build-time replacement\n\nSimple approach for now:\n```typescript\nimport { Command } from 'commander';\n\nconst VERSION = '0.1.0';  // TODO: sync with package.json\n\nexport function main() {\n  const program = new Command();\n  program\n    .name('bdm')\n    .description('Agent messaging for beads projects')\n    .version(VERSION);\n  \n  program.parse();\n}\n```\n\n### src/types.ts\n```typescript\n// Placeholder - full types defined in bdm-6cj\nexport interface Agent {\n  agent_id: string;\n}\n\nexport interface Message {\n  id: number;\n}\n```\n\n### Empty directories\nCreate with .gitkeep or placeholder files:\n- src/commands/\n- src/db/\n- src/core/\n- tests/\n\n## Acceptance Criteria\n- `npm run build` completes successfully\n- `./dist/bin/bdm.js --version` outputs \"0.1.0\"\n- `./dist/bin/bdm.js --help` shows usage\n- All directories exist","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T09:56:48.142467-08:00","updated_at":"2025-12-19T22:57:34.309639-08:00","closed_at":"2025-12-04T12:14:03.391558-08:00","dependencies":[{"issue_id":"fray-bml","depends_on_id":"fray-kit","type":"parent-child","created_at":"2025-12-04T09:57:10.46725-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-bml","depends_on_id":"fray-3po","type":"blocks","created_at":"2025-12-04T09:57:24.695706-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-bml","depends_on_id":"fray-fr5","type":"blocks","created_at":"2025-12-04T09:57:29.816894-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-bsj","title":"Respect NO_COLOR env var in mention highlighting","description":"## Problem\n`highlightMentions()` always emits ANSI color codes (src/core/mentions.ts:50-55):\n\n```typescript\nexport function highlightMentions(body: string): string {\n  return body.replace(MENTION_REGEX, '\\x1b[36m@\\$1\\x1b[0m');\n}\n```\n\nShould respect the `NO_COLOR` environment variable standard (https://no-color.org/).\n\n## Fix\n```typescript\nexport function highlightMentions(body: string): string {\n  if (process.env.NO_COLOR) {\n    return body;  // No highlighting\n  }\n  return body.replace(MENTION_REGEX, '\\x1b[36m@\\$1\\x1b[0m');\n}\n```\n\nAlso consider:\n- Skipping colors when stdout is not a TTY (`!process.stdout.isTTY`)\n- Skipping colors in JSON mode (caller responsibility)\n\n## Files\n- src/core/mentions.ts:50-55\n\n## Acceptance Criteria\n- NO_COLOR=1 bdm ... produces no ANSI codes\n- Normal operation still has colored mentions","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-04T14:03:48.763263-08:00","updated_at":"2025-12-19T22:57:34.314568-08:00","closed_at":"2025-12-04T14:30:31.507019-08:00"}
{"id":"fray-bu0g","title":"Mention hierarchy and staleness display","description":"Redesign how fray displays @mentions to reduce agent context waste and anxiety.\n\n## Problem (msg-gb6ncace, msg-0swpzddy)\n\nAgents see '36 unread @mentions' and panic-query with --all, burning tokens on stale context. The current display:\n1. Doesn't distinguish direct address from FYI mentions\n2. Shows all unreads as equally urgent\n3. Suggests '--all' which triggers wasteful behavior\n\n## Design\n\n**Mention hierarchy** (three tiers):\n\n1. **Direct address** (@agent at message start)\n   - 'This message is FOR you'\n   - High priority, show full\n\n2. **FYI mention** (@agent mid-message)\n   - 'You should know about this'  \n   - Lower priority, labeled separately\n\n3. **Reply chain** (reply to your message)\n   - 'Someone responded to your work'\n   - Contextual, often stale\n\n**Time-based staleness**:\n- \u003c2h: Recent, show normally\n- \u003e2h: 'Likely stale' - just show count, no details\n\n**Display format** (msg-7sm3zxvh, msg-04l62ab5):\n```\nRecent @designer:\n  [msg-abc] adam: @designer can you review... (10m ago)\n  [msg-def] opus: @designer thoughts on... (1h ago)\n\nYou were FYI'd here:\n  [msg-ghi] opus: ...per @designer's earlier... (45m ago)\n\n3 likely stale (\u003e2h)\n```\n\n**Key principles** (msg-64gyv0m8):\n- No suggestions like 'use --all to show' - it's 'token gasoline'\n- Trust the system: if someone needs you, they'll ask again\n- The river flows by - what matters is notes + recent mentions\n\n## Implementation notes\n\n- Detect direct address: @mention at start of message body\n- Add timestamp to mention queries\n- Audit all CLI output for suggestion patterns that trigger wasteful queries\n\n## Source conversation\nRoom discussion: msg-gb6ncace through msg-04l62ab5","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-03T07:49:02.072406-08:00","created_by":"adam","updated_at":"2026-01-03T21:54:34.373265-08:00","closed_at":"2026-01-03T21:54:34.373265-08:00","close_reason":"Implemented mention hierarchy: direct address vs FYI vs reply detection, 2h staleness threshold, grouped display. Direct at message start, FYI mid-message, stale just shows count.","dependencies":[{"issue_id":"fray-bu0g","depends_on_id":"fray-0etk","type":"parent-child","created_at":"2026-01-03T21:21:51.192805-08:00","created_by":"adam"}]}
{"id":"fray-c0sc","title":"Chat: filter deleted messages from display","description":"The filterDeletedMessages helper was added to CLI commands (notes, thread, history, etc.) but the fray chat TUI still shows '[deleted]' placeholders for deleted messages.\n\nNeed to add filtering in the chat view rendering, similar to internal/chat/commands.go:155 check.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-31T23:38:06.530795-08:00","created_by":"adam","updated_at":"2025-12-31T23:54:50.26718-08:00","closed_at":"2025-12-31T23:54:50.26718-08:00","close_reason":"Fixed in chat bug batch: filtered deleted messages, fixed thread scroll bounce, added near-top preload, refactored answer to Bubble Tea TUI"}
{"id":"fray-caq","title":"Go: Add rm command","description":"Missing 'mm rm \u003cmsgid\u003e' command to delete messages.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-21T01:29:09.760585-08:00","updated_at":"2025-12-21T01:49:46.74208-08:00","closed_at":"2025-12-21T01:49:46.74208-08:00","close_reason":"Implemented in Go"}
{"id":"fray-cbcs","title":"Design: Room as coordination surface operational pattern","description":"Work through how 'threads as workspace, room as coordination surface' becomes an operational habit.\n\n## Design Complete (thrd-kw5z6vmu)\n\n### Core Insight\nThe solution is convention-based, not feature-based. No new commands needed. Clear conventions + prompt updates make existing primitives work.\n\n### Room Purpose\nRoom is ONLY for:\n- Standup reports (generated by /land)\n- Announcements (major completions)\n- Blocked notices\n\nEverything else goes in threads.\n\n### Key Decisions\n1. No `announce` command - `post` + conventions is enough\n2. No `peek` command - `get` doesn't subscribe, so it IS peek\n3. Thread assignment via `subscribe`/`sub`\n4. /land generates standup report for room\n5. Visibility = involvement (agents see threads they're assigned to)\n\n### Implementation\nTracked in child beads:\n- fray-l42t: Convention prompts (/fly, /land, standup format)\n- fray-a8h1: /hop command (quick session join)\n- fray-mzg8: Chat UX epic (sidebar, notifications)\n- fray-bu0g: Mention hierarchy (direct vs FYI vs stale)\n\nSee cbcs-design thread (thrd-kw5z6vmu) for full discussion.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-01T07:38:40.42983-08:00","created_by":"adam","updated_at":"2026-01-03T20:58:58.004719-08:00","closed_at":"2026-01-03T20:58:58.004719-08:00","close_reason":"Design complete. Convention-based approach: room = standups + announcements + blocked. Implementation tracked in child beads (fray-l42t, fray-a8h1, fray-mzg8, fray-bu0g).","labels":["discuss"],"dependencies":[{"issue_id":"fray-cbcs","depends_on_id":"fray-jlw8","type":"related","created_at":"2026-01-01T07:38:49.574934-08:00","created_by":"adam"}]}
{"id":"fray-cbt","title":"In-chat slash commands","description":"Bring CLI capabilities into the chat interface.\n\n```\n/ask @bob what's blocking?       # ask question\n/answer #qstn-xyz the thing      # answer question  \n/thread new research             # create thread\n/pin #abc123                     # pin message\n/alias #abc123 context           # create alias\n/neo                             # onboard with context dump\n```\n\nSlash commands parsed in chat input. Reduces context switching between chat and CLI.\n\n**Depends on**: Core features (alias, pin, neo) should exist first.","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-30T16:47:26.234814-08:00","created_by":"adam","updated_at":"2025-12-30T16:47:26.234814-08:00"}
{"id":"fray-cbu","title":"Go: Fix JSON output to use snake_case keys","description":"Go uses PascalCase (ID, TS, ChannelID) but TS uses snake_case (id, ts, channel_id). This breaks API compatibility.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-21T01:28:36.28564-08:00","updated_at":"2025-12-21T01:41:40.399971-08:00","closed_at":"2025-12-21T01:41:40.399971-08:00","close_reason":"Go JSON output now uses snake_case struct tags"}
{"id":"fray-cdwu","title":"Prompt bug: fray ask should include context in question display","description":"When using the answers tool/interface, context added via follow-up posts isn't visible. The ## Questions block creates the 'answers' interface, but questions should have full context attached rather than requiring readers to scroll up. Update prompts to make this clearer - questions should be self-contained.","status":"open","priority":1,"issue_type":"bug","created_at":"2026-01-01T20:31:46.228591-08:00","created_by":"adam","updated_at":"2026-01-06T12:37:23.910077-08:00"}
{"id":"fray-cfxv","title":"Saved views: named query presets","description":"DEFERRED TO v2. Named query presets.\n\n**Design note after fray-w6xh**: The 'fray view' command has been removed. If we implement saved views, we should use a different command name. Options:\n- fray preset create/list/run\n- fray saved create/list/run  \n- fray query create/list/run\n\nNot essential for MVP. See THREAD-CURATION-SPEC.md 'Deferred to v2' section.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-01T12:24:05.753405-08:00","created_by":"adam","updated_at":"2026-01-05T03:20:36.058683-08:00","closed_at":"2026-01-05T03:20:36.058683-08:00","close_reason":"Deferred to v2 - not needed for MVP. Named query presets are a nice-to-have.","dependencies":[{"issue_id":"fray-cfxv","depends_on_id":"fray-gz26","type":"parent-child","created_at":"2026-01-01T12:24:28.296695-08:00","created_by":"adam"}]}
{"id":"fray-co5","title":"Implement config command","description":"Implement the config command for viewing and setting configuration.\n\n## Usage\n\n```bash\nbdm config                       # show all config\nbdm config stale-hours           # show specific key\nbdm config stale-hours 8         # set value\n```\n\n## Available Config Keys\n\n| Key | Default | Description |\n|-----|---------|-------------|\n| stale_hours | 4 | Hours of inactivity before agent is stale |\n\n## Implementation\n\n### Show all config\n```bash\nbdm config\n```\n\nOutput:\n```\nstale_hours = 4\n```\n\n### Show specific key\n```bash\nbdm config stale-hours\n```\n\nOutput:\n```\nstale_hours = 4\n```\n\n### Set value\n```bash\nbdm config stale-hours 8\n```\n\nOutput:\n```\nstale_hours = 8 (was: 4)\n```\n\n## Key Name Normalization\n- Accept both `stale-hours` and `stale_hours`\n- Store with underscores internally\n- Display with underscores\n\n## Validation\n- stale_hours: must be positive integer\n- Unknown key: \"Unknown config key: foo\"\n\n## JSON Output\n\n```json\n{\n  \"stale_hours\": \"4\"\n}\n```\n\n## Files\n- src/commands/config.ts\n\n## Acceptance Criteria\n- Show all config works\n- Show specific key works\n- Set value works with validation\n- Key name normalization (hyphens to underscores)\n- Error on unknown keys","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T10:10:22.288019-08:00","updated_at":"2025-12-19T22:57:34.303229-08:00","closed_at":"2025-12-04T12:37:54.318274-08:00","dependencies":[{"issue_id":"fray-co5","depends_on_id":"fray-yh4","type":"parent-child","created_at":"2025-12-04T10:11:14.38319-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-co5","depends_on_id":"fray-2vy","type":"blocks","created_at":"2025-12-04T10:12:05.836053-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-co5","depends_on_id":"fray-oa5","type":"blocks","created_at":"2025-12-04T10:47:33.00824-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-cyq","title":"Add 'alias' command","description":"Create semantic aliases for messages/notes.\n\n```bash\nfray alias #abc123 context       # alias as 'context'\nfray alias #def456 handoff       # alias as 'handoff'\n```\n\nUsage:\n- `#alias` works anywhere (posts, replies, etc.)\n- In chat, shows truncated 'quote retweet' with first line + original ID\n- `#alias#` embeds the full message content\n\n**Agent namespacing rule**: Agent-created aliases are auto-prefixed with agent name (e.g. `opus.context`) unless `--no-prefix` flag. Prevents collisions while allowing users to create shared aliases like `#context`, `#handoff`.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-30T16:46:47.56964-08:00","created_by":"adam","updated_at":"2025-12-30T16:46:47.56964-08:00"}
{"id":"fray-d0b0","title":"Convention: require path for all fray post commands","description":"Change convention: instead of bare 'fray post' going to main, require 'fray post \u003cprojname\u003e' or 'fray post main'. No post without a path, ever.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-05T20:38:36.998812-08:00","created_by":"adam","updated_at":"2026-01-05T20:38:36.998812-08:00"}
{"id":"fray-d0i7","title":"Bug: fray edit command UX confusing","description":"From msg-99cira1j: The edit command interface is confusing:\n- `fray note --edit \u003cid\u003e` doesn't work (no --edit flag)\n- `fray edit \u003cid\u003e --as agent 'text'` errors with 'required flag message not set'\n- `fray edit \u003cid\u003e --as agent --message 'text'` errors with 'requires at least 2 args'\n\nShould simplify: `fray edit \u003cid\u003e 'new text' --as agent` or detect agent from env.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-04T20:42:51.536115-08:00","created_by":"adam","updated_at":"2026-01-06T03:41:12.894727-08:00","closed_at":"2026-01-06T03:41:12.894727-08:00","close_reason":"Fixed edit command UX: -m is now optional for humans (--as flag), required for agents (FRAY_AGENT_ID env). Also added FRAY_AGENT_ID fallback for --as flag. Updated help text to be clearer."}
{"id":"fray-d9y","title":"Add fray summary command","description":"Smart context dump when running `fray` with FRAY_AGENT_ID set, or `fray --as \u003cagent\u003e`.\n\nShould replace/enhance current `fray get` with more useful agent-aware summary.\n\nDesign pending - likely follows fray-poo (neo) design.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-31T08:01:18.485432-08:00","created_by":"adam","updated_at":"2025-12-31T08:01:18.485432-08:00","dependencies":[{"issue_id":"fray-d9y","depends_on_id":"fray-poo","type":"related","created_at":"2025-12-31T08:01:25.292603-08:00","created_by":"daemon"},{"issue_id":"fray-d9y","depends_on_id":"fray-qnd","type":"blocks","created_at":"2025-12-31T14:42:44.038847-08:00","created_by":"adam"}]}
{"id":"fray-dcev","title":"Thread sidebar header should show depth chevrons and click to go up","description":"When drilled into a thread, the header should show chevrons to the left indicating depth (e.g., \u003e\u003e for 2 levels deep). Clicking the header should navigate up one level.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-06T10:58:57.912288-08:00","created_by":"adam","updated_at":"2026-01-06T11:18:10.664085-08:00","closed_at":"2026-01-06T11:18:10.664085-08:00","close_reason":"Header now shows depth chevrons (❮❮ for 2 levels deep) and clicking the header drills out one level"}
{"id":"fray-dgt","title":"Implement message query functions","description":"Create query functions for message CRUD operations in src/db/queries.ts.\n\n## Functions to Implement\n\n```typescript\n// src/db/queries.ts (message functions)\n\nimport type { Message, MessageRow, MessageQueryOptions } from '../types.js';\nimport type Database from 'better-sqlite3';\n\n/**\n * Create a new message.\n * @param mentions - Pre-extracted mentions array (caller extracts from body)\n * @returns The created message with ID\n */\nexport function createMessage(\n  db: Database, \n  message: { from_agent: string; body: string; mentions: string[] }\n): Message;\n\n/**\n * Get messages with optional filtering.\n * Returns in chronological order (oldest first).\n */\nexport function getMessages(\n  db: Database, \n  options?: MessageQueryOptions\n): Message[];\n\n/**\n * Get messages where the given prefix is mentioned.\n * Uses prefix matching: @alice matches messages mentioning alice.1, alice.419, etc.\n * Also includes @all broadcasts.\n */\nexport function getMessagesWithMention(\n  db: Database, \n  mentionPrefix: string, \n  options?: MessageQueryOptions\n): Message[];\n\n/**\n * Get the last message ID.\n * Used for --since polling.\n * @returns 0 if no messages exist\n */\nexport function getLastMessageId(db: Database): number;\n\n/**\n * Convert MessageRow to Message (parse mentions JSON).\n */\nexport function parseMessageRow(row: MessageRow): Message;\n```\n\n## Implementation Notes\n- mentions are stored as JSON array in database\n- **Important**: Caller is responsible for extracting mentions from body before calling createMessage. The extractMentions() function is implemented later in Phase 3 (bdm-92p). For now, just accept mentions as a parameter.\n- Prefix matching for mentions: check if any mention starts with prefix\n- @all is stored literally and matched specially\n\n## Query for Mention Matching\n```sql\n-- For each message, check if any mention in the JSON array starts with prefix\n-- SQLite approach: use json_each to expand array\nSELECT * FROM bdm_messages \nWHERE id IN (\n  SELECT m.id FROM bdm_messages m, json_each(m.mentions) j\n  WHERE j.value = 'all' OR j.value LIKE ? || '%'\n)\nORDER BY id\nLIMIT ?\n```\n\n## Files\n- src/db/queries.ts (add message functions)\n\n## Acceptance Criteria\n- Messages are created with provided mentions array\n- Mention filtering uses prefix matching\n- @all broadcasts are always included\n- Pagination via limit/since works correctly\n- Unit tests for all functions","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T09:59:53.467278-08:00","updated_at":"2025-12-19T22:57:34.307137-08:00","closed_at":"2025-12-04T12:22:37.756841-08:00","dependencies":[{"issue_id":"fray-dgt","depends_on_id":"fray-08v","type":"parent-child","created_at":"2025-12-04T10:01:00.162331-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-dgt","depends_on_id":"fray-6cj","type":"blocks","created_at":"2025-12-04T10:01:38.661022-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-dgt","depends_on_id":"fray-1wj","type":"blocks","created_at":"2025-12-04T10:01:43.784959-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-dil","title":"P4: Multi-Channel Sidebar (P0 feature)","description":"Add IRC-style channel sidebar. Tab toggles visibility, Tab cycles focus when open, Esc returns to input. Channel list with j/k navigation, Enter to select. ~8 hours.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T12:17:31.894036-08:00","updated_at":"2025-12-21T01:35:04.917991-08:00","closed_at":"2025-12-21T01:35:04.917991-08:00","close_reason":"Implemented Bubbletea channel sidebar with toggle, focus, navigation, and switching","dependencies":[{"issue_id":"fray-dil","depends_on_id":"fray-m6c","type":"blocks","created_at":"2025-12-20T12:22:21.062727-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-dk4","title":"Phase 3: Core Logic","description":"Agent identity and mention parsing logic for bdm.\n\n## Goal\nCore business logic utilities for:\n- Agent ID parsing, validation, and formatting\n- @mention extraction and matching\n- Timestamp formatting for human-readable display\n\n## Context\nAgent IDs follow a hierarchical format with mandatory version suffix:\n- Format: `\u003crole\u003e[.\u003cqualifier\u003e]*.\u003csession_number\u003e`\n- Examples: `alice.1`, `alice.frontend.3`, `pm.5.sub.2`\n\n@mentions use prefix matching:\n- `@alice` matches alice.1, alice.419, alice.frontend.3\n- `@alice.4` matches alice.4, alice.4.sub.1\n- `@all` is a special broadcast\n\nSee PLAN.md \"Decision 4\" and \"Decision 5\" for full rationale.\n\n## Exit Criteria\n- Agent ID parsing handles all valid cases\n- Mention extraction works with various patterns\n- Relative time formatting is human-readable\n- Unit tests for all core functions","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-04T10:03:37.254737-08:00","updated_at":"2025-12-19T22:57:34.296343-08:00","closed_at":"2025-12-04T12:31:11.373478-08:00","dependencies":[{"issue_id":"fray-dk4","depends_on_id":"fray-08v","type":"blocks","created_at":"2025-12-04T10:07:18.617208-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-dkh","title":"P9: Polish \u0026 Testing","description":"Error handling, graceful degradation, config validation, documentation updates, cross-platform builds, version embedding. ~4 hours.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T12:17:57.814501-08:00","updated_at":"2025-12-21T15:54:51.48262-08:00","closed_at":"2025-12-21T15:54:51.48262-08:00","close_reason":"Implemented in Go rewrite","dependencies":[{"issue_id":"fray-dkh","depends_on_id":"fray-dil","type":"blocks","created_at":"2025-12-20T12:22:46.925074-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-dkh","depends_on_id":"fray-6fx","type":"blocks","created_at":"2025-12-20T12:22:52.100511-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-dkh","depends_on_id":"fray-n7d","type":"blocks","created_at":"2025-12-20T12:22:57.274081-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-dkh","depends_on_id":"fray-beb","type":"blocks","created_at":"2025-12-20T12:23:02.443356-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-dkh","depends_on_id":"fray-0vz","type":"blocks","created_at":"2025-12-20T12:23:07.612555-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-dlvh","title":"Faves: subscribe to threads, collect messages","description":"Fave threads or messages (personal collection). Faving a thread = subscribe + add to sidebar. Faving a message = collect for later. fray fave/unfave, fray faves --as alice. Note: fave subscribes but unfave does NOT unsubscribe (use mute for that). See THREAD-CURATION-SPEC.md Phase 3.\n\n## Updates from cbcs-design discussion (thrd-kw5z6vmu)\n\n**Nickname support** (msg-tqhe0jx7, msg-gxh3yzcl):\n- `/fave \u003cid\u003e \u003cnick\u003e` - fave with custom nickname\n- Or prompt for nickname when faving\n- Nicknames make long thread paths navigable: `gz26-curation/design-dua7-anchors` → `anchors`\n\n**Sidebar sorting** (msg-tqhe0jx7):\n- Faves float to top of sidebar (or separate 'Favorites' section)\n- All threads listed (no hidden ones) - faves just sort higher\n- Enables quick access to active work","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-01-01T12:23:37.055028-08:00","created_by":"adam","updated_at":"2026-01-03T23:07:56.054315-08:00","closed_at":"2026-01-03T23:07:56.054315-08:00","close_reason":"Implemented faves feature:\n- Added fray_faves table to SQLite schema\n- Added agent_fave/agent_unfave JSONL record types\n- Implemented fray fave command (with implicit thread subscription)\n- Implemented fray unfave command (does NOT unsubscribe)\n- Implemented fray faves listing command with --threads/--messages filters\n- Added rebuild support for faves from JSONL\n- Updated CLAUDE.md with fave commands","dependencies":[{"issue_id":"fray-dlvh","depends_on_id":"fray-gz26","type":"parent-child","created_at":"2026-01-01T12:24:28.059005-08:00","created_by":"adam"}]}
{"id":"fray-dro","title":"mm @agent: show activity summary and claims hint","description":"When running mm @agent, after showing mentions, display a summary to help agents catch up:\n\n---\nX messages since you last posted (from @bob, @charlie)\nActive claims: @bob (src/auth.ts), @pm (docs/)\nRun 'mm get \u003cagent\u003e' to catch up\n\nThis nudges agents toward the right command and shows claim awareness without changing core behavior.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-22T12:34:24.19896-08:00","updated_at":"2025-12-22T12:37:46.009347-08:00","closed_at":"2025-12-22T12:37:46.009347-08:00","close_reason":"Implemented activity summary with messages since last post, unique senders, and active claims"}
{"id":"fray-drt4","title":"Default DM thread per agent","description":"Each agent should have a single thread created by default that contains the agent and the user - essentially a DM between user and agent","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-02T11:51:22.15459-08:00","created_by":"adam","updated_at":"2026-01-06T12:37:37.703445-08:00","closed_at":"2026-01-06T12:37:37.703445-08:00","close_reason":"Not needed - removed from roadmap"}
{"id":"fray-dua7","title":"Thread anchors: anchor messages with opt-out hiding","description":"Threads have anchor_message_guid (TL;DR) and anchor_hidden flag. fray thread anchor sets/updates anchor. anchor_hidden controls visibility in parent thread (default false, true for meta/agent-notes). Room is container without anchor. Note: explicit anchor creation only, no auto-generation. See THREAD-CURATION-SPEC.md Phase 1.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-01T12:23:24.433752-08:00","created_by":"adam","updated_at":"2026-01-02T00:26:33.732949-08:00","closed_at":"2026-01-02T00:26:33.732949-08:00","close_reason":"Implemented: thread anchor command, anchor_message_guid/anchor_hidden fields, thread display shows anchor at top","dependencies":[{"issue_id":"fray-dua7","depends_on_id":"fray-gz26","type":"parent-child","created_at":"2026-01-01T12:24:27.98615-08:00","created_by":"adam"}]}
{"id":"fray-dvn","title":"P0.3: SQLite rebuild from JSONL","description":"Implement SQLite rebuild from JSONL on startup (beads-style staleness detection).\n\nImplementation:\n- Check JSONL mtime vs SQLite mtime on db connection\n- If JSONL newer or SQLite missing: rebuild from JSONL\n- Read messages.jsonl, agents.jsonl, .mm/mm-config.json\n- Drop and recreate tables, insert all records\n- Update .mm/.gitignore to ignore *.db, *.db-wal, *.db-shm\n\nStaleness check:\n- Compare max(messages.jsonl mtime, agents.jsonl mtime) vs mm.db mtime\n- Log: \"Rebuilding SQLite from JSONL (stale database)\"\n\nReferences: PLAN.md section 2, beads staleness detection\nCritical files: src/db/schema.ts, src/db/jsonl.ts, .mm/.gitignore","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-19T11:57:09.444343-08:00","updated_at":"2025-12-19T22:57:34.293117-08:00","closed_at":"2025-12-19T14:17:02.539391-08:00","close_reason":"Added JSONL staleness rebuild, DB rebuild from JSONL, and .mm gitignore","dependencies":[{"issue_id":"fray-dvn","depends_on_id":"fray-3vp","type":"blocks","created_at":"2025-12-19T11:57:45.361823-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-dx8m","title":"Feature: fray react command (syntactic sugar)","description":"Add 'fray react \u003cmsg\u003e \u003cemoji\u003e --as \u003cagent\u003e' as syntactic sugar for 'fray post --reply-to \u003cmsg\u003e \u003cemoji\u003e --as \u003cagent\u003e'. More discoverable and clearer intent. Example: fray react msg-abc123 👍 --as architect","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-02T00:30:02.945148-08:00","created_by":"adam","updated_at":"2026-01-02T00:30:02.945148-08:00"}
{"id":"fray-dym","title":"Rename agent goal/bio to status/purpose","description":"Rename goal to status and bio to purpose for clarity. Update mm new flags to --status and --purpose.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-20T16:16:06.01408-08:00","updated_at":"2025-12-20T16:26:40.551136-08:00","closed_at":"2025-12-20T16:26:40.551136-08:00","close_reason":"Closed"}
{"id":"fray-e01","title":"Go: Add back command","description":"Missing 'mm back \u003cagent\u003e' command to rejoin as previous agent.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-21T01:28:59.016584-08:00","updated_at":"2025-12-21T01:49:46.74026-08:00","closed_at":"2025-12-21T01:49:46.74026-08:00","close_reason":"Implemented in Go"}
{"id":"fray-e7ow","title":"Bug: fray post in thread doesn't show unread @mentions","description":"When posting to a thread with --thread flag, the command should return unread @mentions like it does for room posts. Currently it only returns the message ID. This caused @opus to miss @adam's question in the review thread.\n\nShould also show chained replies to the posted message's parent chain - if someone replied to a message you're replying to, you should see that context.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-01T20:38:55.938469-08:00","created_by":"adam","updated_at":"2026-01-03T07:01:59.183622-08:00","closed_at":"2026-01-03T07:01:59.183622-08:00","close_reason":"Fixed: post now checks mentions from all homes (threads included) and includes chained replies. Added ghost cursor session-aware unread logic."}
{"id":"fray-ebf","title":"Fix bdm watch --last 0 showing all history","description":"Running bdm watch --last 0 should skip history and only stream new messages, but it shows all history first.\n\n## Bug\n\nWhen running bdm watch --last 0:\n1. Shows 0 messages from history (correct)\n2. Sets lastMessageId = 0 (because recent.length === 0)\n3. Starts polling with since: 0\n4. Queries since: 0 returns ALL messages in database\n5. Floods output with entire history\n\n## Expected Behavior\n\nbdm watch --last 0 should:\n1. Skip showing any history\n2. Set lastMessageId to current max message ID\n3. Only show NEW messages that arrive after the command starts\n\n## Fix\n\nIn src/commands/watch.ts around line 26-45:\n\n```typescript\n// Get last message ID - if --last 0, skip to current\nlet lastMessageId = 0;\nconst lastN = parseInt(options.last, 10);\n\nif (lastN === 0) {\n  // Skip history, start from current\n  const maxId = getLastMessageId(db);\n  lastMessageId = maxId;\n} else {\n  // Show recent context first\n  const recent = getMessages(db, { limit: lastN });\n  if (recent.length \u003e 0) {\n    // ... display messages ...\n    lastMessageId = recent[recent.length - 1].id;\n  }\n}\n```\n\n## Files\n\n- src/commands/watch.ts - Fix initialization of lastMessageId when --last 0","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-09T06:14:53.848443-08:00","updated_at":"2025-12-19T22:57:34.294095-08:00","closed_at":"2025-12-09T06:23:24.938312-08:00"}
{"id":"fray-eeor","title":"Pins: mark essential messages within threads","description":"Pin messages within threads. fray pin/unpin commands. Pins are per-thread (message can be pinned in one thread but not another). Any agent can unpin. pinned_by tracks attribution. fray thread X --pinned shows only pinned. See THREAD-CURATION-SPEC.md Phase 1.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-01T12:23:36.787269-08:00","created_by":"adam","updated_at":"2026-01-02T00:26:33.850068-08:00","closed_at":"2026-01-02T00:26:33.850068-08:00","close_reason":"Implemented: fray pin/unpin commands, fray_message_pins table, JSONL records","dependencies":[{"issue_id":"fray-eeor","depends_on_id":"fray-gz26","type":"parent-child","created_at":"2026-01-01T12:24:28.011618-08:00","created_by":"adam"}]}
{"id":"fray-eg1q","title":"Chat: /thread and /subthread commands for creating threads","description":"Allow creating threads directly from chat:\n- `/thread name-of-thread \"anchor message\"` (or `/t`) to create a global thread\n- `/subthread name-of-thread \"anchor\"` (or `/st`) to create a subthread of the current thread\n\nFrom: #msg-0d2e0oab","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-06T15:20:27.66185-08:00","created_by":"adam","updated_at":"2026-01-06T15:20:36.283277-08:00","labels":["discuss"]}
{"id":"fray-eg25","title":"Decompose chat/model.go into focused modules","description":"chat/model.go is 2966 lines handling 10+ UI subsystems. Split into: model.go (core), model_update.go, model_view.go, messages.go, suggestions.go, panels.go, questions.go, viewport.go, colors.go, layout.go, input.go. Each file \u003c300 lines with single responsibility.","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-31T23:53:30.767432-08:00","created_by":"adam","updated_at":"2026-01-01T00:33:39.293041-08:00","closed_at":"2026-01-01T00:33:39.293041-08:00","close_reason":"Phase 1 complete. model.go reduced from 2966 to 738 lines (75% reduction). 8 files extracted."}
{"id":"fray-egc","title":"Update .gitignore to exclude development files","description":"Add .mm/, PLAN*.md, RESEARCH*.md, .claude/settings.local.json to .gitignore","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T19:55:17.227921-08:00","updated_at":"2025-12-19T22:57:34.300554-08:00","closed_at":"2025-12-17T19:57:10.228079-08:00","close_reason":"Closed"}
{"id":"fray-egq3","title":"Answer input: move prompt below question","description":"In fray answer interactive mode, the input prompt should be on a separate line below the question/options display, giving a fresh writing space rather than inline after the prompt text.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-31T17:47:13.669462-08:00","created_by":"adam","updated_at":"2025-12-31T17:47:13.669462-08:00"}
{"id":"fray-eog","title":"Update LICENSE copyright","description":"Update copyright year and add author name to LICENSE file","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T19:55:18.265004-08:00","updated_at":"2025-12-19T22:57:34.311496-08:00","closed_at":"2025-12-17T19:58:14.223377-08:00","close_reason":"Closed"}
{"id":"fray-ep0","title":"Silence system messages by default","description":"System messages (beads issue events) are flooding chat and causing noise.\n\n## Problem\n\nRunning `bdm watch` triggers a flood of system messages about issue status changes, which then appear in `bdm chat`. These messages clutter the conversation and make it hard to follow agent-to-agent communication.\n\nExample spam:\n```\n[#party #party-3f5]  @system:\nupdate: _party-3f5 status_changed_\n```\n\n## Solution\n\n**Default behavior**: Silence system messages in all modes (get, chat, watch, @mentions)\n\n**Opt-in**: Add `--show-updates` flag to display system messages when explicitly requested\n\n```bash\nbdm chat --show-updates      # Show system messages\nbdm watch --show-updates     # Include events\nbdm get alice.1 --show-updates  # Show events in combined view\n```\n\n## Implementation\n\n- Add `exclude_events` parameter to message queries (default: true)\n- Update all commands to respect this flag\n- Add `--show-updates` option to: chat, watch, get, @mentions commands\n\n## Follow-up\n\nCreate a separate card to revisit event notification design - we may want smarter filtering (e.g., only show events for issues mentioned in conversation).\n\n## Files\n\n- src/db/queries.ts - Add exclude_events to getMessages query\n- src/commands/chat.ts - Add --show-updates flag\n- src/commands/watch.ts - Add --show-updates flag, default exclude events\n- src/commands/get.ts - Add --show-updates flag\n- src/commands/mentions.ts - Add --show-updates flag","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-09T06:12:02.890916-08:00","updated_at":"2025-12-19T22:57:34.29436-08:00","closed_at":"2025-12-09T06:23:24.902711-08:00"}
{"id":"fray-ex1","title":"Prompt: Better agent onboarding for reply chains and threading","description":"Agents aren't threading replies effectively. Need better onboarding about --reply-to and when to create threads. See msg-j1a4fspw for context.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T14:52:14.128959-08:00","created_by":"adam","updated_at":"2026-01-02T09:37:42.6166-08:00","closed_at":"2026-01-02T09:37:42.6166-08:00","close_reason":"Added reply chain and threading guidance to fray-beads/SKILL.md and fly.md"}
{"id":"fray-eya","title":"Bug: prune --all doesn't prune all, leaves 20","description":"Current behavior:\n- --all leaves last 20 messages (should prune ALL)\n- Default keeps 100 messages\n\nExpected behavior:\n- --all should prune ALL messages (0 remaining)\n- Default should keep last 20 (not 100)","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-21T10:56:33.792706-08:00","updated_at":"2025-12-21T17:04:12.154598-08:00","closed_at":"2025-12-21T17:04:12.154598-08:00","close_reason":"Implemented"}
{"id":"fray-f296","title":"Bug: fray @agent misses mentions in thread messages","description":"fray @architect shows 'No unread mentions' but there are @architect mentions in thread messages (e.g., msg-wo3fktk5 in thrd-r3z3e4gk). The mentions query seems to only check room messages, not thread messages.\n\nRelated: fray-e7ow (post output), but this is the read side.","status":"closed","priority":2,"issue_type":"bug","assignee":"opus","created_at":"2026-01-01T23:18:29.626669-08:00","created_by":"adam","updated_at":"2026-01-02T08:30:58.471364-08:00","closed_at":"2026-01-02T08:30:58.471364-08:00","close_reason":"Fixed: history now works for users, mentions include threads, double-enter bug fixed by not consuming Enter after suggestion apply"}
{"id":"fray-fr5","title":"Set up project dependencies","description":"Install and configure all required dependencies for bdm.\n\n## Runtime Dependencies\n- better-sqlite3: Synchronous SQLite3 bindings for Node.js\n- commander: CLI framework for argument parsing\n\n## Dev Dependencies\n- typescript: TypeScript compiler\n- tsup: Fast TypeScript bundler\n- vitest: Test framework\n- @types/better-sqlite3: Type definitions\n- @types/node: Node.js type definitions\n\n## Optional (defer if not needed)\n- chalk: Terminal colors (respect NO_COLOR env var)\n\n## Tasks\n1. Run npm install for each dependency\n2. Verify better-sqlite3 compiles native bindings successfully\n3. Verify TypeScript recognizes all type definitions\n\n## Notes\n- better-sqlite3 requires native compilation - ensure build tools available\n- Use exact versions in package.json for reproducibility\n\n## Acceptance Criteria\n- All dependencies install without errors\n- `import Database from 'better-sqlite3'` compiles\n- `import { Command } from 'commander'` compiles","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T09:56:29.176972-08:00","updated_at":"2025-12-19T22:57:34.309973-08:00","closed_at":"2025-12-04T12:14:03.390899-08:00","dependencies":[{"issue_id":"fray-fr5","depends_on_id":"fray-kit","type":"parent-child","created_at":"2025-12-04T09:57:05.341912-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-fr5","depends_on_id":"fray-3po","type":"blocks","created_at":"2025-12-04T09:57:19.576357-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-frz","title":"Handling long messages in fray chat","description":"**Needs design revisit** given new TUI capabilities.\n\nOriginal scope:\n1. Give more acceptable line length for `fray chat` than for agents. Keep as-is for agents, but set to something huge like 500 lines for users.\n2. Give user some way of showing the rest of the message -- either via command, keyboard shortcut, or rewriting full history in view.\n\nNew considerations:\n- Thread view vs room view behavior\n- Interaction with message expansion/collapse\n- Mobile-friendly truncation?\n- How does this work with structured message display?\n\nFirst step: Design session to clarify UX.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-09T19:04:34.609119-08:00","updated_at":"2025-12-30T16:47:25.854687-08:00","labels":["creator:adamavenir@hey.com","feature"]}
{"id":"fray-g276","title":"Bug: up-to-edit broken with -m parameter","description":"The up-to-edit feature (pressing up to edit last message) is currently broken, likely due to now taking a -m parameter for edits.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-01T21:00:57.19116-08:00","created_by":"adam","updated_at":"2026-01-06T17:22:59.308368-08:00","closed_at":"2026-01-06T17:22:59.308368-08:00","close_reason":"Fixed: prefill now includes default reason 'edit' so up-arrow + enter works immediately"}
{"id":"fray-g5e","title":"Implement lifecycle commands (new, hi, bye)","description":"Create lifecycle commands for agent session management.\n\n## Commands\n\n### bdm new \u003cname\u003e\nCreate a new agent session with auto-incremented version.\n\n```bash\nbdm new alice                    # → alice.1 (or alice.N+1)\nbdm new alice --goal \"...\"       # with goal\nbdm new alice --bio \"...\"        # with bio\n```\n\n**Implementation:**\n1. Parse and validate base name\n2. Query getMaxVersion(db, base) to find highest version\n3. Create agent with version = max + 1\n4. Set registered_at and last_seen to now()\n5. Output: \"Registered as alice.N\"\n\n### bdm hi \u003cagent.N\u003e\nResume a previous session (clear left_at, update last_seen).\n\n```bash\nbdm hi alice.419\n```\n\n**Implementation:**\n1. Parse and validate full agent ID\n2. Verify agent exists\n3. Update: left_at = NULL, last_seen = now()\n4. Output: \"Welcome back, alice.419\"\n\n**Error cases:**\n- Agent doesn't exist: \"Unknown agent: alice.419\"\n- Agent never left: \"alice.419 is already active\"\n\n### bdm bye \u003cagent.N\u003e\nLeave the session (set left_at).\n\n```bash\nbdm bye alice.419\n```\n\n**Implementation:**\n1. Parse and validate full agent ID\n2. Verify agent exists and is active\n3. Update: left_at = now()\n4. Output: \"Goodbye, alice.419\"\n\n**Error cases:**\n- Agent doesn't exist: \"Unknown agent: alice.419\"\n- Agent already left: \"alice.419 has already left\"\n\n## Files\n- src/commands/new.ts\n- src/commands/hi.ts\n- src/commands/bye.ts\n\n## Acceptance Criteria\n- new creates agent with correct version\n- hi reactivates agent\n- bye marks agent as left\n- Clear error messages for all failure cases\n- Integration test for full lifecycle","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T10:08:21.729327-08:00","updated_at":"2025-12-19T22:57:34.305261-08:00","closed_at":"2025-12-04T12:37:29.60012-08:00","dependencies":[{"issue_id":"fray-g5e","depends_on_id":"fray-yh4","type":"parent-child","created_at":"2025-12-04T10:10:38.505506-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-g5e","depends_on_id":"fray-2vy","type":"blocks","created_at":"2025-12-04T10:11:29.975136-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-g5e","depends_on_id":"fray-xpd","type":"blocks","created_at":"2025-12-04T10:46:29.940376-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-g5e","depends_on_id":"fray-6u7","type":"blocks","created_at":"2025-12-04T10:58:21.183265-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-g9n8","title":"Bug: fray history doesn't work for users (only agents)","description":"Running 'fray history adam' returns 'agent not found: adam' even though adam is a registered user. Should be able to search message history for users too, not just agents. Source: architect session trying to find @adam's bug reports.","status":"closed","priority":2,"issue_type":"bug","assignee":"opus","created_at":"2026-01-02T00:30:02.807361-08:00","created_by":"adam","updated_at":"2026-01-02T08:30:58.469885-08:00","closed_at":"2026-01-02T08:30:58.469885-08:00","close_reason":"Fixed: history now works for users, mentions include threads, double-enter bug fixed by not consuming Enter after suggestion apply"}
{"id":"fray-gcr","title":"Add batch-update command for bulk agent management","description":"Add 'mm batch-update' command that accepts JSON to batch register/update agents.\n\nUsage:\n  mm batch-update --file agents.json\n  echo '{...}' | mm batch-update\n\nJSON shape:\n{\n  \"agents\": [\n    {\n      \"agent_id\": \"devrel\",\n      \"status\": \"working on docs\",\n      \"purpose\": \"developer relations\",\n      \"nicks\": [\"dr\", \"devrel-alias\"]\n    }\n  ]\n}\n\nBehavior:\n- Agent exists → update status/purpose/nicks (only fields provided)\n- Agent doesn't exist → register it\n- Never deletes\n\nReturns summary:\n{\"created\": 2, \"updated\": 1, \"unchanged\": 0}","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-21T13:30:37.154806-08:00","updated_at":"2025-12-21T15:54:51.482958-08:00","closed_at":"2025-12-21T15:54:51.482958-08:00","close_reason":"Implemented in Go rewrite"}
{"id":"fray-gju8","title":"Reflections: role-based insights","description":"Design for role-based reflections and async agent notes.\n\n## Source Discussion\ngju8-design thread (thrd-54hilwmi)\n\n## Design Decisions\n\n### Reflections (was: journals)\n\n**Command:**\n```\nfray reflect \"insight\" --as opus --role architect\nfray reflect \"insight\" --as opus --role architect,reviewer\n```\n\n**Key decisions (msg-5gci0gb0, msg-lqdfif0x):**\n- Called `reflect` not `journal`\n- Role required (not agent-based)\n- Multiple roles OK\n- Atomic insights (one per message) for individual reactions\n- Goes to `roles/{role}/learnings`\n\n**Viewing:**\n```\nfray reflections                    # all roles, recent\nfray reflections --role architect   # architect learnings\nfray reflections --top 10           # by reaction count\n```\n\n**/fly injection:** Top 10 reflections by reactions for agent's held roles.\n\n### Async Notes (msg-3s6izq84, msg-nrs17rdi)\n\n**Command:**\n```\nfray note \"Review auth when you're back\" --to opus --as designer\n```\n\n**Key decisions:**\n- Lands in target agent's notes\n- Attributed: 'From @sender'\n- NO notification, NO wake-up\n- Discovered on /fly or `fray notes`\n- Async counterpart to @mention: @mention = 'hey now', note --to = 'hey whenever'\n\n## Related\n- fray-wl5n: Roles as first-class concept (hold/play/drop)\n- fray-adj6: Knowledge thread hierarchy (roles/{role}/learnings)\n- fray-1mch: Roles \u0026 Knowledge System epic","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-01T07:26:27.314565-08:00","created_by":"adam","updated_at":"2026-01-03T21:18:06.543412-08:00","closed_at":"2026-01-03T21:18:06.543412-08:00","close_reason":"Design complete. Reflections are role-based (fray reflect), async notes via (fray note --to). See gju8-design thread for full discussion.","labels":["discuss"],"dependencies":[{"issue_id":"fray-gju8","depends_on_id":"fray-1mch","type":"parent-child","created_at":"2026-01-03T21:09:19.170157-08:00","created_by":"adam"}]}
{"id":"fray-gllz","title":"Chat: breadcrumb nav at bottom shows full path","description":"Replace `#fray #main` at bottom of chat with full breadcrumb based on current location:\n\n```\nfray ❯ parent-name ❯ current-thread-name\n```\n\nShould update as user navigates thread hierarchy.","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-01-06T12:55:22.720185-08:00","created_by":"adam","updated_at":"2026-01-06T13:25:19.511878-08:00","closed_at":"2026-01-06T13:25:19.511878-08:00","close_reason":"Status line now shows breadcrumb format: channel ❯ parent ❯ thread (e.g., 'fray ❯ opus ❯ notes')","dependencies":[{"issue_id":"fray-gllz","depends_on_id":"fray-a5hc","type":"parent-child","created_at":"2026-01-06T13:18:45.136915-08:00","created_by":"adam"}]}
{"id":"fray-gnpg","title":"fray daemon implementation","description":"Watch @mentions, spawn agents, track process state, update presence.\n\n## Schema (implemented in fray-7w5d)\n- Types: `internal/types/types.go` - PresenceState, InvokeConfig, SessionStart/End/Heartbeat\n- JSONL: `internal/db/jsonl_append.go` - AppendSessionStart, AppendSessionEnd, AppendSessionHeartbeat\n- SQLite: `internal/db/schema.go` - fray_agent_sessions table\n\n## Core Loop\n1. Watch messages.jsonl for @mentions of managed agents\n2. Filter: ignore self-mentions, debounce if already spawning\n3. Spawn via driver (stdin/tempfile prompt delivery)\n4. Track process state → update presence\n5. Emit session events via AppendSession* functions\n\n## Lock File\n`.fray/daemon.lock` contains:\n- PID of running daemon\n- Timestamp of start\n- On startup: detect stale locks (PID not running) and clear\n\n## Presence Detection\nUse PresenceState constants from types.go:\n- `spawning`: process started, no activity yet\n- `active`: network I/O or CPU activity detected\n- `idle`: process exited cleanly\n- `error`: spawned but no activity (inferred failure)\n- `offline`: not managed or daemon not running\n\n## Wake Prompts\n- Resume: 'check fray, you've been @'d' + msg IDs + thread\n- Fresh: /fly equivalent\n\n## Exit Criteria\n- Daemon runs and watches mentions\n- Lock file prevents multiple daemons\n- Presence updates correctly\n- Session events persisted to agents.jsonl\n- Graceful shutdown clears lock\n\nReferences: msg-fginuidn (decisions), msg-bcmo1102 (architect feedback)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-01T22:45:17.084334-08:00","created_by":"adam","updated_at":"2026-01-02T01:19:16.592298-08:00","closed_at":"2026-01-02T01:19:16.592298-08:00","close_reason":"Implemented in internal/daemon/*.go. Passed 6 rounds of @gpt52 review (thrd-4oikeoie). Ready for commit.","dependencies":[{"issue_id":"fray-gnpg","depends_on_id":"fray-7w5d","type":"blocks","created_at":"2026-01-01T22:45:24.495879-08:00","created_by":"adam"},{"issue_id":"fray-gnpg","depends_on_id":"fray-24yf","type":"blocks","created_at":"2026-01-01T22:45:24.518751-08:00","created_by":"adam"},{"issue_id":"fray-gnpg","depends_on_id":"fray-y5za","type":"blocks","created_at":"2026-01-01T23:14:40.635852-08:00","created_by":"adam"},{"issue_id":"fray-gnpg","depends_on_id":"fray-upb9","type":"blocks","created_at":"2026-01-01T23:14:40.663306-08:00","created_by":"adam"},{"issue_id":"fray-gnpg","depends_on_id":"fray-szq4","type":"blocks","created_at":"2026-01-01T23:19:57.415976-08:00","created_by":"adam"}]}
{"id":"fray-guc","title":"QA: Compare TS vs Go implementation gaps","description":"Compared TS and Go mm implementations. See docs/go-ts-gap-analysis.md for full report. Key findings: 12 missing commands, critical JSON casing difference.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T01:23:13.528035-08:00","updated_at":"2025-12-21T01:28:22.535445-08:00","closed_at":"2025-12-21T01:28:22.535445-08:00","close_reason":"QA complete. Gap analysis documented in docs/go-ts-gap-analysis.md"}
{"id":"fray-gusm","title":"Decouple from 'beads' branding - agnostic issue resolver","description":"Review how tightly coupled we are to 'beads' as issue tracker.\n\n## Goal\nMake fray agnostic to issue tracking system. Support:\n- `bd:\u003cid\u003e` - beads\n- `gh:\u003cid\u003e` - github issues  \n- `linear:\u003cid\u003e` - linear\n- etc.\n\n## Current State\nCheck where we reference beads specifically:\n- Claims: `--bd` flag\n- CLAUDE.md references\n- Any hardcoded assumptions\n\n## Design\nCreate a namespace resolver system:\n- `fray resolver add bd \"bd show {id}\"`\n- `fray resolver add gh \"gh issue view {id}\"`\n\nThen neo/answers can pipeline issue context without coupling to any one system.\n\n## Questions\n- Should we rename `--bd` to `--issue` with namespace prefix?\n- How to handle issue metadata (title, status) from different systems?","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-05T11:44:29.588031-08:00","created_by":"adam","updated_at":"2026-01-06T12:37:23.907568-08:00"}
{"id":"fray-gwg6","title":"UX: Click textarea to close sidebar","description":"When sidebar is open, clicking in textarea should close sidebar and return focus to typing. Source: msg-zivqlnja","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-02T00:26:25.931263-08:00","created_by":"adam","updated_at":"2026-01-02T00:26:25.931263-08:00"}
{"id":"fray-gz26","title":"Thread Curation System","description":"Comprehensive thread curation: anchors, pins, faves, mute, rehome, add-to-thread, quotes, reactions improvements, 4-level nesting, filters/views. Enables 'threads as workspace, room as coordination surface' pattern and reaction-based knowledge curation.\n\n## Status\nCore curation mechanics complete (10/16 children closed). Remaining 6 are P2 filter/view features.\n\n**Revisit after fray-w6xh (command simplification) lands** - the new `fray get` model may affect how filters/views are implemented.","status":"closed","priority":0,"issue_type":"epic","created_at":"2026-01-01T12:23:15.761387-08:00","created_by":"adam","updated_at":"2026-01-05T03:20:42.336692-08:00","closed_at":"2026-01-05T03:20:42.336692-08:00","close_reason":"Thread Curation System complete. All 16 children closed. Implemented: anchors, pins, faves, mute, move, add-to-thread, quotes, reactions, nesting, filters/views, tree display, mention hierarchy."}
{"id":"fray-h03","title":"Add mm destroy \u003cchannel\u003e to delete channel entirely","description":"mm destroy \u003cchannel\u003e should:\n- Remove the entry from global config (~/.config/mm/mm-config.json)\n- Delete the .mm/ directory for that channel\n\nRequires N/y confirmation (default No) with clear warning that this is irreversible and destroys all messages/history. Use --force to skip confirmation.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-21T10:51:34.105328-08:00","updated_at":"2025-12-21T17:04:12.155465-08:00","closed_at":"2025-12-21T17:04:12.155465-08:00","close_reason":"Implemented"}
{"id":"fray-h3hx","title":"Extract chat/viewport.go from model.go","description":"Extract viewport management: pollCmd(), refreshViewport(), loadOlderMessages(), currentMessages(), filterNewMessages(), refreshThreadMessages(). Polling constants + pollMsg type. ~200 lines.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-01T00:07:01.740394-08:00","created_by":"adam","updated_at":"2026-01-01T00:21:38.547629-08:00","closed_at":"2026-01-01T00:21:38.547629-08:00","close_reason":"Extracted viewport.go (225 lines). model.go 2254→2040.","dependencies":[{"issue_id":"fray-h3hx","depends_on_id":"fray-kd0g","type":"blocks","created_at":"2026-01-01T00:07:10.20502-08:00","created_by":"adam"}]}
{"id":"fray-h3jy","title":"fray answer: shortcut to show full question post context","description":"Add a keyboard shortcut in fray answer TUI to expand and show the full original post containing the question, for full context.","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-06T10:58:59.321958-08:00","created_by":"adam","updated_at":"2026-01-06T10:58:59.321958-08:00"}
{"id":"fray-hgaq","title":"Update fray-gz26 children to align with THREAD-CURATION-SPEC.md","description":"Several children of fray-gz26 need description updates to match final spec:\n- fray-50na: Now 'Pin threads (public) + Fave threads (personal)'\n- fray-jlw8: Now 'Move messages (mv)' not rehome\n- fray-oww1: Now 'Agent views (extend fray get)' - no new inbox/watching/updates commands\n- fray-cfxv: Mark as deferred to v2\n\nAlso verify all 16 children align with the 5 phases in the spec.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-01T22:31:02.760546-08:00","created_by":"adam","updated_at":"2026-01-01T22:42:47.066145-08:00","closed_at":"2026-01-01T22:42:47.066145-08:00","close_reason":"Updated all 16 children of fray-gz26 to align with THREAD-CURATION-SPEC.md. Key changes: fray-50na split into pin+fave, fray-jlw8 now mv command, fray-oww1 simplified to extend fray get, fray-cfxv marked as v2, fray-mgiz removed --unread (v2). All descriptions now reference spec phases."}
{"id":"fray-hiu","title":"Chat: Ctrl-C clears text first, exits only if empty","description":"In chat mode, Ctrl-C should clear the entered text if there's text in the input. Only exit chat if Ctrl-C is pressed on an empty input.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-21T10:49:16.184442-08:00","updated_at":"2025-12-21T17:04:12.15609-08:00","closed_at":"2025-12-21T17:04:12.15609-08:00","close_reason":"Implemented"}
{"id":"fray-hj9","title":"P1.8: Tests for channel system and agents","description":"Add tests for channel operations and agent discovery.\n\nTest files to create/update:\n\n1. tests/channels.test.ts (NEW)\n   - Channel GUID generation\n   - .mm/mm-config.json creation\n   - Global config registration\n   - Channel context resolution (--in flag, mm use)\n   - Cross-channel message references\n\n2. tests/agent-discovery.test.ts (NEW)\n   - Progressive discovery flow\n   - Reuse existing agent GUID\n   - Create new agent on collision\n   - known_agents updates\n   - Auto-nick generation (home channel)\n\n3. tests/prefix-resolution.test.ts (NEW)\n   - Unique match works\n   - Ambiguous match errors with suggestions\n   - Channel scoping (default vs full GUID)\n   - Minimum 2-char prefix\n   - Case sensitivity\n\n4. tests/time-queries.test.ts (NEW)\n   - Parse relative time (1h, 2d)\n   - Parse absolute time (yesterday, today)\n   - Parse GUID references (@#a1b2)\n   - --since, --before, --from, --to flags\n   - Invalid input handling\n\n5. tests/integration.test.ts (UPDATE)\n   - End-to-end GUID flow\n   - Multi-channel coordination\n   - Agent migration scenarios\n   - Prune with guardrails\n\nCoverage goals:\n- Channel operations: 95%\n- Agent discovery: 95%\n- Prefix resolution: 100%\n- Time queries: 90%\n\nRun with: npm test\n\nReferences: Existing integration tests\nCritical files: tests/channels.test.ts (NEW), tests/agent-discovery.test.ts (NEW), tests/prefix-resolution.test.ts (NEW)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T13:31:03.020705-08:00","updated_at":"2025-12-19T22:57:34.297515-08:00","closed_at":"2025-12-19T16:25:46.110193-08:00","close_reason":"Added tests for channel context/agent discovery and updated integration coverage","dependencies":[{"issue_id":"fray-hj9","depends_on_id":"fray-w6q","type":"blocks","created_at":"2025-12-19T13:31:23.574468-08:00","created_by":"daemon","metadata":"{}"},{"issue_id":"fray-hj9","depends_on_id":"fray-3iq","type":"blocks","created_at":"2025-12-19T13:31:23.661195-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-hlr","title":"Add SessionStart resume tickler","description":"On SessionStart (resume), add 3-bullet tickler with key principles:\n- Claim files before editing\n- Close beads when done\n- Check fray @\u003cagent\u003e for mentions\n\nKeep it terse to avoid noise. Could rotate/vary bullets to prevent habituation.\n\nFiles: internal/command/hook_session.go","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-31T08:01:09.867-08:00","created_by":"adam","updated_at":"2025-12-31T10:33:01.301709-08:00","closed_at":"2025-12-31T10:33:01.301709-08:00","close_reason":"Implemented hook-statusline command, enhanced UserPromptSubmit with statusline, added SessionStart resume tickler, added PreCompact hook"}
{"id":"fray-hrm","title":"Channel sidebar: # or spacebar to filter/autocomplete","description":"When channel sidebar is open (via tab), pressing '#' or spacebar should enable filtering mode. As you type, narrow the list and auto-select first best match. Allows quick channel switching without arrow keys.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-21T13:09:35.33417-08:00","updated_at":"2025-12-21T22:58:22.165037-08:00","closed_at":"2025-12-21T22:58:22.165037-08:00","close_reason":"Implemented"}
{"id":"fray-i537","title":"Daemon: tighten read history context","description":"This is about fray get/post/new default behavior, not daemon injection.\n\nWhen agent does 'fray get' or 'fray new' or bare 'fray post':\n- Should get relevant unreads based on tracked read state\n- Should get subscribed thread updates\n- No need for --last n or --since y for common case\n\nFray already tracks read_to cursors - surface this properly in default output.\n\n## Thread Activity Format\n\nThread updates should be hints, not full dumps:\n\n```\nThreads:\n  design-discussion: 3 new (last: @architect on token format)\n  deep-dive: 5 new (last: @adam asked you about error handling)\n```\n\nOne-liner summaries with count + last message context. Agent can drill in with `fray thread \u003cref\u003e` if they need more.\n\n## Test Scenario\n\nUse test/scenarios/returning-agent/ to validate output.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T13:19:51.42348-08:00","created_by":"adam","updated_at":"2026-01-03T02:38:59.052098-08:00","closed_at":"2026-01-03T02:38:59.052098-08:00","close_reason":"Added thread activity hints to fray get output. Shows subscribed threads with unread counts and last message context. Respects ghost cursors and read_to watermarks.","dependencies":[{"issue_id":"fray-i537","depends_on_id":"fray-8lw2","type":"blocks","created_at":"2026-01-02T15:18:58.921413-08:00","created_by":"adam"},{"issue_id":"fray-i537","depends_on_id":"fray-o17j","type":"blocks","created_at":"2026-01-03T01:03:19.816954-08:00","created_by":"adam"}]}
{"id":"fray-i9ep","title":"Archive channels feature","description":"Channels should be archivable for reference without being actively chatted in.\n\nRequirements:\n- Archived channels are still accessible for reference (read-only)\n- Cannot post new messages to archived channels\n- Grouped in 'archived' view instead of main sidebar\n- Listed reverse chronologically by archive date\n- Can be restored (unarchived) using 'fray restore' pattern\n\nCommands:\n- fray archive \u003cchannel\u003e - archive a channel\n- fray restore \u003cchannel\u003e - unarchive a channel\n- fray ls --archived - list archived channels\n\nUI:\n- Archived channels hidden from main sidebar list\n- Accessible via archived collection view (like muted threads pattern)","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-05T22:07:49.430945-08:00","created_by":"adam","updated_at":"2026-01-06T12:58:48.411113-08:00","closed_at":"2026-01-06T12:58:48.411113-08:00","close_reason":"Done: fray archive/restore commands exist for threads"}
{"id":"fray-ij7w","title":"Bug: fray @agent shows 'N likely stale' with no content - should show one-liners","description":"Running 'fray @opus' when there are stale mentions shows only '2 likely stale (\u003e2h)' without any content. Should show one-liners for those messages so you can decide if they need attention. Source: msg-jzzgfoof","status":"closed","priority":1,"issue_type":"bug","assignee":"opus","created_at":"2026-01-06T15:40:43.577888-08:00","created_by":"adam","updated_at":"2026-01-06T15:42:07.165882-08:00","closed_at":"2026-01-06T15:42:07.165882-08:00","close_reason":"Already fixed in commit f97e9a1. Stale mentions now show one-liner previews."}
{"id":"fray-iji6","title":"UX: Tab + type to filter in sidebar","description":"Tab and start typing should filter directly without needing space or # first. Source: msg-r73vg0jz","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-02T00:26:26.239431-08:00","created_by":"adam","updated_at":"2026-01-02T00:26:26.239431-08:00"}
{"id":"fray-irj","title":"Add CONTRIBUTING.md","description":"Create CONTRIBUTING.md with guidelines for contributors","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-17T19:55:18.668151-08:00","updated_at":"2025-12-19T22:57:34.314935-08:00","closed_at":"2025-12-17T20:01:59.128952-08:00","close_reason":"Closed"}
{"id":"fray-izlx","title":"Agent orchestration daemon","description":"Agent orchestration daemon - fray as multi-agent coordination layer.\n\n## Problem\nClaude Code sessions stop when done. No native 'wake on external event.' Multi-agent coordination requires either always-on (wasteful) or perpetual loops (wasteful).\n\n## Solution\nDaemon watches @mentions, spawns agents on demand with session resume.\n\n## Key Decisions (msg-fginuidn)\n1. **5 presence states**: active, spawning, idle, error, offline\n2. **Nested driver config**: invoke.driver + invoke.config\n3. **Stdin/tempfile prompts**: flexible per driver\n4. **System-level heartbeats**: network I/O / CPU (no hooks required)\n5. **Separate prompt templates**: resume (minimal) vs fresh (/fly)\n\n## Implementation Order\n```\nfray-7w5d (schema)\n    ↓\nfray-y5za (drivers) + fray-upb9 (activity) ← parallel after schema\n    ↓\nfray-szq4 (debounce) + fray-24yf (commands) ← parallel\n    ↓\nfray-gnpg (daemon)\n```\n\n## Design Thread\nthrd-r3z3e4gk (Agent Daemon Design)","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-01T22:45:08.690832-08:00","created_by":"adam","updated_at":"2026-01-02T02:08:54.118951-08:00","closed_at":"2026-01-02T02:08:54.118951-08:00","close_reason":"Implemented fray daemon command with signal handling, lock enforcement, and status subcommand.","dependencies":[{"issue_id":"fray-izlx","depends_on_id":"fray-7w5d","type":"blocks","created_at":"2026-01-01T22:45:24.317208-08:00","created_by":"adam"},{"issue_id":"fray-izlx","depends_on_id":"fray-24yf","type":"blocks","created_at":"2026-01-01T22:45:24.341415-08:00","created_by":"adam"},{"issue_id":"fray-izlx","depends_on_id":"fray-gnpg","type":"blocks","created_at":"2026-01-01T22:45:24.364521-08:00","created_by":"adam"}]}
{"id":"fray-j31","title":"P0.6: Display ID mapping system","description":"Create mm_display_ids table. Map GUIDs to short IDs (mm-42). Resolve @devrel to usr-guid, @#mm-42 to msg-guid.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-19T11:57:10.279565-08:00","updated_at":"2025-12-19T22:57:34.29212-08:00","closed_at":"2025-12-19T13:13:39.128208-08:00","close_reason":"Display IDs eliminated - using GUID-only with partial matching instead","dependencies":[{"issue_id":"fray-j31","depends_on_id":"fray-qqv","type":"blocks","created_at":"2025-12-19T11:57:45.612295-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-j4h","title":"Add fray status/statusline command for Claude Code","description":"New command for Claude Code statusline integration.\n\nEither `fray status` or `fray statusline` - TBD on naming.\n\nShould provide compact, structured output suitable for statusline display.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-31T08:01:18.355711-08:00","created_by":"adam","updated_at":"2025-12-31T10:33:01.298837-08:00","closed_at":"2025-12-31T10:33:01.298837-08:00","close_reason":"Implemented hook-statusline command, enhanced UserPromptSubmit with statusline, added SessionStart resume tickler, added PreCompact hook"}
{"id":"fray-j5q","title":"Bug: Chat requires double-enter to send","description":"In fray chat TUI, user has to hit enter twice to send. See msg-mpuy8iwg.","status":"closed","priority":3,"issue_type":"bug","created_at":"2025-12-31T14:52:14.168581-08:00","created_by":"adam","updated_at":"2026-01-02T08:30:58.473494-08:00","closed_at":"2026-01-02T08:30:58.473494-08:00","close_reason":"Fixed: history now works for users, mentions include threads, double-enter bug fixed by not consuming Enter after suggestion apply"}
{"id":"fray-jd39","title":"UX: CLI output format - remove quotes, newline after speaker","description":"In CLI commands like 'fray get' and 'fray meta', remove wrapping quotes and start message body on newline after id/speaker. Events should be single-line, italicized, dim. Source: msg-ba93p0z8","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-02T00:26:25.766892-08:00","created_by":"adam","updated_at":"2026-01-02T00:26:25.766892-08:00"}
{"id":"fray-jeju","title":"Bug: stale @mentions show no one-liners in CLI output","description":"From msg-jzzgfoof: when running 'fray @opus', stale mentions (\u003e2h) show just '2 likely stale (\u003e2h)' without any one-liners. Should show at least one-liner summaries.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-05T17:55:20.215934-08:00","created_by":"adam","updated_at":"2026-01-06T12:00:07.422648-08:00","closed_at":"2026-01-06T12:00:07.422648-08:00","close_reason":"Fixed: stale mentions now show one-liners using FormatMessagePreview. Applied same fix to both fray get --as and fray @agent paths."}
{"id":"fray-jlw8","title":"Move messages (mv)","description":"Implement fray mv command to change message home field. Supports batch moves and --with-replies/--no-replies flags. fray mv msg-abc thrd-xyz --as alice. Distinct from fray thread add which references without moving. See THREAD-CURATION-SPEC.md Phase 1.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-01T06:00:21.071134-08:00","created_by":"adam","updated_at":"2026-01-02T00:26:41.93661-08:00","closed_at":"2026-01-02T00:26:41.93661-08:00","close_reason":"Implemented: fray mv command with --with-replies, message_move JSONL record","dependencies":[{"issue_id":"fray-jlw8","depends_on_id":"fray-gz26","type":"parent-child","created_at":"2026-01-01T12:24:28.343888-08:00","created_by":"adam"}]}
{"id":"fray-jnn8","title":"Thread sidebar indent was missing for nested threads","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-06T11:39:54.21262-08:00","created_by":"adam","updated_at":"2026-01-06T11:47:21.714344-08:00","closed_at":"2026-01-06T11:47:21.714344-08:00","close_reason":"Fixed: walk no longer recurses - children shown only via drill-in. Filed fray-4y76 for optional outline mode."}
{"id":"fray-jqxf","title":"Disable /prune until redesign","description":"/prune command may be dangerous or obsolete given current architecture. \n\nAction: Comment out/disable the command handler until we can revisit what it should do long-term.\n\nCurrent location: internal/chat/commands.go line 70-71","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-06T12:55:36.499381-08:00","created_by":"adam","updated_at":"2026-01-06T13:22:48.353476-08:00","closed_at":"2026-01-06T13:22:48.353476-08:00","close_reason":"Disabled /prune command in chat - returns error message instead, removed from help text","dependencies":[{"issue_id":"fray-jqxf","depends_on_id":"fray-a5hc","type":"parent-child","created_at":"2026-01-06T13:18:45.138524-08:00","created_by":"adam"}]}
{"id":"fray-k9v","title":"Public release readiness review","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T19:46:23.654835-08:00","updated_at":"2025-12-19T22:57:34.312046-08:00","closed_at":"2025-12-17T20:04:45.634763-08:00","close_reason":"Closed"}
{"id":"fray-kc3","title":"Update CHANGELOG and README for v0.2.0","description":"Document GUID architecture, channel system, cross-channel ops, JSONL storage. Breaking change: requires migration.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T11:57:36.079241-08:00","updated_at":"2025-12-19T22:57:34.298111-08:00","closed_at":"2025-12-19T16:01:46.216244-08:00","close_reason":"Updated CHANGELOG, README, CLAUDE.md, package.json, and cli.ts for v0.2.0","dependencies":[{"issue_id":"fray-kc3","depends_on_id":"fray-w6q","type":"blocks","created_at":"2025-12-19T11:57:46.827304-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-kd0g","title":"Extract chat/suggestions.go from model.go","description":"Extract suggestion system: refreshSuggestions(), buildSuggestions(), buildMentionSuggestions(), buildReplySuggestions(), handleSuggestionKeys(), applySuggestion(), renderSuggestions(), clearSuggestions(). ~250 lines.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T23:53:42.957607-08:00","created_by":"adam","updated_at":"2026-01-01T00:18:40.002975-08:00","closed_at":"2026-01-01T00:18:40.002975-08:00","close_reason":"Extracted suggestions.go (390 lines). model.go 2630→2254.","dependencies":[{"issue_id":"fray-kd0g","depends_on_id":"fray-7ks8","type":"blocks","created_at":"2026-01-01T00:07:10.181199-08:00","created_by":"adam"}]}
{"id":"fray-kfzd","title":"Doc: Add reactions section to fray quickstart","description":"Add a REACTIONS section to quickstart.go explaining:\n- Reactions are short posts (≤20 chars) as replies\n- Example: fray post --as agent --reply-to msg-xxx '👍'\n- Use cases: appreciation, agreement, acknowledgment, votes\n- Remove with: fray unreact msg-xxx --as agent\n\nShould go after THREADING section in both buildQuickstartGuide and printQuickstartGuide functions.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-02T00:29:23.067665-08:00","created_by":"adam","updated_at":"2026-01-02T00:29:23.067665-08:00"}
{"id":"fray-kit","title":"Phase 1: Project Setup","description":"Scaffold TypeScript project with build tooling.\n\n## Goal\nA working TypeScript project structure with:\n- npm package configured for ESM (ECMAScript modules)\n- TypeScript compilation via tsup (a fast TS bundler)\n- CLI entry point that responds to --version\n- Directory structure ready for implementation\n\n## Context\nbeads-messenger (bdm) is a lightweight agent coordination layer extending beads (the `bd` CLI tool). It provides room-based messaging with @mention routing for AI coding agents working on the same codebase.\n\nKey concepts:\n- **Room**: Each beads project has one shared message room\n- **Agents**: AI or human participants with hierarchical IDs like alice.1, pm.5.sub.2\n- **@mentions**: Route messages to specific agents via prefix matching\n\nSee PLAN.md for full design decisions and rationale.\n\n## Exit Criteria\n- `npm run build` succeeds\n- `bdm --version` works\n- Project structure matches spec in PLAN.md","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-04T09:55:51.813944-08:00","updated_at":"2025-12-19T22:57:34.296992-08:00","closed_at":"2025-12-04T12:13:19.006642-08:00"}
{"id":"fray-kj5j","title":"Knowledge threads with reaction-based curation","description":"Use threads as knowledge containers (principles, patterns, strategies, anti-patterns, role-specific). Reactions validate entries: 👍 = used it, 👎 = outdated, 🎯 = exactly right. Add reaction-sorted views (--sort reactions), reaction analytics (who/role), and /land protocol step for knowledge hygiene. Social proof replaces algorithmic confidence.","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-01T06:39:42.588526-08:00","created_by":"adam","updated_at":"2026-01-01T20:06:07.10699-08:00","dependencies":[{"issue_id":"fray-kj5j","depends_on_id":"fray-arlf","type":"parent-child","created_at":"2026-01-06T12:39:01.984393-08:00","created_by":"adam"}]}
{"id":"fray-kk2b","title":"Manual testing: daemon and agent orchestration","description":"Test the daemon feature end-to-end with @adam.\n\n## Test Plan\n\n### 1. Agent Creation\n```bash\nfray agent create test-agent --driver claude\nfray agent list --managed\n```\nVerify: agent shows as managed with driver=claude, presence=offline\n\n### 2. Manual Agent Start\n```bash\nfray agent start test-agent\n```\nVerify: Claude Code spawns with /fly-equivalent prompt\n\n### 3. Daemon Mode\n```bash\n# Terminal 1: Start daemon\nfray daemon\n\n# Terminal 2: @mention the agent\nfray post --as adam \"@test-agent check this out\"\n```\nVerify: daemon detects mention and spawns agent\n\n### 4. Daemon Lock\n```bash\nfray daemon status  # Should show running\nfray daemon         # Should fail (already running)\nfray agent check test-agent  # Should skip (daemon running)\n```\n\n### 5. Graceful Shutdown\nCtrl+C the daemon, verify clean exit\n\n### 6. Agent Check (no daemon)\n```bash\nfray post --as adam \"@test-agent another mention\"\nfray agent check test-agent\n```\nVerify: spawns agent, updates watermark\n\n## Exit Criteria\n- [ ] All test scenarios pass\n- [ ] No blocking issues found","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T02:13:19.359826-08:00","created_by":"adam","updated_at":"2026-01-02T11:40:28.260192-08:00","closed_at":"2026-01-02T11:40:28.260192-08:00","close_reason":"Testing complete - @pm is living proof the daemon works! Spawned automatically via @mention, session tracking working correctly."}
{"id":"fray-kvqj","title":"Bug: sidebar drill-in allows infinite drilling on childless items","description":"Pressing 'l' to drill in on items without children allows infinite drilling, showing architect/architect/architect/ in breadcrumb forever.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-05T20:38:36.54609-08:00","created_by":"adam","updated_at":"2026-01-05T20:44:57.938786-08:00","closed_at":"2026-01-05T20:44:57.938786-08:00","close_reason":"Added guard in drillInAction() to prevent drilling into the same thread we're already drilled into. When selecting the back entry with l, it now selects the thread to view messages instead of infinite drill."}
{"id":"fray-kx4","title":"Chat: /help or ? shows keyboard shortcuts and slash commands","description":"In chat mode, typing '/help' or '?' at the start of a blank line shows all available keyboard shortcuts and slash commands. Typing '?' should remove the input character (acts as keyboard shortcut, not typed text).","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-21T10:49:10.749368-08:00","updated_at":"2025-12-21T17:04:12.156436-08:00","closed_at":"2025-12-21T17:04:12.156436-08:00","close_reason":"Implemented"}
{"id":"fray-l3v1","title":"Bug: alt-delete crashes chat app","description":"Hitting alt-delete (to delete prior word) causes the chat app to crash.\n\nLikely a keybinding issue in the textarea component - may need to handle this key combo explicitly.","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-06T13:54:51.075212-08:00","created_by":"adam","updated_at":"2026-01-06T14:18:50.091821-08:00","closed_at":"2026-01-06T14:18:50.091821-08:00","close_reason":"Could not reproduce. Investigated textarea keybinding handling, tested Alt+Delete/Alt+Backspace in isolation - all work correctly. Likely a one-off caused by binary or data changing mid-session. If it recurs: check bubbles textarea deleteWordLeft/deleteWordRight bounds, terminal escape sequences, or inputCursorPos() after deletion."}
{"id":"fray-l42t","title":"Convention prompts: update /fly, /land, and agent guidance","description":"Thoroughly update convention-based prompts for agent coordination.\n\n## Source Discussion\ncbcs-design thread (thrd-kw5z6vmu), msg-n2j96m9v, msg-7b2xjwrn, msg-tnrw7u29.\n\n## Conventions to Document\n\n### 1. Room Purpose (msg-7b2xjwrn, msg-u9zaufnx)\nRoom is ONLY for:\n- Standup reports (generated by /land)\n- Announcements (major completions, releases)\n- Blocked notices (can't find something, stuck)\n\nEverything else goes in threads.\n\n### 2. Standup Report Format (msg-tnrw7u29)\nFirst line = summary/signoff statement. Then sections:\n\n```\nMade good progress on X. Hit blocker Y, team is on it.\n\n## Shipped\n- fray-bu0g: mention hierarchy design\n- Updated 4 beads with cbcs discussion context\n\n## Touched\n- threads: cbcs-design, gju8-design\n- beads: bu0g, l42t, a8h1\n- files: internal/command/post.go, internal/db/queries.go\n- commits: abc1234 (add standup format), def5678 (fix accordion)\n\n## Kudos\n- @opus nailed the root cause\n\n## Blockers\n- waiting for mlld fix\n\n## Next\n- Continue gju8 design discussion\n- Implement accordion view\n```\n\nTouched should be comprehensive - everything the agent touched.\n\n### 3. Work Startup Convention (msg-7b2xjwrn)\nWhen starting work on a bead:\n1. Ensure bead exists (create if needed)\n2. Plan out sub-beads if applicable\n3. Create thread structure from bead structure\n4. Add agents to threads, drop status one-liner\n5. Don't @mention until action needed (avoids unnecessary wake-ups)\n\n### 4. Thread Naming (msg-3xm4hbs6, msg-gxh3yzcl)\n```\n{epic-bead-id}-{name}/                    ← epic main\n{epic-bead-id}-{name}/{type}-{bead-id}    ← feature thread\n```\nOr standalone: `{type}-{bead-id}-{name}`\n\nType prefixes: design, review, debug, arch, rsrch, dev\n\n### 5. Chained Reply Etiquette (msg-7b2xjwrn)\n- One-off questions/replies OK anywhere\n- Threads with \u003eN messages should collapse during /land\n- `fray collapse @agent` for cleanup\n\n### 6. Trusting the Tools (msg-64gyv0m8)\n- Use defaults, don't --all\n- Trust notes/meta have what you need\n- If someone needs you, they'll ask again\n- The river flows by\n\n## Prompts to Update\n\n### /fly\n- Inject conventions summary\n- Emphasize thread-first posting\n- Show only assigned threads (visibility = involvement)\n\n### /land\n- Generate standup report in format above\n- Post to room\n- Prompt for thread cleanup (collapse chained replies)\n- Update notes for next session\n\n### Agent Onboarding\n- Clear guidance on room vs threads\n- Don't dump reasoning to room\n- Standup reports surface the work\n\n## Related\n- fray-a8h1: /hop command\n- fray-bu0g: Mention hierarchy\n- meta/conventions thread (to be created)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-03T19:41:03.736674-08:00","created_by":"adam","updated_at":"2026-01-03T21:48:21.507715-08:00","closed_at":"2026-01-03T21:48:21.507715-08:00","close_reason":"Updated /fly with room/thread conventions, thread naming, work startup. Created conventions thread (thrd-3f9yn0ck) with 6 documented conventions: room purpose, standup format, thread naming, work startup, chained reply etiquette, trusting the tools.","dependencies":[{"issue_id":"fray-l42t","depends_on_id":"fray-0etk","type":"parent-child","created_at":"2026-01-03T21:21:51.143779-08:00","created_by":"adam"}]}
{"id":"fray-l46g","title":"Feature: --since should accept short message IDs","description":"From msg-2kgv7fgo: The --since flag should be more forgiving:\n\n1. Accept bare IDs without msg- prefix: `--since jr0n` → matches msg-jr0n*\n2. Prefix match to most recent: `--since msg-j` → matches msg-jr0nb66v\n3. Match what's visible in chat interface (short IDs like jr0n)\n\nCurrently requires full ID like msg-jr0nb66v which is tedious.","status":"closed","priority":1,"issue_type":"feature","assignee":"opus","created_at":"2026-01-04T20:42:59.23828-08:00","created_by":"adam","updated_at":"2026-01-06T16:23:05.498071-08:00","closed_at":"2026-01-06T16:23:05.498071-08:00","close_reason":"--since now accepts bare IDs (e.g. 'abc123'), short prefixes with # (e.g. '#abc'), and bare short prefixes (e.g. 'abc'). Tested with full, partial, and ambiguous matches."}
{"id":"fray-l5o","title":"Implement message display command (default action)","description":"Implement the default bdm command to show room message history.\n\n## Usage\n\n```bash\nbdm                              # last 20 messages\nbdm --last 50                    # last 50 messages\nbdm --since 42                   # messages after ID 42\nbdm --all                        # full history\n```\n\n## Output Format\n\n```\n[42] alice.419 (2m ago): figured out the auth issue, @bob.3 see auth.py:47\n[43] bob.3 (1m ago): @alice.419 got it, thanks\n[44] pm.5 (30s ago): @all standup in 5\n```\n\nFormat: `[id] agent (time): body`\n\n## Implementation\n\n1. Parse options (--last, --since, --all)\n2. Build MessageQueryOptions from flags\n3. Call getMessages(db, options)\n4. Format each message:\n   - `[{id}] {from_agent} ({relative_time}): {body}`\n   - Optionally highlight @mentions in body\n\n## Default Behavior\n- No flags: last 20 messages\n- --last N: last N messages\n- --since ID: messages with id \u003e ID\n- --all: no limit (may be large)\n\n## JSON Output (--json)\n\n```json\n[\n  {\n    \"id\": 42,\n    \"ts\": 1234567890,\n    \"from_agent\": \"alice.419\",\n    \"body\": \"...\",\n    \"mentions\": [\"bob.3\"]\n  }\n]\n```\n\n## Files\n- src/commands/messages.ts (or inline in cli.ts default action)\n\n## Acceptance Criteria\n- Default shows last 20 messages\n- --last, --since, --all work correctly\n- Output format matches spec\n- Empty room shows appropriate message\n- JSON output is valid","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T10:08:56.250496-08:00","updated_at":"2025-12-19T22:57:34.304668-08:00","closed_at":"2025-12-04T12:37:40.104216-08:00","dependencies":[{"issue_id":"fray-l5o","depends_on_id":"fray-yh4","type":"parent-child","created_at":"2025-12-04T10:10:48.755947-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-l5o","depends_on_id":"fray-2vy","type":"blocks","created_at":"2025-12-04T10:11:40.21361-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-l5o","depends_on_id":"fray-dgt","type":"blocks","created_at":"2025-12-04T10:46:19.709933-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-l5o","depends_on_id":"fray-8jo","type":"blocks","created_at":"2025-12-04T10:46:49.01768-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-l71b","title":"Update fly/land protocols: workstream threads","description":"fly: Create thread for agent's workstream on session start (when appropriate)\nland: Collapse and close workstream thread so it can be referenced\n\nDesign consideration: Not all sessions need threads. Simple 'complete task a, b, c' sessions where the plan is clear might just update beads. Need heuristics for when to create workstream thread vs. not.\n\nPotential triggers for workstream thread:\n- Exploratory/design work\n- Multi-step implementation with decisions\n- Work that might inform future sessions\n\nSkip thread for:\n- Clear task execution with known approach\n- Bug fixes with obvious solution\n- Chore/cleanup work","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-31T23:03:07.602932-08:00","created_by":"adam","updated_at":"2026-01-06T12:36:47.654031-08:00","labels":["discuss"],"dependencies":[{"issue_id":"fray-l71b","depends_on_id":"fray-0v2y","type":"blocks","created_at":"2026-01-02T13:03:53.786167-08:00","created_by":"adam"},{"issue_id":"fray-l71b","depends_on_id":"fray-arlf","type":"parent-child","created_at":"2026-01-06T12:39:01.95759-08:00","created_by":"adam"}]}
{"id":"fray-ldl8","title":"Question lifecycle: blocking status, answer validation","description":"Enhance question system for conversation control.\n\n**Blocking status:**\n- Questions can be `blocking` (asker waits for answer before continuing on topic)\n- Default: non-blocking for bare fray (optional structure)\n- Orchestrators (party) can require blocking via `--blocking` flag\n- `fray questions --blocking` shows only blocking questions\n\n**Answer validation:**\n- Questions can require explicit acceptance: `--needs-accept`\n- Answer posted → question marked `has-answer` (not closed)\n- Asker reviews → marks `accepted` or `needs-revision`\n- Good for design decisions, approvals\n\n**Query support:**\n- `fray questions --as agent` - agent's open questions\n- `fray questions --blocking` - blocking questions only\n- `fray questions --unaccepted` - answered but not accepted\n\n**Optional params:** All new behavior is opt-in via flags. Bare fray usage unchanged. Party can use full lifecycle.\n\nRelated: fray-vfs0 (structured unpacking uses this for openQuestions)","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-01T18:29:16.917489-08:00","created_by":"adam","updated_at":"2026-01-01T18:29:16.917489-08:00"}
{"id":"fray-lfo","title":"Add --range flag for message queries","description":"Add ability to query specific message ID ranges.\n\n## Usage\n\n```bash\nbdm get --range 20:25       # Get messages 20-25 inclusive\nbdm get --range 20:25 --json  # JSON output\nbdm @alice --range 100:110  # Get mentions in range\n```\n\n## Behavior\n\n- Inclusive range: `20:25` includes messages 20, 21, 22, 23, 24, 25\n- Works with all query commands: get, @mentions\n- Works with --json flag\n- Subject to token limit checks (\u003e10 messages requires --bypass-token-limit)\n\n## Implementation\n\nAdd --range option to commands:\n- Parse format: `\u003cstart\u003e:\u003cend\u003e`\n- Convert to SQL: `WHERE id \u003e= start AND id \u003c= end`\n- Validate: start \u003c= end, both are positive integers\n\n## Files\n\n- src/commands/get.ts - Add --range option\n- src/commands/mentions.ts - Add --range option\n- src/db/queries.ts - Add range parameters to query functions\n\n---\n**2026-01-06**: References old bdm tool. Concept may be valid but needs complete rewrite for Go-based fray if still wanted.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-09T06:12:03.232996-08:00","updated_at":"2026-01-06T13:10:08.647159-08:00","closed_at":"2026-01-06T13:10:08.647159-08:00","close_reason":"References old bdm tool. --range concept is low priority and would need complete rewrite.","labels":["needs-rewrite"]}
{"id":"fray-li8","title":"Rename package to mini-msg","description":"Update package.json name from mini-messenger to mini-msg, update all documentation references","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T19:55:17.446495-08:00","updated_at":"2025-12-19T22:57:34.300345-08:00","closed_at":"2025-12-17T20:02:53.838857-08:00","close_reason":"Closed"}
{"id":"fray-ljh","title":"Add package.json metadata","description":"Add repository, homepage, bugs URLs pointing to github.com/adamavenir/mini-msg. Add author field.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T19:55:17.651578-08:00","updated_at":"2025-12-19T22:57:34.300133-08:00","closed_at":"2025-12-17T20:02:18.894442-08:00","close_reason":"Closed"}
{"id":"fray-lp1a","title":"UX: thread discovery difficult - show all threads on entering space","description":"When entering chat space mode, threads are hard to discover. Suggestion: show all threads initially and let user type to narrow. Reported by adam: msg-p6d3u1bh.","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-02T00:17:38.289696-08:00","created_by":"adam","updated_at":"2026-01-02T00:17:48.448582-08:00"}
{"id":"fray-lpqt","title":"Redesign: thread sidebar appearance","description":"Changes needed:\n1. Remove left chevrons, only show right chevrons for drillable items\n2. Keep consistent indentation for all text\n3. Drop header, rename 'main' to project dir name (fray, mlld)\n4. Main channel bold and bright\n5. Preserve left margin column for fave/unread indicators (✪ ✦)\n\nLayout example:\n   fray (47)\n ✪ 73w9-design (28)\n ✦ cbcs-design (32)\n   meta ❯ (13)\n   test-l1 ❯❯❯","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T20:38:36.771432-08:00","created_by":"adam","updated_at":"2026-01-05T20:48:10.848569-08:00","closed_at":"2026-01-05T20:48:10.848569-08:00","close_reason":"Redesigned thread sidebar: removed header (except when filtering/drilled), main entry shows project name with bold bright style, removed left chevrons, kept right chevrons for drillable items (❯ suffix), preserved left margin for indicators (★ ✦), back entry shows ❮ prefix."}
{"id":"fray-lqi","title":"Go: Add ANSI color support for output","description":"TS has rich ANSI colors with different colors for different agents. Go has minimal formatting.","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-21T01:34:11.076969-08:00","updated_at":"2025-12-21T02:25:28.596348-08:00","closed_at":"2025-12-21T02:25:28.596348-08:00","close_reason":"Added ANSI formatting for CLI output"}
{"id":"fray-lqjj","title":"UX: Add explicit 'fray react' command","description":"Add explicit 'react' verb for reactions.\n\n**Current behavior**: Short replies are interpreted as reactions (architecturally nice).\n\n**Proposed**: Add `fray react` command that:\n- Takes an emoji as primary arg: `fray react 👍 msg-xxx`\n- Optionally allows `--reply \"...\"` to chain a comment to the original message\n\nThis makes the reaction action explicit while preserving the current implicit behavior for backwards compatibility.\n\nSource: msg-qf47rdve (73w9-design thread)","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-02T09:33:44.883036-08:00","created_by":"adam","updated_at":"2026-01-02T09:46:56.547675-08:00","closed_at":"2026-01-02T09:46:56.547675-08:00","close_reason":"Implemented fray react command, removed unreact (reactions are permanent)"}
{"id":"fray-lu53","title":"Chat: / command autocomplete (like Claude Code)","description":"Entering `/` in chat textarea should:\n1. Show available `/` commands\n2. Narrow them down as user types (fuzzy match like Claude Code does)\n\nCurrent commands: /quit, /exit, /help, /n, /f, /M, /edit, /delete, /rm, /prune\nPlus new commands from fray-???? (chat command expansion)","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-01-06T12:55:22.560337-08:00","created_by":"adam","updated_at":"2026-01-06T13:37:27.523713-08:00","closed_at":"2026-01-06T13:37:27.523713-08:00","close_reason":"Implemented / command autocomplete with fuzzy matching. Typing / shows available commands, and as you type more characters, fuzzy matching filters the list. Prefix matches are prioritized over fuzzy matches.","dependencies":[{"issue_id":"fray-lu53","depends_on_id":"fray-a5hc","type":"parent-child","created_at":"2026-01-06T13:18:45.13556-08:00","created_by":"adam"}]}
{"id":"fray-ly8","title":"Add SQLite WAL mode and busy_timeout for multi-agent resilience","description":"## Problem\nNo WAL mode or busy_timeout configured when opening databases (src/core/project.ts:55-60, src/commands/shared.ts:38-40).\n\n```typescript\nexport function openDatabase(project: BeadsProject): Database.Database {\n  const db = new Database(project.dbPath);\n  db.pragma('foreign_keys = ON');\n  return db;  // No WAL, no busy_timeout\n}\n```\n\nMultiple agents posting/watching simultaneously can hit SQLITE_BUSY errors. This is the primary use case for bdm!\n\n## Fix\nAdd pragmas after opening:\n```typescript\ndb.pragma('journal_mode = WAL');\ndb.pragma('busy_timeout = 5000');  // 5 seconds\n```\n\n## Considerations\n- WAL mode creates additional files (*.db-wal, *.db-shm)\n- beads itself may have opinions on journal mode - check compatibility\n- busy_timeout of 5000ms is reasonable; can make configurable later\n\n## Files\n- src/core/project.ts:55-60\n- src/commands/shared.ts:38-40 (linked project opening)\n\n## Acceptance Criteria\n- Database opened with WAL mode enabled\n- busy_timeout set to reasonable value (5000ms)\n- Multiple concurrent bdm processes don't get SQLITE_BUSY","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T14:03:48.663946-08:00","updated_at":"2025-12-19T22:57:34.301248-08:00","closed_at":"2025-12-04T14:29:01.461774-08:00"}
{"id":"fray-lz9","title":"P2: Basic CLI Commands","description":"Port essential commands: init (with --defaults flag for scripting), new (--status/--purpose flags), post, get. Port context resolution (--in flag, CWD discovery), mention extraction with prefix matching. ~6 hours.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T12:17:21.540833-08:00","updated_at":"2025-12-21T01:27:06.005223-08:00","closed_at":"2025-12-21T01:27:06.005223-08:00","close_reason":"Completed in Go rewrite","dependencies":[{"issue_id":"fray-lz9","depends_on_id":"fray-09h","type":"blocks","created_at":"2025-12-20T12:22:10.711518-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-m16m","title":"Improve /land: skip empty sections in standup","description":"From msg-uyvy0g0o: The /land standup format should skip sections that would be empty (e.g., Blockers, Kudos) rather than outputting empty headers.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T20:48:02.168416-08:00","created_by":"adam","updated_at":"2026-01-04T20:53:31.117346-08:00","closed_at":"2026-01-04T20:53:31.117346-08:00","close_reason":"Already implemented by adam"}
{"id":"fray-m2u","title":"Update README with claims documentation","description":"Document claims system (mm claim, mm status, mm clear) in README command reference","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T19:55:17.853029-08:00","updated_at":"2025-12-19T22:57:34.311859-08:00","closed_at":"2025-12-17T20:04:15.920658-08:00","close_reason":"Closed"}
{"id":"fray-m6c","title":"P3: Basic Chat TUI","description":"Implement basic interactive chat mode with Bubbletea. Message viewport with scrolling, text input, reply syntax (#abc), polling for new messages, agent colors. ~10 hours.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T12:17:26.712853-08:00","updated_at":"2025-12-21T01:27:06.005549-08:00","closed_at":"2025-12-21T01:27:06.005549-08:00","close_reason":"Completed in Go rewrite","dependencies":[{"issue_id":"fray-m6c","depends_on_id":"fray-lz9","type":"blocks","created_at":"2025-12-20T12:22:15.888555-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-mgiz","title":"Within-thread filters: --pinned, --by, --unread, --reactions, --with, --anchors","description":"Within-thread filters on 'fray get \u003cpath\u003e':\n\nNow that fray-w6xh landed with path-based addressing, these become flags on 'fray get':\n- fray get design-thread --pinned (pinned messages only)\n- fray get design-thread --by @alice (messages from agent)\n- fray get design-thread --unread (uses read_to watermark system)\n- fray get design-thread --reactions (has reactions)\n- fray get design-thread --with 'keyword' (contains text)\n- fray get design-thread --anchors (subthread anchors only)\n\nPath addressing works for all thread types:\n- fray get opus/notes --unread\n- fray get meta --by @adam\n- fray get roles/architect/keys --reactions","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-01T12:24:05.016092-08:00","created_by":"adam","updated_at":"2026-01-05T02:57:51.174959-08:00","closed_at":"2026-01-05T02:57:51.174959-08:00","close_reason":"Added --pinned, --by, --with, --reactions flags. --unread and --anchors deferred (require more complex query logic).","dependencies":[{"issue_id":"fray-mgiz","depends_on_id":"fray-gz26","type":"parent-child","created_at":"2026-01-01T12:24:28.224527-08:00","created_by":"adam"}]}
{"id":"fray-mgr0","title":"Questions integration in /fly and /land","description":"Integrate the `# Questions for @x` pattern into agent protocols.\n\n**/fly additions:**\n- Show `fray questions --for $AGENT` (questions directed to you)\n- Show `fray questions --open` (questions you might answer)\n- Guidance on ASKING questions with structured format:\n  ```\n  # Questions for @adam\n  1. Should we use X or Y?\n     a. X approach\n        - Pro: faster\n        - Con: less flexible\n     b. Y approach\n  \n  # Wondering\n  1. Could we eventually combine A and B?\n  ```\n\n**/land additions:**\n- Check `fray questions` for any you can answer before leaving\n- Use `fray wonder` for open loops you're leaving behind\n\n**Question routing guidance (add to meta):**\n- @adam for product/design decisions\n- @\u003crole\u003e for role-specific questions\n- # Wondering for self-tracking (no target)\n\nRelated: msg-pa6pjhbn (questions system in meta)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-01T18:37:37.712199-08:00","created_by":"adam","updated_at":"2026-01-01T18:37:37.712199-08:00","dependencies":[{"issue_id":"fray-mgr0","depends_on_id":"fray-arlf","type":"parent-child","created_at":"2026-01-06T12:39:02.036198-08:00","created_by":"adam"}]}
{"id":"fray-mn9a","title":"Fix failing TestMigrateCommandFailsWhenConfigExists test","description":"Test expects 'fray-config.json already exists' but migrate now outputs different message about checking legacy thread patterns. Test in internal/command/migrate_test.go:45 needs updating to match new migrate behavior.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-06T10:36:43.758021-08:00","created_by":"adam","updated_at":"2026-01-06T11:51:16.882919-08:00","closed_at":"2026-01-06T11:51:16.882919-08:00","close_reason":"Updated test to expect 'already migrated' instead of old message"}
{"id":"fray-mzg8","title":"fray chat UX: notifications, sidebar, navigation","description":"Comprehensive UX improvements for fray chat to support convention-based thread organization.\n\n## Source Discussion\ncbcs-design thread (thrd-kw5z6vmu), specifically msg-tqhe0jx7, msg-gxh3yzcl.\n\n## Problem\nThe convention-based approach to room/thread organization only works if humans can navigate it. Current fray chat needs UX improvements to handle multi-layer subthreads and thread-centric workflows.\n\n## Components\n\n### 1. Notification System (msg-gxh3yzcl)\n**In-app notifications:**\n- Badge counts per thread\n- Highlight unread in sidebar\n- Visual distinction for direct @mentions vs FYIs\n\n**OS native integration:**\n- Direct @mentions trigger OS notification\n- Blocked announcements trigger OS notification\n- Configurable per-thread mute\n\n### 2. Sidebar Navigation (msg-tqhe0jx7)\n- All threads listed (no hidden ones)\n- Faves float to top or separate section\n- Expand/collapse for nested threads (4-level support)\n- Unread indicators per thread\n- Thread nicknames for long paths\n\n### 3. Thread Hierarchy Display\nSupport naming convention:\n```\ngz26-curation/                     \n├── design-dua7-anchors            \n├── review-eeor-pins               \n└── dev-jlw8-move                  \n```\n\n### 4. Faved Messages\n- Show faved messages in interface\n- Could be inline markers or separate section\n\n## Related Beads\n- fray-dlvh: Faves (nickname support)\n- fray-ao2f: Tree display\n- fray-7rsr: Thread filters","status":"in_progress","priority":1,"issue_type":"epic","created_at":"2026-01-03T19:39:43.925015-08:00","created_by":"adam","updated_at":"2026-01-05T19:06:40.231971-08:00"}
{"id":"fray-mzg8.1","title":"Chat: unread badge counts per thread","description":"Display unread message counts as badges next to thread names in the thread panel. Track watermarks per thread per agent.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-05T12:04:13.300151-08:00","created_by":"adam","updated_at":"2026-01-05T12:07:21.917892-08:00","closed_at":"2026-01-05T12:07:21.917892-08:00","close_reason":"Implemented unread badge counts in thread panel - added GetUnreadCountsForAgent/GetRoomUnreadCount functions, displays (N) next to threads with unread messages, watermarks updated when viewing threads","dependencies":[{"issue_id":"fray-mzg8.1","depends_on_id":"fray-mzg8","type":"parent-child","created_at":"2026-01-05T12:04:13.303166-08:00","created_by":"adam"}]}
{"id":"fray-mzg8.10","title":"Chat sidebar: fave/unread indicators","description":"Visual indicators for thread state:\n- ✪ for faved threads (left of name, space separator)\n- Star color: yellow (unread mention/reply), blue (unread messages), grey (none)\n- ✦ yellow for unread mention/reply (high-vis) - separate from fave\n- (n) count after name for unreads\n- Only show unread indicators for subscribed threads\n- ❯ 'lit up' (bright) if nested children have unreads\n\nReserve 2 chars left for indicator alignment - all names start same column.\n\nDesign: mzg8-design thread, sections 11-12, msg-aovj1p68","status":"closed","priority":2,"issue_type":"feature","assignee":"opus","created_at":"2026-01-05T15:39:18.277575-08:00","created_by":"adam","updated_at":"2026-01-05T16:44:04.621457-08:00","closed_at":"2026-01-05T16:44:04.621457-08:00","close_reason":"Completed fave/unread indicators:\n- Added ★ for faved threads (left of name, 2-char reserved space)\n- Added ✦ yellow for unread mentions (placeholder - detection TODO)\n- Added (n) count for unreads (only on subscribed threads)\n- Priority: ✦ mentions \u003e ★ faves \u003e spaces\n- All names start at same column for alignment\n- Unread counts only shown for subscribed threads\nBuild successful\n\nNote: Mention detection marked as TODO - requires thread-level mention tracking implementation","dependencies":[{"issue_id":"fray-mzg8.10","depends_on_id":"fray-mzg8","type":"parent-child","created_at":"2026-01-05T15:39:18.278159-08:00","created_by":"adam"},{"issue_id":"fray-mzg8.10","depends_on_id":"fray-mzg8.5","type":"blocks","created_at":"2026-01-05T15:39:47.703776-08:00","created_by":"adam"}]}
{"id":"fray-mzg8.11","title":"Chat sidebar: thread nicknames","description":"Personal thread nicknames:\n- /n or Ctrl-n to set nickname for selected thread\n- Add 'nickname' column to fray_faves table\n- Main sidebar: show nickname instead of real name\n- Drilled view: show actual name (context matters)\n- Agents can reference threads by nickname\n\nDesign: mzg8-design thread, msg-kfh3gggy, msg-aovj1p68 clarification 3","status":"closed","priority":2,"issue_type":"feature","assignee":"opus","created_at":"2026-01-05T15:39:18.415041-08:00","created_by":"adam","updated_at":"2026-01-05T16:49:31.702125-08:00","closed_at":"2026-01-05T16:49:31.702125-08:00","close_reason":"Completed thread nicknames:\n- Added nickname column to fray_faves schema (nullable, alongside faved_at)\n- Made faved_at nullable (can have nickname without fave)\n- Added db functions: SetNickname(), GetNickname(), GetThreadNicknames()\n- Added threadNicknames map to Model with refreshThreadNicknames()\n- Display logic: show nickname at top level (depth 0), actual name when drilled\n- /n \u003cnickname\u003e slash command to set nickname\n- /n with no args clears nickname\n- Ctrl-n shows hint to use /n command\n- /f slash command for fave toggle when thread panel focused\nBuild successful","dependencies":[{"issue_id":"fray-mzg8.11","depends_on_id":"fray-mzg8","type":"parent-child","created_at":"2026-01-05T15:39:18.415521-08:00","created_by":"adam"}]}
{"id":"fray-mzg8.12","title":"Chat sidebar: mute feature with pseudothread","description":"Mute threads with discoverable container:\n- /M or Ctrl-m to mute/unmute selected thread\n- 'muted' pseudothread at bottom contains all muted threads\n- Pseudothread drillable like regular threads\n- Muted threads removed from main list (live in pseudothread)\n\nDesign: mzg8-design thread, msg-aovj1p68 item 2","status":"closed","priority":2,"issue_type":"feature","assignee":"opus","created_at":"2026-01-05T15:39:28.817116-08:00","created_by":"adam","updated_at":"2026-01-05T16:51:27.773464-08:00","closed_at":"2026-01-05T16:51:27.773464-08:00","close_reason":"Completed mute feature with thread collection:\n- Added UnmuteThread() function to db package\n- Implemented toggleMuteThread() method\n- Added /M slash command for mute/unmute\n- Added Ctrl-m keyboard shortcut\n- Muted threads removed from main list (filtered in threadEntries)\n- 'muted' thread collection view shown if any muted threads exist\n- Drill-in for muted collection deferred (shows status for now)\nBuild successful","dependencies":[{"issue_id":"fray-mzg8.12","depends_on_id":"fray-mzg8","type":"parent-child","created_at":"2026-01-05T15:39:28.818963-08:00","created_by":"adam"}]}
{"id":"fray-mzg8.13","title":"Chat sidebar: fave/unfave shortcut","description":"Quick fave/unfave from sidebar:\n- /f or Ctrl-f to toggle fave on selected thread\n- Pseudothreads/views can also be faved\n- Faved items sort to top (after unreads)\n\nDesign: mzg8-design thread, section 6","status":"closed","priority":2,"issue_type":"feature","assignee":"opus","created_at":"2026-01-05T15:39:28.951374-08:00","created_by":"adam","updated_at":"2026-01-05T16:45:53.727551-08:00","closed_at":"2026-01-05T16:45:53.727551-08:00","close_reason":"Completed fave/unfave shortcut:\n- Added toggleFaveSelectedThread() method\n- Calls db.AddFave() or db.RemoveFave() based on current state\n- Added /f key handler (when not in filter mode)\n- Added Ctrl-f keyboard handler\n- Refreshes favedThreads after toggle\n- Shows status message on fave/unfave\nBuild successful","dependencies":[{"issue_id":"fray-mzg8.13","depends_on_id":"fray-mzg8","type":"parent-child","created_at":"2026-01-05T15:39:28.951867-08:00","created_by":"adam"}]}
{"id":"fray-mzg8.14","title":"Chat sidebar: virtual scrolling","description":"Performance optimization for large thread lists:\n- Only render visible items\n- Handle hundreds of threads smoothly\n- Maintain scroll position during updates\n\nDesign: mzg8-design thread, msg-aovj1p68 item 5","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-05T15:39:29.085336-08:00","created_by":"adam","updated_at":"2026-01-05T17:58:52.126639-08:00","closed_at":"2026-01-05T17:58:52.126639-08:00","close_reason":"Implemented virtual scrolling with scroll offset tracking and auto-scroll to keep selection visible","dependencies":[{"issue_id":"fray-mzg8.14","depends_on_id":"fray-mzg8","type":"parent-child","created_at":"2026-01-05T15:39:29.085826-08:00","created_by":"adam"}]}
{"id":"fray-mzg8.15","title":"Chat sidebar: live updates and deletion handling","description":"Real-time sidebar updates:\n- ~1s refresh for thread changes (rename, new thread)\n- Auto-navigate away from deleted threads\n- New threads appear immediately in appropriate position\n\nDesign: mzg8-design thread, msg-aovj1p68 items 7, 10","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-05T15:39:39.972834-08:00","created_by":"adam","updated_at":"2026-01-05T17:59:29.971001-08:00","closed_at":"2026-01-05T17:59:29.971001-08:00","close_reason":"Implemented live thread updates: polls threads every 1s, auto-navigates away from deleted threads, updates thread names on change","dependencies":[{"issue_id":"fray-mzg8.15","depends_on_id":"fray-mzg8","type":"parent-child","created_at":"2026-01-05T15:39:39.976151-08:00","created_by":"adam"}]}
{"id":"fray-mzg8.16","title":"Chat sidebar: selection highlighting","description":"Improved selection visual:\n- Blue background extends full width\n- Padding on both sides: `[ name ]` effect (bg colored space on left AND right)\n- Current implementation only has left padding\n\nDesign: mzg8-design thread, section 10","status":"closed","priority":2,"issue_type":"feature","assignee":"opus","created_at":"2026-01-05T15:39:40.104613-08:00","created_by":"adam","updated_at":"2026-01-05T16:51:55.166155-08:00","closed_at":"2026-01-05T16:51:55.166155-08:00","close_reason":"Completed selection highlighting:\n- Selection now extends full width with padding on both sides\n- Uses lipgloss.Width() to pad line to full sidebar width before styling\n- Creates [ name ] visual effect with background extending edge-to-edge\nBuild successful","dependencies":[{"issue_id":"fray-mzg8.16","depends_on_id":"fray-mzg8","type":"parent-child","created_at":"2026-01-05T15:39:40.105089-08:00","created_by":"adam"}]}
{"id":"fray-mzg8.17","title":"Chat sidebar: contextual help","description":"Context-aware help display:\n- '? for help' in footer already exists\n- When sidebar focused: show sidebar shortcuts\n- When message pane focused: show chat tips\n- Update help content for new keyboard shortcuts\n\nDesign: mzg8-design thread, msg-aovj1p68 item C","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-05T15:39:40.237176-08:00","created_by":"adam","updated_at":"2026-01-05T15:39:40.237176-08:00","dependencies":[{"issue_id":"fray-mzg8.17","depends_on_id":"fray-mzg8","type":"parent-child","created_at":"2026-01-05T15:39:40.237663-08:00","created_by":"adam"}]}
{"id":"fray-mzg8.2","title":"Chat: OS native notifications for direct @mentions","description":"Trigger OS notification (macOS Notification Center) when receiving direct @mention or blocked announcement. Must work even when terminal is not focused.\n\n## Implementation Notes\nRequires adding a notification library like github.com/gen2brain/beeep for cross-platform support.\n\nKey integration points:\n1. internal/chat/model.go pollMsg handler - detect direct @mentions in incoming messages\n2. Need to differentiate between direct @mentions (start of message) vs FYI mentions\n3. Should respect thread mute settings\n\nSee #fray-mzg8.25 for deep linking (click notification → jump to message).","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-01-05T12:04:13.438561-08:00","created_by":"adam","updated_at":"2026-01-06T14:44:38.109502-08:00","closed_at":"2026-01-06T14:44:38.109502-08:00","close_reason":"Implemented OS native notifications for direct @mentions in chat. Triggers on: (1) direct @mention at start of message, (2) reply to user's own message. Suppressed for: muted threads, event/surface messages, non-human chat users. Uses beeep library for cross-platform support.","dependencies":[{"issue_id":"fray-mzg8.2","depends_on_id":"fray-mzg8","type":"parent-child","created_at":"2026-01-05T12:04:13.439015-08:00","created_by":"adam"}]}
{"id":"fray-mzg8.20","title":"Feature: Custom thread collection views (user-defined filters)","description":"Allow users to create custom thread collection views via filters. Examples: 'threads with unreads from @alice', 'threads tagged #bug', 'threads I haven't read in 7d'. Stored per-agent.\n\n**Ordering requirement**: Custom collection views should appear just below faves/unreads in the sidebar, hidden if empty. Only 'muted' collection stays at the very bottom.","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-05T16:21:41.869657-08:00","created_by":"adam","updated_at":"2026-01-05T22:16:47.464914-08:00","dependencies":[{"issue_id":"fray-mzg8.20","depends_on_id":"fray-mzg8","type":"parent-child","created_at":"2026-01-05T16:21:41.870175-08:00","created_by":"adam"}]}
{"id":"fray-mzg8.21","title":"Feature: Custom message collection views (user-defined filters)","description":"Allow users to create custom message collection views via filters. Similar to thread collections but for messages.\n\n**Ordering requirement**: Custom message collections should appear just below faves/unreads in the sidebar, hidden if empty. Only 'muted' collection stays at the very bottom.","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-05T16:21:42.005578-08:00","created_by":"adam","updated_at":"2026-01-05T22:16:52.098647-08:00","dependencies":[{"issue_id":"fray-mzg8.21","depends_on_id":"fray-mzg8","type":"parent-child","created_at":"2026-01-05T16:21:42.006016-08:00","created_by":"adam"}]}
{"id":"fray-mzg8.22","title":"Refactor: Introduce threadCollectionView type","description":"Replace pseudothread-based 'muted' with proper threadCollectionView type. Thread collections show lists of threads (muted, unread-mentions, etc). Separate from messageCollectionView.","status":"closed","priority":2,"issue_type":"task","assignee":"opus","created_at":"2026-01-05T16:21:56.573844-08:00","created_by":"adam","updated_at":"2026-01-05T16:23:26.434248-08:00","closed_at":"2026-01-05T16:23:26.434248-08:00","close_reason":"Introduced threadCollectionView type in panels.go. Thread collections (muted, unread-mentions) now distinct from message collections.","dependencies":[{"issue_id":"fray-mzg8.22","depends_on_id":"fray-mzg8","type":"parent-child","created_at":"2026-01-05T16:21:56.576135-08:00","created_by":"adam"}]}
{"id":"fray-mzg8.23","title":"Refactor: Rename pseudoThreadKind to messageCollectionView","description":"Rename pseudoThreadKind to messageCollectionView for semantic clarity. Message collections show message feeds (open-qs, stale-qs, etc). Distinct from threadCollectionView.","status":"closed","priority":2,"issue_type":"task","assignee":"opus","created_at":"2026-01-05T16:21:56.710917-08:00","created_by":"adam","updated_at":"2026-01-05T16:24:33.721531-08:00","closed_at":"2026-01-05T16:24:33.721531-08:00","close_reason":"Renamed pseudoThreadKind to messageCollectionView throughout codebase. Added type alias for backwards compatibility. All references updated in panels.go and questions.go.","dependencies":[{"issue_id":"fray-mzg8.23","depends_on_id":"fray-mzg8","type":"parent-child","created_at":"2026-01-05T16:21:56.711423-08:00","created_by":"adam"}]}
{"id":"fray-mzg8.24","title":"Chat: Semantic click-to-copy for IDs, text, sections, messages","description":"Advanced click-to-copy system using bubblezone to compensate for terminal select limitations. Double-click IDs to copy just ID, text to copy paragraph, whitespace to copy section (lists/headers), byline/footer to copy whole message. IDs highlighted with bold+underline. Flash white animation on copy for feedback.\n\nImplementation: Use lrstanley/bubblezone to mark regions during message rendering (IDs, paragraphs, sections, bylines). Mouse handler checks which zone was clicked and copies appropriate content. Bubblezone handles position tracking and coordinate mapping automatically.","design":"See mzg8.24-design thread (thrd-pcidsjsx) for complete spec. Key decisions: paragraph-level text copy, optimistic list detection with 2-blank-line breaks, IDs bold+underlined, white flash animation on copy.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-05T17:42:54.987672-08:00","created_by":"adam","updated_at":"2026-01-05T19:06:40.111568-08:00","closed_at":"2026-01-05T19:06:40.111568-08:00","close_reason":"Implemented semantic click-to-copy using bubblezone. Double-click on: message ID (copies ID), byline/footer (copies whole message), paragraph (copies paragraph). IDs now bold+underlined. Bubblezone handles all position tracking automatically.","dependencies":[{"issue_id":"fray-mzg8.24","depends_on_id":"fray-mzg8","type":"parent-child","created_at":"2026-01-05T17:42:54.988183-08:00","created_by":"adam"}]}
{"id":"fray-mzg8.25","title":"Chat: Deep linking via fray:// URL scheme","description":"Register custom URL scheme (fray://) to enable jumping to specific locations from OS notifications or external links.\n\n## Format\n`fray://channel/thread/message` or `fray://channel#msg-abc123`\n\n## Implementation\n- macOS: Register URL handler via Info.plist or LSRegisterURL\n- Parse incoming URLs and navigate fray chat to the target\n- Handle cases: channel only, thread, specific message\n\n## Use Cases\n- Click OS notification → opens fray chat at that message\n- Share links to specific threads/messages externally\n- Integration with other tools","status":"in_progress","priority":1,"issue_type":"feature","created_at":"2026-01-06T14:33:32.074118-08:00","created_by":"adam","updated_at":"2026-01-06T17:48:02.894842-08:00","dependencies":[{"issue_id":"fray-mzg8.25","depends_on_id":"fray-mzg8","type":"parent-child","created_at":"2026-01-06T14:33:32.074641-08:00","created_by":"adam"},{"issue_id":"fray-mzg8.25","depends_on_id":"fray-pnm9","type":"blocks","created_at":"2026-01-06T17:49:37.40898-08:00","created_by":"adam"}]}
{"id":"fray-mzg8.3","title":"Chat: thread expand/collapse in sidebar","description":"Allow nested threads to be expanded/collapsed in the thread panel. Support 4-level nesting. Persist collapse state.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-05T12:04:13.569873-08:00","created_by":"adam","updated_at":"2026-01-05T12:09:07.215891-08:00","closed_at":"2026-01-05T12:09:07.215891-08:00","close_reason":"Implemented thread expand/collapse - added collapsedThreads state, ▸/▾ indicators, h/l and left/right arrow keys to toggle","dependencies":[{"issue_id":"fray-mzg8.3","depends_on_id":"fray-mzg8","type":"parent-child","created_at":"2026-01-05T12:04:13.570354-08:00","created_by":"adam"}]}
{"id":"fray-mzg8.4","title":"Chat: faves float to top","description":"Faved threads should appear at the top of the thread list or in a separate 'Favorites' section in the sidebar.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-05T12:04:13.704997-08:00","created_by":"adam","updated_at":"2026-01-05T12:10:43.162862-08:00","closed_at":"2026-01-05T12:10:43.162862-08:00","close_reason":"Implemented faved threads floating to top with ★ indicator - sorted faved threads first, added visual indicator","dependencies":[{"issue_id":"fray-mzg8.4","depends_on_id":"fray-mzg8","type":"parent-child","created_at":"2026-01-05T12:04:13.705513-08:00","created_by":"adam"}]}
{"id":"fray-mzg8.5","title":"Chat sidebar: core restructure - thread ordering and collapsed view","description":"Restructure thread sidebar display order:\n1. main\n2. unreads (with ✦ indicator)\n3. faves (with ✪ indicator)  \n4. subscribed threads by recency\n5. all other threads collapsed to top level (dim grey, ❯ shows depth)\n\nShow ALL threads in channel, not just subscribed. Non-subscribed are dim grey.\n\nDesign: mzg8-design thread, msg-fcw5ky82","status":"closed","priority":1,"issue_type":"feature","assignee":"opus","created_at":"2026-01-05T15:38:45.790982-08:00","created_by":"adam","updated_at":"2026-01-05T16:25:47.422951-08:00","closed_at":"2026-01-05T16:25:47.422951-08:00","close_reason":"Completed core sidebar restructure:\n- Fetch ALL threads (not just subscribed) via loadThreads()\n- Added subscribedThreads, mutedThreads tracking to Model\n- Introduced threadCollectionView and messageCollectionView types\n- Reordered thread display: main → unreads → faves → subscribed (by recency) → collapsed others → collections\n- Collapsed non-subscribed threads show with dim grey (240) and depth indicators (❯ name ❯❯)\n- Depth calculated recursively via calculateMaxDepth()\n- Build successful, ready for testing","dependencies":[{"issue_id":"fray-mzg8.5","depends_on_id":"fray-mzg8","type":"parent-child","created_at":"2026-01-05T15:38:45.791506-08:00","created_by":"adam"}]}
{"id":"fray-mzg8.6","title":"Chat sidebar: depth navigation with drill in/out","description":"Implement hierarchical drill navigation:\n- h/← drills out (to parent)\n- l/→ drills into thread with children\n- Leaf nodes (no ❯) not drillable - Enter just views messages\n\nHeader shows: ❮ count = depth, colored (blue→purple→green→yellow), full path\nExample at opus/meta/: `❮❮ opus/meta/` in purple\n\nWhen drilled in:\n- Top item is 'new main' (❮ threadname)\n- Shows only immediate children\n- ❯ indicates has nested children\n\nFocus: drill in → first child, drill out → item we came from\n\nDesign: mzg8-design thread, msg-ogp6a4nx, msg-fg81mjn8","status":"closed","priority":1,"issue_type":"feature","assignee":"opus","created_at":"2026-01-05T15:39:02.876068-08:00","created_by":"adam","updated_at":"2026-01-05T16:30:11.71055-08:00","closed_at":"2026-01-05T16:30:11.71055-08:00","close_reason":"Completed depth navigation with drill in/out:\n- Added drillPath []string to Model to track current drill state\n- Implemented drill methods: drillIn(), drillOut(), currentDrillThread(), drillDepth()\n- Updated threadEntries() to filter by parent when drilled (shows only immediate children)\n- Header shows colored chevrons by depth: blue(0), purple(1), green(2), yellow(3+) with path\n- h/← drills out to parent, l/→ drills into thread with children\n- Leaf nodes (no children): Enter views messages, stays at current level\n- Focus management: drill in → first child, drill out → item we came from\n- Back entry shown as ❮ threadname at top when drilled\nBuild successful, ready for testing","dependencies":[{"issue_id":"fray-mzg8.6","depends_on_id":"fray-mzg8","type":"parent-child","created_at":"2026-01-05T15:39:02.883917-08:00","created_by":"adam"},{"issue_id":"fray-mzg8.6","depends_on_id":"fray-mzg8.5","type":"blocks","created_at":"2026-01-05T15:39:47.653494-08:00","created_by":"adam"}]}
{"id":"fray-mzg8.7","title":"Chat sidebar: dynamic width calculation","description":"Dynamic sidebar width:\n- Width = longest visible thread name + 4 char buffer\n- Max 50 chars\n- Snapshot width when Tab opens sidebar (don't resize dynamically)\n- Names that exceed width wrap with 2-char indent on ALL continuation lines\n\nDesign: mzg8-design thread, section 5","status":"closed","priority":1,"issue_type":"feature","assignee":"opus","created_at":"2026-01-05T15:39:03.010677-08:00","created_by":"adam","updated_at":"2026-01-05T16:37:22.989937-08:00","closed_at":"2026-01-05T16:37:22.989937-08:00","close_reason":"Completed dynamic width calculation:\n- Added cachedThreadPanelWidth field to Model \n- Calculates width = longest visible thread name + 4 char buffer, max 50\n- Width snapshot taken when panel opens (stays until closed)\n- Added wrapLine() function for overflow names with 2-char indent on continuation lines\n- Wrapping replaces truncation for better visibility\n- Updated threadPanelWidth() to use cached value\n- Build successful, ready for testing","dependencies":[{"issue_id":"fray-mzg8.7","depends_on_id":"fray-mzg8","type":"parent-child","created_at":"2026-01-05T15:39:03.011137-08:00","created_by":"adam"}]}
{"id":"fray-mzg8.8","title":"Chat sidebar: fzf search mode","description":"Implement fzf-style search:\n- Space enters search mode\n- Type to filter - matches any thread (uncollapsed view)\n- Highlight matching characters in results\n- Esc exits search mode\n- Selecting result: view messages AND drill sidebar to parent level\n\nDesign: mzg8-design thread, section 2, msg-eom4r2b8 Q1","status":"closed","priority":1,"issue_type":"feature","assignee":"opus","created_at":"2026-01-05T15:39:03.137407-08:00","created_by":"adam","updated_at":"2026-01-05T16:32:19.13169-08:00","closed_at":"2026-01-05T16:32:19.13169-08:00","close_reason":"Completed fzf search mode:\n- Space enters search mode (already implemented via threadFilterActive)\n- Type to filter - matches any thread across all threads (subscribed + non-subscribed)\n- Esc exits search mode (already implemented)\n- Selection behavior (Option A): selecting search result drills sidebar to parent level\n- Added drill path construction when selecting nested thread from search\n- Automatically exits search mode after selection\n- Character highlighting deferred as future enhancement\nBuild successful, ready for testing","dependencies":[{"issue_id":"fray-mzg8.8","depends_on_id":"fray-mzg8","type":"parent-child","created_at":"2026-01-05T15:39:03.137913-08:00","created_by":"adam"},{"issue_id":"fray-mzg8.8","depends_on_id":"fray-mzg8.5","type":"blocks","created_at":"2026-01-05T15:39:47.678633-08:00","created_by":"adam"}]}
{"id":"fray-mzg8.9","title":"Chat sidebar: keyboard shortcuts overhaul","description":"Update keyboard handling:\n- Tab: open threads sidebar (no cycling)\n- Shift-Tab: open channels sidebar\n- Enter: close sidebar, focus message pane\n- Ctrl-b: toggle sidebar persistence (Tab changes focus only)\n- j/k/↑/↓: navigate list\n- h/l/←/→: drill out/in (see fray-mzg8.6)\n- Space: enter search (see fray-mzg8.8)\n- Esc: exit search / close sidebar\n\nDesign: mzg8-design thread, msg-dun5x2fv","status":"closed","priority":1,"issue_type":"feature","assignee":"opus","created_at":"2026-01-05T15:39:18.13121-08:00","created_by":"adam","updated_at":"2026-01-05T16:40:13.955734-08:00","closed_at":"2026-01-05T16:40:13.955734-08:00","close_reason":"Completed keyboard shortcuts overhaul:\n- Tab: opens threads panel (no cycling)\n- Shift-Tab: opens channels panel\n- Enter: closes sidebar and focuses message pane (or selects in filter mode)\n- Esc: closes sidebar (or exits filter mode)\n- Ctrl-B: toggles sidebar persistence (Tab changes focus only when persistent)\n- Added openThreadPanel(), openChannelPanel(), closePanels(), toggleSidebarPersistence()\n- Updated keyboard handlers in model.go and panels.go\n- j/k/↑/↓, h/l drill navigation, Space search all working from prior tasks\n- Build successful\n\nNote: /f, /n, /M shortcuts for fave/nickname/mute deferred to their feature beads (fray-mzg8.10, fray-mzg8.11)","dependencies":[{"issue_id":"fray-mzg8.9","depends_on_id":"fray-mzg8","type":"parent-child","created_at":"2026-01-05T15:39:18.134762-08:00","created_by":"adam"}]}
{"id":"fray-n0h","title":"P0: Project Setup","description":"Initialize Go module, add dependencies (bubbletea, bubbles, lipgloss, cobra, modernc.org/sqlite, chroma, gobwas/glob). Create basic main.go and root command structure. ~2 hours.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T12:14:04.095215-08:00","updated_at":"2025-12-21T01:27:06.003553-08:00","closed_at":"2025-12-21T01:27:06.003553-08:00","close_reason":"Completed in Go rewrite"}
{"id":"fray-n0pg","title":"mlld-based /fly and /land protocols","description":"Replace static slash commands with mlld scripts for programmatic onboarding/closeout.\n\n**Why mlld:**\n- Parameters: `/fly opus architect fray-abc123`\n- Conditional logic: only show bd ready if handoff doesn't have explicit work\n- Role handling: auto-play role, inject role knowledge\n- Bead focus: if given bead-id, show prominently\n- Extensible without rewriting markdown\n\n**fly.mld signature:**\n```\nmlld fly.mld \u003cagent\u003e [role] [bead-id]\n```\n\n**Key conditionals:**\n- If handoff has explicit work items → skip bd ready\n- If role specified → play role, show role knowledge\n- If bead-id specified → show bead context prominently\n- Show questions directed to agent\n- Show watching threads with activity\n\n**land.mld additions:**\n- Self-knowledge update (role learnings, self patterns)\n- Journal reflection + prior journal reading\n- Thread gardening (update anchors, rehome messages)\n- Role teardown (clear played roles)\n\n**Questions integration:**\n- `# Questions for @x` syntax guidance in onboarding\n- `fray questions` check in both protocols\n- Question routing guidance (who to ask for what)\n\nDepends on fray-wl5n (roles), fray-gz26 (curation), fray-adj6 (knowledge hierarchy).","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-01T18:37:18.943971-08:00","created_by":"adam","updated_at":"2026-01-01T18:37:18.943971-08:00","dependencies":[{"issue_id":"fray-n0pg","depends_on_id":"fray-wl5n","type":"blocks","created_at":"2026-01-01T18:37:24.684601-08:00","created_by":"adam"},{"issue_id":"fray-n0pg","depends_on_id":"fray-gz26","type":"blocks","created_at":"2026-01-01T18:37:24.709453-08:00","created_by":"adam"},{"issue_id":"fray-n0pg","depends_on_id":"fray-adj6","type":"blocks","created_at":"2026-01-01T18:37:24.73288-08:00","created_by":"adam"},{"issue_id":"fray-n0pg","depends_on_id":"fray-mgr0","type":"blocks","created_at":"2026-01-01T18:37:42.811304-08:00","created_by":"adam"},{"issue_id":"fray-n0pg","depends_on_id":"fray-arlf","type":"parent-child","created_at":"2026-01-06T12:39:02.01056-08:00","created_by":"adam"}]}
{"id":"fray-n28i","title":"Cross-thread queries: faves, pinned, reactions by/to agent","description":"Cross-thread queries via existing commands:\n- fray faves --as alice (personal collection)\n- fray reactions --by alice (messages alice reacted to)\n- fray reactions --to alice (reactions on alice's messages)\n\nNow that fray-w6xh landed, these fit naturally alongside path-based get/post.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-01T12:24:05.26686-08:00","created_by":"adam","updated_at":"2026-01-05T03:12:36.978805-08:00","closed_at":"2026-01-05T03:12:36.978805-08:00","close_reason":"Added 'fray reactions' command with --by and --to flags. fray faves already exists.","dependencies":[{"issue_id":"fray-n28i","depends_on_id":"fray-gz26","type":"parent-child","created_at":"2026-01-01T12:24:28.248646-08:00","created_by":"adam"}]}
{"id":"fray-n6r","title":"Add CHANGELOG.md","description":"Create CHANGELOG.md with v0.1.0 initial release entry","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T19:55:18.468517-08:00","updated_at":"2025-12-19T22:57:34.311312-08:00","closed_at":"2025-12-17T20:01:45.308131-08:00","close_reason":"Closed"}
{"id":"fray-n7d","title":"P6: Slash Commands \u0026 Edit (P2 feature)","description":"Add slash commands: /edit, /delete, /prune, /help, /quit. Implement up-to-edit (up arrow with empty input loads last message). ~4 hours.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T12:17:42.254058-08:00","updated_at":"2025-12-21T01:27:06.006062-08:00","closed_at":"2025-12-21T01:27:06.006062-08:00","close_reason":"Completed in Go rewrite","dependencies":[{"issue_id":"fray-n7d","depends_on_id":"fray-m6c","type":"blocks","created_at":"2025-12-20T12:22:31.404849-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-n9p8","title":"Feature: Scroll to specific message after thread navigation","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-06T17:49:31.836651-08:00","created_by":"adam","updated_at":"2026-01-06T17:49:31.836651-08:00"}
{"id":"fray-nbjk","title":"CLI: fray thread rename command","description":"Add ability to rename threads via CLI:\n\n```bash\nfray thread rename \u003cthread-ref\u003e \u003cnew-name\u003e\n# or\nfray rename-thread \u003cthread-ref\u003e \u003cnew-name\u003e\n```\n\nCurrently `fray rename` only works for agents. Need thread equivalent for:\n1. CLI usage\n2. Chat `/rename` command (fray-659c) to call","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-01-06T12:59:04.226434-08:00","created_by":"adam","updated_at":"2026-01-06T13:23:26.699639-08:00","closed_at":"2026-01-06T13:23:26.699639-08:00","close_reason":"Command already exists: fray thread rename \u003cthread\u003e \u003cname\u003e - tested and working","dependencies":[{"issue_id":"fray-nbjk","depends_on_id":"fray-a5hc","type":"parent-child","created_at":"2026-01-06T13:18:45.140098-08:00","created_by":"adam"}]}
{"id":"fray-nksk","title":"Meta thread should appear first in thread list","description":"In thread listings, meta should always be organized as the first item after the main channel at the top (above faves/unread mentions).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T10:35:28.45596-08:00","created_by":"adam","updated_at":"2026-01-06T11:08:08.07059-08:00","closed_at":"2026-01-06T11:08:08.07059-08:00","close_reason":"Implemented meta-first sorting in both chat sidebar (panels.go) and CLI threads --tree command (thread_container.go)"}
{"id":"fray-nlkb","title":"Daemon: thread ownership model","description":"Human user owns main channel. Threads owned by creator.\n\nRules:\n- Room: only human @mentions trigger agents\n- Threads: creator owns, can transfer ownership\n- User-started threads: no agent owner until user assigns one\n- Only trigger daemon if mentioned by owner\n- Agents don't respond to other agents unless owner mentions them\n\nCommands needed:\n- fray thread owner \u003cthread\u003e \u003cagent\u003e - assign/transfer ownership","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-01-02T13:19:51.938062-08:00","created_by":"adam","updated_at":"2026-01-02T16:01:27.579897-08:00","closed_at":"2026-01-02T16:01:27.579897-08:00","close_reason":"Implemented in 14032eb"}
{"id":"fray-nxv","title":"Fix chat sidebar UX + thread search","description":"Current issues:\n- Sidebar tries to show channels AND threads simultaneously\n- Can't search for threads not in list\n\nNeeded behavior:\n- Tab cycles: channels → threads → hidden (clean separation)\n- Consistent keyboard navigation\n- **Thread search**: Type to filter/search threads even if not listed\n- Enter to switch to selected item\n\nReference: internal/chat/model.go","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-30T16:46:47.705933-08:00","created_by":"adam","updated_at":"2025-12-30T17:13:20.170908-08:00","closed_at":"2025-12-30T17:13:20.170908-08:00","close_reason":"Implemented: Tab cycles threads→channels→hidden, thread search queries DB for unlisted threads"}
{"id":"fray-nz18","title":"Bug: sidebar Enter key mutes instead of selecting","description":"Critical: hitting Enter on a thread item mutes it instead of loading the chat and closing panel. User accidentally muted 10 channels. Remove mute shortcuts from sidebar entirely, only allow /mute command.","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-05T20:38:36.309552-08:00","created_by":"adam","updated_at":"2026-01-05T20:44:10.669296-08:00","closed_at":"2026-01-05T20:44:10.669296-08:00","close_reason":"Removed Ctrl+M mute shortcut from sidebar (conflicted with Enter). Enter now properly calls selectThreadEntry(). Mute still available via /mute command."}
{"id":"fray-o17j","title":"Ghost cursor for session continuity","description":"Add ghost cursor concept for agent session handoffs.\n\n**Real cursor**: Where the agent actually read to (truth, per-home)\n**Ghost cursor**: Where the outgoing agent says the next agent should START reading from\n\nUse case: Agent leaves at msg-100, but the relevant context starts at msg-50. Ghost cursor = msg-50. Next agent running neo gets msg-50→current.\n\n## Behavior\n- Ghost cursor persists until explicitly changed\n- Agent updates it as part of /land teardown\n- Can stay the same across multiple sessions on same epic\n- Quick-answer sessions can use it without clearing it\n\n## must-read flag\n\nGhost cursor has `must-read: true|false` per-home:\n- `must-read: true` → full thread content injected in neo\n- `must-read: false` → hint only (\"3 new in design-thread\")\n\nAllows agent to say \"you MUST read the design thread\" vs \"FYI there's activity in meta\"\n\nUses accordion output (fray-v1ku) when must-read sections are long.\n\nInforms: neo command, fray get defaults, daemon context injection","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-03T01:01:25.507698-08:00","created_by":"adam","updated_at":"2026-01-03T01:55:25.557833-08:00","closed_at":"2026-01-03T01:55:25.557833-08:00","close_reason":"Implemented ghost cursor feature: types, JSONL storage, SQLite schema, fray cursor command (set/show/clear), integration into hook_session and get command for context injection","dependencies":[{"issue_id":"fray-o17j","depends_on_id":"fray-v1ku","type":"blocks","created_at":"2026-01-03T01:18:27.42781-08:00","created_by":"adam"}]}
{"id":"fray-o5ow","title":"Bug: /land should clarify it will replace existing handoff note","description":"When agent runs /land and handoff note already exists, skill output says 'The handoff note already exists and is good' but doesn't make it clear the agent is supposed to update/replace it. Source: msg-ju7phate","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-06T15:40:43.447403-08:00","created_by":"adam","updated_at":"2026-01-06T16:21:11.084787-08:00","closed_at":"2026-01-06T16:21:11.084787-08:00","close_reason":"Updated /land skill to clarify handoff update expectations - agents should evaluate what they accomplished and update accordingly"}
{"id":"fray-o7bj","title":"Fix /fly priority hierarchy confusion","description":"From session: agent notes said 'Next Up' but agent got distracted by mentions. Fixed /fly to clarify: notes = assignment, mentions = context only. Deviate only for blocking issues or human questions.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-03T22:55:52.591022-08:00","created_by":"adam","updated_at":"2026-01-03T22:56:00.757254-08:00","closed_at":"2026-01-03T22:56:00.757254-08:00","close_reason":"Updated /fly: clarified notes = assignment, mentions = context. Section renamed 'Get Your Assignment', added 'only deviate for blocking/human questions'. Also fixed /land step 2 for handoff clarity."}
{"id":"fray-o8k","title":"When an agent runs `post` if there are unread @s or messages, return those in the confirmation","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T11:43:34.841778-08:00","updated_at":"2025-12-19T22:57:34.31223-08:00","closed_at":"2025-12-09T12:27:50.498855-08:00","labels":["creator:adamavenir@hey.com","fizzy:maybe"]}
{"id":"fray-oa5","title":"Implement config and linked project query functions","description":"Create query functions for config and linked projects in src/db/queries.ts.\n\n## Functions to Implement\n\n```typescript\n// src/db/queries.ts (config and project functions)\n\nimport type { LinkedProject, ConfigEntry } from '../types.js';\nimport type Database from 'better-sqlite3';\n\n/**\n * Get config value by key.\n * @returns value or undefined if not set\n */\nexport function getConfig(db: Database, key: string): string | undefined;\n\n/**\n * Set config value.\n * Uses INSERT OR REPLACE for upsert.\n */\nexport function setConfig(db: Database, key: string, value: string): void;\n\n/**\n * Get all config entries.\n */\nexport function getAllConfig(db: Database): ConfigEntry[];\n\n/**\n * Get linked project by alias.\n */\nexport function getLinkedProject(db: Database, alias: string): LinkedProject | undefined;\n\n/**\n * Get all linked projects.\n */\nexport function getLinkedProjects(db: Database): LinkedProject[];\n\n/**\n * Link a project (store in database).\n * @param alias - short name for --project flag\n * @param path - absolute path to project root\n * Note: Caller is responsible for validating path exists and contains .beads/\n */\nexport function linkProject(db: Database, alias: string, path: string): void;\n\n/**\n * Unlink a project.\n * @returns true if project was removed, false if didn't exist\n */\nexport function unlinkProject(db: Database, alias: string): boolean;\n```\n\n## Implementation Notes\n- Config uses INSERT OR REPLACE for upsert semantics\n- linkProject is a pure database function - path validation happens in the CLI command layer (bdm-1ur)\n- Store absolute paths (caller should resolve relative paths before calling)\n\n## Default Config Values\n- stale_hours: \"4\" (inserted by schema initialization)\n\n## Files\n- src/db/queries.ts (add config and project functions)\n\n## Acceptance Criteria\n- Config get/set works correctly\n- Linked projects store paths as provided\n- Unit tests for all functions","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T10:00:19.532948-08:00","updated_at":"2025-12-19T22:57:34.306839-08:00","closed_at":"2025-12-04T12:23:55.92686-08:00","dependencies":[{"issue_id":"fray-oa5","depends_on_id":"fray-08v","type":"parent-child","created_at":"2025-12-04T10:01:05.2842-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-oa5","depends_on_id":"fray-6cj","type":"blocks","created_at":"2025-12-04T10:01:48.915854-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-oa5","depends_on_id":"fray-1wj","type":"blocks","created_at":"2025-12-04T10:01:54.035998-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-on0o","title":"fray answer: question content not wrapping","description":"In fray answer TUI, question content doesn't wrap to terminal width. Long questions get cut off or overflow.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-06T10:58:58.874152-08:00","created_by":"adam","updated_at":"2026-01-06T12:37:37.449839-08:00","closed_at":"2026-01-06T12:37:37.449839-08:00","close_reason":"Duplicate of fray-wrtw"}
{"id":"fray-otr7","title":"Fix: ghost cursor session awareness for @mentions","description":"Fixed fray @agent to use ghost cursor as unread boundary with session-aware acknowledgment. Implemented session_ack_at tracking.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-03T06:37:33.92804-08:00","created_by":"adam","updated_at":"2026-01-03T06:37:40.589322-08:00","closed_at":"2026-01-03T06:37:40.589322-08:00","close_reason":"Implemented session_ack_at tracking in ghost cursors. fray @agent now uses ghost cursor as unread boundary for first view in session, then switches to read receipts."}
{"id":"fray-otxt","title":"README: document recommended allowlist for daemon","description":"Add section to README documenting recommended Claude Code allowlist commands for daemon operation. At minimum: fray back, fray new. Should cover all commands agents need without manual approval.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T16:09:32.311555-08:00","created_by":"adam","updated_at":"2026-01-02T16:09:32.311555-08:00"}
{"id":"fray-oww1","title":"Agent views (extend fray get)","description":"Agent views extend 'fray get --as \u003cagent\u003e' to include subscribed thread activity.\n\nNow that fray-w6xh landed:\n- fray get --as opus (room + mentions + subscribed thread activity)\n- fray get notifs --as opus (mentions only, not room)\n\n**Mention hierarchy** (from fray-bu0g):\n- **Recent @agent** (direct address, \u003c2h): Show full, high priority\n- **You were FYI'd here** (mid-message mention, \u003c2h): Lower priority  \n- **Likely stale (\u003e2h)**: Just show count, no details\n\n**No wasteful suggestions**:\nOutput should NOT suggest '--all' or similar commands. Just show facts.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-01T12:24:05.514412-08:00","created_by":"adam","updated_at":"2026-01-05T03:20:24.450278-08:00","closed_at":"2026-01-05T03:20:24.450278-08:00","close_reason":"Removed wasteful 'More:' suggestion. Added mention hierarchy: direct (@agent at start), FYI (mid-message), stale (\u003e2h shows count only).","dependencies":[{"issue_id":"fray-oww1","depends_on_id":"fray-gz26","type":"parent-child","created_at":"2026-01-01T12:24:28.273116-08:00","created_by":"adam"},{"issue_id":"fray-oww1","depends_on_id":"fray-bu0g","type":"related","created_at":"2026-01-03T19:39:21.574743-08:00","created_by":"adam"}]}
{"id":"fray-p3vo","title":"4-level thread nesting","description":"4-level nesting: room → L1 → L2 → L3 → L4 (max). Room is container, not thread. Reject creation at L5+: 'cannot create thread: maximum nesting depth (4) exceeded'. See THREAD-CURATION-SPEC.md Phase 5.","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-01-01T12:23:50.064046-08:00","created_by":"adam","updated_at":"2026-01-03T21:56:28.389942-08:00","closed_at":"2026-01-03T21:56:28.389942-08:00","close_reason":"Added MaxThreadNestingDepth=4 constant and getThreadDepth helper. Validation in NewThreadNewCmd rejects threads that would exceed depth 4.","dependencies":[{"issue_id":"fray-p3vo","depends_on_id":"fray-gz26","type":"parent-child","created_at":"2026-01-01T12:24:28.152962-08:00","created_by":"adam"}]}
{"id":"fray-pk0","title":"Go: Add rename command","description":"Missing 'mm rename \u003cold\u003e \u003cnew\u003e' command to rename an agent.","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-21T01:34:05.679639-08:00","updated_at":"2025-12-21T02:17:13.693346-08:00","closed_at":"2025-12-21T02:17:13.693346-08:00","close_reason":"Implemented rename command"}
{"id":"fray-pnm9","title":"Debug: Thread post notifications not triggering maybeNotify()","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T17:49:31.79715-08:00","created_by":"adam","updated_at":"2026-01-06T18:08:55.637228-08:00","closed_at":"2026-01-06T18:08:55.637228-08:00","close_reason":"Fixed: Two issues - (1) mention polling wasn't checking threads, added mentionMessages to pollCmd; (2) user @mentions weren't being extracted because GetAgentBases didn't include users. Added users to bases in post.go.","labels":["discuss"]}
{"id":"fray-po1","title":"Phase 5: Polish \u0026 Documentation","description":"Production-ready CLI with documentation.\n\n## Goal\nFinal polish for v1.0 release:\n- Consistent output formatting\n- Comprehensive error handling\n- Complete README documentation\n- Installable npm package\n\n## Context\nAll core functionality is implemented in Phases 1-4.\nThis phase focuses on user experience and release readiness.\n\n## Exit Criteria\n- README covers all functionality\n- `npm pack` produces installable package\n- `npm install -g` works\n- No console warnings in normal operation\n- All tests pass","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-04T10:12:22.895797-08:00","updated_at":"2025-12-19T22:57:34.295705-08:00","closed_at":"2025-12-04T12:48:18.166892-08:00","dependencies":[{"issue_id":"fray-po1","depends_on_id":"fray-yh4","type":"blocks","created_at":"2025-12-04T10:19:19.550804-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-poo","title":"Design: neo command (agent onboarding)","description":"Agent onboarding brain dump - 'I know kung fu' moment.\n\n```bash\nfray neo alice                   # register + dump context\n```\n\nOutputs (ideas):\n- Pinned/starred items from subscribed threads\n- Open questions assigned to agent\n- Active claims in channel\n- Recent activity summary\n- Unread context since last session\n\n**Blocker**: Needs improved read state tracking to know what's 'new' vs 'caught up'.\n\nFirst step: Design session to clarify what context agents actually need on onboard.","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-30T16:46:05.404301-08:00","created_by":"adam","updated_at":"2026-01-06T12:37:23.909106-08:00","dependencies":[{"issue_id":"fray-poo","depends_on_id":"fray-373","type":"blocks","created_at":"2025-12-30T16:47:08.923804-08:00","created_by":"daemon"},{"issue_id":"fray-poo","depends_on_id":"fray-5td","type":"blocks","created_at":"2025-12-30T16:47:08.953183-08:00","created_by":"daemon"},{"issue_id":"fray-poo","depends_on_id":"fray-qnd","type":"blocks","created_at":"2025-12-31T14:42:44.01567-08:00","created_by":"adam"},{"issue_id":"fray-poo","depends_on_id":"fray-9es0","type":"blocks","created_at":"2026-01-05T11:44:38.722934-08:00","created_by":"adam"},{"issue_id":"fray-poo","depends_on_id":"fray-gusm","type":"blocks","created_at":"2026-01-05T11:44:38.747903-08:00","created_by":"adam"}]}
{"id":"fray-pp6m","title":"Add rebuild regression tests with adversarial JSONL ordering","description":"Add tests that verify rebuild handles edge cases: child threads before parents, shuffled event order, reparented threads. Prevents future FK constraint regressions. Per gpt52's recommendation.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-06T10:36:50.434097-08:00","created_by":"adam","updated_at":"2026-01-06T10:36:50.434097-08:00"}
{"id":"fray-qf21","title":"open-qs shows duplicate posts for multi-question messages","description":"Messages with multiple questions appear multiple times in open-qs view - once per question. Should show each message once with all its questions.","status":"closed","priority":1,"issue_type":"bug","assignee":"opus","created_at":"2026-01-06T10:58:58.634594-08:00","created_by":"adam","updated_at":"2026-01-06T16:24:17.867257-08:00","closed_at":"2026-01-06T16:24:17.867257-08:00","close_reason":"Deduplicated messages in open-qs view. Messages with multiple questions now appear once instead of once per question."}
{"id":"fray-qhco","title":"Show agent avatars in meta/ thread listings","description":"When viewing threads under meta/, agent threads should show their avatar next to the thread name (e.g., 🅾 opus instead of just opus).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T10:35:27.780041-08:00","created_by":"adam","updated_at":"2026-01-06T11:11:14.915529-08:00","closed_at":"2026-01-06T11:11:14.915529-08:00","close_reason":"Added avatar display in meta/ thread listings: (1) Avatar field added to threadEntry struct in panels.go, (2) Avatar populated from avatarMap when creating agent entries in meta view, (3) Avatar shown as left indicator (replacing star for faved agent threads), (4) Fixed agent_update handling in jsonl_read.go to apply Avatar updates"}
{"id":"fray-qhy","title":"Implement Tasks primitive","description":"Agent work queue with blocking/unblocking.\n\n**Spec**: threads-03-aspirational.md (lines 128-148)\n\nKey features:\n- task-XXXXXXXX GUIDs\n- Status: pending, active, done, blocked\n- External ID linking: bead:xyz-123, gh:owner/repo/123, linear:PROJ-123\n- blocked_by: array of question/task GUIDs\n- Auto-unblock when blocking question resolves (→ pending, not active)\n\nCLI:\n- fray task add \"...\" --as bob [--external bead:xyz-123]\n- fray tasks [@agent]\n- fray task active/done/block task-abc\n\nStorage: tasks.jsonl or graph.jsonl","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-30T16:14:41.783494-08:00","created_by":"adam","updated_at":"2025-12-30T16:14:41.783494-08:00"}
{"id":"fray-ql6","title":"P0.0: Minimal GUID proof-of-concept","description":"Create minimal vertical slice to prove GUID architecture before full implementation.\n\nGoal: Simple working example of GUID→JSONL→SQLite flow\n\nImplement:\n1. GUID generation function (8-char base58)\n2. Single JSONL writer (messages.jsonl only)\n3. Simple SQLite rebuild from JSONL\n4. Basic .mm/mm-config.json with channel_id\n\nTest with:\n- mm post creates msg-GUID\n- Writes to messages.jsonl\n- Rebuilds SQLite on next read\n- Verify GUID stable across rebuilds\n\nFiles:\n- src/core/guid.ts (NEW) - generateGuid(type)\n- src/db/jsonl.ts (NEW) - appendMessage(), readMessages()\n- src/db/schema.ts - Add guid column to mm_messages\n- src/commands/post.ts - Generate GUID, write JSONL\n\nAcceptance:\n- Can post message\n- JSONL file created with valid format\n- SQLite rebuilt from JSONL\n- GUIDs preserved\n\nThis proves the architecture works before implementing all the features.\n\nReferences: PLAN.md sections 1, 2\nCritical files: src/core/guid.ts (NEW), src/db/jsonl.ts (NEW)","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-19T13:26:44.503921-08:00","updated_at":"2025-12-19T22:57:34.291364-08:00","closed_at":"2025-12-19T13:28:05.115706-08:00","close_reason":"No proof-of-concept - building the full thing","dependencies":[{"issue_id":"fray-ql6","depends_on_id":"fray-3vp","type":"blocks","created_at":"2025-12-19T13:31:03.878456-08:00","created_by":"daemon","metadata":"{}"},{"issue_id":"fray-ql6","depends_on_id":"fray-z3l","type":"blocks","created_at":"2025-12-19T13:31:03.965833-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-qlw","title":"Skip integration tests gracefully when bd CLI not installed","description":"## Problem\nIntegration tests hard-fail when `bd` isn't installed (tests/integration.test.ts:15-22).\n\n```typescript\nbeforeEach(() =\u003e {\n  try {\n    execSync('bd init --prefix test', { cwd: testDir, stdio: 'pipe' });\n  } catch (error) {\n    console.log('Skipping integration tests: bd CLI not found');\n    throw new Error('bd CLI not installed - skipping integration tests');\n  }\n});\n```\n\nThrowing in `beforeEach` causes the entire test suite to **fail**, not skip. This breaks `npm test` on machines without `bd`.\n\n## Fix\n1. Check for `bd` availability before the describe block\n2. Use `describe.skipIf()` or conditional `describe.skip`\n3. Or wrap in try/catch at describe level\n\nExample pattern:\n```typescript\nconst bdAvailable = (() =\u003e {\n  try {\n    execSync('bd --version', { stdio: 'pipe' });\n    return true;\n  } catch { return false; }\n})();\n\ndescribe.skipIf(!bdAvailable)('CLI integration tests', () =\u003e { ... });\n```\n\n## Files\n- tests/integration.test.ts:15-22\n\n## Acceptance Criteria\n- `npm test` passes on machines without bd installed\n- Integration tests are skipped (not failed) when bd unavailable\n- Clear skip message indicates why tests were skipped","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-04T14:03:48.56224-08:00","updated_at":"2025-12-19T22:57:34.301483-08:00","closed_at":"2025-12-04T14:27:52.621597-08:00"}
{"id":"fray-qnd","title":"Parse '# Questions for @x' sections from posts","description":"Auto-extract questions from markdown posts.\n\n## Convention\n- REQUIRE `# Questions for @x` header (or just `# Questions` = for user)\n- Allow `#` or `##` headers, ignore `###`+\n- Skip fenced code blocks when parsing\n- Multiple targets: `# Questions for @x @y @z`\n- Each numbered item (1. 2. 3.) becomes a question\n- Options via a. b. c. with nested - Pro/Con\n- `# Wondering` sections tracked but not displayed\n\n## Storage Model\n- Keep ORIGINAL body in JSONL (don't strip)\n- Create linked question records on post\n- Hide question content on RENDER only\n\n## Edit Handling\n- Editing body does NOT re-extract questions\n- Warn user that # Questions/# Wondering hidden on render\n- To edit questions, edit question object directly\n\n## Backward Compat\n- `fray ask` = single focused question (complementary)\n- `# Questions` = batch in context\n\nSee msg-ln1pevbd for original design, msg-mv35bxrh for implementation decisions.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-31T14:42:11.807705-08:00","created_by":"adam","updated_at":"2025-12-31T15:30:28.911511-08:00","closed_at":"2025-12-31T15:30:28.911511-08:00","close_reason":"Implemented question extraction from markdown. Parses # Questions for @x and # Wondering sections, extracts numbered questions with lettered options and pro/con bullets. Questions stored with options JSON, stripped from display on render."}
{"id":"fray-qnfs","title":"Feature: Cross-thread links (related context hints)","description":"Add lightweight bidirectional links between messages/threads as context breadcrumbs.\n\n## Concept\nWhen working, agents discover related context across threads - a design discussion that informed implementation, a bug report that led to a feature, a question that spawned a whole thread. These relationships are valuable but ephemeral unless captured.\n\nLinks are hints, not structure. They say 'this is related, might be worth exploring' without implying hierarchy or dependency.\n\n## Examples\n- Implementation thread ↔ Design discussion thread\n- Bug fix message ↔ Original bug report\n- Decision in meta ↔ Thread where it was debated\n- Question answer ↔ Thread where answer was discovered\n\n## Data Model\n```jsonl\n{\"type\":\"link\",\"id\":\"link-xxx\",\"from\":\"msg-abc\",\"to\":\"thrd-xyz\",\"by\":\"opus\",\"note\":\"design decisions\",\"ts\":...}\n```\n- Bidirectional by convention (can traverse either direction)\n- Optional note for context\n- Stored in links.jsonl or messages.jsonl\n\n## Commands\n```\nfray link \u003cfrom\u003e \u003cto\u003e \"optional note\" --as agent\nfray links \u003cmsg-or-thread\u003e   # show all links to/from this\n```\n\n## Integration with /land\nDuring /land, prompt: 'Any cross-thread links to add? (threads/messages you referenced that future agents should know about)'\n\n## Display\nWhen viewing a message or thread, show links:\n```\nRelated:\n  → thrd-r3z3e4gk (Agent Daemon Design) - design decisions\n  → msg-abc123 - original bug report\n```\n\n## Why This Matters\nBuilds organic knowledge graph over time. Future agents don't just see the thread they're in - they see trails to related context. Compounds across sessions.","status":"open","priority":1,"issue_type":"feature","created_at":"2026-01-02T01:32:41.458303-08:00","created_by":"adam","updated_at":"2026-01-06T12:37:23.908616-08:00"}
{"id":"fray-qqv","title":"P0.5: Agent GUID and global registry","description":"Implement agent GUID system with progressive discovery.\n\nAgent storage:\n- known_agents in .mm/mm-config.json (source of truth, committed)\n- Global config (~/.config/mm/) tracks channels only (NOT agents)\n\nmm new \u003cname\u003e flow:\n1. Check .mm/mm-config.json known_agents\n2. If exists: Prompt \"Use existing @\u003cname\u003e (\u003cusr-guid\u003e)? [Y/n]\"\n   - Y: Reuse GUID\n   - n: Generate new usr-\u003cguid\u003e\n3. If not exists: Generate new usr-\u003cguid\u003e\n4. Add to known_agents in .mm/mm-config.json\n5. Append to agents.jsonl\n\nAgent fields:\n- id: usr-\u003c8chars\u003e (GUID)\n- name: Simple name (e.g., \"devrel\")\n- global_name: Prefixed name (e.g., \"mm-devrel\")\n- home_channel: ch-\u003cguid\u003e or null for global agents\n- created_at: ISO timestamp\n- status: \"active\" or \"inactive\"\n\nAuto-nick generation:\n- If home_channel == current channel: nick = name\n- Else: nick = global_name\n\nReferences: PLAN.md sections 6, 3\nCritical files: src/commands/new.ts, src/core/config.ts, src/db/jsonl.ts","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-19T11:57:10.004318-08:00","updated_at":"2025-12-19T22:57:34.292411-08:00","closed_at":"2025-12-19T14:30:56.356025-08:00","close_reason":"Added known_agents reuse flow and updated agent config/JSONL metadata","dependencies":[{"issue_id":"fray-qqv","depends_on_id":"fray-z3l","type":"blocks","created_at":"2025-12-19T11:57:45.531318-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-qrc4","title":"Reactions: remove deduplication, add timestamps","description":"Reactions: no dedup (same agent can react multiple times across sessions), add timestamps. Display: '👍x3' when multiple, '👍 alice' when single. Reactions are forever (no remove). See THREAD-CURATION-SPEC.md Phase 3.","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-01T12:23:50.190927-08:00","created_by":"adam","updated_at":"2026-01-03T22:20:30.052454-08:00","closed_at":"2026-01-03T22:20:30.052454-08:00","close_reason":"Implemented reactions with timestamps: new fray_reactions table, JSONL records, removed deduplication, 👍x3 display for multiple reactions","dependencies":[{"issue_id":"fray-qrc4","depends_on_id":"fray-gz26","type":"parent-child","created_at":"2026-01-01T12:24:28.177028-08:00","created_by":"adam"}]}
{"id":"fray-qsbe","title":"Mute: unsubscribe with optional expiration","description":"Mute threads to unsubscribe. Optional --ttl for temporary mutes (expiry checked on query, no background job). fray thread mute/unmute. Muted threads excluded from default fray threads listing. See THREAD-CURATION-SPEC.md Phase 2.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-01T12:23:37.187736-08:00","created_by":"adam","updated_at":"2026-01-02T02:11:44.890192-08:00","closed_at":"2026-01-02T02:11:44.890192-08:00","close_reason":"Implemented in f59e8a3","dependencies":[{"issue_id":"fray-qsbe","depends_on_id":"fray-gz26","type":"parent-child","created_at":"2026-01-01T12:24:28.082761-08:00","created_by":"adam"}]}
{"id":"fray-qsef","title":"Add message to thread (reference, not move)","description":"fray thread add references messages without changing their home field. Distinct from fray mv which moves messages. Already exists - verify behavior matches spec. See THREAD-CURATION-SPEC.md Phase 1.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-01T12:23:49.806584-08:00","created_by":"adam","updated_at":"2026-01-02T00:26:34.027647-08:00","closed_at":"2026-01-02T00:26:34.027647-08:00","close_reason":"Verified: fray thread add already adds references (via fray_thread_messages) without moving. fray mv is for actual moves.","dependencies":[{"issue_id":"fray-qsef","depends_on_id":"fray-gz26","type":"parent-child","created_at":"2026-01-01T12:24:28.106097-08:00","created_by":"adam"}]}
{"id":"fray-re5","title":"Validate linked project DB exists before opening","description":"## Problem\nWhen opening a linked project database (src/commands/shared.ts:38), there's no validation that the file exists:\n\n```typescript\nconst linkedDb = new Database(linkedProj.path);\n```\n\n`better-sqlite3` silently creates a new empty database if the path doesn't exist. This means:\n- If the linked project's DB is moved/deleted, a new empty DB is created\n- Silent data divergence - agent thinks they're in the right project\n- The stored path is the `.db` file, not project root, making it fragile to renames\n\n## Additional Issues\n- `link.ts:34` stores `targetProject.dbPath` (the DB file path)\n- `shared.ts:44` sets `project.root` to the DB path, not the project root\n\n## Fix\n1. Check `fs.existsSync(linkedProj.path)` before `new Database()`\n2. Consider storing project root instead of DB path, and re-discovering\n3. Surface clear error: \"Linked project 'foo' database not found at /path. Use 'bdm unlink foo' and re-link.\"\n\n## Files\n- src/commands/shared.ts:24-45\n- src/commands/link.ts:33-39\n\n## Acceptance Criteria\n- Error thrown if linked DB doesn't exist\n- Clear error message with remediation steps\n- No silent DB creation","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-04T14:03:26.68534-08:00","updated_at":"2025-12-19T22:57:34.295222-08:00","closed_at":"2025-12-04T14:11:29.764681-08:00"}
{"id":"fray-ree","title":"P0.8: Tests for GUID system","description":"Add comprehensive tests for GUID-based architecture.\n\nTest files to create/update:\n\n1. tests/guid.test.ts (NEW)\n   - GUID generation (uniqueness, format, length)\n   - Base58 encoding validation\n   - Type prefixes (msg-, usr-, ch-)\n   - Collision handling\n\n2. tests/jsonl.test.ts (NEW)\n   - appendMessage() writes valid JSONL\n   - readMessages() parses correctly\n   - Handle malformed JSONL (skip bad lines)\n   - Append-only guarantees\n   - File locking behavior (optional)\n\n3. tests/schema.test.ts (UPDATE)\n   - GUID columns exist and are primary keys\n   - No short_id or display_id columns\n   - Channel_id foreign key relationships\n\n4. tests/queries.test.ts (NEW)\n   - Prefix matching resolution\n   - Ambiguous GUID handling\n   - Channel-scoped queries\n   - GUID → message lookup\n\n5. tests/rebuild.test.ts (NEW)\n   - SQLite rebuilds from JSONL\n   - Staleness detection works\n   - GUIDs preserved across rebuilds\n   - Handles missing JSONL files\n\nCoverage goals:\n- Core GUID functions: 100%\n- JSONL writers/readers: 95%\n- Schema migrations: 90%\n- Query resolvers: 95%\n\nRun with: npm test\n\nReferences: Existing tests in tests/\nCritical files: tests/guid.test.ts (NEW), tests/jsonl.test.ts (NEW), tests/rebuild.test.ts (NEW)","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-19T13:31:02.571331-08:00","updated_at":"2025-12-19T22:57:34.290322-08:00","closed_at":"2025-12-19T15:09:07.164777-08:00","close_reason":"Added GUID/jsonl/rebuild/query tests and schema assertions","dependencies":[{"issue_id":"fray-ree","depends_on_id":"fray-3vp","type":"blocks","created_at":"2025-12-19T13:31:23.060634-08:00","created_by":"daemon","metadata":"{}"},{"issue_id":"fray-ree","depends_on_id":"fray-qqv","type":"blocks","created_at":"2025-12-19T13:31:23.147933-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-rq1","title":"Go: Add quickstart command","description":"Missing 'mm quickstart' or 'mm qs' command. Critical for agent onboarding.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-21T01:28:41.667461-08:00","updated_at":"2025-12-21T01:45:08.823068-08:00","closed_at":"2025-12-21T01:45:08.823068-08:00","close_reason":"Implemented in Go"}
{"id":"fray-rv1r","title":"Sidebar click targets get misaligned after window switching","description":"Sometimes after switching between windows, sidebar click targets are offset (~20px or more above actual item). May need to rebuild click zones when focus returns to window, or reset after each click.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-06T10:58:58.39564-08:00","created_by":"adam","updated_at":"2026-01-06T11:20:47.271993-08:00","closed_at":"2026-01-06T11:20:47.271993-08:00","close_reason":"Fixed click target alignment in both sidebar and thread panel: now properly accounts for header lines (1-2 depending on state) and scroll offset when mapping Y coordinate to list index"}
{"id":"fray-s6yn","title":"Use agent avatar instead of ✪ for faved agent threads","description":"When an agent thread (under meta/) is faved, show the agent's avatar instead of the generic ✪ fave icon.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-06T10:35:28.22701-08:00","created_by":"adam","updated_at":"2026-01-06T10:35:28.22701-08:00"}
{"id":"fray-sg7q","title":"Bug: open-qs sidebar item appears/disappears when selecting threads","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-06T03:48:29.769983-08:00","created_by":"adam","updated_at":"2026-01-06T03:48:34.725108-08:00","closed_at":"2026-01-06T03:48:34.725108-08:00","close_reason":"Fixed: question counts in sidebar are now global instead of thread-scoped. The counts no longer change when selecting different threads, so open-qs stays visible consistently."}
{"id":"fray-sk6a","title":"Bug: chat requires Enter twice to send message","description":"When entering text in chat, user has to hit Enter twice to send. Source: msg-mpuy8iwg","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-06T16:53:01.861865-08:00","created_by":"adam","updated_at":"2026-01-06T17:01:52.46384-08:00","closed_at":"2026-01-06T17:01:52.46384-08:00","close_reason":"Believed fixed in prior work; will reopen if issue recurs"}
{"id":"fray-smj6","title":"Add fray validate command for JSONL integrity checks","description":"Add a validate command that checks JSONL referential integrity (orphan parents, missing thread refs, etc.) and fails loudly. Run in CI and locally before release. This replaces relying on SQLite FK constraints for data integrity since SQLite is just a cache.","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-06T10:36:43.62239-08:00","created_by":"adam","updated_at":"2026-01-06T10:36:43.62239-08:00"}
{"id":"fray-sw9d","title":"Extract chat/panels.go from model.go","description":"Extract sidebar + thread panel: renderThreadPanel(), renderSidebar(), handleThreadPanelKeys(), handleSidebarKeys(), threadEntries(), filtering logic, navigation helpers. ~800 lines - biggest extraction.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T23:53:43.098075-08:00","created_by":"adam","updated_at":"2026-01-01T00:33:13.008878-08:00","closed_at":"2026-01-01T00:33:13.008878-08:00","close_reason":"Extracted panels.go (896 lines). model.go 1623→738. Phase 1 complete!","dependencies":[{"issue_id":"fray-sw9d","depends_on_id":"fray-08qo","type":"blocks","created_at":"2026-01-01T00:07:10.278191-08:00","created_by":"adam"}]}
{"id":"fray-szq4","title":"Mention debounce and watermark tracking","description":"Track per-agent mention watermarks and debounce rapid @mentions.\n\n## Schema Reference (fray-7w5d)\n- Agent.MentionWatermark in `internal/types/types.go`: last processed msg_id\n- AgentUpdateJSONLRecord in `internal/db/jsonl.go`: for persisting watermark updates\n- AppendAgentUpdate in `internal/db/jsonl_append.go`: write watermark to JSONL\n\n## Problem\nIf agent is spawning/active and gets more @mentions, don't spawn new sessions. Queue them.\n\n## Storage\nWatermark persists in agents.jsonl via agent_update records:\n```json\n{\"type\":\"agent_update\",\"agent_id\":\"alice\",\"mention_watermark\":\"msg-abc123\"}\n```\n\n## Implementation\n- Per-agent watermark: last processed msg_id (persisted via AppendAgentUpdate)\n- Pending mentions queue: msg_ids received while spawning/active (in-memory)\n- On spawn: include all pending mentions in wake prompt\n- Self-mention filter: ignore agent's own posts\n\n## Daemon-less Mode\n`fray agent check` reads watermark from agents.jsonl, respects daemon lock.\n\n## Exit Criteria\n- Watermark persists across daemon restarts\n- `fray agent check` uses same watermark\n- Self-mentions filtered\n- Pending queue coalesces during spawn\n\nReferences: msg-yn7bknb8 (gpt52), msg-j8axywm5 (gpt52 round 2), msg-rmwkp8sc (opus round 3)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-01T23:19:53.74815-08:00","created_by":"adam","updated_at":"2026-01-02T01:19:16.590931-08:00","closed_at":"2026-01-02T01:19:16.590931-08:00","close_reason":"Implemented in internal/daemon/*.go. Passed 6 rounds of @gpt52 review (thrd-4oikeoie). Ready for commit."}
{"id":"fray-t29","title":"P2.1: Nick management commands","description":"mm nick @agent --as nickname --in channel. mm nicks @agent to show all nicks. mm whoami to show my names/nicks.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T11:57:35.368913-08:00","updated_at":"2025-12-19T22:57:34.311088-08:00","closed_at":"2025-12-19T15:44:34.984201-08:00","close_reason":"Added nick/nicks/whoami commands and nickname mapping","dependencies":[{"issue_id":"fray-t29","depends_on_id":"fray-qqv","type":"blocks","created_at":"2025-12-19T11:57:46.654854-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-tzi","title":"Show status/purpose consistently across roster, info, who","description":"Display status and purpose fields consistently in roster, info, and who commands.\n\nWhen not set:\n- JSON output: show as empty string (\"\")\n- CLI output: show as '--'\n\nCurrently:\n- roster: shows status (only when set), no purpose\n- info: doesn't show status/purpose in roster summary\n- who: doesn't show status or purpose","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-21T12:13:23.975689-08:00","updated_at":"2025-12-21T15:55:28.299495-08:00","closed_at":"2025-12-21T15:55:28.299495-08:00","close_reason":"Implemented - formatOptionalValue returns '--' for nil/empty"}
{"id":"fray-unj","title":"Add 'import' command","description":"Import file as messages.\n\n```bash\nfray import doc.md --as alice              # single message\nfray import doc.md --as alice --split      # split on ## headers\nfray import doc.md --as alice --thread research\n```\n\nSplitting logic:\n- `#` or `##` markdown headers indicate message boundaries\n- Each section becomes its own message\n- Preserves threading/attribution\n\nUse cases: bringing external docs into fray, seeding conversations.","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-30T16:47:26.108512-08:00","created_by":"adam","updated_at":"2025-12-30T16:47:26.108512-08:00"}
{"id":"fray-upb9","title":"Implement activity detection (network/CPU)","description":"System-level activity detection for spawned processes.\n\n## Schema Reference (fray-7w5d)\n- InvokeConfig timeouts in `internal/types/types.go`:\n  - SpawnTimeoutMs: max time in 'spawning' before 'error' (default: 30000)\n  - IdleAfterMs: time since last activity before 'idle' (default: 5000)\n- PresenceState enum: active, spawning, idle, error, offline\n\n## Interface\n```go\ntype ActivityDetector interface {\n    IsActive(pid int) bool\n    LastActivityTime(pid int) time.Time\n}\n```\n\n## Implementation\n1. Darwin impl (MVP): use `netstat` or `lsof` for network, `ps` for CPU\n2. Fallback: process-alive + recent output file modification\n\n## Platform Support\n- **Darwin**: Full implementation (network I/O + CPU)\n- **Linux/Windows**: Process-alive-only fallback until OS-specific adapter added\n\n## Risks\n- OS-specific APIs differ\n- Permissions: some metrics need elevated access\n- Child processes: may need to track process tree\n\n## Exit Criteria\n- ActivityDetector interface defined\n- Darwin implementation passes tests\n- Fallback works on non-Darwin platforms\n- Integration with InvokeConfig timeouts\n\nReferences: msg-flq36oho (opus), msg-5lykv31l (architect), msg-j8axywm5 (gpt52)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-01T23:14:36.63303-08:00","created_by":"adam","updated_at":"2026-01-02T01:19:16.589741-08:00","closed_at":"2026-01-02T01:19:16.589741-08:00","close_reason":"Implemented in internal/daemon/*.go. Passed 6 rounds of @gpt52 review (thrd-4oikeoie). Ready for commit.","dependencies":[{"issue_id":"fray-upb9","depends_on_id":"fray-7w5d","type":"blocks","created_at":"2026-01-01T23:20:31.332449-08:00","created_by":"adam"}]}
{"id":"fray-v08l","title":"Meta-centric knowledge hierarchy with agent avatars","description":"Reorganize knowledge threads under meta/ and add agent avatars.\n\n## Structure Change\n\nCurrent:\n```\nmeta/\n{agent}/notes\n{agent}/jrnl  \nroles/{role}/keys\n```\n\nNew:\n```\nmeta/                           # project knowledge root\n  meta/{agent}/                 # agent identity (anchor = who they are)\n    meta/{agent}/notes          # working notes\n    meta/{agent}/jrnl           # journal\n  meta/role-{rolename}/         # role definition\n    meta/role-{rolename}/keys   # atomic insights\n```\n\nKey changes:\n- All knowledge under meta/ (single root)\n- Roles renamed from `roles/{role}` to `role-{rolename}` (no false hierarchy)\n- Agent threads nested under meta/{agent}/\n\n## Meta View Grouping\n\nWhen viewing meta thread, children grouped with subtle headers:\n- **topics** - topical meta subthreads (conventions, architecture, etc.)\n- **agents** - agent identity threads  \n- **roles** - role definition threads\n\n## Agent Avatars\n\nSingle-character avatar per agent, displayed:\n- Chat bylines: `🅾 @opus:` instead of `@opus:`\n- Sidebar meta view: avatar as left indicator for agent threads\n- Sidebar faved: avatar replaces ★ when agent thread is faved\n\nAvatar assignment:\n- Auto-assigned on `fray new` from curated pool\n- Letter-matched when possible (opus → 🅾, designer → 🅳)\n- Fallback to generic symbols when letters exhausted\n- Humans: `⏺`\n- Updateable via command\n\nAvatar pool (letter-based):\n```\n🅰🅱🅲🅳🅴🅵🅶🅷🅸🅹🅺🅻🅼🅽🅾🅿🆀🆁🆂🆃🆄🆅🆆🆇🆈🆉\nⒶ Ⓑ Ⓒ Ⓓ Ⓔ Ⓕ Ⓖ Ⓗ Ⓘ Ⓙ Ⓚ Ⓛ Ⓜ Ⓝ Ⓞ Ⓟ Ⓠ Ⓡ Ⓢ Ⓣ Ⓤ Ⓥ Ⓦ Ⓧ Ⓨ Ⓩ\n```\n\nGeneric fallbacks:\n```\n✿ 🞴 ☗ ⏏ ❖ ⌘ 〶 ☡ 〠\n```\n\n## Migration (`fray migrate`)\n\nUpdate `fray migrate` to detect and move legacy thread structures:\n\n1. Detect legacy patterns:\n   - `{agent}/` at top level → move to `meta/{agent}/`\n   - `{agent}/notes` → `meta/{agent}/notes`\n   - `{agent}/jrnl` → `meta/{agent}/jrnl`\n   - `roles/{role}/` → `meta/role-{role}/`\n   - `roles/{role}/keys` → `meta/role-{role}/keys`\n\n2. For each thread:\n   - Update thread name and parent_thread\n   - Preserve all messages, anchors, pins\n   - Update any references in other threads\n   - Append thread_update to JSONL\n\n3. Handle edge cases:\n   - Thread already exists at target location (merge? error?)\n   - Nicknames pointing to old paths\n   - Ghost cursors referencing old thread GUIDs\n\n4. Report what was migrated:\n   ```\n   Migrated 3 agent threads:\n     opus/ → meta/opus/\n     opus/notes → meta/opus/notes\n     designer/ → meta/designer/\n   Migrated 1 role thread:\n     roles/architect/ → meta/role-architect/\n   ```\n\n## Implementation Order\n\n1. Add `avatar` field to agent struct/JSONL\n2. Auto-assign avatar on `fray new` (letter-match or random generic)\n3. Update byline rendering to include avatar\n4. Create meta/ structure on init/new-agent\n5. Update meta view to group children with headers\n6. Update sidebar to show avatar for agent threads\n7. Add avatar update command\n8. Implement `fray migrate` for legacy thread moves\n\n## Design Thread\nTBD","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-06T09:03:02.267541-08:00","created_by":"adam","updated_at":"2026-01-06T11:11:34.799392-08:00","closed_at":"2026-01-06T11:11:34.799392-08:00","close_reason":"Meta-centric hierarchy complete: meta thread appears first in sidebar and CLI tree output, agent avatars display in meta/ thread listings with avatars replacing star indicator for agent threads","dependencies":[{"issue_id":"fray-v08l","depends_on_id":"fray-nksk","type":"blocks","created_at":"2026-01-06T10:38:18.875811-08:00","created_by":"adam"},{"issue_id":"fray-v08l","depends_on_id":"fray-qhco","type":"blocks","created_at":"2026-01-06T10:38:18.903473-08:00","created_by":"adam"}]}
{"id":"fray-v1ku","title":"Accordion output for long message lists","description":"When outputting more than N messages, accordion the display:\n\n- First 3 messages: show entirely\n- Middle messages: msg ID + first line preview (like chained replies in chat)\n- Last 3 messages: show entirely\n\n## Config\n- Default threshold: 10 messages\n- Make configurable (fray config or flag)\n- `--show-all` flag to override and show everything\n\n## Applies to\n- fray get\n- fray neo\n- fray thread \u003cref\u003e\n- fray @agent\n- Anywhere we dump a list of messages\n\n## Format for middle messages\nSimilar to how we show chained replies in chat - just enough to orient without burning tokens.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-03T01:18:12.1797-08:00","created_by":"adam","updated_at":"2026-01-03T01:27:32.684597-08:00","closed_at":"2026-01-03T01:27:32.684597-08:00","close_reason":"Implemented accordion output: \u003e10 messages shows first 3 full, middle as previews, last 3 full. --show-all flag to disable. Applied to get, @agent, thread."}
{"id":"fray-v24f","title":"Extract chat/questions.go from model.go","description":"Extract question/pseudo-thread logic: renderQuestions(), refreshQuestionCounts(), refreshPseudoQuestions(), questionScope(). Pseudo-thread type constants. ~250 lines.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-01T00:07:01.878879-08:00","created_by":"adam","updated_at":"2026-01-01T00:23:46.320187-08:00","closed_at":"2026-01-01T00:23:46.320187-08:00","close_reason":"Extracted questions.go (140 lines). model.go 2040→1911.","dependencies":[{"issue_id":"fray-v24f","depends_on_id":"fray-h3hx","type":"blocks","created_at":"2026-01-01T00:07:10.228875-08:00","created_by":"adam"}]}
{"id":"fray-v2dj","title":"Extract chat/layout.go from model.go","description":"Extract layout calculations: mainWidth(), sidebarWidth(), threadPanelWidth(), resize(), cyclePanelFocus(). Size constants. ~150 lines.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-01T00:07:01.462979-08:00","created_by":"adam","updated_at":"2026-01-01T00:13:04.020548-08:00","closed_at":"2026-01-01T00:13:04.020548-08:00","close_reason":"Extracted layout.go (96 lines). model.go 2843→2749.","dependencies":[{"issue_id":"fray-v2dj","depends_on_id":"fray-yxgm","type":"blocks","created_at":"2026-01-01T00:07:10.132364-08:00","created_by":"adam"}]}
{"id":"fray-v7bq","title":"Bug: sidebar threads unstable (reordering/disappearing)","description":"In chat UI, sidebar threads are unstable - reordering, disappearing, and reappearing unexpectedly. Reported by adam: msg-b2pkpg4a.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-02T00:17:38.135593-08:00","created_by":"adam","updated_at":"2026-01-06T12:37:37.577105-08:00","closed_at":"2026-01-06T12:37:37.577105-08:00","close_reason":"Fixed: sidebar threads are now stable"}
{"id":"fray-v98e","title":"Drilling into agent from meta should auto-select notes","description":"When drilling into an agent's thread from meta view, auto-select meta/{agent}/notes instead of stopping at meta/{agent}. Notes is the most common destination.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-06T10:58:58.150334-08:00","created_by":"adam","updated_at":"2026-01-06T11:18:55.460043-08:00","closed_at":"2026-01-06T11:18:55.460043-08:00","close_reason":"Drilling into an agent thread from meta now auto-selects the notes child, showing notes messages immediately"}
{"id":"fray-vfs0","title":"Structured message unpacking: --structured JSON input","description":"Add `fray post --structured '{...}'` that unpacks into multiple fray operations.\n\n**Input:**\n```json\n{\n  \"text\": \"visible response\",\n  \"openQuestions\": [{\"to\": \"adam\", \"q\": \"what's priority?\"}],\n  \"answers\": [\"msg-xyz\"],\n  \"replyTo\": \"msg-abc\",\n  \"handoff\": \"alice\"\n}\n```\n\n**Unpacks to:**\n- `fray post` with text\n- `fray ask` for each openQuestion\n- `fray answer` for each answer ID\n- `--reply-to` threading\n\n**Use case:** Orchestrated agents (party) output clean JSON. Coordinator validates and unpacks. Single source of truth - structured fields ARE fray operations.\n\n**Backward compatible:** Regular `fray post` still works. Structured is opt-in.\n\nSee: party/proto-5.1/LEARNINGS-BONUS.md","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-01T18:29:06.014351-08:00","created_by":"adam","updated_at":"2026-01-01T18:29:06.014351-08:00","dependencies":[{"issue_id":"fray-vfs0","depends_on_id":"fray-ldl8","type":"related","created_at":"2026-01-01T18:29:21.47169-08:00","created_by":"adam"}]}
{"id":"fray-vftl","title":"Daemon: filter mentions - only trigger on direct address","description":"Only trigger daemon on direct address. Filter out:\n- Self-mentions\n- FYIs (cc @agent, mid-sentence mentions)\n- Agent as subject not addressee\n\nDirect address = mention at START of message (can be in list: '@a @b hey...')\n\nNuances:\n- Reactions SHOULD show in mentions (but not trigger daemon spawn)\n- Chained replies: follow owner hierarchy (channel owner / human mentions = trigger, others = fyi)\n- 'cc @agent' = fyi, not trigger","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-01-02T13:19:51.768492-08:00","created_by":"adam","updated_at":"2026-01-02T16:01:27.578698-08:00","closed_at":"2026-01-02T16:01:27.578698-08:00","close_reason":"Implemented in 14032eb"}
{"id":"fray-vfv","title":"Implement read_to watermark system","description":"Replace per-message read receipts with positional watermarks.\n\nSchema:\n```sql\nfray_read_to (\n  agent_id TEXT NOT NULL,\n  home TEXT NOT NULL,  -- 'room' or thread GUID\n  message_guid TEXT NOT NULL,\n  message_ts INTEGER NOT NULL,\n  set_at INTEGER NOT NULL,\n  PRIMARY KEY (agent_id, home)\n)\n```\n\n- SQLite only (not JSONL persisted)\n- Watermark advances as agent views messages\n- Persists across sessions via back/bye\n- Display in chat: `#guid    read_to: @alice @bob`\n- JSON output includes read_to positions","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-31T00:08:05.204028-08:00","created_by":"adam","updated_at":"2025-12-31T05:53:48.375969-08:00","closed_at":"2025-12-31T05:53:48.375969-08:00","close_reason":"Implemented read_to watermark system: schema, queries, and integration with get command"}
{"id":"fray-vtw","title":"Go: Add view command","description":"Missing 'mm view \u003cid\u003e' command to view full message without truncation.","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-21T01:33:54.8982-08:00","updated_at":"2025-12-21T02:17:38.366743-08:00","closed_at":"2025-12-21T02:17:38.366743-08:00","close_reason":"Implemented view command"}
{"id":"fray-vws","title":"Display read_to in chat TUI","description":"Show read_to watermark positions in chat:\n\n```\n@opus:\nFixed beads sync issue...\n#908n                                    read_to: @gpt52 @devrel\n```\n\n- Right-aligned on the #guid line\n- Show agents whose watermark is at this message\n- Dim/style appropriately","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T00:08:05.450673-08:00","created_by":"adam","updated_at":"2025-12-31T05:53:54.50668-08:00","closed_at":"2025-12-31T05:53:54.50668-08:00","close_reason":"Implemented read_to display in chat TUI: shows 'read_to: @agent1 @agent2' right-aligned on the #guid line","dependencies":[{"issue_id":"fray-vws","depends_on_id":"fray-vfv","type":"blocks","created_at":"2025-12-31T00:08:13.53981-08:00","created_by":"daemon"}]}
{"id":"fray-w35g","title":"UX: Recent threads under threads view","description":"\"Recent threads\" should be listed under the threads view rather than the channels view. Source: msg-9v3mc8ys","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-02T00:26:39.63191-08:00","created_by":"adam","updated_at":"2026-01-02T00:26:39.63191-08:00"}
{"id":"fray-w5k3","title":"Quote messages with commentary","description":"Quote messages with commentary: fray post --quote msg-abc 'This is the key insight'. quote_message_guid field (distinct from references for surface). Display shows quoted content inline. See THREAD-CURATION-SPEC.md Phase 3.","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-01-01T12:23:49.936391-08:00","created_by":"adam","updated_at":"2026-01-03T22:39:07.477728-08:00","closed_at":"2026-01-03T22:39:07.477728-08:00","close_reason":"Implemented quote messages feature with --quote/-q flag on fray post. Quotes display inline with \u003e prefix showing the quoted content and source.","dependencies":[{"issue_id":"fray-w5k3","depends_on_id":"fray-gz26","type":"parent-child","created_at":"2026-01-01T12:24:28.130042-08:00","created_by":"adam"}]}
{"id":"fray-w5u7","title":"Ephemeral agent instances (@agent.taskname)","description":"Allow spawning ephemeral versions of agents for quick weigh-ins without shared context burden.\n\nExamples:\n- @dev.1, @dev.2, @dev.3 - numbered instances\n- @dev.taskname - task-specific instance\n\nChallenge: they share the same @ trigger pattern. Need to think through:\n- How to disambiguate mentions\n- Whether ephemeral instances share identity/notes\n- Token efficiency vs context continuity tradeoffs\n\nDeferred - not on table for daemon stabilization.","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-02T15:03:38.980486-08:00","created_by":"adam","updated_at":"2026-01-02T15:03:38.980486-08:00"}
{"id":"fray-w6q","title":"P1.4: Cross-channel operations","description":"Implement cross-channel operations with --in flag and mm use.\n\n1. Add --in \u003cchannel\u003e flag to all commands:\n   mm post @dev \"update\" --in party\n   mm get --in party --last 10\n   mm thread @#x9y8 --in party\n\n2. Implement mm use \u003cchannel\u003e:\n   mm use party\n   # Updates ~/.config/mm/mm-config.json current_channel\n   # Subsequent commands use party context\n\n3. Channel context resolution priority:\n   a. --in \u003cchannel\u003e flag (explicit)\n   b. Current channel from mm use (stored in ~/.config/mm/)\n   c. Channel from current directory (.mm/mm-config.json)\n   d. Error: \"No channel context\"\n\n4. Agent resolution in channel context:\n   - @dev in home channel → usr-devrel5\n   - @mm-devrel in other channels → usr-devrel5\n   - Lookup known_agents in target channel's .mm/mm-config.json\n\nImplementation:\n- src/commands/use.ts (NEW): mm use command\n- src/core/context.ts (NEW): Channel context resolution\n- Add --in flag parsing to all commands\n- Update agent resolution to check channel context\n\nReferences: PLAN.md sections 5, 6\nCritical files: src/commands/use.ts (NEW), src/core/context.ts (NEW), src/core/agents.ts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T11:57:26.225192-08:00","updated_at":"2025-12-19T22:57:34.298986-08:00","closed_at":"2025-12-19T15:32:40.620706-08:00","close_reason":"Added channel context resolution, --in support, and mm use","dependencies":[{"issue_id":"fray-w6q","depends_on_id":"fray-qqv","type":"blocks","created_at":"2025-12-19T11:57:46.215967-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-w6xh","title":"Simplify commands: path-based post/get","description":"Simplify fray to 3 core patterns with universal path-based addressing.\n\n## Design Discussion\nSee **command-design** thread (msg-rbd9x) for full conversation.\n\n## Core Insight\nPaths are nouns, commands are verbs. One mental model for everything.\n\n## The 3 Core Patterns\n\n### 1. `fray post [path] \"msg\"` - write anywhere\n```bash\nfray post \"msg\"                         # room (default)\nfray post meta \"msg\"                    # project meta\nfray post opus/meta \"msg\"               # agent meta  \nfray post opus/notes \"msg\"              # agent notes\nfray post roles/architect/keys \"msg\"   # role key\nfray post \"msg\" --reply msg-abc         # reply to message\nfray reply msg-abc \"msg\"                # shorthand\n```\n\n### 2. `fray get [path]` - read anywhere\n```bash\nfray get                                 # room + notifs (default)\nfray get meta                            # project meta\nfray get opus/notes                      # agent notes\nfray get notifs                          # @mentions + followed threads\nfray get roles/architect/keys            # role keys\nfray get design-thread                   # specific thread\nfray get msg-abc                         # specific message\nfray msg-abc                             # shorthand for above\nfray msg-abc --replies                   # message + reply chain\n```\n\n### 3. `fray \u003cverb\u003e \u003cpath|id\u003e` - actions\n```bash\n# Create thread\nfray thread design-thread \"Anchor message\"\nfray thread opus/meta                    # no anchor\n\n# Thread operations (all accept path OR thread-id)\nfray follow opus/notes\nfray unfollow design-thread\nfray mute roles/architect/keys\nfray unmute thrd-abc123\nfray add design-thread msg-xyz           # add msg to thread\nfray remove design-thread msg-xyz\nfray anchor design-thread msg-xyz\nfray anchor design-thread \"New anchor\"  # create anchor msg\nfray archive old-thread\nfray restore old-thread\nfray rename opus/notes \"working\"        # → opus/working\nfray pin my-thread                       # pin thread globally\nfray pin my-thread msg-abc               # pin msg in thread\nfray unpin my-thread [msg-abc]\n\n# Universal ops (ID prefix determines type: msg-, thrd-, qstn-, usr-)\nfray rm msg-abc123                       # delete message\nfray rm thrd-xyz789                      # delete thread\nfray fave msg-abc                        # fave message\nfray fave opus/notes                     # fave thread by path\nfray fave thrd-xyz                       # fave thread by id\nfray unfave \u003cpath|id\u003e\nfray mv msg-abc design-thread            # move message\n\n# Reactions\nfray react msg-abc 👍\n```\n\n## Universal Addressing\n\n**Paths** work everywhere a thread-id works:\n- `meta` = project meta thread\n- `opus/notes` = agent's notes thread\n- `roles/architect/keys` = role's keys thread\n- `design-thread` = thread by name\n\n**IDs** are self-describing via prefix:\n- `msg-abc123` = message\n- `thrd-xyz789` = thread\n- `qstn-def456` = question\n- `usr-ghi789` = agent\n\n## Commands Removed\n\nThese become path-based post/get:\n- `fray meta` → `fray post meta` / `fray get meta`\n- `fray note` → `fray post {me}/notes`\n- `fray notes` → `fray get {me}/notes`\n- `fray key` → `fray post roles/X/keys`\n- `fray keys` → `fray get roles/X/keys`\n- `fray mentions` → `fray get notifs`\n- `fray view` → `fray get \u003cid\u003e` or `fray \u003cid\u003e`\n- `fray history X` → `fray get --from X`\n- `fray between X Y` → `fray get --from X --to Y`\n\nThese become top-level verbs:\n- `fray thread new` → `fray thread \u003cpath\u003e [\"anchor\"]`\n- `fray thread subscribe` → `fray follow`\n- `fray thread unsubscribe` → `fray unfollow`\n- `fray thread mute` → `fray mute`\n- `fray thread unmute` → `fray unmute`\n- `fray thread add` → `fray add`\n- `fray thread remove` → `fray remove`\n- `fray thread anchor` → `fray anchor`\n- `fray thread archive` → `fray archive`\n- `fray thread restore` → `fray restore`\n- `fray thread rename` → `fray rename`\n- `fray thread pin` → `fray pin`\n- `fray thread unpin` → `fray unpin`\n\n## `--as` Becomes Debug-Only\n\nFRAY_AGENT_ID set by hooks on `fray new`. Only use --as for:\n- Debugging\n- Humans without hooks\n- Posting as another agent (rare)\n\n## Commands That Stay\n\n**Questions** (special ask/answer flow):\n- `wonder`, `ask`, `question`, `questions`, `answer`\n\n**Agent lifecycle**:\n- `new`, `back`, `bye`, `here`, `who`, `whoami`, `status`\n\n**Claims/Roles**:\n- `claim`, `claims`, `clear`, `role`, `roles`\n\n**Message ops**:\n- `edit`, `versions`\n- `reply` (shorthand for post --reply)\n- `react` (shorthand)\n\n**Infrastructure**:\n- `init`, `rebuild`, `config`, `chat`, `watch`, `threads`, `faves`, etc.\n\n## Implementation Order\n\n1. Add path resolution to all thread operations\n2. Promote thread subcommands to top-level verbs\n3. Rename subscribe→follow, unsubscribe→unfollow\n4. Make `fray thread \u003cpath\u003e` create threads\n5. Add `fray get \u003cpath\u003e` with path as first arg\n6. Add `fray post \u003cpath\u003e` with path as first arg\n7. Add `fray \u003cmsg-id\u003e` shorthand\n8. Add `fray get notifs`\n9. Make `fray rm` / `fray fave` universal by ID prefix\n10. Remove old commands\n11. Update all docs, prompts, CLAUDE.md","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-05T00:16:01.891408-08:00","created_by":"adam","updated_at":"2026-01-05T01:16:32.461513-08:00","closed_at":"2026-01-05T01:16:32.461513-08:00","close_reason":"Implemented path-based command simplification: fray get/post \u003cpath\u003e, fray thread \u003cpath\u003e, top-level follow/unfollow/mute/add/remove/archive/restore, msg-xxx shorthand, universal rm/fave by ID prefix. CLAUDE.md updated."}
{"id":"fray-w7oo","title":"Split db/jsonl.go by operation type","description":"## Overview\ndb/jsonl.go is 1376 lines. Split by operation type.\n\n## Target Files\n1. **jsonl_append.go** (11 append functions)\n   - AppendMessage, AppendMessageUpdate\n   - AppendAgent\n   - AppendQuestion, AppendQuestionUpdate\n   - AppendThread, AppendThreadUpdate\n   - AppendThreadSubscribe, AppendThreadUnsubscribe\n   - AppendThreadMessage, AppendThreadMessageRemove\n   - appendJSONLine helper\n\n2. **jsonl_read.go** (read functions + version history)\n   - ReadMessages, ReadQuestions, ReadThreads, ReadAgents\n   - GetMessageVersions, GetMessageEditCounts, ApplyMessageEditCounts\n   - readJSONLFile[T], readJSONLLines helpers\n\n3. **jsonl_rebuild.go** (single big function + helpers)\n   - RebuildDatabaseFromJSONL\n   - resolveFrayDir, UpdateProjectConfig, ReadProjectConfig\n\n## Approach\nSame as chat decomposition. Append operations have no deps on read logic; rebuild is self-contained.\n\n## Risk\nMedium - jsonl.go contains the disaster recovery mechanism. Test rebuild explicitly:\n```bash\nrm .fray/fray.db \u0026\u0026 fray get --last 5  # Should rebuild and work\n```\n\n## Order\nDo this AFTER queries split - queries is lower risk.","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-31T23:53:31.057154-08:00","created_by":"adam","updated_at":"2026-01-01T06:28:31.593077-08:00","closed_at":"2026-01-01T06:28:31.593077-08:00","close_reason":"Split jsonl.go (1376 lines) into 3 operation files: append (239), read (596), rebuild (405). Remaining jsonl.go is 160 lines of types/constants. Rebuild mechanism tested and working. 88% reduction."}
{"id":"fray-wenu","title":"Bug: sidebar width not calculated on initial open","description":"Thread panel starts open (threadPanelOpen: true in NewModel) but calculateThreadPanelWidth() was never called during initialization. This caused the panel to use the fallback width of 20 until toggled.\n\nFix: Call calculateThreadPanelWidth() at end of NewModel after all thread data is loaded.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-06T03:07:33.595936-08:00","created_by":"adam","updated_at":"2026-01-06T03:07:38.862013-08:00","closed_at":"2026-01-06T03:07:38.862013-08:00","close_reason":"Added calculateThreadPanelWidth() call in NewModel after all refresh calls"}
{"id":"fray-wh2o","title":"Review/update prune command for thread changes","description":"The prune command needs review after all the thread/questions/surface changes. Ensure it:\n- Handles thread messages correctly\n- Preserves thread integrity\n- Works with questions system\n- Handles surfaced messages and backlinks","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T23:38:06.923895-08:00","created_by":"adam","updated_at":"2026-01-02T12:00:56.070128-08:00","closed_at":"2026-01-02T12:00:56.070128-08:00","close_reason":"Implemented minimal fix to preserve data integrity during prune: thread anchors, pinned messages, question references, surface message references, thread_message events, and all event records for kept messages"}
{"id":"fray-wjm","title":"Implement beads database discovery","description":"Create src/core/project.ts to discover and connect to the beads database.\n\n## Behavior\n1. Start from current working directory\n2. Walk up directory tree looking for `.beads/` directory\n3. Find `*.db` file within `.beads/`\n4. Return absolute path to the database file\n\n## Error Cases\n- No `.beads/` directory found: Exit with error \"Not in a beads project. Run 'bd init' first.\"\n- Multiple `*.db` files: Use first one (alphabetically) or error if ambiguous\n- `.beads/` exists but no `*.db`: Exit with error \"Beads project not initialized. Run 'bd init' first.\"\n\n## API\n```typescript\n// src/core/project.ts\n\nexport interface BeadsProject {\n  root: string;      // Absolute path to project root\n  dbPath: string;    // Absolute path to .beads/*.db\n}\n\n/**\n * Discover beads project from current directory.\n * Walks up the directory tree looking for .beads/\n * @throws Error if not in a beads project\n */\nexport function discoverProject(startDir?: string): BeadsProject;\n\n/**\n * Open database connection to beads project.\n * Initializes bdm schema if not present.\n */\nexport function openDatabase(project: BeadsProject): Database;\n```\n\n## Files\n- src/core/project.ts\n\n## Acceptance Criteria\n- Discovers .beads/ from any nested subdirectory\n- Returns correct absolute paths\n- Clear error messages when not in beads project\n- Unit tests for discovery logic","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T09:58:24.845618-08:00","updated_at":"2025-12-19T22:57:34.309357-08:00","closed_at":"2025-12-04T12:17:01.85223-08:00","dependencies":[{"issue_id":"fray-wjm","depends_on_id":"fray-08v","type":"parent-child","created_at":"2025-12-04T10:00:39.675319-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-wjm","depends_on_id":"fray-kit","type":"blocks","created_at":"2025-12-04T10:45:24.188389-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-wjm","depends_on_id":"fray-bml","type":"blocks","created_at":"2025-12-04T10:59:48.435876-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-wkx","title":"Write integration tests for key flows","description":"Create integration tests covering the main user workflows.\n\n## Prerequisites\n- Tests require the `bd` CLI to be installed (beads issue tracker)\n- Tests create temporary beads projects using `bd init`\n\n## Test Flows\n\n### 1. Full Agent Lifecycle\n```typescript\ntest('agent lifecycle: new → post → bye', async () =\u003e {\n  // Create agent\n  await run('bdm new alice --goal \"testing\"');\n  // Verify agent exists\n  expect(await run('bdm who alice')).toContain('alice.1');\n  // Post message\n  await run('bdm post --as alice.1 \"hello world\"');\n  // Verify message\n  expect(await run('bdm')).toContain('hello world');\n  // Leave\n  await run('bdm bye alice.1');\n  // Verify not in here\n  expect(await run('bdm here')).not.toContain('alice.1');\n});\n```\n\n### 2. Mention Routing\n```typescript\ntest('mention routing', async () =\u003e {\n  await run('bdm new alice');\n  await run('bdm new bob');\n  await run('bdm post --as alice.1 \"@bob.1 hey there\"');\n  await run('bdm post --as bob.1 \"@alice check this\"');\n  \n  // Bob should see alice's message\n  expect(await run('bdm @bob')).toContain('@bob.1 hey there');\n  // Alice should see bob's message (prefix match)\n  expect(await run('bdm @alice')).toContain('@alice check this');\n});\n```\n\n### 3. @all Broadcast\n```typescript\ntest('@all broadcast', async () =\u003e {\n  await run('bdm new pm');\n  await run('bdm new dev');\n  await run('bdm post --as pm.1 \"@all standup\"');\n  \n  // Both should see it\n  expect(await run('bdm @pm')).toContain('@all standup');\n  expect(await run('bdm @dev')).toContain('@all standup');\n});\n```\n\n### 4. Cross-Project Messaging\n```typescript\ntest('cross-project messaging', async () =\u003e {\n  // Setup: create two beads projects using bd init\n  await runIn('/tmp/proj-a', 'bd init --prefix a');\n  await runIn('/tmp/proj-b', 'bd init --prefix b');\n  \n  // Link from A to B\n  await runIn('/tmp/proj-a', 'bdm link other /tmp/proj-b');\n  \n  // Create agent in A, post to B\n  await runIn('/tmp/proj-a', 'bdm new frontend');\n  await runIn('/tmp/proj-a', 'bdm --project other post --as frontend.1 \"hey B\"');\n  \n  // Verify message appears in B\n  expect(await runIn('/tmp/proj-b', 'bdm')).toContain('hey B');\n});\n```\n\n### 5. Stale Agent Filtering\n```typescript\ntest('stale agents filtered from here', async () =\u003e {\n  await run('bdm new alice');\n  // Artificially age the agent by updating DB directly\n  // Note: need direct DB access for this test\n  await db.run('UPDATE bdm_agents SET last_seen = ? WHERE agent_id = ?', \n    [Date.now()/1000 - 5*3600, 'alice.1']);\n  \n  // Default here should not show stale\n  expect(await run('bdm here')).not.toContain('alice.1');\n  // --all should show\n  expect(await run('bdm here --all')).toContain('alice.1');\n});\n```\n\n## Test Setup\n\n```typescript\n// tests/setup.ts\nimport { execaCommand } from 'execa';\nimport * as fs from 'fs/promises';\nimport * as path from 'path';\nimport * as os from 'os';\n\nlet testDir: string;\n\nexport async function setupTestProject(): Promise\u003cstring\u003e {\n  // Create temp directory\n  testDir = await fs.mkdtemp(path.join(os.tmpdir(), 'bdm-test-'));\n  // Initialize beads project\n  await execaCommand('bd init --prefix test', { cwd: testDir });\n  return testDir;\n}\n\nexport async function cleanup() {\n  if (testDir) {\n    await fs.rm(testDir, { recursive: true, force: true });\n  }\n}\n\nexport function run(cmd: string, cwd: string = testDir) {\n  return execaCommand(cmd, { cwd });\n}\n```\n\n## Files\n- tests/integration/lifecycle.test.ts\n- tests/integration/mentions.test.ts\n- tests/integration/cross-project.test.ts\n- tests/setup.ts\n\n## Acceptance Criteria\n- All key workflows have integration tests\n- Tests run in isolated temp directories\n- Tests clean up after themselves\n- All tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T10:17:46.99771-08:00","updated_at":"2025-12-19T22:57:34.302311-08:00","closed_at":"2025-12-04T12:47:16.031657-08:00","dependencies":[{"issue_id":"fray-wkx","depends_on_id":"fray-po1","type":"parent-child","created_at":"2025-12-04T10:19:05.568139-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-wkx","depends_on_id":"fray-yug","type":"blocks","created_at":"2025-12-04T10:19:24.674191-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-wkx","depends_on_id":"fray-8xb","type":"blocks","created_at":"2025-12-04T10:19:29.798964-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-wl5n","title":"Add roles as first-class concept","description":"Agents have persistent identity. Roles are context that filters knowledge access.\n\n**Three dimensions:**\n- Identity (agent name) - persistent, owns history/journal\n- Capability (model) - what LLM runs the agent  \n- Context (role) - what knowledge domain, can change\n\n**Role verbs:**\n- `fray role X add Y` - X now holds Y (persistent, part of identity)\n- `fray role X play Y` - X plays Y this session (evaporates at /land)\n- `fray role X drop Y` - X no longer holds Y\n\n**Knowledge access:**\n- Always see: meta/* (project), {agent}/* (self)\n- Holding/playing adds: roles/{role}/*\n\n**Contributions are open:** Anyone can post to any role's learnings. Validation comes from reactions, weighted by role-holders.\n\n**Naming strategies (all valid):**\n- Model-based: opus, sonnet (clear capability, flexible role)\n- Role-based: architect, designer (clear function, auto-assigned role)\n- Arbitrary: alice, team-1 (neutral)\n\n**Session-scoped playing:** Agent can play a role without holding it. Useful for serendipitous work. Knowledge access for session, no persistence, no future expectations.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-01T06:01:13.318701-08:00","created_by":"adam","updated_at":"2026-01-04T21:25:21.383718-08:00","closed_at":"2026-01-04T21:25:21.383718-08:00","close_reason":"Core roles feature implemented: hold/play/drop semantics, session role clearing on bye, role display in here. Knowledge access filtering deferred to fray-adj6.","dependencies":[{"issue_id":"fray-wl5n","depends_on_id":"fray-1mch","type":"parent-child","created_at":"2026-01-03T21:09:18.924049-08:00","created_by":"adam"}]}
{"id":"fray-wq0m","title":"UX: Create default DM thread between agent and user","description":"When an agent joins, automatically create a thread that contains just that agent and the user. This provides a default DM channel between human and agent, separate from the main room.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-02T11:51:07.088199-08:00","created_by":"adam","updated_at":"2026-01-02T11:55:05.932945-08:00","closed_at":"2026-01-02T11:55:05.932945-08:00","close_reason":"Implemented: when agent joins via fray new, creates dm-\u003cagentID\u003e thread subscribed to both agent and configured user"}
{"id":"fray-wrtw","title":"Bug: Question text overflow in answers view","description":"In answers view, the question text doesn't wrap - it overflows past the viewport. Source: msg-qf790ejg","status":"open","priority":1,"issue_type":"bug","created_at":"2026-01-02T00:26:39.938564-08:00","created_by":"adam","updated_at":"2026-01-06T12:37:23.909552-08:00"}
{"id":"fray-x40","title":"Go: Add filter command","description":"Missing 'mm filter' command to manage message filter preferences.","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-21T01:33:49.496231-08:00","updated_at":"2025-12-21T02:18:02.637233-08:00","closed_at":"2025-12-21T02:18:02.637233-08:00","close_reason":"Implemented filter command"}
{"id":"fray-x7k6","title":"Agent path collision detection: block root-level thread creation when meta/ equivalent exists","description":"When an agent attempts to create or post to a root-level thread (e.g. 'opus/notes'), check if meta/\u003cpath\u003e already exists (e.g. 'meta/opus/notes'). If so, block the operation and return an error with the correct path. This prevents agents from accidentally creating duplicate thread hierarchies outside of meta/.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-06T17:12:33.659536-08:00","created_by":"adam","updated_at":"2026-01-06T17:52:38.829926-08:00","closed_at":"2026-01-06T17:52:38.829926-08:00","close_reason":"Implemented meta/ path collision detection - blocks thread creation at root when meta/\u003cpath\u003e exists, suggests correct path"}
{"id":"fray-xbg4","title":"Daemon spawns new sessions instead of resuming","description":"Sessions reusable until agent runs /land. Need:\n- Store session ID in agents.jsonl (session_start event)\n- Track token usage (read from ~/.claude session state?)\n- Warn agent at ~20% context remaining so they have runway to /land\n- Workloads should either complete and /land, or be open-ended weigh-in sessions\n\nSee also: fray-NEW for ephemeral agent instances concept (@agent.taskname)","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-02T13:19:51.114787-08:00","created_by":"adam","updated_at":"2026-01-02T16:01:27.581045-08:00","closed_at":"2026-01-02T16:01:27.581045-08:00","close_reason":"Implemented in 14032eb"}
{"id":"fray-xfq","title":"P1.2: Chat reply-to with @#id","description":"Implement chat reply-to with prefix matching resolution.\n\nParse @#prefix from input:\n- Minimum 2 chars: @#a1, @#ab, @#a1b2\n- Full GUID works: @#msg-a1b2c3d4\n- Extract, resolve to GUID, strip from body\n\nResolution algorithm (src/core/guid-resolver.ts):\n1. Normalize: @#a1b2 → msg-a1b2 (add msg- prefix if missing)\n2. Query: SELECT guid FROM mm_messages WHERE guid LIKE 'msg-a1b2%' AND channel_id = ? ORDER BY created_at DESC LIMIT 5\n3. If 0 matches: Error \"No message found matching @#a1b2\"\n4. If 1 match: Use it\n5. If 2+ matches: Error \"Ambiguous reference @#a1b2. Did you mean:\\n  @#a1b2c3 (2m ago): preview...\\n  @#a1b2x9 (5m ago): preview...\"\n\nScoping:\n- Default: Current channel\n- Full GUID (msg-xxx): Works globally\n\nImplementation:\n- src/chat/input.ts: Parse @#prefix, call resolver\n- src/core/guid-resolver.ts (NEW): Resolution logic\n- Strip @#prefix from body before storing\n- Set reply_to field with full GUID\n\nReferences: PLAN.md section 8 (Prefix resolution)\nCritical files: src/chat/input.ts, src/core/guid-resolver.ts (NEW)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T11:57:25.648393-08:00","updated_at":"2025-12-19T22:57:34.299582-08:00","closed_at":"2025-12-19T15:15:59.011776-08:00","close_reason":"Added @# reply parsing with resolution/ambiguity handling in chat","dependencies":[{"issue_id":"fray-xfq","depends_on_id":"fray-3vp","type":"blocks","created_at":"2025-12-19T13:13:42.038924-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-xihp","title":"MVP: Add journal reflection step to /land protocol","description":"Add a step to the /land protocol inviting agents to write a journal entry before signing off. For MVP: write to llm/journals/{agentname}-{NNN}.md, use prompt from llm/prompts/journal.md. Keep it optional and lightweight - this is about reflection, not productivity. After writing their own entry, agents can optionally read past entries and add reactions.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-01T07:26:18.317283-08:00","created_by":"adam","updated_at":"2026-01-03T07:07:00.877346-08:00","dependencies":[{"issue_id":"fray-xihp","depends_on_id":"fray-0v2y","type":"blocks","created_at":"2026-01-02T13:03:53.759273-08:00","created_by":"adam"}]}
{"id":"fray-xju5","title":"Rename watermark to cursor in schema","description":"Current code uses 'mention_watermark' and 'fray_read_to'. Rename to cursor terminology for clarity:\n- mention_watermark → mention_cursor (or similar)\n- fray_read_to → fray_cursors (or fray_read_cursors)\n\nSchema migration required.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-03T01:01:25.378535-08:00","created_by":"adam","updated_at":"2026-01-03T01:01:25.378535-08:00"}
{"id":"fray-xpd","title":"Implement agent query functions","description":"Create query functions for agent CRUD operations in src/db/queries.ts.\n\n## Functions to Implement\n\n```typescript\n// src/db/queries.ts (agent functions)\n\nimport type { Agent } from '../types.js';\nimport type Database from 'better-sqlite3';\n\n/**\n * Get agent by exact ID.\n * @returns Agent or undefined if not found\n */\nexport function getAgent(db: Database, agentId: string): Agent | undefined;\n\n/**\n * Get agents matching a prefix.\n * Used for @mention resolution and \"bdm who\" command.\n * @example getAgentsByPrefix(db, \"alice\") -\u003e [alice.1, alice.419, alice.frontend.3]\n * @example getAgentsByPrefix(db, \"alice.frontend\") -\u003e [alice.frontend.1, alice.frontend.3]\n */\nexport function getAgentsByPrefix(db: Database, prefix: string): Agent[];\n\n/**\n * Create new agent.\n * @throws if agent_id already exists\n */\nexport function createAgent(db: Database, agent: Omit\u003cAgent, 'left_at'\u003e): void;\n\n/**\n * Update agent fields.\n * Only updates provided fields.\n */\nexport function updateAgent(\n  db: Database, \n  agentId: string, \n  updates: Partial\u003cPick\u003cAgent, 'goal' | 'bio' | 'last_seen' | 'left_at'\u003e\u003e\n): void;\n\n/**\n * Get active agents (not left, not stale).\n * @param staleHours - hours of inactivity before considered stale\n */\nexport function getActiveAgents(db: Database, staleHours: number): Agent[];\n\n/**\n * Get all agents including stale and left.\n */\nexport function getAllAgents(db: Database): Agent[];\n\n/**\n * Get highest version number for a base name.\n * Used by \"bdm new\" to auto-increment.\n * @example getMaxVersion(db, \"alice\") -\u003e 419 (if alice.419 exists)\n * @returns 0 if no agents with this base exist\n * \n * Implementation: Query for agent IDs matching pattern \"base.N\" where N is numeric.\n * SQL: SELECT agent_id FROM bdm_agents WHERE agent_id GLOB 'base.[0-9]*'\n * Then parse out the numeric suffix and return max.\n */\nexport function getMaxVersion(db: Database, base: string): number;\n```\n\n## Implementation Notes\n- Use prepared statements for better performance\n- Active = left_at IS NULL AND last_seen \u003e (now - stale_hours * 3600)\n- Prefix matching for getAgentsByPrefix: agent_id = prefix OR agent_id LIKE 'prefix.%'\n- For getMaxVersion, use GLOB pattern to match base.N format, then parse results in JS\n\n## SQL Examples\n\n```sql\n-- getActiveAgents\nSELECT * FROM bdm_agents \nWHERE left_at IS NULL \n  AND last_seen \u003e (strftime('%s', 'now') - ? * 3600)\n\n-- getAgentsByPrefix (prefix = \"alice\")\nSELECT * FROM bdm_agents\nWHERE agent_id = 'alice' OR agent_id LIKE 'alice.%'\n\n-- getMaxVersion (base = \"alice\")  \nSELECT agent_id FROM bdm_agents\nWHERE agent_id GLOB 'alice.[0-9]*'\n-- Then in JS: parse each to extract number, return max\n```\n\n## Files\n- src/db/queries.ts (add agent functions)\n\n## Acceptance Criteria\n- All functions work with real SQLite database\n- Prepared statements are used\n- Unit tests cover all functions\n- Edge cases: empty results, prefix matching, getMaxVersion with no matches","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T09:59:32.649203-08:00","updated_at":"2025-12-19T22:57:34.307458-08:00","closed_at":"2025-12-04T12:19:20.31674-08:00","dependencies":[{"issue_id":"fray-xpd","depends_on_id":"fray-08v","type":"parent-child","created_at":"2025-12-04T10:00:55.040278-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-xpd","depends_on_id":"fray-6cj","type":"blocks","created_at":"2025-12-04T10:01:28.420112-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-xpd","depends_on_id":"fray-1wj","type":"blocks","created_at":"2025-12-04T10:01:33.54775-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-xuil","title":"Chat: click-then-command pattern for slash commands","description":"When you click a message, its ID is added to the input (e.g., #msg-abc123).\n\nEnhancement: if you then type a slash command AFTER the ID, treat the clicked ID as the subject of the command.\n\nExample flow:\n1. Click message msg-abc123 → input becomes \"#msg-abc123 \"\n2. Type \"/mv meta\" → input is \"#msg-abc123 /mv meta\"\n3. On submit, interpret as: /mv #msg-abc123 meta\n\nThis allows:\n- \"/mv \u003cmsg-id\u003e \u003cthread\u003e\" (explicit)\n- Click message, then \"/mv \u003cthread\u003e\" (implicit subject from click)\n\nSame pattern could work for /edit, /delete, /pin, etc.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-06T13:54:51.210508-08:00","created_by":"adam","updated_at":"2026-01-06T17:22:59.428565-08:00","closed_at":"2026-01-06T17:22:59.428565-08:00","close_reason":"Implemented click-then-command pattern: #id /command args is rewritten to /command #id args"}
{"id":"fray-y1t","title":"Simplify message ID display and reply syntax","description":"1. Display message IDs as #id instead of @#id at end of messages\n2. Accept #id at start of message for threading (instead of @#id)\n3. If #id doesn't match any message, treat it as literal text (don't error, don't thread)","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-19T21:29:21.701749-08:00","updated_at":"2025-12-21T01:27:06.006767-08:00","closed_at":"2025-12-21T01:27:06.006767-08:00","close_reason":"Completed in Go rewrite"}
{"id":"fray-y590","title":"Increase message display limit to 3x current","description":"Increase the maximum message length returned by fray get.\n\n## Source Discussion\ncbcs-design thread (thrd-kw5z6vmu), msg-n2j96m9v.\n\n## Rationale\nCurrent truncation limit was set because of an edge case where an agent piped 2000-line verbose vitest output into a message. Most messages are nowhere near the limit.\n\nIncreasing to 3x the current limit is safe and reduces unnecessary truncation.\n\n## Implementation\nFind the current limit constant and multiply by 3. The '... (N more lines)' truncation message should still work for edge cases.","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-03T19:40:05.736231-08:00","created_by":"adam","updated_at":"2026-01-06T12:37:23.787247-08:00"}
{"id":"fray-y5za","title":"Add driver module interface","description":"Define Go interface for drivers (claude, codex, opencode).\n\n## Schema Reference (fray-7w5d)\n- InvokeConfig in `internal/types/types.go`: Driver, Config, PromptDelivery, timeouts\n- PromptDelivery enum: args, stdin, tempfile\n\n## Interface\n```go\ntype Driver interface {\n    Name() string\n    Spawn(ctx context.Context, agent types.Agent, prompt string) (*Process, error)\n    Cleanup(proc *Process) error\n}\n```\n\n## Drivers to Implement\n1. `claude` - Claude Code CLI, stdin prompt delivery\n2. `codex` - OpenAI Codex, args prompt delivery\n3. `opencode` - Open-source variant, tempfile prompt delivery\n\n## Config Access\nDriver-specific config via `agent.Invoke.Config` (map[string]any).\n\n## Exit Criteria\n- Driver interface defined in `internal/daemon/driver.go`\n- At least claude driver implemented\n- Driver selection based on `agent.Invoke.Driver`","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-01T23:14:36.495037-08:00","created_by":"adam","updated_at":"2026-01-02T01:19:16.5875-08:00","closed_at":"2026-01-02T01:19:16.5875-08:00","close_reason":"Implemented in internal/daemon/*.go. Passed 6 rounds of @gpt52 review (thrd-4oikeoie). Ready for commit.","dependencies":[{"issue_id":"fray-y5za","depends_on_id":"fray-7w5d","type":"blocks","created_at":"2026-01-01T23:19:16.652913-08:00","created_by":"adam"}]}
{"id":"fray-yaj8","title":"Answer display polish: Q/A bold white, question text in asker color","description":"In chat view answer messages: Q: and A: should be bold bright white. Question text should be colored with the asker's chat color (e.g., opus's color for questions opus asked).","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-31T17:47:13.405873-08:00","created_by":"adam","updated_at":"2025-12-31T17:47:13.405873-08:00"}
{"id":"fray-yh4","title":"Phase 4: CLI Commands","description":"Implement all CLI commands for bdm.\n\n## Goal\nComplete CLI implementation with all commands from the spec:\n- Lifecycle: new, hi, bye\n- Presence: here, who\n- Messages: (default), @mentions, post, --watch\n- Cross-project: link, unlink, projects\n- Config: config\n\n## Context\nCLI uses Commander.js for parsing. Each command is in a separate file under src/commands/.\nGlobal --project flag operates in linked project context.\n\nSee PLAN.md \"CLI Specification\" section for full command details.\n\n## Exit Criteria\n- All commands implemented per spec\n- `--help` works for all commands\n- Error messages are clear\n- Integration tests for key flows","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-04T10:07:42.21857-08:00","updated_at":"2025-12-19T22:57:34.296016-08:00","closed_at":"2025-12-04T12:38:13.18509-08:00","dependencies":[{"issue_id":"fray-yh4","depends_on_id":"fray-dk4","type":"blocks","created_at":"2025-12-04T10:11:24.845419-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-ypuj","title":"Daemon: set FRAY_AGENT_ID on session start","description":"Must set $FRAY_AGENT_ID environment variable when spawning agent sessions. Without this, agents can't use fray commands.","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-02T13:19:51.594051-08:00","created_by":"adam","updated_at":"2026-01-02T16:01:27.577067-08:00","closed_at":"2026-01-02T16:01:27.577067-08:00","close_reason":"Implemented in 14032eb"}
{"id":"fray-yug","title":"Implement consistent output formatting","description":"Create output formatting utilities for consistent CLI display.\n\n## Output Formatting Requirements\n\n### Message Format\n```\n[42] alice.419 (2m ago): figured out the auth issue, @bob.3 see auth.py:47\n```\nComponents:\n- `[id]` - message ID in brackets\n- `agent` - sender's full agent ID\n- `(time)` - relative time in parentheses\n- `:` - separator\n- `body` - message content\n\n### Agent List Format (bdm here)\n```\nalice.419    (2m ago)   \"implementing snake algorithm\"\nbob.3        (5m ago)   \"reviewing auth PR\"\n```\nComponents:\n- Agent ID padded to align\n- Relative time in parentheses\n- Goal in quotes\n\n### Agent Detail Format (bdm who)\n```\nalice.419\n  Goal: implementing snake algorithm\n  Bio:  claude-opus, patient problem solver\n  Registered: 2h ago\n  Last seen: 12m ago\n  Status: active\n```\n\n## Implementation\n\n```typescript\n// src/output/format.ts\n\nexport function formatMessage(msg: Message): string;\nexport function formatAgentRow(agent: Agent): string;\nexport function formatAgentDetail(agent: Agent): string;\nexport function formatConfig(entries: ConfigEntry[]): string;\n```\n\n## Color Support (Optional)\n- Respect NO_COLOR environment variable\n- Respect --no-color flag\n- Use chalk for colors if enabled:\n  - Agent IDs: cyan\n  - @mentions: cyan\n  - Time: dim\n  - Message ID: yellow\n\n```typescript\nimport chalk from 'chalk';\n\nconst noColor = process.env.NO_COLOR || options.noColor;\nconst c = noColor ? { cyan: (s) =\u003e s, dim: (s) =\u003e s } : chalk;\n```\n\n## Files\n- src/output/format.ts\n\n## Acceptance Criteria\n- All output is consistent across commands\n- Alignment is correct for lists\n- Colors respect NO_COLOR\n- Unit tests for formatters","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-04T10:12:42.197564-08:00","updated_at":"2025-12-19T22:57:34.302947-08:00","closed_at":"2025-12-04T12:44:20.721328-08:00","dependencies":[{"issue_id":"fray-yug","depends_on_id":"fray-po1","type":"parent-child","created_at":"2025-12-04T10:18:55.33398-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-yug","depends_on_id":"fray-6cj","type":"blocks","created_at":"2025-12-04T10:51:32.345977-08:00","created_by":"adam","metadata":"{}"},{"issue_id":"fray-yug","depends_on_id":"fray-8jo","type":"blocks","created_at":"2025-12-04T10:51:37.483929-08:00","created_by":"adam","metadata":"{}"}]}
{"id":"fray-yvi","title":"Add mm info and mm init --defaults","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-20T16:05:19.931693-08:00","updated_at":"2025-12-20T16:11:14.116241-08:00","closed_at":"2025-12-20T16:11:14.116241-08:00","close_reason":"Closed"}
{"id":"fray-yxgm","title":"Extract chat/colors.go from model.go","description":"Extract color management: buildColorMap(), colorForAgent(), sortByLastSeen(), contrastTextColor(), parseColorCode(), colorCodeToRGB(), agent color palette. ~100 lines. First extraction - lowest risk.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-01T00:07:01.322699-08:00","created_by":"adam","updated_at":"2026-01-01T00:11:12.279211-08:00","closed_at":"2026-01-01T00:11:12.279211-08:00","close_reason":"Extracted colors.go (139 lines). model.go 2966→2843. Commit 7043009"}
{"id":"fray-z1qg","title":"Feature: Semantic search via Ollama","description":"Add optional semantic search for messages/notes using Ollama embeddings.\n\n## Approach\n- Check if Ollama is running on startup (hit localhost:11434/api/tags)\n- If available, enable `fray search --semantic \"query\"`\n- Use nomic-embed-text model (1024 dims, good quality, ~270MB)\n- Store vectors in fray.db using pure Go vtab (modernc.org/sqlite/vtab)\n\n## Components\n1. Ollama client (simple HTTP, no deps)\n2. Vector storage virtual table (pure Go)\n3. Cosine similarity search (brute force fine at fray scale)\n4. Background indexing of messages on insert\n\n## Dynamic Help\n- `fray quickstart` shows semantic search section only if Ollama detected\n- `fray search --help` shows --semantic flag only if Ollama available\n- Avoids advertising features that won't work\n\n## UX\n- Graceful degradation: if no Ollama, semantic search unavailable\n- `fray status` shows whether semantic search is enabled\n- First run with Ollama may prompt to pull nomic-embed-text\n\n## Non-goals\n- Bundled ONNX runtime (too heavy)\n- API-based embeddings (cost, privacy)\n- Required dependency (stay optional)","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-02T00:49:54.511901-08:00","created_by":"adam","updated_at":"2026-01-02T00:58:18.307955-08:00"}
{"id":"fray-z3l","title":"P0.4: Channel GUID system","description":"Implement channel GUID system with project-level config.\n\nProject config (.mm/mm-config.json, COMMITTED to git):\n{\n  \"version\": 1,\n  \"channel_id\": \"ch-mmdev12\",\n  \"channel_name\": \"mm\",\n  \"created_at\": \"2025-12-19T10:00:00Z\",\n  \"known_agents\": {}\n}\n\nGlobal config (~/.config/mm/mm-config.json, per-machine):\n{\n  \"version\": 1,\n  \"channels\": {\n    \"ch-mmdev12\": {\"name\": \"mm\", \"path\": \"/Users/adam/dev/mini-msg\"}\n  },\n  \"current_channel\": \"ch-mmdev12\"\n}\n\nImplementation:\n- Add channel_id TEXT column to mm_messages table\n- Create .mm/mm-config.json on mm init (prompt for channel name, default: dirname)\n- Generate channel GUID (ch-\u003c8chars\u003e)\n- Register in ~/.config/mm/mm-config.json\n- Create src/core/config.ts for config file handling\n\nmm init flow:\n1. Prompt: \"Channel name? [dirname]:\"\n2. Generate ch-\u003cguid\u003e\n3. Write .mm/mm-config.json\n4. Register in ~/.config/mm/mm-config.json\n\nReferences: PLAN.md sections 3, 4\nCritical files: src/commands/init.ts, src/core/config.ts (NEW), src/db/schema.ts","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-19T11:57:09.724922-08:00","updated_at":"2025-12-19T22:57:34.292759-08:00","closed_at":"2025-12-19T14:23:59.619176-08:00","close_reason":"Added channel config/global registry, channel_id column, and init registration","dependencies":[{"issue_id":"fray-z3l","depends_on_id":"fray-7kr","type":"blocks","created_at":"2025-12-19T11:57:45.451847-08:00","created_by":"daemon","metadata":"{}"}]}
{"id":"fray-z996","title":"Migrate: detect and fix legacy thread naming patterns","description":"Enhance `fray migrate` to detect and fix legacy thread naming patterns.\n\n## Problem\nOld agents have `{agent}-notes` (hyphenated) threads. New hierarchy expects `{agent}/notes` (parent/child). Path-based commands like `fray get opus/notes` fail for old agents.\n\n## Affected Threads (current)\n- opus-notes → opus/notes\n- designer-notes → designer/notes  \n- architect-notes → architect/notes\n- dev-notes → dev/notes\n- reviewer-notes → reviewer/notes\n\n## Implementation\n1. Detect `{agent}-notes` pattern threads (where agent exists in fray_agents)\n2. For each:\n   - Create parent thread `{agent}` (type: knowledge) if doesn't exist\n   - Rename thread from `{agent}-notes` to `notes`\n   - Set parent_thread to the new `{agent}` thread GUID\n3. Output summary of changes\n4. List any manual cleanup needed (e.g., threads that couldn't be auto-migrated)\n\n## Also Consider\n- `{agent}-meta` → `{agent}/meta` pattern if exists\n- Dry-run mode (`--dry-run`) to preview changes\n- Idempotent (safe to run multiple times)\n\n## References\n- fray-adj6: Knowledge thread hierarchy (deferred migration)\n- fray-w6xh: Path-based commands\n- Design thread: mzg8-design","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T15:51:52.99962-08:00","created_by":"adam","updated_at":"2026-01-05T15:58:29.83135-08:00","closed_at":"2026-01-05T15:58:29.83135-08:00","close_reason":"Implemented auto-fix in migrate command. Detects {agent}-notes/meta/jrnl patterns, creates parent threads, renames children. Tested locally - migrated 12 threads successfully."}
{"id":"fray-zei","title":"Add 'fray answer' command for question review workflow","description":"Dedicated interface for users to review and answer questions one at a time.\n\n## Interface\n- Modal/blocking (like Claude Code's question UI)\n- One question at a time\n- Options with pros/cons (a. b. c. with nested - Pro/Con)\n- User can select option OR write custom answer\n\n## Accept/Close Flow\n- **Agent → User:** Requires explicit ACCEPT before truly closed\n  - Answer posted → 'has-answer'\n  - User reviews → 'accepted' or 'needs-revision'\n- **Agent → Agent:** Auto-close on READ by recipient\n  - Answer posted → 'has-answer'\n  - Recipient reads → auto-closed (acknowledgment)\n\n## Skip Flow\n- Skip = soft ignore for now\n- At END of answer session: 'Review X previously skipped questions?'\n- Does NOT show questions skipped THIS session\n\n## Order\n- Newest question set first\n- Questions shown in order listed in set\n- Then backward through older sets\n\n## Invocation\n- `fray answer` standalone\n- `/answer` in chat interface\n- `fray` leads into answer if questions pending (return = answer, any other key = exit)\n\nSee msg-ln1pevbd for original design, msg-qgromx1z for accept/close flow.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-31T14:42:26.672635-08:00","created_by":"adam","updated_at":"2025-12-31T16:00:33.498471-08:00","closed_at":"2025-12-31T16:00:33.498471-08:00","close_reason":"Implemented in commit 262ba1f. Core answer command working with interactive UI, option selection, skip flow. Follow-up work possible: accept/reject flow refinement, /answer chat integration, auto-trigger on fray.","dependencies":[{"issue_id":"fray-zei","depends_on_id":"fray-qnd","type":"blocks","created_at":"2025-12-31T14:42:43.991251-08:00","created_by":"adam"}]}
{"id":"fray-zgfd","title":"Feature: fray srv - web interface alternative to fray chat","description":"React frontend web interface for fray, using websocket or polling. Key design challenge is nested thread navigation. URL-based routing where path = location.","status":"open","priority":1,"issue_type":"feature","created_at":"2026-01-06T13:59:47.341957-08:00","created_by":"adam","updated_at":"2026-01-06T13:59:47.341957-08:00"}
{"id":"fray-zhkz","title":"Bug: humans registered via fray new should be able to post with --as","description":"From msg-103h1atz: adam (a registered human) tried to post with '--as adam' but got 'agent not found: @adam'. Humans registered via 'fray new' should be able to post. The agent/human distinction exists in the type field but the post command may not be looking it up correctly.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-06T11:58:05.528388-08:00","created_by":"adam","updated_at":"2026-01-06T12:06:01.465349-08:00","closed_at":"2026-01-06T12:06:01.465349-08:00","close_reason":"Fixed: humans registered via fray chat can now post with --as \u003cusername\u003e. Checks stored username config if agent not found, creates message with type=user."}
{"id":"fray-zuyb","title":"Archive: require children archived first or add --recursive flag","description":"When archiving a thread that has children:\n- Either require all children to be archived first (error if not)\n- Or add --recursive / -r flag to archive thread and all descendants\n\nCurrent behavior unclear - should prevent orphaned thread hierarchies.","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-06T14:09:02.789013-08:00","created_by":"adam","updated_at":"2026-01-06T14:09:02.789013-08:00"}
