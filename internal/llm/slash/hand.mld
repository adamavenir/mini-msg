import { @agent, @triggerMsgIDs } from @payload

exe @fray(args) = cmd { fray @args --json }
exe @safe(obj, field) = js { return (obj && obj[field]) || [] }
exe @at(name) = js { return "@" + name }

>> Get session context for hot handoff
var @notes = @fray(`get meta/@agent/notes`)
var @claimsData = @fray(`claims @$@agent`)
var @notesList = @safe(@notes, "messages")
var @claimsList = @safe(@claimsData, "claims")

var @prompt = `**@at(@agent)** - Hot handoff requested. Work continues immediately in fresh context.

## Trigger
Messages: @triggerMsgIDs

## Your Notes
/for @m in @notesList
- [@m.id] @m.body
/end

## Your Claims
/for @c in @claimsList
- @c.resource
/end

---
Hand off to fresh context (you KNOW the explicit next steps):

1. Post brief "handing off" message to room
2. Review session notes - ensure all balls land somewhere (beads, handoff, or delete)
3. Create beads for any discovered work: bd create "..." --type task
4. Update your notes thread in fray at meta/@agent/notes with EXPLICIT next steps (not suggestions - the assignment)
5. Commit code (your work only)
6. Update changelog if user-facing changes
7. Clear claims: fray clear @at(@agent)
8. Hand off: fray brb @agent "handing off to fresh context"`

show @prompt

export { @prompt }
