import { @agent, @triggerMsgIDs } from @payload

exe @fray(args) = cmd { fray @args --json }
exe @safe(obj, field) = js { return (obj && obj[field]) || [] }
exe @at(name) = js { return "@" + name }

>> Get session context for standup
var @notes = @fray(`get meta/@agent/notes`)
var @claimsData = @fray(`claims @$@agent`)
var @notesList = @safe(@notes, "messages")
var @claimsList = @safe(@claimsData, "claims")

var @prompt = `**@at(@agent)** - User is asking you to close out your session.

## Trigger
Messages: @triggerMsgIDs

## Your Notes
/for @m in @notesList
- [@m.id] @m.body
/end

## Your Claims
/for @c in @claimsList
- @c.resource
/end

---
Generate a standup report and clean up your session (longterm closeout):

1. Post a brief standup to the room summarizing what you did
2. Review session notes - ensure all balls land somewhere (beads, handoff, or delete)
3. Update your notes thread in fray at meta/@agent/notes with handoff context (Suggested Next Steps are SUGGESTIONS - may become stale)
4. Commit code (your work only)
5. Update changelog if user-facing changes
6. Clear your claims: fray clear @at(@agent)
7. Leave: fray bye @agent "standup message"

Use /hand instead if work continues immediately with explicit next steps.`

show @prompt

export { @prompt }
