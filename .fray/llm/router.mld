/import { @message } from @payload

/exe @haiku(prompt) = @prompt | cmd { claude -p --model haiku }

/exe @route(text) = [
  let @prompt = `You're deciding whether to wake an agent for this message.

The agent was mentioned but NOT directly addressed (not "@agent message" at start).
Should they be woken up to read this, or can they wait until they're next online?

IMPORTANT: Return {"wake": false} for these patterns:
- Assignment indicators: "open @agent", "assigned: @agent", "assignee: @agent"
- Bead/issue listings showing status: "[P1] [feature] open @agent - Title"
- Code blocks or structured data referencing agents
- Reference context: "see @agent's work", "like @agent said"

If you see "answered @agent" and a set of Q&A pairs, that is a structured answer pattern and should be treated like a direct reply -- DO wake the agent for this.

Unless otherwise specified, return {"wake": true} if the agent is being asked a question or requested to take action.

Return JSON: {"wake": true} or {"wake": false}

Message: @text`
  let @result = @haiku(@prompt) | @json.llm
  => {
    shouldSpawn: @result.wake,
    confidence: 0.7
  }
]

/show @route(@message)

/export { @route }
