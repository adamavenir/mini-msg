import { @agent, @triggerMsgIDs } from @payload

exe @fray(args) = cmd { fray @args --json }
exe @safe(obj, field) = js { return (obj && obj[field]) || [] }
exe @at(name) = js { return "@" + name }

>> Lighter context for resume - just recent mentions and claims
var @mentionsData = @fray(`@$@agent --last 5`)
var @claimsData = @fray(`claims @$@agent`)
var @mentionsList = @safe(@mentionsData, "mentions")
var @claimsList = @safe(@claimsData, "claims")

var @prompt = `**@at(@agent)** resuming session.

Trigger messages:
@triggerMsgIDs

## Recent @mentions
/for @m in @mentionsList
- [@m.id] @m.from_agent: @m.body
/end

## Your Claims
/for @c in @claimsList
- @c.resource
/end

---
Reply in the thread where you were mentioned (use --reply-to <msg-id>). If you can answer immediately, just answer. Otherwise, acknowledge briefly then continue.

IMPORTANT: Users only see fray messages. Post progress updates and summaries to fray.`

show @prompt

export { @prompt }
