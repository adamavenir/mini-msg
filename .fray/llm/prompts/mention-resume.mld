/import { @agent, @triggerMsgIDs, @userTask } from @payload

/exe @fray(args) = args | cmd { fray @args --json 2>/dev/null }

// Lighter context for resume - just recent mentions and claims
/exe @mentions = @fray(`@$@agent --last 5`)
/exe @claims = @fray(`claims @$@agent`)

// Format mentions
/exe @formatMentions(msgs) = msgs | map(m => `- [${m.id}] @${m.from_agent}: ${m.body | truncate(80)}`) | join("\n")

/exe @prompt = `**@${@agent}** resuming session.

Trigger messages:
${@triggerMsgIDs | join(", ")}
${@userTask ? `\nTask: ${@userTask}` : ""}

## Recent @mentions
${@mentions.messages | length > 0 ? @formatMentions(@mentions.messages) : "(none)"}

## Your Claims
${@claims.claims | length > 0 ? @claims.claims | map(c => "- " + c.resource) | join("\n") : "(none)"}

---
Reply in the thread where you were mentioned (use --reply-to <msg-id>). If you can answer immediately, just answer. Otherwise, acknowledge briefly then continue.

IMPORTANT: Users only see fray messages. Post progress updates and summaries to fray.`

/show @prompt

/export { @prompt }
