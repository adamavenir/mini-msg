/import { @agent, @triggerMsgIDs, @userTask } from @payload

/exe @fray(args) = args | cmd { fray @args --json 2>/dev/null }

// Minimal context for quick hop-in tasks
/exe @mentions = @fray(`@$@agent --last 3`)

// Format mentions
/exe @formatMentions(msgs) = msgs | map(m => `- [${m.id}] @${m.from_agent}: ${m.body | truncate(80)}`) | join("\n")

/exe @prompt = `**You are @${@agent}.** Quick hop-in task.

## Trigger
Messages: ${@triggerMsgIDs | join(", ")}
${@userTask ? `\nTask: ${@userTask}` : ""}

## Recent @mentions
${@mentions.messages | length > 0 ? @formatMentions(@mentions.messages) : "(none)"}

---
Complete this task efficiently. Run \`fray bye ${@agent}\` when done.

If you go idle without completing, you'll be auto-terminated.

IMPORTANT: Users only see fray messages. Post progress updates to fray.`

/show @prompt

/export { @prompt }
