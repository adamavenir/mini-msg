import { @agent, @triggerMsgIDs } from @payload

exe @fray(args) = cmd { fray @args --json }
exe @safe(obj, field) = js { return (obj && obj[field]) || [] }
exe @at(name) = js { return "@" + name }

>> Get session context for standup
var @notes = @fray(`get meta/@agent/notes --last 3`)
var @claimsData = @fray(`claims @$@agent`)
var @notesList = @safe(@notes, "messages")
var @claimsList = @safe(@claimsData, "claims")

var @prompt = `**@at(@agent)** - User is asking you to close out your session.

## Trigger
Messages: @triggerMsgIDs

## Your Notes
/for @m in @notesList
- [@m.id] @m.body
/end

## Your Claims
/for @c in @claimsList
- @c.resource
/end

---
Generate a standup report and clean up your session:

1. Post a brief standup to the room summarizing what you did
2. Update your notes with any handoff context for next session
3. Clear your claims: fray clear @at(@agent)
4. Leave: fray bye @agent "standup message"`

show @prompt

export { @prompt }
