---
id: f-818d
status: open
deps: [f-82d6]
links: []
created: 2026-01-25T11:08:12Z
type: task
priority: 2
assignee: Adam Avenir
parent: f-d1ae
---
# Phase 1: Split prune command into subcomponents

Split internal/command/prune.go by responsibility while preserving CLI behavior.

Suggested file layout:
- internal/command/prune_cmd.go: NewPruneCmd wiring + flags + top-level flow.
- internal/command/prune_targets.go: resolvePruneTarget, parsePruneProtectionOpts, pruneProtectionOpts types.
- internal/command/prune_exec.go: pruneMessages, pruneMessagesWithReaction, pruneResult.
- internal/command/prune_io.go: readJSONLLines, writeMessagesWithEvents, writeMessages, appendFile, createTombstone.
- internal/command/prune_helpers.go: collectRequiredMessageIDs, resolveFrayDir.
- internal/command/prune_guardrails.go: checkPruneGuardrails, runGitCommand.
- internal/command/prune_watermarks.go: fixStaleWatermarks.

Keep function signatures stable; no behavior changes.

## Acceptance Criteria

prune.go split into focused files; CLI behavior unchanged. go test ./internal/command passes. Commit with message like 'refactor(command): split prune command'.

