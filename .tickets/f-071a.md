---
id: f-071a
status: open
deps: [f-8924, f-8371]
links: []
created: 2026-01-25T05:33:18Z
type: task
priority: 2
assignee: Adam Avenir
parent: f-9a7e
---
# Phase 2: Split internal/db/jsonl_append.go by entity

Move append/write helpers into per-entity files with a shared writer helper.

Suggested files
- internal/db/jsonl_append_common.go: appendJSONLine, atomicAppend, shared path helpers.
- internal/db/jsonl_append_messages.go: AppendMessage, AppendMessageUpdate/Delete/Move/Pin/Unpin.
- internal/db/jsonl_append_threads.go: AppendThread*, subscription/unsubscription, thread pin/mute.
- internal/db/jsonl_append_agents.go: AppendAgent, AppendAgentUpdate, session events, presence, usage snapshots.
- internal/db/jsonl_append_questions.go: AppendQuestion, AppendQuestionUpdate.
- internal/db/jsonl_append_reactions.go: AppendReaction.
- internal/db/jsonl_append_roles.go: role events.
- internal/db/jsonl_append_permissions.go: permission request/update.
- internal/db/jsonl_append_wake.go: wake condition events.
- internal/db/jsonl_append_jobs.go: job events.
- internal/db/jsonl_append_misc.go: faves, ghost cursors, descriptors, etc.

Maintain existing APIs.

## Acceptance Criteria

Append file split by entity with a shared helper.
Tests: go test ./internal/db/...
Commit: refactor(db): split jsonl_append by entity

