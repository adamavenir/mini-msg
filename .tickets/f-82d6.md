---
id: f-82d6
status: open
deps: []
links: []
created: 2026-01-25T11:07:59Z
type: task
priority: 2
assignee: Adam Avenir
parent: f-d1ae
---
# Phase 1: Add tests for prune command

Add coverage for prune command logic before refactor.

Test targets (suggested):
- parsePruneProtectionOpts: defaults, --with flags, --without flags, mixed combos.
- resolvePruneTarget: main/room aliases, thread name/prefix resolution (uses temp DB + threads).
- pruneMessages: keeps N recent, respects protection flags, handles --before message, creates tombstones/history.
- pruneMessagesWithReaction: prunes only messages with reaction and preserves others.

Prefer temp project + sqlite + JSONL fixtures via existing db helpers; keep tests hermetic.

## Acceptance Criteria

New tests in internal/command (e.g., prune_test.go) covering protection parsing + prune behavior. go test ./internal/command -run Prune passes. Commit with message like 'test(command): add prune coverage'.

