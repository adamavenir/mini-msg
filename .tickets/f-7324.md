---
id: f-7324
status: open
deps: [f-6e39]
links: []
created: 2026-01-25T11:08:36Z
type: task
priority: 2
assignee: Adam Avenir
parent: f-d1ae
---
# Phase 3: Add tests for migrate command

Expand migration coverage before refactor.

Test targets (suggested):
- GUID generation: generateUniqueGUID returns unique values and respects used set.
- resolveReplyTo/resolveReplyString: correct mapping for legacy ID/GUID combos.
- loadAgents/loadMessages: handles missing guid/id columns (tableExists + getColumns path).
- read receipts: restoreReadReceipts maps IDs to GUIDs correctly.
- copyDir/copyFile: preserves contents and permissions for migration backup.

Build on existing internal/command/migrate_test.go with temp sqlite + fixtures.

## Acceptance Criteria

New/expanded tests in internal/command migrate suite cover legacy ID/GUID handling and receipt restore. go test ./internal/command -run Migrate passes. Commit with message like 'test(command): add migrate coverage'.

