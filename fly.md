---
name: fly
description: Start a new agent session with full context
allowed-tools: Bash, Read, Skill
---

# Session Start

Your name for this session: **$ARGUMENTS**

Use `--as $ARGUMENTS` and `@$ARGUMENTS` throughout.

## First: Learn the Tools

1. Invoke the `fray` skill for coordination patterns
2. Run `fray --help` or `tk help` if you need command reference

## Join and Get Your Assignment

```bash
fray new $ARGUMENTS              # or `fray back $ARGUMENTS` if rejoining
fray get meta/$ARGUMENTS/notes   # prior session handoffs
fray get meta                    # project-wide shared context
```

**Your notes contain your assignment.** Look for:
- **Current Priority** - this is your #1 focus until complete
- **Active Patterns** - ongoing workflows, review threads, processes to follow
- Specific docs to read, threads to review, or work to continue

**Follow the Current Priority.** Only deviate for:
- Blocking issues (something broken that prevents your assigned work)
- Direct questions from humans needing immediate response

**Check meta** (`fray get meta`) for project-wide context - it's the living CLAUDE.md, shared memory for all agents.

## Gather Additional Context

```bash
tk ready                   # unblocked tickets (for context, not reassignment)
fray @$ARGUMENTS           # mentions (FYI unless blocking/human question)
fray questions             # open questions you might answer
```

These inform your work but don't override your Current Priority.

## CRITICAL: Claim Files Before Editing

**You MUST claim files before editing them.** This prevents collision between agents working on the same files.

```bash
# Before editing ANY file:
fray claim @$ARGUMENTS --file <path>

# For glob patterns:
fray claim @$ARGUMENTS --file "src/auth/*.ts"

# Combined with status:
fray status @$ARGUMENTS "fixing auth" --file src/auth.ts
```

Check existing claims with `fray claims` before starting work. If another agent has claimed files you need, coordinate in fray before proceeding.

Claims auto-clear when you `fray bye`, or clear manually with `fray clear @$ARGUMENTS`.

## As You Work

- **Track work in tickets**: `tk update <id> --status in_progress` when starting a ticket
- **Close tickets when done**: `tk close <id> --reason "..."` with what you implemented
- **Create tickets for discovered work**: `tk create "..." --type task`

## Write Notes Throughout Your Session

**Use your notes as a scratch pad.** Whenever you learn something that would help someone else working in the same area, jot it down:

```bash
fray post meta/$ARGUMENTS/notes "Discovered: the auth flow requires..." --as $ARGUMENTS
```

Don't worry about perfection - you'll get a chance to review and clean these up at session end (/land or /hand). Think of them as breadcrumbs for yourself and future agents.

Good things to note:
- Gotchas and surprises you encountered
- Context that wasn't obvious from the code
- Decisions made and why
- Things you learned that aren't captured elsewhere

## Questions for User and Other Agents

Use structured question blocks in posts for decisions that need input:

```
## Questions for @<name>

1. First question
   a. Option A
      - Pro: benefit
      - Con: tradeoff
   b. Option B
      - Pro: benefit
      - Con: tradeoff

2. Second question (open-ended)
```

This creates a structured set of questions the user can answer interactively.

Answer questions with: `fray answer <question-id> "answer text" --as $ARGUMENTS`

## ID Convention: Always Use `#`

When referencing IDs in messages, **always prefix with `#`**:
- `#fray-abc123` - tickets
- `#msg-xyz789` - messages
- `#thrd-12345` - threads
- `#123` - github issue IDs

These become **bold+underlined** in chat and are **double-click to copy** (copies just the ID without `#`). This makes IDs scannable and actionable.

## Room & Thread Conventions

**Room is ONLY for:**
- Standup reports (generated by /land)
- Announcements (major completions, releases)
- Blocked notices (can't find something, stuck)

**Everything else goes in threads.** Don't dump reasoning to room - that's noise for humans.

**Thread naming:**
```
{issue-system}:{issue-id}-design     # design discussion
{issue-system}:{issue-id}-review     # code review
{issue-system}:{issue-id}-debug      # debugging session
```

Issue system: two-letter abbreviation (tk, gh). Examples: `tk:ab2f-review` `gh:134-design`

For epics: `{issue-system}:epic-{epic-id}-{name}/{feature-id}-{type}`

## Working in Threads

**Post to threads** for all substantive work:
```bash
fray post abc1-design "Exploring approach A..." --as $ARGUMENTS
```

All work should be tied to an issue and take place in a thread tied to that issue. If no issue/thread exists, create using conventions above.

**Reply to messages** to build conversation chains:
```bash
fray post --as $ARGUMENTS --reply-to msg-abc123 "Agreed, and also..."
```

**Surface conclusions to main room** only via standup reports during /land.

## Work Startup

When starting work on a ticket:
1. Ensure ticket exists (`tk show` or `tk create`)
2. Create thread if needed: `fray thread {ticket-id}-design "Anchor summary" --as $ARGUMENTS`
3. Post to thread, not room: `fray post {ticket-id}-design "..." --as $ARGUMENTS`
4. Don't @mention until action needed (avoids waking idle agents)

## Manage Your Tokens

Fray has full project history. Defaults are token efficient, but use `| grep` when searching past context.

You should have a **home thread** for your work, tied to an issue using our convention {issue-system}:{id}-{type}. Room is for standups and block notices only. All other work goes in threads. Use reply-to where possible so replies stay linked.
